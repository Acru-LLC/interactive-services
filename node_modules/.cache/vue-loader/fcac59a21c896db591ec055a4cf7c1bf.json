{"remainingRequest":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\src\\modules\\projects\\files.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\src\\modules\\projects\\files.vue","mtime":1667352074512},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1667355378280},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1667355379758},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1667355378280},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1667355356562}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgcHJvamVjdFNlcnZpY2UgZnJvbSAiQC9zaGFyZWQvc2VydmljZXMvcHJvamVjdFNlcnZpY2UiOw0KaW1wb3J0IHNpbXBsZWJhciBmcm9tICJzaW1wbGViYXItdnVlIjsNCmltcG9ydCB7Z2V0RmlsZVNpemUsIHJlcGxhY2VEYXRlfSBmcm9tICJAL2hlbHBlciI7DQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgcHJvcHM6IHsNCiAgICBwcm9qZWN0OiB7DQogICAgICB0eXBlOiBPYmplY3QsDQogICAgICBkZWZhdWx0OiAoKSA9PiB7DQogICAgICB9LA0KICAgIH0sDQogIH0sDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHBhcmFtczogew0KICAgICAgICBwYWdlOiAwLA0KICAgICAgICBpdGVtc1BlclBhZ2U6IDIwLA0KICAgICAgfSwNCiAgICAgIGZpbGVzOiBbXSwNCiAgICAgIGZpbGVQYWdlOiAwLA0KICAgICAgZ2V0RmlsZVNpemU6IGdldEZpbGVTaXplLA0KICAgICAgZmlsZVVwbG9hZFBhdGg6IG51bGwsDQogICAgICB2aWV3RmlsZU1vZGFsOiBmYWxzZSwNCiAgICAgIHJlcGxhY2VEYXRlOiByZXBsYWNlRGF0ZQ0KICAgIH07DQogIH0sDQogIGNvbXBvbmVudHM6IHsNCiAgICBzaW1wbGViYXIsDQogIH0sDQogIGNyZWF0ZWQoKSB7DQogICAgdGhpcy5saXN0RmlsZXMoKTsNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIHZpZXdGaWxlKHVwbG9hZFBhdGgpIHsNCiAgICAgIGlmICgNCiAgICAgICAgICB0aGlzLmdldEV4dCh1cGxvYWRQYXRoKSA9PSAiUERGIiB8fA0KICAgICAgICAgIHRoaXMuZ2V0RXh0KHVwbG9hZFBhdGgpID09ICJwZGYiDQogICAgICApIHsNCiAgICAgICAgdGhpcy5maWxlVXBsb2FkUGF0aCA9IHVwbG9hZFBhdGg7DQogICAgICAgIHRoaXMudmlld0ZpbGVNb2RhbCA9IHRydWU7DQogICAgICB9DQogICAgfSwNCiAgICBzYXZlRmlsZShtc2csIGZpbGUpIHsNCiAgICAgIHRoaXMubGVhdmVGaWxlKG1zZywgZmlsZSk7DQogICAgfSwNCiAgICBjbGlja1VwbG9hZCgpIHsNCiAgICAgIHRoaXMuJHJlZnMuZmlsZS51cGxkKCk7DQogICAgfSwNCiAgICBsZWF2ZUZpbGUobXNnLCBjbXQpIHsNCiAgICAgIGxldCBpZCA9IHRoaXMuJHJvdXRlLnF1ZXJ5LmlkOw0KICAgICAgaWYgKGlkKSB7DQogICAgICAgIHByb2plY3RTZXJ2aWNlDQogICAgICAgICAgICAubGVhdmVGaWxlKGlkLCBtc2csIGNtdCkNCiAgICAgICAgICAgIC50aGVuKChycykgPT4gew0KICAgICAgICAgICAgICB0aGlzLmZpbGUgPSBudWxsOw0KICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgICAgICB0aGlzLmxpc3RGaWxlcygpOw0KICAgICAgICAgICAgICB9LCAzMDApOw0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7DQogICAgICAgICAgICAgIC8vIHRoaXMuY2F0Y2hFcnIoZXJyKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGxpc3RGaWxlcygpIHsNCiAgICAgIGxldCBpZCA9IHRoaXMuJHJvdXRlLnF1ZXJ5LmlkOw0KICAgICAgaWYgKGlkKSB7DQogICAgICAgIHByb2plY3RTZXJ2aWNlDQogICAgICAgICAgICAubGlzdEZpbGVzKGlkLCB0aGlzLnBhcmFtcykNCiAgICAgICAgICAgIC50aGVuKChycykgPT4gew0KICAgICAgICAgICAgICB0aGlzLmZpbGVzID0gcnMuZGF0YS5saXN0Ow0KICAgICAgICAgICAgICB0aGlzLmhhbmRsZVNjcm9sbCgpOw0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7DQogICAgICAgICAgICAgIC8vIHRoaXMuY2F0Y2hFcnIoZXJyKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGxvYWRNb3JlRmlsZXMocGFnZSkgew0KICAgICAgbGV0IGlkID0gdGhpcy4kcm91dGUucXVlcnkuaWQ7DQogICAgICBpZiAoaWQpIHsNCiAgICAgICAgcHJvamVjdFNlcnZpY2UNCiAgICAgICAgICAgIC5saXN0RmlsZXMoaWQsIHsNCiAgICAgICAgICAgICAgcGFnZTogcGFnZSwNCiAgICAgICAgICAgICAgaXRlbXNQZXJQYWdlOiAyMCwNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICAudGhlbihhc3luYyAoe2RhdGF9KSA9PiB7DQogICAgICAgICAgICAgIGlmIChkYXRhLmxpc3QubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgIHRoaXMuZmlsZXMgPSB0aGlzLmZpbGVzLmNvbmNhdChkYXRhLmxpc3QpOw0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHRoaXMuZmlsZVBhZ2UgKyAtMTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oLTEpOw0KICAgICAgfQ0KICAgIH0sDQogICAgaGFuZGxlU2Nyb2xsKCkgew0KICAgICAgaWYgKHRoaXMuJHJlZnMuZmlsZXNSZWYuJGVsKSB7DQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgIHRoaXMuJHJlZnMuZmlsZXNSZWYuU2ltcGxlQmFyLmdldFNjcm9sbEVsZW1lbnQoKS5zY3JvbGxUb3AgPSAwOw0KICAgICAgICB9LCA1MDApOw0KICAgICAgfQ0KICAgIH0sDQogIH0sDQogIG1vdW50ZWQoKSB7DQogICAgdmFyIGNvbnRhaW5lcjMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKA0KICAgICAgICAiI2ZpbGUtbGlzdCAuc2ltcGxlYmFyLWNvbnRlbnQtd3JhcHBlciINCiAgICApOw0KICAgIGlmIChjb250YWluZXIzKSB7DQogICAgICBjb250YWluZXIzLnNjcm9sbFRvKHt0b3A6IDUwMCwgYmVoYXZpb3I6ICJzbW9vdGgifSk7DQogICAgfQ0KICAgIC8vIENvbnRhY3QgbGlzdCBhY3Rpb25zDQogICAgdGhpcy4kcmVmcy5maWxlc1JlZi5TaW1wbGVCYXIuZ2V0U2Nyb2xsRWxlbWVudCgpLmFkZEV2ZW50TGlzdGVuZXIoDQogICAgICAgICJzY3JvbGwiLA0KICAgICAgICAoZSkgPT4gew0KICAgICAgICAgIGxldCB7c2Nyb2xsVG9wLCBzY3JvbGxIZWlnaHQsIGNsaWVudEhlaWdodH0gPSBldmVudC50YXJnZXQ7DQogICAgICAgICAgY29uc3Qgb2Zmc2V0Rm9yVHJpZ2dlciA9IDE7DQogICAgICAgICAgaWYgKHNjcm9sbEhlaWdodCAtIGNsaWVudEhlaWdodCAtIG9mZnNldEZvclRyaWdnZXIgPCBzY3JvbGxUb3ApIHsNCiAgICAgICAgICAgIHRoaXMubG9hZE1vcmVGaWxlcygodGhpcy5maWxlUGFnZSArPSAxKSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgKTsNCiAgfSwNCn07DQo="},{"version":3,"sources":["files.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyHA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"files.vue","sourceRoot":"src/modules/projects","sourcesContent":["<template>\r\n  <div class=\"card\">\r\n    <div class=\"card-body\">\r\n      <h4 class=\"card-title mb-4\">{{ $t(\"attached_files\") }}</h4>\r\n      <simplebar\r\n          id=\"file-list\"\r\n          ref=\"filesRef\"\r\n          style=\"height: 384px\"\r\n      >\r\n        <div class=\"table-responsive mb-0\">\r\n          <table\r\n              class=\"table table-centered table-hover\"\r\n              style=\"table-layout: fixed; width: 100%\"\r\n          >\r\n            <tbody>\r\n            <tr\r\n                v-for=\"(file, index) in files\"\r\n                :key=\"index\"\r\n            >\r\n              <td style=\"width: 53px\">\r\n                <div>\r\n                  <a\r\n                      :download=\"getExt(file.uploadPath) === 'pdf' ? false : file.uploadPath\"\r\n                      :href=\"getExt(file.uploadPath) === 'pdf' ? `#` : `${baseUrl}/${file.uploadPath}`\"\r\n                      @click=\"viewFile(file.uploadPath)\"\r\n                  >\r\n                    <FileView\r\n                        :uploadPath=\"file.uploadPath\"\r\n                        class=\"my-card-hovered\"\r\n                    />\r\n                    <small class=\"text-center\">{{ getFileSize(parseFloat(file.fileSize)) }}</small>\r\n                  </a>\r\n                </div>\r\n              </td>\r\n              <td style=\"width: 60%\">\r\n                <h5 class=\"font-size-14 m-0\">\r\n                  <p class=\"text-dark m-0\">{{ file.fileName }}</p>\r\n                </h5>\r\n                <p class=\"text-muted mb-0 font-size-10\">\r\n                  <i class=\"bx bx-calendar mr-1 text-primary\"></i>\r\n                  {{ replaceDate(file.date) ? replaceDate(file.date).daym_shortyyyy_hm() : '' }}\r\n                </p>\r\n                <small class=\"d-block text-muted\">{{\r\n                    `${file.ownerLastName} ${file.ownerFirstName} ${file.ownerParentName ? file.ownerParentName : ''}`\r\n                  }}</small>\r\n                <small class=\"d-block\">{{\r\n                    file.comment\r\n                  }}</small>\r\n\r\n              </td>\r\n              <td style=\"width: 45px\">\r\n                <div class=\"text-center\">\r\n                  <a\r\n                      :download=\"`${file.fileName}`\"\r\n                      :href=\"`${baseUrl}/${file.uploadPath}`\"\r\n                      class=\"text-dark\"\r\n                  >\r\n                    <i class=\"bx bx-download h3 m-0\"></i>\r\n                  </a>\r\n                </div>\r\n              </td>\r\n            </tr>\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </simplebar>\r\n    </div>\r\n    <!-- for view file -->\r\n    <b-modal\r\n        v-model=\"viewFileModal\"\r\n        :title=\"$t('actions.view')\"\r\n        scrollable\r\n        size=\"xl\"\r\n    >\r\n      <div\r\n          v-if=\"fileUploadPath\"\r\n          style=\"height: 700px\"\r\n      >\r\n        <embed\r\n            :src=\"`${baseUrl}/${fileUploadPath}`\"\r\n            height=\"800\"\r\n            type=\"application/pdf\"\r\n            width=\"100%\"\r\n        />\r\n      </div>\r\n      <template v-slot:modal-footer>\r\n        <b-button\r\n            variant=\"secondary\"\r\n            @click=\"viewFileModal = false\"\r\n        >{{\r\n            $t(\"actions.close\")\r\n          }}\r\n        </b-button>\r\n      </template>\r\n    </b-modal>\r\n    <div\r\n        v-if=\"project.status != 'FINISHED'\"\r\n        class=\"p-3\"\r\n    >\r\n      <form>\r\n        <div>\r\n          <b-button\r\n              block\r\n              variant=\"primary\"\r\n              @click.prevent=\"clickUpload\"\r\n          >\r\n            <i class=\"mdi mdi-upload d-block font-size-16\"></i>\r\n            {{ $t(\"actions.upload\") }}\r\n          </b-button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n    <upload-file\r\n        ref=\"file\"\r\n        :cmt=\"true\"\r\n        @sendFile=\"saveFile\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport projectService from \"@/shared/services/projectService\";\r\nimport simplebar from \"simplebar-vue\";\r\nimport {getFileSize, replaceDate} from \"@/helper\";\r\n\r\nexport default {\r\n  props: {\r\n    project: {\r\n      type: Object,\r\n      default: () => {\r\n      },\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      params: {\r\n        page: 0,\r\n        itemsPerPage: 20,\r\n      },\r\n      files: [],\r\n      filePage: 0,\r\n      getFileSize: getFileSize,\r\n      fileUploadPath: null,\r\n      viewFileModal: false,\r\n      replaceDate: replaceDate\r\n    };\r\n  },\r\n  components: {\r\n    simplebar,\r\n  },\r\n  created() {\r\n    this.listFiles();\r\n  },\r\n  methods: {\r\n    viewFile(uploadPath) {\r\n      if (\r\n          this.getExt(uploadPath) == \"PDF\" ||\r\n          this.getExt(uploadPath) == \"pdf\"\r\n      ) {\r\n        this.fileUploadPath = uploadPath;\r\n        this.viewFileModal = true;\r\n      }\r\n    },\r\n    saveFile(msg, file) {\r\n      this.leaveFile(msg, file);\r\n    },\r\n    clickUpload() {\r\n      this.$refs.file.upld();\r\n    },\r\n    leaveFile(msg, cmt) {\r\n      let id = this.$route.query.id;\r\n      if (id) {\r\n        projectService\r\n            .leaveFile(id, msg, cmt)\r\n            .then((rs) => {\r\n              this.file = null;\r\n              setTimeout(() => {\r\n                this.listFiles();\r\n              }, 300);\r\n            })\r\n            .catch((err) => {\r\n              // this.catchErr(err);\r\n            });\r\n      } else {\r\n        this.$router.go(-1);\r\n      }\r\n    },\r\n    listFiles() {\r\n      let id = this.$route.query.id;\r\n      if (id) {\r\n        projectService\r\n            .listFiles(id, this.params)\r\n            .then((rs) => {\r\n              this.files = rs.data.list;\r\n              this.handleScroll();\r\n            })\r\n            .catch((err) => {\r\n              // this.catchErr(err);\r\n            });\r\n      } else {\r\n        this.$router.go(-1);\r\n      }\r\n    },\r\n    loadMoreFiles(page) {\r\n      let id = this.$route.query.id;\r\n      if (id) {\r\n        projectService\r\n            .listFiles(id, {\r\n              page: page,\r\n              itemsPerPage: 20,\r\n            })\r\n            .then(async ({data}) => {\r\n              if (data.list.length > 0) {\r\n                this.files = this.files.concat(data.list);\r\n              } else {\r\n                this.filePage + -1;\r\n              }\r\n            });\r\n      } else {\r\n        this.$router.go(-1);\r\n      }\r\n    },\r\n    handleScroll() {\r\n      if (this.$refs.filesRef.$el) {\r\n        setTimeout(() => {\r\n          this.$refs.filesRef.SimpleBar.getScrollElement().scrollTop = 0;\r\n        }, 500);\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n    var container3 = document.querySelector(\r\n        \"#file-list .simplebar-content-wrapper\"\r\n    );\r\n    if (container3) {\r\n      container3.scrollTo({top: 500, behavior: \"smooth\"});\r\n    }\r\n    // Contact list actions\r\n    this.$refs.filesRef.SimpleBar.getScrollElement().addEventListener(\r\n        \"scroll\",\r\n        (e) => {\r\n          let {scrollTop, scrollHeight, clientHeight} = event.target;\r\n          const offsetForTrigger = 1;\r\n          if (scrollHeight - clientHeight - offsetForTrigger < scrollTop) {\r\n            this.loadMoreFiles((this.filePage += 1));\r\n          }\r\n        }\r\n    );\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n</style>"]}]}