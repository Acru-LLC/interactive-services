{"remainingRequest":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\src\\modules\\projects\\comments.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\src\\modules\\projects\\comments.vue","mtime":1674799497703},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1667355378280},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1675061970665},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1667355378280},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1675061970715}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgcHJvamVjdFNlcnZpY2UgZnJvbSAiQC9zaGFyZWQvc2VydmljZXMvcHJvamVjdFNlcnZpY2UiOw0KaW1wb3J0IHNpbXBsZWJhciBmcm9tICJzaW1wbGViYXItdnVlIjsNCmltcG9ydCB7IHJlcGxhY2VEYXRlIH0gZnJvbSAiQC9oZWxwZXIiOw0KZXhwb3J0IGRlZmF1bHQgew0KICBwcm9wczogWyJoZWlnaHQiLCAicHJvamVjdCJdLA0KICB3YXRjaDogew0KICAgIGZpbGU6IHsNCiAgICAgIGhhbmRsZXIodikgew0KICAgICAgICBpZiAodikgew0KICAgICAgICAgIHRoaXMuZmlsZU1vZGFsID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICB9LA0KICB9LA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICByZXBsYWNlRGF0ZTogcmVwbGFjZURhdGUsDQogICAgICBmaWxlTW9kYWw6IGZhbHNlLA0KICAgICAgY29tbWVudDogIiIsDQogICAgICBmaWxlOiBudWxsLA0KICAgICAgcGFyYW1zOiB7DQogICAgICAgIHBhZ2U6IDAsDQogICAgICAgIGl0ZW1zUGVyUGFnZTogMjAsDQogICAgICB9LA0KICAgICAgY29tbWVudHM6IFtdLA0KICAgICAgY29tbWVudFBhZ2U6IDAsDQogICAgICBsb2FkZXJDbXQ6IGZhbHNlLA0KICAgIH07DQogIH0sDQogIGNvbXBvbmVudHM6IHsNCiAgICBzaW1wbGViYXIsDQogIH0sDQogIGNyZWF0ZWQoKSB7DQogICAgdGhpcy5saXN0Q29tbWVudHMoKTsNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIHNlbmRGaWxlKG1lc3NhZ2UsIGZpbGUpIHsNCiAgICAgIHRoaXMubGVhdmVDb21tZW50KG1lc3NhZ2UsIGZpbGUpOw0KICAgICAgdGhpcy5maWxlTW9kYWwgPSBmYWxzZTsNCiAgICAgIHRoaXMuZmlsZSA9IG51bGw7DQogICAgfSwNCiAgICBjbGlja1VwbG9hZCgpIHsNCiAgICAgIHRoaXMuJHJlZnMuZmlsZS51cGxkKCk7DQogICAgfSwNCiAgICBsZWF2ZUNvbW1lbnQoY210LCBmaWxlKSB7DQogICAgICBsZXQgaWQgPSB0aGlzLiRyb3V0ZS5xdWVyeS5pZDsNCiAgICAgIGlmIChpZCkgew0KICAgICAgICB0aGlzLmxvYWRlckNtdCA9IHRydWU7DQogICAgICAgIHByb2plY3RTZXJ2aWNlDQogICAgICAgICAgLmxlYXZlQ29tbWVudChpZCwgY210LCBmaWxlKQ0KICAgICAgICAgIC50aGVuKChycykgPT4gew0KICAgICAgICAgICAgdGhpcy5jb21tZW50ID0gIiI7DQogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgICAgdGhpcy5saXN0Q29tbWVudHMoKTsNCiAgICAgICAgICAgIH0sIDMwMCk7DQogICAgICAgICAgfSkNCiAgICAgICAgICAuY2F0Y2goKGVycikgPT4gew0KICAgICAgICAgICAgLy8gdGhpcy5jYXRjaEVycihlcnIpOw0KICAgICAgICAgIH0pDQogICAgICAgICAgLmZpbmFsbHkoKCkgPT4gew0KICAgICAgICAgICAgdGhpcy5sb2FkZXJDbXQgPSBmYWxzZTsNCiAgICAgICAgICB9KTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuJHJvdXRlci5nbygtMSk7DQogICAgICB9DQogICAgfSwNCiAgICBsaXN0Q29tbWVudHMoKSB7DQogICAgICBsZXQgaWQgPSB0aGlzLiRyb3V0ZS5xdWVyeS5pZDsNCiAgICAgIGlmIChpZCkgew0KICAgICAgICBwcm9qZWN0U2VydmljZQ0KICAgICAgICAgIC5saXN0Q29tbWVudHMoaWQsIHRoaXMucGFyYW1zLCB0cnVlKQ0KICAgICAgICAgIC50aGVuKChycykgPT4gew0KICAgICAgICAgICAgdGhpcy5jb21tZW50cyA9IHJzLmRhdGEubGlzdDsNCiAgICAgICAgICAgIHRoaXMuaGFuZGxlU2Nyb2xsKCk7DQogICAgICAgICAgfSkNCiAgICAgICAgICAuY2F0Y2goKGVycikgPT4gew0KICAgICAgICAgICAgLy8gdGhpcy5jYXRjaEVycihlcnIpOw0KICAgICAgICAgIH0pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGxvYWRNb3JlQ29tbWVudHMocGFnZSkgew0KICAgICAgbGV0IGlkID0gdGhpcy4kcm91dGUucXVlcnkuaWQ7DQogICAgICBpZiAoaWQpIHsNCiAgICAgICAgcHJvamVjdFNlcnZpY2UNCiAgICAgICAgICAubGlzdENvbW1lbnRzKGlkLCB7DQogICAgICAgICAgICBwYWdlOiBwYWdlLA0KICAgICAgICAgICAgaXRlbXNQZXJQYWdlOiAyMCwNCiAgICAgICAgICB9KQ0KICAgICAgICAgIC50aGVuKGFzeW5jICh7IGRhdGEgfSkgPT4gew0KICAgICAgICAgICAgaWYgKGRhdGEubGlzdC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgIHRoaXMuY29tbWVudHMgPSB0aGlzLmNvbW1lbnRzLmNvbmNhdChkYXRhLmxpc3QpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgdGhpcy5jb21tZW50UGFnZSArIC0xOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pDQogICAgICAgICAgLmNhdGNoKChlcnIpID0+IHsNCiAgICAgICAgICAgIC8vIHRoaXMuY2F0Y2hFcnIoZXJyKTsNCiAgICAgICAgICB9KTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuJHJvdXRlci5nbygtMSk7DQogICAgICB9DQogICAgfSwNCiAgICBoYW5kbGVTY3JvbGwoKSB7DQogICAgICBpZiAodGhpcy4kcmVmcy5jb21tZW50c1JlZi4kZWwpIHsNCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgdGhpcy4kcmVmcy5jb21tZW50c1JlZi5TaW1wbGVCYXIuZ2V0U2Nyb2xsRWxlbWVudCgpLnNjcm9sbFRvcCA9IDA7DQogICAgICAgIH0sIDUwMCk7DQogICAgICB9DQogICAgfSwNCiAgfSwNCiAgbW91bnRlZCgpIHsNCiAgICB2YXIgY29udGFpbmVyMyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoDQogICAgICAiI2NvbW1lbnQtbGlzdCAuc2ltcGxlYmFyLWNvbnRlbnQtd3JhcHBlciINCiAgICApOw0KICAgIGlmIChjb250YWluZXIzKSB7DQogICAgICBjb250YWluZXIzLnNjcm9sbFRvKHsgdG9wOiA1MDAsIGJlaGF2aW9yOiAic21vb3RoIiB9KTsNCiAgICB9DQogICAgLy8gQ29udGFjdCBsaXN0IGFjdGlvbnMNCiAgICB0aGlzLiRyZWZzLmNvbW1lbnRzUmVmLlNpbXBsZUJhci5nZXRTY3JvbGxFbGVtZW50KCkuYWRkRXZlbnRMaXN0ZW5lcigNCiAgICAgICJzY3JvbGwiLA0KICAgICAgKGUpID0+IHsNCiAgICAgICAgbGV0IHsgc2Nyb2xsVG9wLCBzY3JvbGxIZWlnaHQsIGNsaWVudEhlaWdodCB9ID0gZXZlbnQudGFyZ2V0Ow0KICAgICAgICBjb25zdCBvZmZzZXRGb3JUcmlnZ2VyID0gMTsNCiAgICAgICAgaWYgKHNjcm9sbEhlaWdodCAtIGNsaWVudEhlaWdodCAtIG9mZnNldEZvclRyaWdnZXIgPCBzY3JvbGxUb3ApIHsNCiAgICAgICAgICB0aGlzLmxvYWRNb3JlQ29tbWVudHMoKHRoaXMuY29tbWVudFBhZ2UgKz0gMSkpOw0KICAgICAgICB9DQogICAgICB9DQogICAgKTsNCiAgfSwNCn07DQo="},{"version":3,"sources":["comments.vue"],"names":[],"mappings":";AA2GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"comments.vue","sourceRoot":"src/modules/projects","sourcesContent":["<template>\r\n  <div class=\"card\">\r\n    <div class=\"card-body\">\r\n      <h4 class=\"card-title mb-4\">{{ $t(\"cmts\") }}</h4>\r\n      <simplebar\r\n        :style=\"height ? 'height:330px' : 'height: 330px'\"\r\n        id=\"comment-list\"\r\n        ref=\"commentsRef\"\r\n      >\r\n        <div class=\"media mb-4\" v-for=\"(cmt, index) in comments\" :key=\"index\">\r\n          <div class=\"mr-3\">\r\n            <img\r\n              v-if=\"cmt.employeeUploadPath\"\r\n              class=\"media-object rounded-circle avatar-xs\"\r\n              alt\r\n              :src=\"`${hrUrl}/${cmt.employeeUploadPath}`\"\r\n            />\r\n            <div v-else class=\"avatar-xs mr-3\">\r\n              <span\r\n                class=\"\r\n                  avatar-title\r\n                  rounded-circle\r\n                  bg-soft-primary\r\n                  text-primary\r\n                  font-size-16\r\n                \"\r\n              >\r\n                {{\r\n                  `${cmt.ownerLastName.charAt(0)}${cmt.ownerFirstName.charAt(\r\n                    0\r\n                  )}`\r\n                }}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div class=\"media-body\">\r\n            <h5 class=\"font-size-13 font-weight-bold mb-1\">\r\n              {{\r\n                `${cmt.ownerLastName} ${cmt.ownerFirstName} ${cmt.ownerMiddleName}`\r\n              }}\r\n            </h5>\r\n            <div v-if=\"cmt.uploadPath\">\r\n              <p class=\"mb-1 d-flex align-items-center\">\r\n                <a\r\n                  :href=\"`${baseUrl}/${cmt.uploadPath}`\"\r\n                  :download=\"`file.${cmt.fileExtension}`\"\r\n                  class=\"fa fas fa-arrow-alt-circle-down text-primary\"\r\n                  style=\"font-size: 35px\"\r\n                ></a>\r\n                <span class=\"ml-2\">{{ cmt.fileName }}</span>\r\n              </p>\r\n            </div>\r\n\r\n            <p class=\"mb-1\" style=\"word-break: break-all !important\">\r\n              {{ cmt.comment }}\r\n            </p>\r\n            <p class=\"text-muted mb-0 font-size-10\">\r\n              <i class=\"bx bx-calendar mr-1 text-primary\"></i>\r\n              {{ replaceDate(cmt.date).daym_shortyyyy_hm() }}\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </simplebar>\r\n    </div>\r\n\r\n    <div class=\"pl-3 pr-3 pt-3\">\r\n      <form v-if=\"project && project.status != 'FINISHED'\">\r\n        <div class=\"form-group m-0\" style=\"position: relative\">\r\n          <textarea\r\n            style=\"resize: none\"\r\n            @keyup.enter=\"leaveComment(comment)\"\r\n            v-model=\"comment\"\r\n            class=\"form-control\"\r\n            id=\"commentmessage-input\"\r\n            :placeholder=\"$t('writeCmt')\"\r\n            rows=\"3\"\r\n          ></textarea>\r\n          <b-button\r\n            variant=\"white\"\r\n            class=\"iconUpload\"\r\n            @click.prevent=\"clickUpload\"\r\n            style=\"padding: 1px\"\r\n            size=\"sm\"\r\n          >\r\n            <i class=\"bx bxs-file-doc text-primary font-size-20\"></i>\r\n          </b-button>\r\n        </div>\r\n\r\n        <b-button\r\n          @click=\"leaveComment(comment)\"\r\n          class=\"mt-1 float-right mb-3\"\r\n          variant=\"primary\"\r\n        >\r\n          <b-overlay :show=\"loaderCmt\" rounded=\"sm\" opacity=\"0.1\">\r\n            {{ $t(\"actions.send\") }}\r\n\r\n            <i class=\"bx bx-send\"></i>\r\n          </b-overlay>\r\n        </b-button>\r\n      </form>\r\n\r\n      <upload-file :cmt=\"true\" ref=\"file\" @sendFile=\"sendFile\" />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport projectService from \"@/shared/services/projectService\";\r\nimport simplebar from \"simplebar-vue\";\r\nimport { replaceDate } from \"@/helper\";\r\nexport default {\r\n  props: [\"height\", \"project\"],\r\n  watch: {\r\n    file: {\r\n      handler(v) {\r\n        if (v) {\r\n          this.fileModal = true;\r\n        }\r\n      },\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      replaceDate: replaceDate,\r\n      fileModal: false,\r\n      comment: \"\",\r\n      file: null,\r\n      params: {\r\n        page: 0,\r\n        itemsPerPage: 20,\r\n      },\r\n      comments: [],\r\n      commentPage: 0,\r\n      loaderCmt: false,\r\n    };\r\n  },\r\n  components: {\r\n    simplebar,\r\n  },\r\n  created() {\r\n    this.listComments();\r\n  },\r\n  methods: {\r\n    sendFile(message, file) {\r\n      this.leaveComment(message, file);\r\n      this.fileModal = false;\r\n      this.file = null;\r\n    },\r\n    clickUpload() {\r\n      this.$refs.file.upld();\r\n    },\r\n    leaveComment(cmt, file) {\r\n      let id = this.$route.query.id;\r\n      if (id) {\r\n        this.loaderCmt = true;\r\n        projectService\r\n          .leaveComment(id, cmt, file)\r\n          .then((rs) => {\r\n            this.comment = \"\";\r\n            setTimeout(() => {\r\n              this.listComments();\r\n            }, 300);\r\n          })\r\n          .catch((err) => {\r\n            // this.catchErr(err);\r\n          })\r\n          .finally(() => {\r\n            this.loaderCmt = false;\r\n          });\r\n      } else {\r\n        this.$router.go(-1);\r\n      }\r\n    },\r\n    listComments() {\r\n      let id = this.$route.query.id;\r\n      if (id) {\r\n        projectService\r\n          .listComments(id, this.params, true)\r\n          .then((rs) => {\r\n            this.comments = rs.data.list;\r\n            this.handleScroll();\r\n          })\r\n          .catch((err) => {\r\n            // this.catchErr(err);\r\n          });\r\n      } else {\r\n        this.$router.go(-1);\r\n      }\r\n    },\r\n    loadMoreComments(page) {\r\n      let id = this.$route.query.id;\r\n      if (id) {\r\n        projectService\r\n          .listComments(id, {\r\n            page: page,\r\n            itemsPerPage: 20,\r\n          })\r\n          .then(async ({ data }) => {\r\n            if (data.list.length > 0) {\r\n              this.comments = this.comments.concat(data.list);\r\n            } else {\r\n              this.commentPage + -1;\r\n            }\r\n          })\r\n          .catch((err) => {\r\n            // this.catchErr(err);\r\n          });\r\n      } else {\r\n        this.$router.go(-1);\r\n      }\r\n    },\r\n    handleScroll() {\r\n      if (this.$refs.commentsRef.$el) {\r\n        setTimeout(() => {\r\n          this.$refs.commentsRef.SimpleBar.getScrollElement().scrollTop = 0;\r\n        }, 500);\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n    var container3 = document.querySelector(\r\n      \"#comment-list .simplebar-content-wrapper\"\r\n    );\r\n    if (container3) {\r\n      container3.scrollTo({ top: 500, behavior: \"smooth\" });\r\n    }\r\n    // Contact list actions\r\n    this.$refs.commentsRef.SimpleBar.getScrollElement().addEventListener(\r\n      \"scroll\",\r\n      (e) => {\r\n        let { scrollTop, scrollHeight, clientHeight } = event.target;\r\n        const offsetForTrigger = 1;\r\n        if (scrollHeight - clientHeight - offsetForTrigger < scrollTop) {\r\n          this.loadMoreComments((this.commentPage += 1));\r\n        }\r\n      }\r\n    );\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.iconUpload {\r\n  position: absolute;\r\n  right: 2px;\r\n  bottom: 2px;\r\n}\r\n</style>"]}]}