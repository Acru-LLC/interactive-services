{"remainingRequest":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\src\\modules\\projects\\comments.vue?vue&type=style&index=0&id=16e7c558&lang=css&","dependencies":[{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\src\\modules\\projects\\comments.vue","mtime":1674799497703},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\css-loader\\dist\\cjs.js","mtime":1667355376309},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1675061970775},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\postcss-loader\\src\\index.js","mtime":1667355363746},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1667355378280},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1675061970715}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouaWNvblVwbG9hZCB7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgcmlnaHQ6IDJweDsNCiAgYm90dG9tOiAycHg7DQp9DQo="},{"version":3,"sources":["comments.vue"],"names":[],"mappings":";AAkPA;AACA;AACA;AACA;AACA","file":"comments.vue","sourceRoot":"src/modules/projects","sourcesContent":["<template>\r\n  <div class=\"card\">\r\n    <div class=\"card-body\">\r\n      <h4 class=\"card-title mb-4\">{{ $t(\"cmts\") }}</h4>\r\n      <simplebar\r\n        :style=\"height ? 'height:330px' : 'height: 330px'\"\r\n        id=\"comment-list\"\r\n        ref=\"commentsRef\"\r\n      >\r\n        <div class=\"media mb-4\" v-for=\"(cmt, index) in comments\" :key=\"index\">\r\n          <div class=\"mr-3\">\r\n            <img\r\n              v-if=\"cmt.employeeUploadPath\"\r\n              class=\"media-object rounded-circle avatar-xs\"\r\n              alt\r\n              :src=\"`${hrUrl}/${cmt.employeeUploadPath}`\"\r\n            />\r\n            <div v-else class=\"avatar-xs mr-3\">\r\n              <span\r\n                class=\"\r\n                  avatar-title\r\n                  rounded-circle\r\n                  bg-soft-primary\r\n                  text-primary\r\n                  font-size-16\r\n                \"\r\n              >\r\n                {{\r\n                  `${cmt.ownerLastName.charAt(0)}${cmt.ownerFirstName.charAt(\r\n                    0\r\n                  )}`\r\n                }}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div class=\"media-body\">\r\n            <h5 class=\"font-size-13 font-weight-bold mb-1\">\r\n              {{\r\n                `${cmt.ownerLastName} ${cmt.ownerFirstName} ${cmt.ownerMiddleName}`\r\n              }}\r\n            </h5>\r\n            <div v-if=\"cmt.uploadPath\">\r\n              <p class=\"mb-1 d-flex align-items-center\">\r\n                <a\r\n                  :href=\"`${baseUrl}/${cmt.uploadPath}`\"\r\n                  :download=\"`file.${cmt.fileExtension}`\"\r\n                  class=\"fa fas fa-arrow-alt-circle-down text-primary\"\r\n                  style=\"font-size: 35px\"\r\n                ></a>\r\n                <span class=\"ml-2\">{{ cmt.fileName }}</span>\r\n              </p>\r\n            </div>\r\n\r\n            <p class=\"mb-1\" style=\"word-break: break-all !important\">\r\n              {{ cmt.comment }}\r\n            </p>\r\n            <p class=\"text-muted mb-0 font-size-10\">\r\n              <i class=\"bx bx-calendar mr-1 text-primary\"></i>\r\n              {{ replaceDate(cmt.date).daym_shortyyyy_hm() }}\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </simplebar>\r\n    </div>\r\n\r\n    <div class=\"pl-3 pr-3 pt-3\">\r\n      <form v-if=\"project && project.status != 'FINISHED'\">\r\n        <div class=\"form-group m-0\" style=\"position: relative\">\r\n          <textarea\r\n            style=\"resize: none\"\r\n            @keyup.enter=\"leaveComment(comment)\"\r\n            v-model=\"comment\"\r\n            class=\"form-control\"\r\n            id=\"commentmessage-input\"\r\n            :placeholder=\"$t('writeCmt')\"\r\n            rows=\"3\"\r\n          ></textarea>\r\n          <b-button\r\n            variant=\"white\"\r\n            class=\"iconUpload\"\r\n            @click.prevent=\"clickUpload\"\r\n            style=\"padding: 1px\"\r\n            size=\"sm\"\r\n          >\r\n            <i class=\"bx bxs-file-doc text-primary font-size-20\"></i>\r\n          </b-button>\r\n        </div>\r\n\r\n        <b-button\r\n          @click=\"leaveComment(comment)\"\r\n          class=\"mt-1 float-right mb-3\"\r\n          variant=\"primary\"\r\n        >\r\n          <b-overlay :show=\"loaderCmt\" rounded=\"sm\" opacity=\"0.1\">\r\n            {{ $t(\"actions.send\") }}\r\n\r\n            <i class=\"bx bx-send\"></i>\r\n          </b-overlay>\r\n        </b-button>\r\n      </form>\r\n\r\n      <upload-file :cmt=\"true\" ref=\"file\" @sendFile=\"sendFile\" />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport projectService from \"@/shared/services/projectService\";\r\nimport simplebar from \"simplebar-vue\";\r\nimport { replaceDate } from \"@/helper\";\r\nexport default {\r\n  props: [\"height\", \"project\"],\r\n  watch: {\r\n    file: {\r\n      handler(v) {\r\n        if (v) {\r\n          this.fileModal = true;\r\n        }\r\n      },\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      replaceDate: replaceDate,\r\n      fileModal: false,\r\n      comment: \"\",\r\n      file: null,\r\n      params: {\r\n        page: 0,\r\n        itemsPerPage: 20,\r\n      },\r\n      comments: [],\r\n      commentPage: 0,\r\n      loaderCmt: false,\r\n    };\r\n  },\r\n  components: {\r\n    simplebar,\r\n  },\r\n  created() {\r\n    this.listComments();\r\n  },\r\n  methods: {\r\n    sendFile(message, file) {\r\n      this.leaveComment(message, file);\r\n      this.fileModal = false;\r\n      this.file = null;\r\n    },\r\n    clickUpload() {\r\n      this.$refs.file.upld();\r\n    },\r\n    leaveComment(cmt, file) {\r\n      let id = this.$route.query.id;\r\n      if (id) {\r\n        this.loaderCmt = true;\r\n        projectService\r\n          .leaveComment(id, cmt, file)\r\n          .then((rs) => {\r\n            this.comment = \"\";\r\n            setTimeout(() => {\r\n              this.listComments();\r\n            }, 300);\r\n          })\r\n          .catch((err) => {\r\n            // this.catchErr(err);\r\n          })\r\n          .finally(() => {\r\n            this.loaderCmt = false;\r\n          });\r\n      } else {\r\n        this.$router.go(-1);\r\n      }\r\n    },\r\n    listComments() {\r\n      let id = this.$route.query.id;\r\n      if (id) {\r\n        projectService\r\n          .listComments(id, this.params, true)\r\n          .then((rs) => {\r\n            this.comments = rs.data.list;\r\n            this.handleScroll();\r\n          })\r\n          .catch((err) => {\r\n            // this.catchErr(err);\r\n          });\r\n      } else {\r\n        this.$router.go(-1);\r\n      }\r\n    },\r\n    loadMoreComments(page) {\r\n      let id = this.$route.query.id;\r\n      if (id) {\r\n        projectService\r\n          .listComments(id, {\r\n            page: page,\r\n            itemsPerPage: 20,\r\n          })\r\n          .then(async ({ data }) => {\r\n            if (data.list.length > 0) {\r\n              this.comments = this.comments.concat(data.list);\r\n            } else {\r\n              this.commentPage + -1;\r\n            }\r\n          })\r\n          .catch((err) => {\r\n            // this.catchErr(err);\r\n          });\r\n      } else {\r\n        this.$router.go(-1);\r\n      }\r\n    },\r\n    handleScroll() {\r\n      if (this.$refs.commentsRef.$el) {\r\n        setTimeout(() => {\r\n          this.$refs.commentsRef.SimpleBar.getScrollElement().scrollTop = 0;\r\n        }, 500);\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n    var container3 = document.querySelector(\r\n      \"#comment-list .simplebar-content-wrapper\"\r\n    );\r\n    if (container3) {\r\n      container3.scrollTo({ top: 500, behavior: \"smooth\" });\r\n    }\r\n    // Contact list actions\r\n    this.$refs.commentsRef.SimpleBar.getScrollElement().addEventListener(\r\n      \"scroll\",\r\n      (e) => {\r\n        let { scrollTop, scrollHeight, clientHeight } = event.target;\r\n        const offsetForTrigger = 1;\r\n        if (scrollHeight - clientHeight - offsetForTrigger < scrollTop) {\r\n          this.loadMoreComments((this.commentPage += 1));\r\n        }\r\n      }\r\n    );\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.iconUpload {\r\n  position: absolute;\r\n  right: 2px;\r\n  bottom: 2px;\r\n}\r\n</style>"]}]}