{"remainingRequest":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\src\\modules\\report\\organizitional\\components\\editReportDynamicModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\src\\modules\\report\\organizitional\\components\\editReportDynamicModal.vue","mtime":1675054786286},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1667355378280},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1675061970665},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1667355378280},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1675061970715}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgU2VydmljZSBmcm9tICJAL21vZHVsZXMvcmVwb3J0L3JlcG9ydFNlcnZpY2UiOw0KaW1wb3J0IGNydWRBbmRMaXN0c1NlcnZpY2UgZnJvbSAiQC9zaGFyZWQvc2VydmljZXMvY3J1ZF9hbmRfbGlzdC5zZXJ2aWNlIg0KaW1wb3J0IENoZWNrYm94IGZyb20gInZ1ZS1tYXRlcmlhbC1jaGVja2JveCI7DQoNCmNvbnN0IE9LRURfQVBJX1VSTCA9ICdyZWVzdHIvaW5mby1va2VkJw0KZXhwb3J0IGRlZmF1bHQgew0KICBwcm9wczogew0KICAgIGlzR2VuZXJhdGVkOiB7DQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgICAgZGVmYXVsdDogZmFsc2UNCiAgICB9DQogIH0sDQogIGNvbXBvbmVudHM6IHsgQ2hlY2tib3ggfSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgbGFzdFJlcG9ydERhdGE6IFtdLA0KICAgICAgbGFzdFJlcG9ydERhdGFSb3dzOiBbXSwNCiAgICAgIGxhc3RSZXBvcnRGb3JtdWxhczogW10sDQogICAgICBkZWJvdW5jZTogbnVsbCwNCiAgICAgIC8vIE9LRUQgVkFSSUFCTEVTDQogICAgICBva2VkczogW10sDQogICAgICBoYXNOZXh0UGFnZU9rZWQ6IGZhbHNlLA0KICAgICAgaXNMb2FkaW5nT2tlZDogZmFsc2UsDQogICAgICBva2VkU2VhcmNoUGF5bG9hZDoge30sDQogICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tDQogICAgICBmMUlkczogW10sDQogICAgICBmMklkczogW10sDQogICAgICBmUm93SWQ6IG51bGwsDQogICAgICB0YWJsZUlkOiBudWxsLA0KICAgICAgdGFibGVJbmZvOiB7fSwNCiAgICAgIHJlcG9ydElkOiBudWxsLA0KICAgICAgLy8gZ2V0TmFtZTogZ2V0TmFtZSwNCiAgICAgIHNlbGVjdGVkQ29sdW1uczogW10sDQogICAgICBzZWxlY3RlZFJvd3M6IFtdLA0KDQogICAgICBmaXJzdENvbHVtbnM6IFtdLA0KICAgICAgc2Vjb25kQ29sdW1uczogW10sDQogICAgICB0aGlyZENvbHVtbnM6IFtdLA0KDQogICAgICB0aGlyZFRySWREYXRhOiBbXSwNCiAgICAgIGN1cnJlbnRSb3dJZDogbnVsbCwNCiAgICAgIGludmFsaWRFbnRyaWVzOiAwLA0KICAgICAgY3VycmVudEl0ZW1EYXRhOiBbXSwNCiAgICAgIHNob3dEYXRhOiBbXSwNCiAgICAgIGxvYWRlcjogZmFsc2UsDQogICAgICBzaG93UmVzdWx0OiBmYWxzZSwNCiAgICAgIHJlcG9ydDoge30sDQogICAgICB0YWJsZToge30sDQogICAgICBmb3JtdWxhczogW10sDQogICAgICBjdXJyZW50UG9zaXRpb246IHsNCiAgICAgICAgcm93SW5kZXg6IG51bGwsDQogICAgICAgIGNvbHVtbkluZGV4OiBudWxsLA0KICAgICAgICByb3dJZDogbnVsbCwNCiAgICAgICAgY29sdW1uSWQ6IG51bGwsDQogICAgICB9LA0KICAgICAgZG9jVGFibGVGb3JtdWxhc0xpc3Q6IHt9LA0KICAgICAgZG9jVGFibGVGb3JtdWxhc0xpc3RlbkNvbHVtbklkOiB7fSwNCiAgICAgIHRyQ29sdW1uSWRPbkRvY0NvbHVtbklkTWFwOiB7fSwNCiAgICB9Ow0KICB9LA0KICB3YXRjaDogew0KICAgIHRoaXJkVHJJZERhdGE6IGZ1bmN0aW9uIChuZXdUaGlyZFRySWREYXRhKSB7DQogICAgICBpZiAodHlwZW9mIG5ld1RoaXJkVHJJZERhdGEgPT09ICdvYmplY3QnICYmIG5ld1RoaXJkVHJJZERhdGEubGVuZ3RoID4gMCkgew0KICAgICAgICBsZXQgbGVuZ3RoID0gbmV3VGhpcmRUcklkRGF0YS5sZW5ndGg7DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICB0aGlzLnRyQ29sdW1uSWRPbkRvY0NvbHVtbklkTWFwW25ld1RoaXJkVHJJZERhdGFbaV0uY29sdW1uSWRdID0gaQ0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIGdldENvbHVtbkRhdGEoaSkgew0KICAgICAgbGV0IGZvdW5kID0gdGhpcy5zaG93RGF0YS5maW5kKChlKSA9PiBlLmNvbHVtbklkID09IGkuY29sdW1uSWQpDQogICAgICBpZiAoZm91bmQpIHsNCiAgICAgICAgcmV0dXJuIGZvdW5kLmNvbHVtbkRhdGENCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAiIg0KICAgICAgfQ0KICAgIH0sDQogICAgLy8gRFlOQU1JQ19SRUZFUkVOQ0VTIE1FVEhPRFMNCiAgICBnZXRSYW5kb21JbnQoKSB7DQogICAgICBsZXQgbnVtYmVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDAwMDApOw0KICAgICAgbGV0IGJvb2wgPSB0cnVlDQogICAgICB0aGlzLnNlbGVjdGVkUm93cy5maW5kKGVsID0+IHsNCiAgICAgICAgaWYgKGVsLmlkID09IG51bWJlcikgew0KICAgICAgICAgIGJvb2wgPSBmYWxzZQ0KICAgICAgICB9IGVsc2UgaWYgKGVsLmlkID09IG51bWJlcikgew0KICAgICAgICAgIGJvb2wgPSBmYWxzZQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBib29sDQogICAgICB9KQ0KICAgICAgaWYgKGJvb2wpIHsNCiAgICAgICAgcmV0dXJuIG51bWJlcjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuZ2V0UmFuZG9tSW50KCkNCiAgICAgIH0NCg0KICAgIH0sDQogICAgYXN5bmMgYWRkTmV3Um93KCkgew0KICAgICAgYXdhaXQgdGhpcy5zZWxlY3RlZFJvd3MucHVzaCh7IGlkOiB0aGlzLmdldFJhbmRvbUludCgpIH0pDQogICAgICBhd2FpdCB0aGlzLnNldERvY3VtZW50Q29sdW1uVmFsdWVzKHRoaXMubGFzdFJlcG9ydERhdGEsIHRoaXMubGFzdFJlcG9ydEZvcm11bGFzKQ0KICAgIH0sDQogICAgYXN5bmMgY2xvc2VSZXBvcnQoKSB7DQogICAgICB0aGlzLiRlbWl0KCJjbG9zZWRSZXBvcnRMb2FkZXIiKTsNCiAgICAgIHRoaXMuY25mKCkudGhlbihhc3luYyAocnMpID0+IHsNCiAgICAgICAgaWYgKHJzLnZhbHVlKSB7DQogICAgICAgICAgdGhpcy4kZW1pdCgnc2F2ZScsIHRydWUpDQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0sDQogICAgc3RvcEZvcm1pbmdSb3dzKCkgew0KICAgICAgU2VydmljZS5zdG9wRm9ybWluZ1RoZVJlcG9ydCh0aGlzLnJlcG9ydElkKQ0KICAgICAgICAgIC50aGVuKGFzeW5jIChycykgPT4gew0KICAgICAgICAgICAgdGhpcy4kc2V0KHRoaXMudGFibGVJbmZvLCAnaGFzRHluYW1pY1Jvd3MnLCBmYWxzZSkNCiAgICAgICAgICAgIC8vIGF3YWl0IHRoaXMuZGVsZXRlU3VjY2VzcygpOw0KICAgICAgICAgIH0pDQogICAgICAgICAgLmNhdGNoKChlcnIpID0+IHsNCiAgICAgICAgICAgIC8vIHRoaXMuY2F0Y2hFcnIoZXJyKTsNCiAgICAgICAgICB9KTsNCiAgICB9LA0KICAgIGFzeW5jIGRlbGV0ZVJvdyhpbmRleCwgZGF0YSkgew0KICAgICAgbGV0IGZpbmRFbGVtZW50ID0gdGhpcy5sYXN0UmVwb3J0RGF0YVJvd3MuZmluZEluZGV4KGVsID0+IGVsLmlkID09IGRhdGEuaWQpDQogICAgICBpZiAoZmluZEVsZW1lbnQgPiAtMSkgew0KICAgICAgICB0aGlzLmNuZigpLnRoZW4oYXN5bmMgKHJzKSA9PiB7DQogICAgICAgICAgaWYgKHJzLnZhbHVlKSB7DQogICAgICAgICAgICBhd2FpdCBTZXJ2aWNlLmRlbGV0ZVJvd0lkKGRhdGEuaWQsIHRoaXMucmVwb3J0SWQpDQogICAgICAgICAgICAgICAgLnRoZW4oYXN5bmMgKHJzKSA9PiB7DQogICAgICAgICAgICAgICAgICAvLyBhd2FpdCB0aGlzLmRlbGV0ZVN1Y2Nlc3MoKTsNCiAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRSb3dzLnNwbGljZShpbmRleCwgMSkNCiAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuJGZvcmNlVXBkYXRlKCkNCiAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucmVzZXRJbmRleCgpDQogICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnNldERvY3VtZW50Q29sdW1uVmFsdWVzKHRoaXMubGFzdFJlcG9ydERhdGEuZmlsdGVyKGUgPT4gZS5yb3dJZCAhPSBkYXRhLmlkKSwgdGhpcy5sYXN0UmVwb3J0Rm9ybXVsYXMpDQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAuY2F0Y2goKGVycikgPT4gew0KICAgICAgICAgICAgICAgICAgLy8gdGhpcy5jYXRjaEVycihlcnIpOw0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgLmZpbmFsbHkoYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5nZXRCeUlkKHRoaXMudGFibGVJZCwgdGhpcy5yZXBvcnRJZCwgdGhpcy50YWJsZUluZm8pDQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIDsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5jbmYoKS50aGVuKGFzeW5jIChycykgPT4gew0KICAgICAgICAgIGlmIChycy52YWx1ZSkgew0KICAgICAgICAgICAgbGV0IG5ld1RoaXJkVHJJZERhdGEgPSBbXQ0KICAgICAgICAgICAgdGhpcy50aGlyZFRySWREYXRhID0gdGhpcy50aGlyZFRySWREYXRhLm1hcCgoZSkgPT4gew0KICAgICAgICAgICAgICBlLnZhbHVlID0gZS52YWx1ZS5maWx0ZXIoZCA9PiB7DQogICAgICAgICAgICAgICAgaWYgKGQgJiYgZC5yb3dJZCAhPSBkYXRhLmlkKSB7DQogICAgICAgICAgICAgICAgICBpZiAoZC50eXBlQ29kZSA9PT0gIkJPT0xFQU4iKSB7DQogICAgICAgICAgICAgICAgICAgIGQudmFsdWVCb29sZWFuID0gZC52YWx1ZQ0KICAgICAgICAgICAgICAgICAgICBkLnZhbHVlU3RyaW5nID0gbnVsbA0KICAgICAgICAgICAgICAgICAgICBkLnZhbHVlQmlnRGVjaW1hbCA9IG51bGwNCiAgICAgICAgICAgICAgICAgICAgZC52YWx1ZURhdGUgPSBudWxsDQogICAgICAgICAgICAgICAgICAgIGQuc2VsZWN0VmFsdWVOYW1lVXogPSBudWxsDQogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGQudHlwZUNvZGUgPT09ICJTVFJJTkciKSB7DQogICAgICAgICAgICAgICAgICAgIGQudmFsdWVTdHJpbmcgPSBkLnZhbHVlDQogICAgICAgICAgICAgICAgICAgIGQudmFsdWVCaWdEZWNpbWFsID0gbnVsbA0KICAgICAgICAgICAgICAgICAgICBkLnZhbHVlRGF0ZSA9IG51bGwNCiAgICAgICAgICAgICAgICAgICAgZC52YWx1ZUJvb2xlYW4gPSBudWxsDQogICAgICAgICAgICAgICAgICAgIGQuc2VsZWN0VmFsdWVOYW1lVXogPSBudWxsDQogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGQudHlwZUNvZGUgPT09ICJCSUdERUNJTUFMIikgew0KICAgICAgICAgICAgICAgICAgICBkLnZhbHVlQmlnRGVjaW1hbCA9IGQudmFsdWUNCiAgICAgICAgICAgICAgICAgICAgZC52YWx1ZVN0cmluZyA9IG51bGwNCiAgICAgICAgICAgICAgICAgICAgZC52YWx1ZURhdGUgPSBudWxsDQogICAgICAgICAgICAgICAgICAgIGQudmFsdWVCb29sZWFuID0gbnVsbA0KICAgICAgICAgICAgICAgICAgICBkLnNlbGVjdFZhbHVlTmFtZVV6ID0gbnVsbA0KICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkLnR5cGVDb2RlID09PSAiREFURSIpIHsNCiAgICAgICAgICAgICAgICAgICAgZC52YWx1ZURhdGUgPSBkLnZhbHVlDQogICAgICAgICAgICAgICAgICAgIGQudmFsdWVTdHJpbmcgPSBudWxsDQogICAgICAgICAgICAgICAgICAgIGQudmFsdWVCaWdEZWNpbWFsID0gbnVsbA0KICAgICAgICAgICAgICAgICAgICBkLnZhbHVlQm9vbGVhbiA9IG51bGwNCiAgICAgICAgICAgICAgICAgICAgZC5zZWxlY3RWYWx1ZU5hbWVVeiA9IG51bGwNCiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZC50eXBlQ29kZSA9PT0gIllFQVIiKSB7DQogICAgICAgICAgICAgICAgICAgIGQudmFsdWVEYXRlID0gbnVsbA0KICAgICAgICAgICAgICAgICAgICBkLnZhbHVlU3RyaW5nID0gZC52YWx1ZQ0KICAgICAgICAgICAgICAgICAgICBkLnZhbHVlQmlnRGVjaW1hbCA9IG51bGwNCiAgICAgICAgICAgICAgICAgICAgZC52YWx1ZUJvb2xlYW4gPSBudWxsDQogICAgICAgICAgICAgICAgICAgIGQuc2VsZWN0VmFsdWVOYW1lVXogPSBudWxsDQogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGQudHlwZUNvZGUgPT09ICJTRUxFQ1QiKSB7DQogICAgICAgICAgICAgICAgICAgIGQudmFsdWVTdHJpbmcgPSBudWxsDQogICAgICAgICAgICAgICAgICAgIGQudmFsdWVCaWdEZWNpbWFsID0gbnVsbA0KICAgICAgICAgICAgICAgICAgICBkLnZhbHVlRGF0ZSA9IG51bGwNCiAgICAgICAgICAgICAgICAgICAgZC52YWx1ZUJvb2xlYW4gPSBudWxsDQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBuZXdUaGlyZFRySWREYXRhLnB1c2goZCkNCiAgICAgICAgICAgICAgICAgIHJldHVybiBkDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICByZXR1cm4gZQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRSb3dzLnNwbGljZShpbmRleCwgMSkNCiAgICAgICAgICAgIGF3YWl0IHRoaXMuJGZvcmNlVXBkYXRlKCkNCiAgICAgICAgICAgIGF3YWl0IHRoaXMucmVzZXRJbmRleCgpDQogICAgICAgICAgICBuZXdUaGlyZFRySWREYXRhLmZvckVhY2goZSA9PiB0aGlzLmxhc3RSZXBvcnREYXRhLnB1c2goZSkpDQogICAgICAgICAgICBhd2FpdCB0aGlzLnNldERvY3VtZW50Q29sdW1uVmFsdWVzKHRoaXMubGFzdFJlcG9ydERhdGEsIHRoaXMubGFzdFJlcG9ydEZvcm11bGFzKQ0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQoNCg0KICAgICAgfQ0KICAgIH0sDQoNCiAgICBkeW5hbWljUmVmc1JlYWNoZWRFbmRPZkxpc3QoZSkgew0KICAgICAgaWYgKGUpIHsNCiAgICAgICAgdGhpcy5mZXRjaER5bmFtaWNSZWZzKCkNCiAgICAgIH0NCiAgICB9LA0KICAgIGFzeW5jIGRlYm91bmNlU2VhcmNoRHluYW1pY1JlZnMoc2VhcmNoVGV4dCkgew0KICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZGVib3VuY2UpOw0KICAgICAgdGhpcy5kZWJvdW5jZSA9IHNldFRpbWVvdXQoYXN5bmMgKCkgPT4gew0KICAgICAgICBhd2FpdCB0aGlzLmZldGNoRHluYW1pY1JlZnNXaXRoS2V5d29yZChzZWFyY2hUZXh0KTsNCiAgICAgIH0sIDEwMDApOw0KICAgIH0sDQogICAgZmV0Y2hEeW5hbWljUmVmc1dpdGhLZXl3b3JkKGtleXdvcmQpIHsNCiAgICAgIHRoaXMub2tlZHMgPSBbXQ0KICAgICAgdGhpcy5va2VkU2VhcmNoUGF5bG9hZC5wYWdlID0gMQ0KICAgICAgdGhpcy5va2VkU2VhcmNoUGF5bG9hZC5rZXl3b3JkID0ga2V5d29yZCA/IGtleXdvcmQgOiAnJw0KICAgICAgdGhpcy5mZXRjaER5bmFtaWNSZWZzKCkNCiAgICB9LA0KICAgIGFzeW5jIGZldGNoRHluYW1pY1JlZnMoKSB7DQogICAgICB0aGlzLmlzTG9hZGluZ09rZWQgPSB0cnVlDQogICAgICBhd2FpdCBjcnVkQW5kTGlzdHNTZXJ2aWNlLnNlYXJjaExpc3RXaXRoS2V5d29yZChPS0VEX0FQSV9VUkwsIHRoaXMub2tlZFNlYXJjaFBheWxvYWQpDQogICAgICAgICAgLnRoZW4ocmVzID0+IHsNCiAgICAgICAgICAgIHRoaXMub2tlZHMucHVzaCguLi5yZXMuZGF0YS5saXN0KQ0KICAgICAgICAgICAgdGhpcy5oYXNOZXh0UGFnZU9rZWQgPSByZXMuZGF0YS50b3RhbCAvIHRoaXMub2tlZFNlYXJjaFBheWxvYWQuaXRlbXNQZXJQYWdlID4gdGhpcy5va2VkU2VhcmNoUGF5bG9hZC5wYWdlDQogICAgICAgICAgICB0aGlzLm9rZWRTZWFyY2hQYXlsb2FkLnBhZ2UgKz0gMQ0KICAgICAgICAgICAgaWYgKCF0aGlzLmlzTW9kZUNyZWF0ZSAmJiB0aGlzLmVkaXRpbmdJdGVtLm9rZWRJZCkgew0KICAgICAgICAgICAgICBsZXQgZm91bmRJdG0gPSB0aGlzLm9rZWRzLmZpbmQoZWwgPT4gZWwuaWQgPT0gdGhpcy5lZGl0aW5nSXRlbS5va2VkSWQpDQogICAgICAgICAgICAgIGlmICghZm91bmRJdG0gJiYgdGhpcy5lZGl0aW5nSXRlbS5pbmZvT2tlZER0bykgew0KICAgICAgICAgICAgICAgIHRoaXMub2tlZHMucHVzaCh0aGlzLmVkaXRpbmdJdGVtLmluZm9Pa2VkRHRvKQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfSkNCiAgICAgICAgICAuY2F0Y2goZSA9PiB7DQogICAgICAgICAgICBjb25zb2xlLmxvZyhlKQ0KICAgICAgICAgICAgdGhpcy5va2VkcyA9IFtdDQogICAgICAgICAgfSkNCiAgICAgICAgICAuZmluYWxseSgoKSA9PiB7DQogICAgICAgICAgICB0aGlzLmlzTG9hZGluZ09rZWQgPSBmYWxzZQ0KICAgICAgICAgIH0pDQogICAgfSwNCiAgICBjdXN0b21MYWJlbER5bmFtaWNSZWYob3B0KSB7DQogICAgICBsZXQgc2VsZWN0ZWQgPSB0aGlzLm9rZWRzLmZpbmQoZSA9PiBlLmlkID09IG9wdC5pZCk7DQogICAgICBpZiAoc2VsZWN0ZWQpIHsNCiAgICAgICAgcmV0dXJuIGAke3NlbGVjdGVkLmNvZGV9IC0gJHsNCiAgICAgICAgICAgIHNlbGVjdGVkLm5hbWVVeiA/DQogICAgICAgICAgICAgICAgdGhpcy5nZXROYW1lKHsNCiAgICAgICAgICAgICAgICAgIG5hbWVSdTogc2VsZWN0ZWQubmFtZVJ1LA0KICAgICAgICAgICAgICAgICAgbmFtZUx0OiBzZWxlY3RlZC5uYW1lTHQsDQogICAgICAgICAgICAgICAgICBuYW1lVXo6IHNlbGVjdGVkLm5hbWVVeiwNCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIDoNCiAgICAgICAgICAgICAgICBzZWxlY3RlZC5uYW1lDQogICAgICAgIH1gDQogICAgICB9DQogICAgICByZXR1cm4gYGA7DQogICAgfSwNCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgIGNsZWFyQWxsKCkgew0KICAgICAgdGhpcy5zZWxlY3RlZENvbHVtbnMgPSBbXTsNCiAgICAgIHRoaXMuc2VsZWN0ZWRSb3dzID0gW107DQogICAgICB0aGlzLmZpcnN0Q29sdW1ucyA9IFtdOw0KICAgICAgdGhpcy5zZWNvbmRDb2x1bW5zID0gW107DQogICAgICB0aGlzLnRoaXJkQ29sdW1ucyA9IFtdOw0KICAgICAgdGhpcy50aGlyZFRySWREYXRhID0gW107DQogICAgICB0aGlzLmZvcm11bGFzID0gW107DQogICAgICB0aGlzLnRhYmxlID0gW107DQogICAgICB0aGlzLmYxSWRzID0gW107DQogICAgICB0aGlzLmYySWRzID0gW107DQogICAgfSwNCiAgICBrZXlkb3duRXZ0KGV2dCwgcm93SWQsIHZhbHVlLCByb3dJbmRleCwgY29sdW1uSW5kZXgsIGNvbHVtbklkLCB0eXBlQ29kZSkgew0KICAgICAgdGhpcy5rZXlVcEV2ZW50c0Rpc2FibGUoZXZ0KTsNCiAgICAgIGlmIChjb2x1bW5JZCAhPSBudWxsKSB7DQogICAgICAgIGlmIChldnQua2V5Q29kZSA9PSA0MCAmJiByb3dJZCAhPSBudWxsKSB7DQogICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgLy8gZG93bg0KICAgICAgICAgIGlmIChyb3dJbmRleCA8IHRoaXMuc2VsZWN0ZWRSb3dzLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgICAgIGxldCBjdXJyZW50Q29sdW1uID0gdGhpcy50aGlyZFRySWREYXRhW2NvbHVtbkluZGV4XTsNCiAgICAgICAgICAgIGxldCBkb3duUm93Q29sdW1uID0gdGhpcy5zZWxlY3RlZFJvd3Nbcm93SW5kZXggKyAxXTsNCiAgICAgICAgICAgIGxldCBkb3duSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgNCiAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7DQogICAgICAgICAgICAgICAgICByb3dJZDogZG93blJvd0NvbHVtbi5pZCwNCiAgICAgICAgICAgICAgICAgIGNvbHVtbklkOiBjdXJyZW50Q29sdW1uLmNvbHVtbklkLA0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICApOw0KICAgICAgICAgICAgaWYgKGRvd25JbnB1dCkgew0KICAgICAgICAgICAgICBkb3duSW5wdXQuZm9jdXMoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSBpZiAoZXZ0LmtleUNvZGUgPT0gMzggJiYgcm93SWQgIT0gbnVsbCkgew0KICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgIGlmIChyb3dJbmRleCAhPSAwKSB7DQogICAgICAgICAgICBsZXQgY3VycmVudENvbHVtbiA9IHRoaXMudGhpcmRUcklkRGF0YVtjb2x1bW5JbmRleF07DQogICAgICAgICAgICBsZXQgdXBSb3dDb2x1bW4gPSB0aGlzLnNlbGVjdGVkUm93c1tyb3dJbmRleCAtIDFdOw0KICAgICAgICAgICAgbGV0IHVwSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgNCiAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7DQogICAgICAgICAgICAgICAgICByb3dJZDogdXBSb3dDb2x1bW4uaWQsDQogICAgICAgICAgICAgICAgICBjb2x1bW5JZDogY3VycmVudENvbHVtbi5jb2x1bW5JZCwNCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIGlmICh1cElucHV0KSB7DQogICAgICAgICAgICAgIHVwSW5wdXQuZm9jdXMoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgLy91cA0KICAgICAgICB9IGVsc2UgaWYgKGV2dC5rZXlDb2RlID09IDM3KSB7DQogICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgLy9sZWZ0DQogICAgICAgICAgaWYgKGNvbHVtbkluZGV4ICE9IDApIHsNCiAgICAgICAgICAgIGxldCBwcmV2Q29sdW1uID0gdGhpcy50aGlyZFRySWREYXRhW2NvbHVtbkluZGV4IC0gMV07DQoNCiAgICAgICAgICAgIGxldCBjdXJyZW50Um93ID0gdGhpcy5zZWxlY3RlZFJvd3Nbcm93SW5kZXhdOw0KICAgICAgICAgICAgbGV0IHByZXZJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKA0KICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHsNCiAgICAgICAgICAgICAgICAgIHJvd0lkOiBjdXJyZW50Um93LmlkLA0KICAgICAgICAgICAgICAgICAgY29sdW1uSWQ6IHByZXZDb2x1bW4uY29sdW1uSWQsDQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICk7DQogICAgICAgICAgICBpZiAocHJldklucHV0KSB7DQogICAgICAgICAgICAgIGlmIChwcmV2SW5wdXQuZGlzYWJsZWQpIHsNCiAgICAgICAgICAgICAgICBsZXQgY291bnQgPSB0aGlzLnRoaXJkVHJJZERhdGEubGVuZ3RoIC0gKGNvbHVtbkluZGV4IC0gMSk7DQogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICBsZXQgcHJldkNvbHVtbjIgPSB0aGlzLnRoaXJkVHJJZERhdGFbY29sdW1uSW5kZXggLSAxIC0gaV07DQogICAgICAgICAgICAgICAgICBpZiAocHJldkNvbHVtbjIpIHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoDQogICAgICAgICAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHJvd0lkOiBjdXJyZW50Um93LmlkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5JZDogcHJldkNvbHVtbjIuY29sdW1uSWQsDQogICAgICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQgJiYgaW5wdXQuZGlzYWJsZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LmZvY3VzKCk7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHByZXZJbnB1dC5mb2N1cygpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2UgaWYgKGV2dC5rZXlDb2RlID09IDM5KSB7DQogICAgICAgICAgLy9yaWdodA0KICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgIGlmICh0aGlzLnRoaXJkVHJJZERhdGEubGVuZ3RoIC0gMSA+IGNvbHVtbkluZGV4KSB7DQogICAgICAgICAgICBsZXQgbmV4dENvbHVtbiA9IHRoaXMudGhpcmRUcklkRGF0YVtjb2x1bW5JbmRleCArIDFdOw0KICAgICAgICAgICAgbGV0IGN1cnJlbnRSb3cgPSB0aGlzLnNlbGVjdGVkUm93c1tyb3dJbmRleF07DQogICAgICAgICAgICBsZXQgbmV4dElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoDQogICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkoew0KICAgICAgICAgICAgICAgICAgcm93SWQ6IGN1cnJlbnRSb3cuaWQsDQogICAgICAgICAgICAgICAgICBjb2x1bW5JZDogbmV4dENvbHVtbi5jb2x1bW5JZCwNCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIGlmIChuZXh0SW5wdXQpIHsNCiAgICAgICAgICAgICAgaWYgKG5leHRJbnB1dC5kaXNhYmxlZCkgew0KICAgICAgICAgICAgICAgIGxldCBmb3JDb3VudCA9IHRoaXMudGhpcmRUcklkRGF0YS5sZW5ndGggLSAoY29sdW1uSW5kZXggKyAxKTsNCiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZvckNvdW50OyBpKyspIHsNCiAgICAgICAgICAgICAgICAgIGxldCBuZXh0Q29sdW1uMiA9IHRoaXMudGhpcmRUcklkRGF0YVtjb2x1bW5JbmRleCArIDEgKyBpXTsNCg0KICAgICAgICAgICAgICAgICAgbGV0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoDQogICAgICAgICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkoew0KICAgICAgICAgICAgICAgICAgICAgICAgcm93SWQ6IGN1cnJlbnRSb3cuaWQsDQogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5JZDogbmV4dENvbHVtbjIuY29sdW1uSWQsDQogICAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgICBpZiAoaW5wdXQuZGlzYWJsZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQpIHsNCiAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5mb2N1cygpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBuZXh0SW5wdXQuZm9jdXMoKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0sDQogICAgYXN5bmMgcmVzZXRJbmRleCgpIHsNCiAgICAgIGF3YWl0IHRoaXMuJHNldCh0aGlzLmN1cnJlbnRQb3NpdGlvbiwgInJvd0luZGV4IiwgbnVsbCk7DQogICAgICBhd2FpdCB0aGlzLiRzZXQodGhpcy5jdXJyZW50UG9zaXRpb24sICJjb2x1bW5JbmRleCIsIG51bGwpOw0KICAgICAgYXdhaXQgdGhpcy4kc2V0KHRoaXMuY3VycmVudFBvc2l0aW9uLCAicm93SWQiLCBudWxsKTsNCiAgICAgIGF3YWl0IHRoaXMuJHNldCh0aGlzLmN1cnJlbnRQb3NpdGlvbiwgImNvbHVtbklkIiwgbnVsbCk7DQogICAgICAvLyBhd2FpdCBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgdGhpcy5rZXlVcEV2ZW50cyk7DQogICAgfSwNCiAgICBzZXRFcnJvcihmMSwgZjIsIGZyb3dJZCkgew0KICAgICAgdGhpcy5mMUlkcyA9IGYxOw0KICAgICAgdGhpcy5mMklkcyA9IGYyOw0KICAgICAgdGhpcy5mUm93SWQgPSBmcm93SWQ7DQogICAgfSwNCiAgICBrZXlVcEV2ZW50c0Rpc2FibGUoZSkgew0KICAgICAgaWYgKHRoaXMuY3VycmVudFBvc2l0aW9uLmNvbHVtbklkICE9IG51bGwpIHsNCiAgICAgICAgaWYgKGUud2hpY2ggPT09IDM4IHx8IGUud2hpY2ggPT09IDQwKSB7DQogICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICBrZXlVcEV2ZW50cyhldnQpIHsNCiAgICAgIHRoaXMua2V5VXBFdmVudHNEaXNhYmxlKGV2dCk7DQogICAgICAvLyBpZiAodGhpcy5jdXJyZW50UG9zaXRpb24uY29sdW1uSWQgIT0gbnVsbCkgew0KICAgICAgLy8gICBpZiAoZXZ0LmtleUNvZGUgPT0gNDAgJiYgdGhpcy5jdXJyZW50UG9zaXRpb24ucm93SWQgIT0gbnVsbCkgew0KICAgICAgLy8gICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgLy8gICAgIC8vIGRvd24NCiAgICAgIC8vICAgICBpZiAodGhpcy5jdXJyZW50UG9zaXRpb24ucm93SW5kZXggPCB0aGlzLnNlbGVjdGVkUm93cy5sZW5ndGggLSAxKSB7DQogICAgICAvLyAgICAgICBsZXQgY3VycmVudENvbHVtbiA9DQogICAgICAvLyAgICAgICAgIHRoaXMudGhpcmRUcklkRGF0YVt0aGlzLmN1cnJlbnRQb3NpdGlvbi5jb2x1bW5JbmRleF07DQogICAgICAvLyAgICAgICBsZXQgZG93blJvd0NvbHVtbiA9DQogICAgICAvLyAgICAgICAgIHRoaXMuc2VsZWN0ZWRSb3dzW3RoaXMuY3VycmVudFBvc2l0aW9uLnJvd0luZGV4ICsgMV07DQogICAgICAvLyAgICAgICBsZXQgZG93bklucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoDQogICAgICAvLyAgICAgICAgIEpTT04uc3RyaW5naWZ5KHsNCiAgICAgIC8vICAgICAgICAgICByb3dJZDogZG93blJvd0NvbHVtbi5pZCwNCiAgICAgIC8vICAgICAgICAgICBjb2x1bW5JZDogY3VycmVudENvbHVtbi5jb2x1bW5JZCwNCiAgICAgIC8vICAgICAgICAgfSkNCiAgICAgIC8vICAgICAgICk7DQogICAgICAvLyAgICAgICBpZiAoZG93bklucHV0KSB7DQogICAgICAvLyAgICAgICAgIGRvd25JbnB1dC5mb2N1cygpOw0KICAgICAgLy8gICAgICAgfQ0KICAgICAgLy8gICAgIH0NCiAgICAgIC8vICAgfSBlbHNlIGlmIChldnQua2V5Q29kZSA9PSAzOCAmJiB0aGlzLmN1cnJlbnRQb3NpdGlvbi5yb3dJZCAhPSBudWxsKSB7DQogICAgICAvLyAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAvLyAgICAgaWYgKHRoaXMuY3VycmVudFBvc2l0aW9uLnJvd0luZGV4ICE9IDApIHsNCiAgICAgIC8vICAgICAgIGxldCBjdXJyZW50Q29sdW1uID0NCiAgICAgIC8vICAgICAgICAgdGhpcy50aGlyZFRySWREYXRhW3RoaXMuY3VycmVudFBvc2l0aW9uLmNvbHVtbkluZGV4XTsNCiAgICAgIC8vICAgICAgIGxldCB1cFJvd0NvbHVtbiA9DQogICAgICAvLyAgICAgICAgIHRoaXMuc2VsZWN0ZWRSb3dzW3RoaXMuY3VycmVudFBvc2l0aW9uLnJvd0luZGV4IC0gMV07DQogICAgICAvLyAgICAgICBsZXQgdXBJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKA0KICAgICAgLy8gICAgICAgICBKU09OLnN0cmluZ2lmeSh7DQogICAgICAvLyAgICAgICAgICAgcm93SWQ6IHVwUm93Q29sdW1uLmlkLA0KICAgICAgLy8gICAgICAgICAgIGNvbHVtbklkOiBjdXJyZW50Q29sdW1uLmNvbHVtbklkLA0KICAgICAgLy8gICAgICAgICB9KQ0KICAgICAgLy8gICAgICAgKTsNCiAgICAgIC8vICAgICAgIGlmICh1cElucHV0KSB7DQogICAgICAvLyAgICAgICAgIHVwSW5wdXQuZm9jdXMoKTsNCiAgICAgIC8vICAgICAgIH0NCiAgICAgIC8vICAgICB9DQogICAgICAvLyAgICAgLy91cA0KICAgICAgLy8gICB9IGVsc2UgaWYgKGV2dC5rZXlDb2RlID09IDM3KSB7DQogICAgICAvLyAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAvLyAgICAgLy9sZWZ0DQogICAgICAvLyAgICAgaWYgKHRoaXMuY3VycmVudFBvc2l0aW9uLmNvbHVtbkluZGV4ICE9IDApIHsNCiAgICAgIC8vICAgICAgIGxldCBwcmV2Q29sdW1uID0NCiAgICAgIC8vICAgICAgICAgdGhpcy50aGlyZFRySWREYXRhW3RoaXMuY3VycmVudFBvc2l0aW9uLmNvbHVtbkluZGV4IC0gMV07DQogICAgICAvLyAgICAgICBsZXQgY3VycmVudFJvdyA9IHRoaXMuc2VsZWN0ZWRSb3dzW3RoaXMuY3VycmVudFBvc2l0aW9uLnJvd0luZGV4XTsNCiAgICAgIC8vICAgICAgIGxldCBwcmV2SW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgNCiAgICAgIC8vICAgICAgICAgSlNPTi5zdHJpbmdpZnkoew0KICAgICAgLy8gICAgICAgICAgIHJvd0lkOiBjdXJyZW50Um93LmlkLA0KICAgICAgLy8gICAgICAgICAgIGNvbHVtbklkOiBwcmV2Q29sdW1uLmNvbHVtbklkLA0KICAgICAgLy8gICAgICAgICB9KQ0KICAgICAgLy8gICAgICAgKTsNCiAgICAgIC8vICAgICAgIGlmIChwcmV2SW5wdXQpIHsNCiAgICAgIC8vICAgICAgICAgaWYgKHByZXZJbnB1dC5kaXNhYmxlZCkgew0KICAgICAgLy8gICAgICAgICAgIGxldCBjb3VudCA9DQogICAgICAvLyAgICAgICAgICAgICB0aGlzLnRoaXJkVHJJZERhdGEubGVuZ3RoIC0NCiAgICAgIC8vICAgICAgICAgICAgICh0aGlzLmN1cnJlbnRQb3NpdGlvbi5jb2x1bW5JbmRleCAtIDEpOw0KICAgICAgLy8gICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykgew0KICAgICAgLy8gICAgICAgICAgICAgbGV0IHByZXZDb2x1bW4yID0NCiAgICAgIC8vICAgICAgICAgICAgICAgdGhpcy50aGlyZFRySWREYXRhWw0KICAgICAgLy8gICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFBvc2l0aW9uLmNvbHVtbkluZGV4IC0gMSAtIGkNCiAgICAgIC8vICAgICAgICAgICAgICAgXTsNCiAgICAgIC8vICAgICAgICAgICAgIGxldCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKA0KICAgICAgLy8gICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7DQogICAgICAvLyAgICAgICAgICAgICAgICAgcm93SWQ6IGN1cnJlbnRSb3cuaWQsDQogICAgICAvLyAgICAgICAgICAgICAgICAgY29sdW1uSWQ6IHByZXZDb2x1bW4yLmNvbHVtbklkLA0KICAgICAgLy8gICAgICAgICAgICAgICB9KQ0KICAgICAgLy8gICAgICAgICAgICAgKTsNCiAgICAgIC8vICAgICAgICAgICAgIGlmIChpbnB1dCAmJiBpbnB1dC5kaXNhYmxlZCkgew0KICAgICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgIC8vICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAvLyAgICAgICAgICAgICAgIGlmIChpbnB1dCkgew0KICAgICAgLy8gICAgICAgICAgICAgICAgIGlucHV0LmZvY3VzKCk7DQogICAgICAvLyAgICAgICAgICAgICAgIH0NCiAgICAgIC8vICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAvLyAgICAgICAgICAgICB9DQogICAgICAvLyAgICAgICAgICAgfQ0KICAgICAgLy8gICAgICAgICB9IGVsc2Ugew0KICAgICAgLy8gICAgICAgICAgIHByZXZJbnB1dC5mb2N1cygpOw0KICAgICAgLy8gICAgICAgICB9DQogICAgICAvLyAgICAgICB9DQogICAgICAvLyAgICAgfQ0KICAgICAgLy8gICB9IGVsc2UgaWYgKGV2dC5rZXlDb2RlID09IDM5KSB7DQogICAgICAvLyAgICAgLy9yaWdodA0KICAgICAgLy8gICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgLy8gICAgIGlmICgNCiAgICAgIC8vICAgICAgIHRoaXMudGhpcmRUcklkRGF0YS5sZW5ndGggLSAxID4NCiAgICAgIC8vICAgICAgIHRoaXMuY3VycmVudFBvc2l0aW9uLmNvbHVtbkluZGV4DQogICAgICAvLyAgICAgKSB7DQogICAgICAvLyAgICAgICBsZXQgbmV4dENvbHVtbiA9DQogICAgICAvLyAgICAgICAgIHRoaXMudGhpcmRUcklkRGF0YVt0aGlzLmN1cnJlbnRQb3NpdGlvbi5jb2x1bW5JbmRleCArIDFdOw0KICAgICAgLy8gICAgICAgbGV0IGN1cnJlbnRSb3cgPSB0aGlzLnNlbGVjdGVkUm93c1t0aGlzLmN1cnJlbnRQb3NpdGlvbi5yb3dJbmRleF07DQogICAgICAvLyAgICAgICBsZXQgbmV4dElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoDQogICAgICAvLyAgICAgICAgIEpTT04uc3RyaW5naWZ5KHsNCiAgICAgIC8vICAgICAgICAgICByb3dJZDogY3VycmVudFJvdy5pZCwNCiAgICAgIC8vICAgICAgICAgICBjb2x1bW5JZDogbmV4dENvbHVtbi5jb2x1bW5JZCwNCiAgICAgIC8vICAgICAgICAgfSkNCiAgICAgIC8vICAgICAgICk7DQogICAgICAvLyAgICAgICBpZiAobmV4dElucHV0KSB7DQogICAgICAvLyAgICAgICAgIGlmIChuZXh0SW5wdXQuZGlzYWJsZWQpIHsNCiAgICAgIC8vICAgICAgICAgICBsZXQgZm9yQ291bnQgPQ0KICAgICAgLy8gICAgICAgICAgICAgdGhpcy50aGlyZFRySWREYXRhLmxlbmd0aCAtDQogICAgICAvLyAgICAgICAgICAgICAodGhpcy5jdXJyZW50UG9zaXRpb24uY29sdW1uSW5kZXggKyAxKTsNCiAgICAgIC8vICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZvckNvdW50OyBpKyspIHsNCiAgICAgIC8vICAgICAgICAgICAgIGxldCBuZXh0Q29sdW1uMiA9DQogICAgICAvLyAgICAgICAgICAgICAgIHRoaXMudGhpcmRUcklkRGF0YVsNCiAgICAgIC8vICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQb3NpdGlvbi5jb2x1bW5JbmRleCArIDEgKyBpDQogICAgICAvLyAgICAgICAgICAgICAgIF07DQoNCiAgICAgIC8vICAgICAgICAgICAgIGxldCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKA0KICAgICAgLy8gICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7DQogICAgICAvLyAgICAgICAgICAgICAgICAgcm93SWQ6IGN1cnJlbnRSb3cuaWQsDQogICAgICAvLyAgICAgICAgICAgICAgICAgY29sdW1uSWQ6IG5leHRDb2x1bW4yLmNvbHVtbklkLA0KICAgICAgLy8gICAgICAgICAgICAgICB9KQ0KICAgICAgLy8gICAgICAgICAgICAgKTsNCiAgICAgIC8vICAgICAgICAgICAgIGlmIChpbnB1dC5kaXNhYmxlZCkgew0KICAgICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgIC8vICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAvLyAgICAgICAgICAgICAgIGlmIChpbnB1dCkgew0KICAgICAgLy8gICAgICAgICAgICAgICAgIGlucHV0LmZvY3VzKCk7DQogICAgICAvLyAgICAgICAgICAgICAgIH0NCiAgICAgIC8vICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAvLyAgICAgICAgICAgICB9DQogICAgICAvLyAgICAgICAgICAgfQ0KICAgICAgLy8gICAgICAgICB9IGVsc2Ugew0KICAgICAgLy8gICAgICAgICAgIG5leHRJbnB1dC5mb2N1cygpOw0KICAgICAgLy8gICAgICAgICB9DQogICAgICAvLyAgICAgICB9DQogICAgICAvLyAgICAgfQ0KICAgICAgLy8gICB9DQogICAgICAvLyB9DQogICAgfQ0KICAgICwNCg0KICAgIGZvY3VzVmFsKHJvd0lkLCB2YWx1ZSwgcm93SW5kZXgsIGNvbHVtbkluZGV4LCBjb2x1bW5JZCwgdHlwZUNvZGUpIHsNCiAgICAgIHRoaXMuJHNldCh0aGlzLmN1cnJlbnRQb3NpdGlvbiwgInJvd0luZGV4IiwgcGFyc2VGbG9hdChyb3dJbmRleCkpOw0KICAgICAgdGhpcy4kc2V0KHRoaXMuY3VycmVudFBvc2l0aW9uLCAiY29sdW1uSW5kZXgiLCBwYXJzZUZsb2F0KGNvbHVtbkluZGV4KSk7DQogICAgICB0aGlzLiRzZXQodGhpcy5jdXJyZW50UG9zaXRpb24sICJyb3dJZCIsIHBhcnNlRmxvYXQocm93SWQpKTsNCiAgICAgIHRoaXMuJHNldCh0aGlzLmN1cnJlbnRQb3NpdGlvbiwgImNvbHVtbklkIiwgcGFyc2VGbG9hdChjb2x1bW5JZCkpOw0KICAgIH0sDQogICAgZ2V0Rm9ybXVsYXNfMigpIHsNCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzLCByZWopID0+IHsNCiAgICAgICAgaWYgKHRoaXMudGFibGVJZCkgew0KICAgICAgICAgIFNlcnZpY2UuZm9ybXVsYXNCeVRhYmxlSWRfMih0aGlzLnRhYmxlSWQpDQogICAgICAgICAgICAgIC50aGVuKCh7IGRhdGEgfSkgPT4gew0KICAgICAgICAgICAgICAgIHRoaXMuZm9ybXVsYXMgPSBkYXRhOw0KICAgICAgICAgICAgICAgIHJlcyhkYXRhKTsNCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiByZWooZSkpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJlaigpOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9LA0KICAgIGdldERhdGFCeUlkKGlkKSB7DQogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlcywgcmVqKSA9PiB7DQogICAgICAgIFNlcnZpY2UuZ2V0UmVwb3J0QnlJZChpZCkNCiAgICAgICAgICAgIC50aGVuKCh7IGRhdGEgfSkgPT4gew0KICAgICAgICAgICAgICByZXMoZGF0YSk7DQogICAgICAgICAgICB9KQ0KICAgICAgICAgICAgLmNhdGNoKChlKSA9PiByZWooZSkpOw0KICAgICAgfSk7DQogICAgfSwNCiAgICBlZGl0VmFsdWUocm93SW5kZXgsIGluZGV4KSB7DQogICAgICB0aGlzLiRzZXQodGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtyb3dJbmRleF0sICdub3RFZGl0YWJsZScsIGZhbHNlKQ0KICAgICAgdGhpcy4kZm9yY2VVcGRhdGUoKTsNCiAgICB9LA0KICAgIHJlc2V0VmFsdWUocm93SW5kZXgsIGluZGV4KSB7DQogICAgICB0aGlzLiRzZXQodGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtyb3dJbmRleF0sICdzZWxlY3RWYWx1ZUlkJywgdGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtyb3dJbmRleF0ub3JpZ2luYWxTZWxlY3RWYWx1ZUlkKQ0KICAgICAgdGhpcy4kc2V0KHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdLCAnc2VsZWN0VmFsdWVOYW1lVXonLCB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XS5vcmlnaW5hbFNlbGVjdFZhbHVlTmFtZVV6KQ0KICAgICAgdGhpcy4kc2V0KHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdLCAnc2VsZWN0VmFsdWVOYW1lTHQnLCB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XS5vcmlnaW5hbFNlbGVjdFZhbHVlTmFtZUx0KQ0KICAgICAgdGhpcy4kc2V0KHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdLCAnc2VsZWN0VmFsdWVOYW1lUnUnLCB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XS5vcmlnaW5hbFNlbGVjdFZhbHVlTmFtZVJ1KQ0KICAgICAgdGhpcy4kc2V0KHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdLCAnbm90RWRpdGFibGUnLCB0cnVlKQ0KICAgICAgdGhpcy4kZm9yY2VVcGRhdGUoKTsNCiAgICB9LA0KICAgIHNldFZhbHVlKHJvd0lkLCB2YWx1ZSwgcm93SW5kZXgsIGluZGV4LCBpZCwgdHlwZUNvZGUsIG5vdEVkaXRhYmxlID0gZmFsc2UsIGluaXRpYWxMb2FkQ2FsbCA9IGZhbHNlKSB7DQogICAgICAvLyB2YWx1ZS5yb3dJZCA9IHJvd0lkDQogICAgICAvLyB2YWx1ZS50eXBlQ29kZSA9IHR5cGVDb2RlDQogICAgICAvLw0KICAgICAgLy8gdmFsdWUubm90RWRpdGFibGUgPSBub3RFZGl0YWJsZQ0KICAgICAgLy8gdmFsdWUuc2VsZWN0VmFsdWVOYW1lTHQgPSB2YWx1ZS5uYW1lTHQNCiAgICAgIC8vIHZhbHVlLnNlbGVjdFZhbHVlTmFtZVJ1ID0gdmFsdWUubmFtZVJ1DQogICAgICAvLyB2YWx1ZS5zZWxlY3RWYWx1ZU5hbWVVeiA9IHZhbHVlLm5hbWVVeg0KICAgICAgLy8NCiAgICAgIC8qIHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdID0gew0KICAgICAgICByb3dJZDogcm93SWQgPyByb3dJZCA6IG51bGwsDQogICAgICAgIHZhbHVlOiB0eXBlQ29kZSA9PT0gJ1NFTEVDVCcgPyAnJyA6IHZhbHVlLA0KICAgICAgICBzZWxlY3RWYWx1ZU5hbWVVejogdmFsdWUgPyB2YWx1ZS5uYW1lVXogOiBudWxsLA0KICAgICAgICBzZWxlY3RWYWx1ZU5hbWVMdDogdmFsdWUgPyB2YWx1ZS5uYW1lTHQgOiBudWxsLA0KICAgICAgICBzZWxlY3RWYWx1ZU5hbWVSdTogdmFsdWUgPyB2YWx1ZS5uYW1lUnUgOiBudWxsLA0KICAgICAgICBvcmlnaW5hbFNlbGVjdFZhbHVlTmFtZVV6OiB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XSA/IHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdLm9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lVXogOiAnJywNCiAgICAgICAgb3JpZ2luYWxTZWxlY3RWYWx1ZU5hbWVMdDogdGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtyb3dJbmRleF0gPyB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XS5vcmlnaW5hbFNlbGVjdFZhbHVlTmFtZUx0IDogJycsDQogICAgICAgIG9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lUnU6IHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdID8gdGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtyb3dJbmRleF0ub3JpZ2luYWxTZWxlY3RWYWx1ZU5hbWVSdSA6ICcnLA0KICAgICAgICB0eXBlQ29kZTogdHlwZUNvZGUsDQogICAgICAgIGNvbHVtbklkOiBpZCwNCiAgICAgICAgbm90RWRpdGFibGU6IG5vdEVkaXRhYmxlDQogICAgICB9OyAqLw0KICAgICAgaWYgKGluaXRpYWxMb2FkQ2FsbCAmJiB0eXBlQ29kZSA9PT0gJ1NFTEVDVCcpIHsNCiAgICAgICAgbGV0IHJvd0luZGV4ID0gdGhpcy5zZWxlY3RlZFJvd3MuZmluZEluZGV4KGVsID0+IGVsLmlkID09IHJvd0lkKQ0KICAgICAgICBpZiAoIXRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdLnJvd0lkKSB7DQogICAgICAgICAgdGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtyb3dJbmRleF0gPSB7DQogICAgICAgICAgICByb3dJZDogcm93SWQsDQogICAgICAgICAgICB2YWx1ZTogdHlwZUNvZGUgPT09ICdTRUxFQ1QnID8gJycgOiB2YWx1ZSwNCiAgICAgICAgICAgIHNlbGVjdFZhbHVlSWQ6IHZhbHVlID8gdmFsdWUuaWQgOiBudWxsLA0KICAgICAgICAgICAgc2VsZWN0VmFsdWVOYW1lVXo6IHZhbHVlID8gKHZhbHVlLm5hbWVVeiA/IHZhbHVlLm5hbWVVeiA6IHZhbHVlLm5hbWUpIDogbnVsbCwNCiAgICAgICAgICAgIHNlbGVjdFZhbHVlTmFtZUx0OiB2YWx1ZSA/IHZhbHVlLm5hbWVMdCA6IG51bGwsDQogICAgICAgICAgICBzZWxlY3RWYWx1ZU5hbWVSdTogdmFsdWUgPyB2YWx1ZS5uYW1lUnUgOiBudWxsLA0KICAgICAgICAgICAgb3JpZ2luYWxTZWxlY3RWYWx1ZU5hbWVVejogdGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtyb3dJbmRleF0gPyB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XS5vcmlnaW5hbFNlbGVjdFZhbHVlTmFtZVV6IDogJycsDQogICAgICAgICAgICBvcmlnaW5hbFNlbGVjdFZhbHVlTmFtZUx0OiB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XSA/IHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdLm9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lTHQgOiAnJywNCiAgICAgICAgICAgIG9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lUnU6IHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdID8gdGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtyb3dJbmRleF0ub3JpZ2luYWxTZWxlY3RWYWx1ZU5hbWVSdSA6ICcnLA0KICAgICAgICAgICAgdHlwZUNvZGU6IHR5cGVDb2RlLA0KICAgICAgICAgICAgY29sdW1uSWQ6IGlkLA0KICAgICAgICAgICAgbm90RWRpdGFibGU6IG5vdEVkaXRhYmxlLA0KICAgICAgICAgIH0NCiAgICAgICAgICB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XS5vcmlnaW5hbHNlbGVjdFZhbHVlSWQgPSB2YWx1ZS5pZA0KICAgICAgICAgIHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdLm9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lVXogPSB2YWx1ZS5uYW1lVXoNCiAgICAgICAgICB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XS5vcmlnaW5hbFNlbGVjdFZhbHVlTmFtZUx0ID0gdmFsdWUubmFtZUx0DQogICAgICAgICAgdGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtyb3dJbmRleF0ub3JpZ2luYWxTZWxlY3RWYWx1ZU5hbWVSdSA9IHZhbHVlLm5hbWVSdQ0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICBpZiAodHlwZUNvZGUgPT09ICdTRUxFQ1QnKSB7DQogICAgICAgICAgdmFsdWUucm93SWQgPSByb3dJZA0KICAgICAgICAgIHZhbHVlLmNvbHVtbklkID0gaWQNCiAgICAgICAgICB2YWx1ZS50eXBlQ29kZSA9IHR5cGVDb2RlDQogICAgICAgICAgdmFsdWUubm90RWRpdGFibGUgPSBub3RFZGl0YWJsZQ0KICAgICAgICAgIHZhbHVlLnNlbGVjdFZhbHVlSWQgPSB2YWx1ZS5pZA0KICAgICAgICAgIHZhbHVlLnNlbGVjdFZhbHVlTmFtZUx0ID0gdmFsdWUubmFtZUx0DQogICAgICAgICAgdmFsdWUuc2VsZWN0VmFsdWVOYW1lUnUgPSB2YWx1ZS5uYW1lUnUNCiAgICAgICAgICB2YWx1ZS5zZWxlY3RWYWx1ZU5hbWVVeiA9IHZhbHVlLm5hbWVVeiA/IHZhbHVlLm5hbWVVeiA6IHZhbHVlLm5hbWUNCiAgICAgICAgfQ0KDQogICAgICAgIHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdID0gew0KICAgICAgICAgIHJvd0lkOiByb3dJZCwNCiAgICAgICAgICB2YWx1ZTogdHlwZUNvZGUgPT09ICdTRUxFQ1QnID8gJycgOiB2YWx1ZSwNCiAgICAgICAgICBzZWxlY3RWYWx1ZUlkOiB2YWx1ZSA/IHZhbHVlLmlkIDogbnVsbCwNCiAgICAgICAgICBzZWxlY3RWYWx1ZU5hbWVVejogdmFsdWUgPyB2YWx1ZS5uYW1lVXogOiBudWxsLA0KICAgICAgICAgIHNlbGVjdFZhbHVlTmFtZUx0OiB2YWx1ZSA/IHZhbHVlLm5hbWVMdCA6IG51bGwsDQogICAgICAgICAgc2VsZWN0VmFsdWVOYW1lUnU6IHZhbHVlID8gdmFsdWUubmFtZVJ1IDogbnVsbCwNCiAgICAgICAgICBvcmlnaW5hbFNlbGVjdFZhbHVlTmFtZVV6OiB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XSA/IHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdLm9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lVXogOiAnJywNCiAgICAgICAgICBvcmlnaW5hbFNlbGVjdFZhbHVlTmFtZUx0OiB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XSA/IHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdLm9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lTHQgOiAnJywNCiAgICAgICAgICBvcmlnaW5hbFNlbGVjdFZhbHVlTmFtZVJ1OiB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XSA/IHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdLm9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lUnUgOiAnJywNCiAgICAgICAgICB0eXBlQ29kZTogdHlwZUNvZGUsDQogICAgICAgICAgY29sdW1uSWQ6IGlkLA0KICAgICAgICAgIG5vdEVkaXRhYmxlOiBub3RFZGl0YWJsZSwNCiAgICAgICAgfTsNCiAgICAgIH0NCg0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgibm9fZW50ZXJfdmFsdWUiKS5mb3JFYWNoKChpbnB1dCkgPT4gew0KICAgICAgICBpZiAoSlNPTi5wYXJzZShpbnB1dC5pZCkucm93SWQpIHsNCiAgICAgICAgICB0aGlzLmZvcm11bGFzLmZvckVhY2goKGUpID0+IHsNCiAgICAgICAgICAgIGxldCBpbmRleF9mMiA9IEpTT04ucGFyc2UoZS5mMikuZmluZEluZGV4KChkKSA9PiBkID09IHBhcnNlRmxvYXQoaWQpKTsNCiAgICAgICAgICAgIGxldCBpbmRleF9mMSA9IEpTT04ucGFyc2UoZS5mMSkuZmluZEluZGV4KChkKSA9PiBkID09IHBhcnNlRmxvYXQoSlNPTi5wYXJzZShpbnB1dC5pZCkuY29sdW1uSWQpKTsNCiAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgICBpbmRleF9mMiA+IC0xICYmDQogICAgICAgICAgICAgICAgaW5kZXhfZjEgPiAtMSAmJg0KICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQoSlNPTi5wYXJzZShpbnB1dC5pZCkucm93SWQpID09PSBwYXJzZUZsb2F0KHJvd0lkKQ0KICAgICAgICAgICAgKSB7DQoNCiAgICAgICAgICAgICAgbGV0IGFsbFZhbCA9IDA7DQogICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImlucHV0X3ZhbCIpLmZvckVhY2goKHZJbnB1dCkgPT4gew0KICAgICAgICAgICAgICAgIGxldCBlX2luZGV4X2YyID0gSlNPTi5wYXJzZShlLmYyKS5maW5kSW5kZXgoDQogICAgICAgICAgICAgICAgICAgIChkKSA9PiBkID09IHBhcnNlRmxvYXQoSlNPTi5wYXJzZSh2SW5wdXQuaWQpLmNvbHVtbklkKQ0KICAgICAgICAgICAgICAgICk7DQoNCiAgICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgICAgIGVfaW5kZXhfZjIgPiAtMSAmJg0KICAgICAgICAgICAgICAgICAgICBwYXJzZUZsb2F0KEpTT04ucGFyc2UodklucHV0LmlkKS5yb3dJZCkgPT09IHBhcnNlRmxvYXQocm93SWQpDQogICAgICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgICAgICBpZiAodGhpcy5fZW1wdHkodklucHV0LnZhbHVlKSkgew0KICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJzZUZsb2F0KHZJbnB1dC52YWx1ZSkgPT0gIm51bWJlciIpIHsNCiAgICAgICAgICAgICAgICAgICAgICBhbGxWYWwgKz0gcGFyc2VGbG9hdCh2SW5wdXQudmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgIGFsbFZhbCArPSAwOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgIHRoaXMuJHNldChpbnB1dCwgInZhbHVlIiwgcGFyc2VGbG9hdChhbGxWYWwpKTsNCiAgICAgICAgICAgICAgICAgIGxldCBmb3VuZEluZGV4ID0gdGhpcy50aGlyZFRySWREYXRhLmZpbmRJbmRleCgNCiAgICAgICAgICAgICAgICAgICAgICAoZSkgPT4gZS5jb2x1bW5JZCA9PSBKU09OLnBhcnNlKGlucHV0LmlkKS5jb2x1bW5JZA0KICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICAgIHRoaXMudGhpcmRUcklkRGF0YVtmb3VuZEluZGV4XS52YWx1ZVtyb3dJbmRleF0gPSB7DQogICAgICAgICAgICAgICAgICAgIHJvd0lkOiByb3dJZCA/IHJvd0lkIDogbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGFsbFZhbCwNCiAgICAgICAgICAgICAgICAgICAgdHlwZUNvZGU6IHR5cGVDb2RlLA0KICAgICAgICAgICAgICAgICAgICBjb2x1bW5JZDogSlNPTi5wYXJzZShpbnB1dC5pZCkuY29sdW1uSWQsDQogICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgdGhpcy4kZm9yY2VVcGRhdGUoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRoaXMuZm9ybXVsYXMuZm9yRWFjaCgoZSkgPT4gew0KICAgICAgICAgICAgbGV0IGluZGV4X2YyID0gSlNPTi5wYXJzZShlLmYyKS5maW5kSW5kZXgoDQogICAgICAgICAgICAgICAgKGQpID0+IGQgPT0gcGFyc2VGbG9hdChpZCkNCiAgICAgICAgICAgICk7DQogICAgICAgICAgICBsZXQgaW5kZXhfZjEgPSBKU09OLnBhcnNlKGUuZjEpLmZpbmRJbmRleCgNCiAgICAgICAgICAgICAgICAoZCkgPT4gZCA9PSBwYXJzZUZsb2F0KEpTT04ucGFyc2UoaW5wdXQuaWQpLmNvbHVtbklkKQ0KICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIGlmIChpbmRleF9mMiA+IC0xICYmIGluZGV4X2YxID4gLTEpIHsNCiAgICAgICAgICAgICAgbGV0IGFsbFZhbCA9IDA7DQogICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImlucHV0X3ZhbCIpLmZvckVhY2goKHZJbnB1dCkgPT4gew0KICAgICAgICAgICAgICAgIGxldCBlX2luZGV4X2YyID0gSlNPTi5wYXJzZShlLmYyKS5maW5kSW5kZXgoDQogICAgICAgICAgICAgICAgICAgIChkKSA9PiBkID09IHBhcnNlRmxvYXQoSlNPTi5wYXJzZSh2SW5wdXQuaWQpLmNvbHVtbklkKQ0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgaWYgKGVfaW5kZXhfZjIgPiAtMSkgew0KICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2VtcHR5KHZJbnB1dC52YWx1ZSkpIHsNCiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcGFyc2VGbG9hdCh2SW5wdXQudmFsdWUpID09ICJudW1iZXIiKSB7DQogICAgICAgICAgICAgICAgICAgICAgYWxsVmFsICs9IHBhcnNlRmxvYXQodklucHV0LnZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICBhbGxWYWwgKz0gMDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0aGlzLiRzZXQoaW5wdXQsICJ2YWx1ZSIsIHBhcnNlRmxvYXQoYWxsVmFsKSk7DQogICAgICAgICAgICAgICAgbGV0IGZvdW5kSW5kZXggPSB0aGlzLnRoaXJkVHJJZERhdGEuZmluZEluZGV4KA0KICAgICAgICAgICAgICAgICAgICAoZSkgPT4gZS5jb2x1bW5JZCA9PSBKU09OLnBhcnNlKGlucHV0LmlkKS5jb2x1bW5JZA0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgdGhpcy50aGlyZFRySWREYXRhW2ZvdW5kSW5kZXhdLnZhbHVlWzBdID0gew0KICAgICAgICAgICAgICAgICAgcm93SWQ6IG51bGwsDQogICAgICAgICAgICAgICAgICB2YWx1ZTogYWxsVmFsLA0KICAgICAgICAgICAgICAgICAgdHlwZUNvZGU6IHR5cGVDb2RlLA0KICAgICAgICAgICAgICAgICAgY29sdW1uSWQ6IEpTT04ucGFyc2UoaW5wdXQuaWQpLmNvbHVtbklkLA0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgdGhpcy4kZm9yY2VVcGRhdGUoKTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgIH0pOw0KDQogICAgICB0aGlzLiRmb3JjZVVwZGF0ZSgpOw0KDQogICAgfSwNCiAgICBhc3luYyBzZXREb2N1bWVudENvbHVtblZhbHVlcyhkYXRhLCBmb3JtdWxhcykgew0KICAgICAgdGhpcy5zaG93RGF0YSA9IFtdDQogICAgICB0aGlzLmN1cnJlbnRJdGVtRGF0YSA9IGRhdGENCiAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoKSB7DQogICAgICAgIGRhdGEuZm9yRWFjaCgoZSkgPT4gew0KICAgICAgICAgIGlmIChlLnZhbHVlU3RyaW5nIHx8IGUudmFsdWVCaWdEZWNpbWFsKSB7DQogICAgICAgICAgICBpZiAoZS50eXBlQ29kZSA9PT0gIllFQVIiKSB7DQogICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImN1c3RvbS1kYXRlcGlja2VyIG14LWRhdGVwaWNrZXIgZHluYW1pYy15ZWFyIikuZm9yRWFjaCgoZmllbGQsIGlkeCkgPT4gew0KICAgICAgICAgICAgICAgIGlmIChKU09OLnBhcnNlKGZpZWxkLmlkKS5yb3dJZCkgew0KICAgICAgICAgICAgICAgICAgaWYgKA0KICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQoSlNPTi5wYXJzZShmaWVsZC5pZCkuY29sdW1uSWQpID09PSBwYXJzZUZsb2F0KGUuY29sdW1uSWQpICYmDQogICAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdChKU09OLnBhcnNlKGZpZWxkLmlkKS5yb3dJZCkgPT09IHBhcnNlRmxvYXQoZS5yb3dJZCkNCiAgICAgICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgICAgICBsZXQgcm93SW5kZXggPSB0aGlzLnNlbGVjdGVkUm93cy5maW5kSW5kZXgoZWwgPT4gZWwuaWQgPT0gSlNPTi5wYXJzZShmaWVsZC5pZCkucm93SWQpDQogICAgICAgICAgICAgICAgICAgIGxldCBjb2xJbmRleCA9IHRoaXMudGhpcmRUcklkRGF0YS5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLmNvbHVtbklkID09PSBlLmNvbHVtbklkKQ0KICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlKGUucm93SWQsIGUudmFsdWUsIHJvd0luZGV4LCBjb2xJbmRleCwgZS5jb2x1bW5JZCwgJ0RBVEUnKQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIGlmIChlLnR5cGVDb2RlID09PSAnQklHREVDSU1BTCcpIHsNCiAgICAgICAgICAgICAgICBsZXQgZm91bmRDb2x1bW5JZCA9IHRoaXMuc2hvd0RhdGEuZmluZEluZGV4KChkKSA9PiBkLmNvbHVtbklkID09PSBlLmNvbHVtbklkKQ0KICAgICAgICAgICAgICAgIGlmIChmb3VuZENvbHVtbklkID4gLTEpIHsNCiAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0RhdGEubWFwKGYgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZiAoZi5jb2x1bW5JZCA9PSBlLmNvbHVtbklkKSB7DQogICAgICAgICAgICAgICAgICAgICAgZi5jb2x1bW5EYXRhID0gKCtmLmNvbHVtbkRhdGEpICsgKCtlLnZhbHVlKQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICB0aGlzLnNob3dEYXRhLnB1c2goew0KICAgICAgICAgICAgICAgICAgICBjb2x1bW5JZDogZS5jb2x1bW5JZCwNCiAgICAgICAgICAgICAgICAgICAgY29sdW1uRGF0YTogKGUudmFsdWUpDQogICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIGRvY3VtZW50DQogICAgICAgICAgICAgICAgICAuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiaW5wdXRfdmFsIikuZm9yRWFjaCgoaW5wdXQpID0+IHsNCiAgICAgICAgICAgICAgICBmb3JtdWxhcy5mb3JFYWNoKChlbGVtZW50KSA9PiB7DQogICAgICAgICAgICAgICAgICBsZXQgaW5kZXhfViA9IEpTT04ucGFyc2UoZWxlbWVudC5mMSkuZmluZEluZGV4KChlKSA9PiBlID09IEpTT04ucGFyc2UoaW5wdXQuaWQpLmNvbHVtbklkKTsNCiAgICAgICAgICAgICAgICAgIGlmIChpbmRleF9WID4gLTEpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc2V0KGlucHV0LCAiZGlzYWJsZWQiLCB0cnVlKTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc2V0KGlucHV0LnN0eWxlLCAiYm9yZGVyIiwgIm5vbmUiKTsNCiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2xhc3NMaXN0LmFkZCgibm9fZW50ZXJfdmFsdWUiKTsNCiAgICAgICAgICAgICAgICAgICAgaW5wdXQuc3R5bGUuZm9udFdlaWdodCA9ICJib2xkIjsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgIGlmIChKU09OLnBhcnNlKGlucHV0LmlkKS5yb3dJZCkgew0KICAgICAgICAgICAgICAgICAgaWYgKA0KICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQoSlNPTi5wYXJzZShpbnB1dC5pZCkuY29sdW1uSWQpID09PSBwYXJzZUZsb2F0KGUuY29sdW1uSWQpICYmDQogICAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdChKU09OLnBhcnNlKGlucHV0LmlkKS5yb3dJZCkgPT09IHBhcnNlRmxvYXQoZS5yb3dJZCkNCiAgICAgICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLiRzZXQoaW5wdXQsICJ2YWx1ZSIsIGUudmFsdWUpOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdChKU09OLnBhcnNlKGlucHV0LmlkKS5jb2x1bW5JZCkgPT09IHBhcnNlRmxvYXQoZS5jb2x1bW5JZCkNCiAgICAgICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLiRzZXQoaW5wdXQsICJ2YWx1ZSIsIGUudmFsdWUpOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSBlbHNlIGlmIChlLnZhbHVlRGF0ZSkgew0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiY3VzdG9tLWRhdGVwaWNrZXIgbXgtZGF0ZXBpY2tlciBkeW5hbWljLWRhdGVwaWNrZXIiKS5mb3JFYWNoKChmaWVsZCwgaWR4KSA9PiB7DQogICAgICAgICAgICAgIGlmIChKU09OLnBhcnNlKGZpZWxkLmlkKS5yb3dJZCkgew0KICAgICAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdChKU09OLnBhcnNlKGZpZWxkLmlkKS5jb2x1bW5JZCkgPT09IHBhcnNlRmxvYXQoZS5jb2x1bW5JZCkgJiYNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdChKU09OLnBhcnNlKGZpZWxkLmlkKS5yb3dJZCkgPT09IHBhcnNlRmxvYXQoZS5yb3dJZCkNCiAgICAgICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICAgIGxldCByb3dJbmRleCA9IHRoaXMuc2VsZWN0ZWRSb3dzLmZpbmRJbmRleChlbCA9PiBlbC5pZCA9PSBKU09OLnBhcnNlKGZpZWxkLmlkKS5yb3dJZCkNCiAgICAgICAgICAgICAgICAgIGxldCBjb2xJbmRleCA9IHRoaXMudGhpcmRUcklkRGF0YS5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLmNvbHVtbklkID09PSBlLmNvbHVtbklkKQ0KICAgICAgICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZShlLnJvd0lkLCBlLnZhbHVlLCByb3dJbmRleCwgY29sSW5kZXgsIGUuY29sdW1uSWQsICdEQVRFJykNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfSBlbHNlIGlmIChlLnZhbHVlQm9vbGVhbiAhPT0gbnVsbCkgew0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiY2hlY2tib3hfZmllbGQiKS5mb3JFYWNoKChmaWVsZCwgaWR4KSA9PiB7DQogICAgICAgICAgICAgIGxldCBjaGVja2JveElucHV0ID0gZmllbGQuY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSA/IGZpZWxkLmNoaWxkcmVuWzBdLmNoaWxkcmVuWzFdLmNoaWxkcmVuWzBdIDogZmllbGQuY2hpbGRyZW5bMF0uY2hpbGRyZW5bMF0uY2hpbGRyZW5bMF0NCiAgICAgICAgICAgICAgaWYgKGNoZWNrYm94SW5wdXQuaWQgJiYgSlNPTi5wYXJzZShjaGVja2JveElucHV0LmlkKSAmJiBKU09OLnBhcnNlKGNoZWNrYm94SW5wdXQuaWQpLnJvd0lkKSB7DQogICAgICAgICAgICAgICAgaWYgKA0KICAgICAgICAgICAgICAgICAgICBwYXJzZUZsb2F0KEpTT04ucGFyc2UoY2hlY2tib3hJbnB1dC5pZCkuY29sdW1uSWQpID09PSBwYXJzZUZsb2F0KGUuY29sdW1uSWQpICYmDQogICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQoSlNPTi5wYXJzZShjaGVja2JveElucHV0LmlkKS5yb3dJZCkgPT09IHBhcnNlRmxvYXQoZS5yb3dJZCkNCiAgICAgICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICAgIGxldCByb3dJbmRleCA9IHRoaXMuc2VsZWN0ZWRSb3dzLmZpbmRJbmRleChlbCA9PiBlbC5pZCA9PSBKU09OLnBhcnNlKGNoZWNrYm94SW5wdXQuaWQpLnJvd0lkKQ0KICAgICAgICAgICAgICAgICAgbGV0IGNvbEluZGV4ID0gdGhpcy50aGlyZFRySWREYXRhLmZpbmRJbmRleChpdGVtID0+IGl0ZW0uY29sdW1uSWQgPT0gZS5jb2x1bW5JZCkNCiAgICAgICAgICAgICAgICAgIHRoaXMuc2V0VmFsdWUoZS5yb3dJZCwgSlNPTi5wYXJzZShlLnZhbHVlKSwgcm93SW5kZXgsIGNvbEluZGV4LCBlLmNvbHVtbklkLCAnQk9PTEVBTicpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KQ0KICAgICAgICAgIH0gZWxzZSBpZiAoZS5zZWxlY3RWYWx1ZU5hbWVVeikgew0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgic2VsZWN0X2ZpZWxkIikuZm9yRWFjaCgoZmllbGQsIGlkeCkgPT4gew0KICAgICAgICAgICAgICBpZiAoSlNPTi5wYXJzZShmaWVsZC5pZCkucm93SWQpIHsNCiAgICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQoSlNPTi5wYXJzZShmaWVsZC5pZCkuY29sdW1uSWQpID09PSBwYXJzZUZsb2F0KGUuY29sdW1uSWQpICYmDQogICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQoSlNPTi5wYXJzZShmaWVsZC5pZCkucm93SWQpID09PSBwYXJzZUZsb2F0KGUucm93SWQpDQogICAgICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgICAgICBsZXQgcm93SW5kZXggPSB0aGlzLnNlbGVjdGVkUm93cy5maW5kSW5kZXgoZWwgPT4gZWwuaWQgPT0gSlNPTi5wYXJzZShmaWVsZC5pZCkucm93SWQpDQogICAgICAgICAgICAgICAgICBsZXQgY29sSW5kZXggPSB0aGlzLnRoaXJkVHJJZERhdGEuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS5jb2x1bW5JZCA9PSBlLmNvbHVtbklkKQ0KICAgICAgICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZSgNCiAgICAgICAgICAgICAgICAgICAgICBlLnJvd0lkLA0KICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVVejogZS5zZWxlY3RWYWx1ZU5hbWVVeiwNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVMdDogZS5zZWxlY3RWYWx1ZU5hbWVMdCwNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVSdTogZS5zZWxlY3RWYWx1ZU5hbWVSdSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBlLnNlbGVjdFZhbHVlSWQNCiAgICAgICAgICAgICAgICAgICAgICB9LCByb3dJbmRleCwgY29sSW5kZXgsIGUuY29sdW1uSWQsICdTRUxFQ1QnLCB0cnVlLCB0cnVlKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgZG9jdW1lbnQNCiAgICAgICAgICAgIC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJpbnB1dF92YWwiKQ0KICAgICAgICAgICAgLmZvckVhY2goKGlucHV0KSA9PiB7DQogICAgICAgICAgICAgIGZvcm11bGFzLmZvckVhY2goKGVsZW1lbnQpID0+IHsNCiAgICAgICAgICAgICAgICBsZXQgaW5kZXhfViA9IEpTT04ucGFyc2UoZWxlbWVudC5mMSkuZmluZEluZGV4KA0KICAgICAgICAgICAgICAgICAgICAoZSkgPT4gZSA9PSBKU09OLnBhcnNlKGlucHV0LmlkKS5jb2x1bW5JZA0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgaWYgKGluZGV4X1YgPiAtMSkgew0KICAgICAgICAgICAgICAgICAgdGhpcy4kc2V0KGlucHV0LCAiZGlzYWJsZWQiLCB0cnVlKTsNCiAgICAgICAgICAgICAgICAgIHRoaXMuJHNldChpbnB1dC5zdHlsZSwgImJvcmRlciIsICJub25lIik7DQogICAgICAgICAgICAgICAgICBpbnB1dC5jbGFzc0xpc3QuYWRkKCJub19lbnRlcl92YWx1ZSIpOw0KICAgICAgICAgICAgICAgICAgaW5wdXQuc3R5bGUuZm9udFdlaWdodCA9ICJib2xkIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQogICAgICB9DQogICAgICBmb3IgKGNvbnN0IGRvY1RhYmxlRm9ybXVsYVRhcmdldElkIGluIHRoaXMuZG9jVGFibGVGb3JtdWxhc0xpc3QpIHsNCiAgICAgICAgbGV0IGRpc2FibGVkRWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtkYXRhLWNvbHVtbi1pZD0iJyArIGRvY1RhYmxlRm9ybXVsYVRhcmdldElkICsgJyJdJyk7DQogICAgICAgIGRpc2FibGVkRWxlbWVudHMuZm9yRWFjaCgoZWxlbWVudCkgPT4gew0KICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgibm9fZW50ZXJfdmFsdWUiKTsNCiAgICAgICAgICBlbGVtZW50LmRpc2FibGVkID0gdHJ1ZTsNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgfSwNCiAgICBhc3luYyBnZXRCeUlkKGlkLCByZXBvcnRJZCwgaW5mbykgew0KICAgICAgdGhpcy5jbGVhckFsbCgpOw0KICAgICAgdGhpcy50YWJsZUlkID0gaWQ7DQogICAgICB0aGlzLnJlcG9ydElkID0gcmVwb3J0SWQ7DQogICAgICB0aGlzLnRhYmxlSW5mbyA9IGluZm87DQogICAgICB0aGlzLmxvYWRlciA9IHRydWU7DQogICAgICBhd2FpdCBTZXJ2aWNlLnJlcG9ydEdldEJ5SWQocmVwb3J0SWQpLnRoZW4oKHsgZGF0YSB9KSA9PiB7DQogICAgICAgIHRoaXMucmVwb3J0ID0gZGF0YTsNCiAgICAgICAgdGhpcy4kZW1pdCgnc2V0UmVwb3J0R2VuZXJhdGVkJywgdGhpcy5yZXBvcnQuZ2VuZXJhdGVkKTsNCiAgICAgIH0pOw0KICAgICAgYXdhaXQgU2VydmljZS5nZXRCeUlkVGFibGVXaXRoUmVwb3J0SWQoaWQsIHJlcG9ydElkKQ0KICAgICAgICAudGhlbihhc3luYyAocnMpID0+IHsNCiAgICAgICAgICBpZiAocnMuZGF0YSkgew0KICAgICAgICAgICAgYXdhaXQgdGhpcy5zZXRDb2x1bW5zKHJzLmRhdGEuY29sdW1ucywgcnMuZGF0YS5yb3dzLmxlbmd0aCk7DQogICAgICAgICAgICB0aGlzLnNldFJvdyhycy5kYXRhLnJvd3MpOw0KICAgICAgICAgICAgdGhpcy50YWJsZSA9IHJzLmRhdGEudGFibGU7DQogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgICAgUHJvbWlzZS5hbGwoWw0KICAgICAgICAgICAgICAgIHRoaXMuZ2V0RGF0YUJ5SWQocmVwb3J0SWQpLA0KICAgICAgICAgICAgICAgIHRoaXMuZ2V0Rm9ybXVsYXNfMigpLA0KICAgICAgICAgICAgICBdKS50aGVuKChbZGF0YSwgZm9ybXVsYXNdKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdFJlcG9ydERhdGEgPSBkYXRhDQogICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdFJlcG9ydEZvcm11bGFzID0gZm9ybXVsYXMNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXREb2N1bWVudENvbHVtblZhbHVlcyhkYXRhLCBmb3JtdWxhcykNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkZXIgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSw1MDApOw0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgICAgLmNhdGNoKChlKSA9PiB7DQogICAgICAgICAgdGhpcy5sb2FkZXIgPSBmYWxzZTsNCiAgICAgICAgfSk7DQogICAgICBhd2FpdCBTZXJ2aWNlLmdldERvY1RhYmxlRm9ybXVsYXNMaXN0KGlkKS50aGVuKCh7IGRhdGEgfSkgPT4gew0KICAgICAgICB0aGlzLmRvY1RhYmxlRm9ybXVsYXNMaXN0ID0ge307DQogICAgICAgIGxldCBsZW5ndGggPSBkYXRhLmxlbmd0aDsNCiAgICAgICAgbGV0IGN1cnJlbnRUYXJnZXRDb2x1bW5JZCA9IG51bGw7DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICBpZiAodGhpcy5kb2NUYWJsZUZvcm11bGFzTGlzdFtkYXRhW2ldLnRhcmdldENvbHVtbklkXSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBjdXJyZW50VGFyZ2V0Q29sdW1uSWQgPSBkYXRhW2ldLnRhcmdldENvbHVtbklkOw0KICAgICAgICAgICAgdGhpcy5kb2NUYWJsZUZvcm11bGFzTGlzdFtkYXRhW2ldLnRhcmdldENvbHVtbklkXSA9IHsNCiAgICAgICAgICAgICAgZXZhbDogIiIsDQogICAgICAgICAgICAgIGxpc3Q6IFtdLA0KICAgICAgICAgICAgICBsaXN0ZW5Db2x1bW5zOiBbXSwNCiAgICAgICAgICAgICAgdGFyZ2V0Q29sdW1uSWQ6IGRhdGFbaV0udGFyZ2V0Q29sdW1uSWQNCiAgICAgICAgICAgIH07DQogICAgICAgICAgfQ0KICAgICAgICAgIHRoaXMuZG9jVGFibGVGb3JtdWxhc0xpc3RbZGF0YVtpXS50YXJnZXRDb2x1bW5JZF0ubGlzdC5wdXNoKGRhdGFbaV0pOw0KICAgICAgICAgIGlmIChkYXRhW2ldLmRvY0NvbHVtbklkKSB7DQogICAgICAgICAgICBpZiAoZGF0YVtpXS5kb2NDb2x1bW5JZCAmJiB0aGlzLmRvY1RhYmxlRm9ybXVsYXNMaXN0W2RhdGFbaV0udGFyZ2V0Q29sdW1uSWRdLmxpc3RlbkNvbHVtbnMuaW5kZXhPZihkYXRhW2ldLmRvY0NvbHVtbklkKSA9PT0gLTEpIHsNCiAgICAgICAgICAgICAgdGhpcy5kb2NUYWJsZUZvcm11bGFzTGlzdFtkYXRhW2ldLnRhcmdldENvbHVtbklkXS5saXN0ZW5Db2x1bW5zLnB1c2goZGF0YVtpXS5kb2NDb2x1bW5JZCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh0aGlzLmRvY1RhYmxlRm9ybXVsYXNMaXN0ZW5Db2x1bW5JZFtkYXRhW2ldLmRvY0NvbHVtbklkXSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgIHRoaXMuZG9jVGFibGVGb3JtdWxhc0xpc3RlbkNvbHVtbklkW2RhdGFbaV0uZG9jQ29sdW1uSWRdID0gW2RhdGFbaV0udGFyZ2V0Q29sdW1uSWRdOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgaWYgKHRoaXMuZG9jVGFibGVGb3JtdWxhc0xpc3RlbkNvbHVtbklkW2RhdGFbaV0uZG9jQ29sdW1uSWRdLmluZGV4T2YoZGF0YVtpXS50YXJnZXRDb2x1bW5JZCkgPT09IC0xKSB7DQogICAgICAgICAgICAgICAgdGhpcy5kb2NUYWJsZUZvcm11bGFzTGlzdGVuQ29sdW1uSWRbZGF0YVtpXS5kb2NDb2x1bW5JZF0ucHVzaChkYXRhW2ldLnRhcmdldENvbHVtbklkKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAoZGF0YVtpXS50eXBlID09PSAiQVJHVU1FTlRTIikgew0KICAgICAgICAgICAgdGhpcy5kb2NUYWJsZUZvcm11bGFzTGlzdFtkYXRhW2ldLnRhcmdldENvbHVtbklkXS5ldmFsICs9ICJ7IiArIGRhdGFbaV0uZG9jQ29sdW1uSWQgKyAifSI7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMuZG9jVGFibGVGb3JtdWxhc0xpc3RbZGF0YVtpXS50YXJnZXRDb2x1bW5JZF0uZXZhbCArPSBkYXRhW2ldLmNvZGU7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9LA0KDQogICAgYXN5bmMgc2V0Q29sdW1ucyh2LCByb3dzQ291bnQpIHsNCiAgICAgIHRoaXMuc2VsZWN0ZWRDb2x1bW5zID0gdjsNCiAgICAgIHRoaXMuZmlyc3RDb2x1bW5zID0gW107DQogICAgICB0aGlzLnNlY29uZENvbHVtbnMgPSBbXTsNCiAgICAgIHRoaXMudGhpcmRDb2x1bW5zID0gW107DQogICAgICB2LmZvckVhY2goKGVsMSkgPT4gew0KICAgICAgICB0aGlzLmZpcnN0Q29sdW1ucy5wdXNoKGVsMSk7DQogICAgICAgIGVsMS5jaGlsZHJlbi5mb3JFYWNoKChlbDIpID0+IHsNCiAgICAgICAgICB0aGlzLnNlY29uZENvbHVtbnMucHVzaChlbDIpOw0KICAgICAgICAgIGVsMi5jaGlsZHJlbi5mb3JFYWNoKChlbDMpID0+IHsNCiAgICAgICAgICAgIHRoaXMudGhpcmRDb2x1bW5zLnB1c2goeyAuLi5lbDMsIGZJZDogZWwxLmlkIH0pOw0KICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICAgIH0pOw0KICAgICAgc2V0VGltZW91dChhc3luYyAoKSA9PiB7DQogICAgICAgIGxldCBmaXJzdFRyVGggPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJmaXJzdFRyVGgiKTsNCiAgICAgICAgbGV0IHNlY29uZFRyVGggPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJzZWNvbmRUclRoIik7DQogICAgICAgIGxldCB0aGlyZFRyVGggPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJ0aGlyZFRyVGgiKTsNCiAgICAgICAgbGV0IGNvdW50ZXIyID0gMCwNCiAgICAgICAgICAgIGNvdW50ZXIzID0gMDsNCiAgICAgICAgYXdhaXQgZmlyc3RUclRoLmZvckVhY2goYXN5bmMgKHRoKSA9PiB7DQogICAgICAgICAgaWYgKHRoLmNvbFNwYW4gPiAxKSB7DQogICAgICAgICAgICBmb3IgKGxldCBpbmRleDIgPSAwOyBpbmRleDIgPCB0aC5jb2xTcGFuOyBpbmRleDIrKykgew0KICAgICAgICAgICAgICBpZiAoc2Vjb25kVHJUaFtjb3VudGVyMl0gJiYgc2Vjb25kVHJUaFtjb3VudGVyMl0uY29sU3BhbiA+IDEpIHsNCiAgICAgICAgICAgICAgICBmb3IgKA0KICAgICAgICAgICAgICAgICAgICBsZXQgaW5kZXgzID0gMDsNCiAgICAgICAgICAgICAgICAgICAgaW5kZXgzIDwgc2Vjb25kVHJUaFtjb3VudGVyMl0uY29sU3BhbjsNCiAgICAgICAgICAgICAgICAgICAgaW5kZXgzKysNCiAgICAgICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICAgIGxldCBhcnJheSA9IHRoaXJkVHJUaFtjb3VudGVyM10uaWQuc3BsaXQoIiwiKTsNCiAgICAgICAgICAgICAgICAgIGxldCB0bXAgPSB7DQogICAgICAgICAgICAgICAgICAgIGNvbHVtbklkOiBhcnJheVswXSwNCiAgICAgICAgICAgICAgICAgICAgdHlwZUNvZGU6IGFycmF5WzFdLA0KICAgICAgICAgICAgICAgICAgICByZWZDb2RlOiBhcnJheVsyXSwNCiAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlVXJsOiBhcnJheVszXSwNCiAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlQXBwZW5kVXJsOiBhcnJheVs0XSwNCiAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlQ29kZTogYXJyYXlbNV0sDQogICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVVejogYXJyYXlbNl0sDQogICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVMdDogYXJyYXlbN10sDQogICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVSdTogYXJyYXlbOF0sDQogICAgICAgICAgICAgICAgICAgIHNlYXJjaFBheWxvYWQ6IE9iamVjdC5hc3NpZ24oe30sIHRoaXMudmFyX2RlZmF1bHRfc2VhcmNoX3BheWxvYWQpLA0KICAgICAgICAgICAgICAgICAgICBoYXNOZXh0UGFnZTogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IFtdLA0KICAgICAgICAgICAgICAgICAgICByb3dJZDogW10sDQogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBbXSwNCiAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAvLyBHRVQgRFlOQU1JQyBSRUZSRU5DRSBPUFRJT05TDQogICAgICAgICAgICAgICAgICBpZiAodG1wLnR5cGVDb2RlID09PSAnU0VMRUNUJykgew0KICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJvd3NDb3VudDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgdG1wLnZhbHVlLnB1c2goeyBzZWxlY3RlZEl0ZW06IG51bGwgfSkNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjcnVkQW5kTGlzdHNTZXJ2aWNlLnNlYXJjaExpc3RXaXRoS2V5d29yZCh0bXAucmVmZXJlbmNlVXJsLCB0bXAuc2VhcmNoUGF5bG9hZCwgdG1wLnJlZmVyZW5jZUFwcGVuZFVybCkNCiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChbJ0RlcGFydG1lbnRGb3JEb2N1bWVudCcsICdEZXBhcnRtZW50J10uaW5jbHVkZXMoaS5yZWZDb2RlKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5vcHRpb25zLnB1c2goLi4ucmVzLmRhdGEpDQogICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wLm9wdGlvbnMucHVzaCguLi5yZXMuZGF0YS5saXN0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5oYXNOZXh0UGFnZSA9IHJlcy5kYXRhLnRvdGFsIC8gdG1wLnNlYXJjaFBheWxvYWQuaXRlbXNQZXJQYWdlID4gdG1wLnNlYXJjaFBheWxvYWQucGFnZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAuc2VhcmNoUGF5bG9hZC5wYWdlICs9IDENCiAgICAgICAgICAgICAgICAgICAgICAgICAgLyogaWYgKCF0aGlzLmlzTW9kZUNyZWF0ZSAmJiB0aGlzLmVkaXRpbmdJdGVtLm9rZWRJZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZvdW5kSXRtID0gdGhpcy5va2Vkcy5maW5kKGVsID0+IGVsLmlkID09IHRoaXMuZWRpdGluZ0l0ZW0ub2tlZElkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmb3VuZEl0bSAmJiB0aGlzLmVkaXRpbmdJdGVtLmluZm9Pa2VkRHRvKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5va2Vkcy5wdXNoKHRoaXMuZWRpdGluZ0l0ZW0uaW5mb09rZWREdG8pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0gKi8NCiAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpDQogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMub2tlZHMgPSBbXQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgICAgIC5maW5hbGx5KCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5pc0xvYWRpbmdPa2VkID0gZmFsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB0aGlzLnRoaXJkVHJJZERhdGEucHVzaCh0bXApOw0KICAgICAgICAgICAgICAgICAgY291bnRlcjMrKzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY291bnRlcjIrKzsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgICAgIHNlY29uZFRyVGhbY291bnRlcjJdICYmDQogICAgICAgICAgICAgICAgICAgIHNlY29uZFRyVGhbY291bnRlcjJdLmNsYXNzTGlzdC5jb250YWlucygidGhpcmRUcklkIikNCiAgICAgICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICAgIGxldCBhcnJheSA9IHNlY29uZFRyVGhbY291bnRlcjJdLmlkLnNwbGl0KCIsIik7DQogICAgICAgICAgICAgICAgICBsZXQgdG1wID0gew0KICAgICAgICAgICAgICAgICAgICBjb2x1bW5JZDogYXJyYXlbMF0sDQogICAgICAgICAgICAgICAgICAgIHR5cGVDb2RlOiBhcnJheVsxXSwNCiAgICAgICAgICAgICAgICAgICAgcmVmQ29kZTogYXJyYXlbMl0sDQogICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZVVybDogYXJyYXlbM10sDQogICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZUFwcGVuZFVybDogYXJyYXlbNF0sDQogICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZUNvZGU6IGFycmF5WzVdLA0KICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VOYW1lVXo6IGFycmF5WzZdLA0KICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VOYW1lTHQ6IGFycmF5WzddLA0KICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VOYW1lUnU6IGFycmF5WzhdLA0KICAgICAgICAgICAgICAgICAgICBzZWFyY2hQYXlsb2FkOiBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnZhcl9kZWZhdWx0X3NlYXJjaF9wYXlsb2FkKSwNCiAgICAgICAgICAgICAgICAgICAgaGFzTmV4dFBhZ2U6IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICBvcHRpb25zOiBbXSwNCiAgICAgICAgICAgICAgICAgICAgcm93SWQ6IFtdLA0KICAgICAgICAgICAgICAgICAgICB2YWx1ZTogW10sDQogICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgLy8gR0VUIERZTkFNSUMgUkVGUkVOQ0UgT1BUSU9OUw0KICAgICAgICAgICAgICAgICAgaWYgKHRtcC50eXBlQ29kZSA9PT0gJ1NFTEVDVCcpIHsNCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb3dzQ291bnQ7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICAgIHRtcC52YWx1ZS5wdXNoKHsgc2VsZWN0ZWRJdGVtOiBudWxsIH0pDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY3J1ZEFuZExpc3RzU2VydmljZS5zZWFyY2hMaXN0V2l0aEtleXdvcmQodG1wLnJlZmVyZW5jZVVybCwgdG1wLnNlYXJjaFBheWxvYWQsIHRtcC5yZWZlcmVuY2VBcHBlbmRVcmwpDQogICAgICAgICAgICAgICAgICAgICAgICAudGhlbihyZXMgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoWydEZXBhcnRtZW50Rm9yRG9jdW1lbnQnLCAnRGVwYXJ0bWVudCddLmluY2x1ZGVzKGkucmVmQ29kZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAub3B0aW9ucy5wdXNoKC4uLnJlcy5kYXRhKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5vcHRpb25zLnB1c2goLi4ucmVzLmRhdGEubGlzdCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAuaGFzTmV4dFBhZ2UgPSByZXMuZGF0YS50b3RhbCAvIHRtcC5zZWFyY2hQYXlsb2FkLml0ZW1zUGVyUGFnZSA+IHRtcC5zZWFyY2hQYXlsb2FkLnBhZ2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wLnNlYXJjaFBheWxvYWQucGFnZSArPSAxDQogICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGlmICghdGhpcy5pc01vZGVDcmVhdGUgJiYgdGhpcy5lZGl0aW5nSXRlbS5va2VkSWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBmb3VuZEl0bSA9IHRoaXMub2tlZHMuZmluZChlbCA9PiBlbC5pZCA9PSB0aGlzLmVkaXRpbmdJdGVtLm9rZWRJZCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZm91bmRJdG0gJiYgdGhpcy5lZGl0aW5nSXRlbS5pbmZvT2tlZER0bykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub2tlZHMucHVzaCh0aGlzLmVkaXRpbmdJdGVtLmluZm9Pa2VkRHRvKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICB9ICovDQogICAgICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGUgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLm9rZWRzID0gW10NCiAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgICAuZmluYWxseSgoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuaXNMb2FkaW5nT2tlZCA9IGZhbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgdGhpcy50aGlyZFRySWREYXRhLnB1c2godG1wKTsNCiAgICAgICAgICAgICAgICAgIGNvdW50ZXIyKys7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIGlmIChzZWNvbmRUclRoW2NvdW50ZXIyXSkgew0KICAgICAgICAgICAgICAgICAgICBmb3IgKA0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGluZGV4MyA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICBpbmRleDMgPCBzZWNvbmRUclRoW2NvdW50ZXIyXS5jb2xTcGFuOw0KICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgzKysNCiAgICAgICAgICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgICAgICAgICAgbGV0IGFycmF5ID0gdGhpcmRUclRoW2NvdW50ZXIzXS5pZC5zcGxpdCgiLCIpOw0KICAgICAgICAgICAgICAgICAgICAgIGxldCB0bXAgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5JZDogYXJyYXlbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICB0eXBlQ29kZTogYXJyYXlbMV0sDQogICAgICAgICAgICAgICAgICAgICAgICByZWZDb2RlOiBhcnJheVsyXSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZVVybDogYXJyYXlbM10sDQogICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VBcHBlbmRVcmw6IGFycmF5WzRdLA0KICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlQ29kZTogYXJyYXlbNV0sDQogICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VOYW1lVXo6IGFycmF5WzZdLA0KICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlTmFtZUx0OiBhcnJheVs3XSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVSdTogYXJyYXlbOF0sDQogICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hQYXlsb2FkOiBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnZhcl9kZWZhdWx0X3NlYXJjaF9wYXlsb2FkKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGhhc05leHRQYWdlOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IFtdLA0KICAgICAgICAgICAgICAgICAgICAgICAgcm93SWQ6IFtdLA0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFtdLA0KICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgLy8gR0VUIERZTkFNSUMgUkVGUkVOQ0UgT1BUSU9OUw0KICAgICAgICAgICAgICAgICAgICAgIGlmICh0bXAudHlwZUNvZGUgPT09ICdTRUxFQ1QnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJvd3NDb3VudDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHRtcC52YWx1ZS5wdXNoKHsgc2VsZWN0ZWRJdGVtOiBudWxsIH0pDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBjcnVkQW5kTGlzdHNTZXJ2aWNlLnNlYXJjaExpc3RXaXRoS2V5d29yZCh0bXAucmVmZXJlbmNlVXJsLCB0bXAuc2VhcmNoUGF5bG9hZCwgdG1wLnJlZmVyZW5jZUFwcGVuZFVybCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihyZXMgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFsnRGVwYXJ0bWVudEZvckRvY3VtZW50JywgJ0RlcGFydG1lbnQnXS5pbmNsdWRlcyhpLnJlZkNvZGUpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5vcHRpb25zLnB1c2goLi4ucmVzLmRhdGEpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAub3B0aW9ucy5wdXNoKC4uLnJlcy5kYXRhLmxpc3QpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAuaGFzTmV4dFBhZ2UgPSByZXMuZGF0YS50b3RhbCAvIHRtcC5zZWFyY2hQYXlsb2FkLml0ZW1zUGVyUGFnZSA+IHRtcC5zZWFyY2hQYXlsb2FkLnBhZ2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5zZWFyY2hQYXlsb2FkLnBhZ2UgKz0gMQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogaWYgKCF0aGlzLmlzTW9kZUNyZWF0ZSAmJiB0aGlzLmVkaXRpbmdJdGVtLm9rZWRJZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBmb3VuZEl0bSA9IHRoaXMub2tlZHMuZmluZChlbCA9PiBlbC5pZCA9PSB0aGlzLmVkaXRpbmdJdGVtLm9rZWRJZCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZvdW5kSXRtICYmIHRoaXMuZWRpdGluZ0l0ZW0uaW5mb09rZWREdG8pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5va2Vkcy5wdXNoKHRoaXMuZWRpdGluZ0l0ZW0uaW5mb09rZWREdG8pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSAqLw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGUgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMub2tlZHMgPSBbXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbmFsbHkoKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5pc0xvYWRpbmdPa2VkID0gZmFsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRoaXJkVHJJZERhdGEucHVzaCh0bXApOw0KICAgICAgICAgICAgICAgICAgICAgIGNvdW50ZXIzKys7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICBjb3VudGVyMisrOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAodGguY2xhc3NMaXN0LmNvbnRhaW5zKCJ0aGlyZFRySWQiKSkgew0KICAgICAgICAgICAgICBsZXQgYXJyYXkgPSB0aC5pZC5zcGxpdCgiLCIpOw0KICAgICAgICAgICAgICBsZXQgdG1wID0gew0KICAgICAgICAgICAgICAgIGNvbHVtbklkOiBhcnJheVswXSwNCiAgICAgICAgICAgICAgICB0eXBlQ29kZTogYXJyYXlbMV0sDQogICAgICAgICAgICAgICAgcmVmQ29kZTogYXJyYXlbMl0sDQogICAgICAgICAgICAgICAgcmVmZXJlbmNlVXJsOiBhcnJheVszXSwNCiAgICAgICAgICAgICAgICByZWZlcmVuY2VBcHBlbmRVcmw6IGFycmF5WzRdLA0KICAgICAgICAgICAgICAgIHJlZmVyZW5jZUNvZGU6IGFycmF5WzVdLA0KICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVVejogYXJyYXlbNl0sDQogICAgICAgICAgICAgICAgcmVmZXJlbmNlTmFtZUx0OiBhcnJheVs3XSwNCiAgICAgICAgICAgICAgICByZWZlcmVuY2VOYW1lUnU6IGFycmF5WzhdLA0KICAgICAgICAgICAgICAgIHNlYXJjaFBheWxvYWQ6IE9iamVjdC5hc3NpZ24oe30sIHRoaXMudmFyX2RlZmF1bHRfc2VhcmNoX3BheWxvYWQpLA0KICAgICAgICAgICAgICAgIGhhc05leHRQYWdlOiBmYWxzZSwNCiAgICAgICAgICAgICAgICBvcHRpb25zOiBbXSwNCiAgICAgICAgICAgICAgICByb3dJZDogW10sDQogICAgICAgICAgICAgICAgdmFsdWU6IFtdLA0KICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAvLyBHRVQgRFlOQU1JQyBSRUZSRU5DRSBPUFRJT05TDQogICAgICAgICAgICAgIGlmICh0bXAudHlwZUNvZGUgPT09ICdTRUxFQ1QnKSB7DQogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb3dzQ291bnQ7IGkrKykgew0KICAgICAgICAgICAgICAgICAgdG1wLnZhbHVlLnB1c2goeyBzZWxlY3RlZEl0ZW06IG51bGwgfSkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY3J1ZEFuZExpc3RzU2VydmljZS5zZWFyY2hMaXN0V2l0aEtleXdvcmQodG1wLnJlZmVyZW5jZVVybCwgdG1wLnNlYXJjaFBheWxvYWQsIHRtcC5yZWZlcmVuY2VBcHBlbmRVcmwpDQogICAgICAgICAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKFsiRGVwYXJ0bWVudEZvckRvY3VtZW50IiwgIkRlcGFydG1lbnQiXS5pbmNsdWRlcyh0bXAucmVmQ29kZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5vcHRpb25zLnB1c2goLi4ucmVzLmRhdGEpDQogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5vcHRpb25zLnB1c2goLi4ucmVzLmRhdGEubGlzdCkNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgdG1wLmhhc05leHRQYWdlID0gcmVzLmRhdGEudG90YWwgLyB0bXAuc2VhcmNoUGF5bG9hZC5pdGVtc1BlclBhZ2UgPiB0bXAuc2VhcmNoUGF5bG9hZC5wYWdlDQogICAgICAgICAgICAgICAgICAgICAgdG1wLnNlYXJjaFBheWxvYWQucGFnZSArPSAxDQogICAgICAgICAgICAgICAgICAgICAgLyogaWYgKCF0aGlzLmlzTW9kZUNyZWF0ZSAmJiB0aGlzLmVkaXRpbmdJdGVtLm9rZWRJZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZm91bmRJdG0gPSB0aGlzLm9rZWRzLmZpbmQoZWwgPT4gZWwuaWQgPT0gdGhpcy5lZGl0aW5nSXRlbS5va2VkSWQpDQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZm91bmRJdG0gJiYgdGhpcy5lZGl0aW5nSXRlbS5pbmZvT2tlZER0bykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5va2Vkcy5wdXNoKHRoaXMuZWRpdGluZ0l0ZW0uaW5mb09rZWREdG8pDQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICB9ICovDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlKQ0KICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMub2tlZHMgPSBbXQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAuZmluYWxseSgoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5pc0xvYWRpbmdPa2VkID0gZmFsc2UNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB0aGlzLnRoaXJkVHJJZERhdGEucHVzaCh0bXApOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgZm9yIChsZXQgaW5kZXgyID0gMDsgaW5kZXgyIDwgdGguY29sU3BhbjsgaW5kZXgyKyspIHsNCiAgICAgICAgICAgICAgICBpZiAoc2Vjb25kVHJUaFtjb3VudGVyMl0uY29sU3BhbiA+IDEpIHsNCiAgICAgICAgICAgICAgICAgIGZvciAoDQogICAgICAgICAgICAgICAgICAgICAgbGV0IGluZGV4MyA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgaW5kZXgzIDwgc2Vjb25kVHJUaFtjb3VudGVyMl0uY29sU3BhbjsNCiAgICAgICAgICAgICAgICAgICAgICBpbmRleDMrKw0KICAgICAgICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgICAgICAgIGxldCBhcnJheSA9IHRoaXJkVHJUaFtjb3VudGVyM10uaWQuc3BsaXQoIiwiKTsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHRtcCA9IHsNCiAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5JZDogYXJyYXlbMF0sDQogICAgICAgICAgICAgICAgICAgICAgdHlwZUNvZGU6IGFycmF5WzFdLA0KICAgICAgICAgICAgICAgICAgICAgIHJlZkNvZGU6IGFycmF5WzJdLA0KICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZVVybDogYXJyYXlbM10sDQogICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlQXBwZW5kVXJsOiBhcnJheVs0XSwNCiAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VDb2RlOiBhcnJheVs1XSwNCiAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VOYW1lVXo6IGFycmF5WzZdLA0KICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVMdDogYXJyYXlbN10sDQogICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlTmFtZVJ1OiBhcnJheVs4XSwNCiAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hQYXlsb2FkOiBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnZhcl9kZWZhdWx0X3NlYXJjaF9wYXlsb2FkKSwNCiAgICAgICAgICAgICAgICAgICAgICBoYXNOZXh0UGFnZTogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgb3B0aW9uczogW10sDQogICAgICAgICAgICAgICAgICAgICAgcm93SWQ6IFtdLA0KICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBbXSwNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgLy8gR0VUIERZTkFNSUMgUkVGUkVOQ0UgT1BUSU9OUw0KICAgICAgICAgICAgICAgICAgICBpZiAodG1wLnR5cGVDb2RlID09PSAnU0VMRUNUJykgew0KICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm93c0NvdW50OyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRtcC52YWx1ZS5wdXNoKHsgc2VsZWN0ZWRJdGVtOiBudWxsIH0pDQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIGNydWRBbmRMaXN0c1NlcnZpY2Uuc2VhcmNoTGlzdFdpdGhLZXl3b3JkKHRtcC5yZWZlcmVuY2VVcmwsIHRtcC5zZWFyY2hQYXlsb2FkLCB0bXAucmVmZXJlbmNlQXBwZW5kVXJsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihyZXMgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChbJ0RlcGFydG1lbnRGb3JEb2N1bWVudCcsICdEZXBhcnRtZW50J10uaW5jbHVkZXMoaS5yZWZDb2RlKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wLm9wdGlvbnMucHVzaCguLi5yZXMuZGF0YSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wLm9wdGlvbnMucHVzaCguLi5yZXMuZGF0YS5saXN0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAuaGFzTmV4dFBhZ2UgPSByZXMuZGF0YS50b3RhbCAvIHRtcC5zZWFyY2hQYXlsb2FkLml0ZW1zUGVyUGFnZSA+IHRtcC5zZWFyY2hQYXlsb2FkLnBhZ2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAuc2VhcmNoUGF5bG9hZC5wYWdlICs9IDENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBpZiAoIXRoaXMuaXNNb2RlQ3JlYXRlICYmIHRoaXMuZWRpdGluZ0l0ZW0ub2tlZElkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBmb3VuZEl0bSA9IHRoaXMub2tlZHMuZmluZChlbCA9PiBlbC5pZCA9PSB0aGlzLmVkaXRpbmdJdGVtLm9rZWRJZCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmb3VuZEl0bSAmJiB0aGlzLmVkaXRpbmdJdGVtLmluZm9Pa2VkRHRvKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9rZWRzLnB1c2godGhpcy5lZGl0aW5nSXRlbS5pbmZvT2tlZER0bykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gKi8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGUgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5va2VkcyA9IFtdDQogICAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgICAgIC5maW5hbGx5KCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmlzTG9hZGluZ09rZWQgPSBmYWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHRoaXMudGhpcmRUcklkRGF0YS5wdXNoKHRtcCk7DQogICAgICAgICAgICAgICAgICAgIGNvdW50ZXIzKys7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBjb3VudGVyMisrOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgICAgICAgc2Vjb25kVHJUaFtjb3VudGVyMl0gJiYNCiAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRUclRoW2NvdW50ZXIyXS5jbGFzc0xpc3QuY29udGFpbnMoInRoaXJkVHJJZCIpDQogICAgICAgICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IGFycmF5ID0gc2Vjb25kVHJUaFtjb3VudGVyMl0uaWQuc3BsaXQoIiwiKTsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHRtcCA9IHsNCiAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5JZDogYXJyYXlbMF0sDQogICAgICAgICAgICAgICAgICAgICAgdHlwZUNvZGU6IGFycmF5WzFdLA0KICAgICAgICAgICAgICAgICAgICAgIHJlZkNvZGU6IGFycmF5WzJdLA0KICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZVVybDogYXJyYXlbM10sDQogICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlQXBwZW5kVXJsOiBhcnJheVs0XSwNCiAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VDb2RlOiBhcnJheVs1XSwNCiAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VOYW1lVXo6IGFycmF5WzZdLA0KICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVMdDogYXJyYXlbN10sDQogICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlTmFtZVJ1OiBhcnJheVs4XSwNCiAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hQYXlsb2FkOiBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnZhcl9kZWZhdWx0X3NlYXJjaF9wYXlsb2FkKSwNCiAgICAgICAgICAgICAgICAgICAgICBoYXNOZXh0UGFnZTogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgb3B0aW9uczogW10sDQogICAgICAgICAgICAgICAgICAgICAgcm93SWQ6IFtdLA0KICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBbXSwNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgLy8gR0VUIERZTkFNSUMgUkVGUkVOQ0UgT1BUSU9OUw0KICAgICAgICAgICAgICAgICAgICBpZiAodG1wLnR5cGVDb2RlID09PSAnU0VMRUNUJykgew0KICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm93c0NvdW50OyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRtcC52YWx1ZS5wdXNoKHsgc2VsZWN0ZWRJdGVtOiBudWxsIH0pDQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIGNydWRBbmRMaXN0c1NlcnZpY2Uuc2VhcmNoTGlzdFdpdGhLZXl3b3JkKHRtcC5yZWZlcmVuY2VVcmwsIHRtcC5zZWFyY2hQYXlsb2FkLCB0bXAucmVmZXJlbmNlQXBwZW5kVXJsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihyZXMgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChbJ0RlcGFydG1lbnRGb3JEb2N1bWVudCcsICdEZXBhcnRtZW50J10uaW5jbHVkZXMoaS5yZWZDb2RlKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wLm9wdGlvbnMucHVzaCguLi5yZXMuZGF0YSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wLm9wdGlvbnMucHVzaCguLi5yZXMuZGF0YS5saXN0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAuaGFzTmV4dFBhZ2UgPSByZXMuZGF0YS50b3RhbCAvIHRtcC5zZWFyY2hQYXlsb2FkLml0ZW1zUGVyUGFnZSA+IHRtcC5zZWFyY2hQYXlsb2FkLnBhZ2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAuc2VhcmNoUGF5bG9hZC5wYWdlICs9IDENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBpZiAoIXRoaXMuaXNNb2RlQ3JlYXRlICYmIHRoaXMuZWRpdGluZ0l0ZW0ub2tlZElkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBmb3VuZEl0bSA9IHRoaXMub2tlZHMuZmluZChlbCA9PiBlbC5pZCA9PSB0aGlzLmVkaXRpbmdJdGVtLm9rZWRJZCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmb3VuZEl0bSAmJiB0aGlzLmVkaXRpbmdJdGVtLmluZm9Pa2VkRHRvKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9rZWRzLnB1c2godGhpcy5lZGl0aW5nSXRlbS5pbmZvT2tlZER0bykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gKi8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGUgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5va2VkcyA9IFtdDQogICAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgICAgIC5maW5hbGx5KCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmlzTG9hZGluZ09rZWQgPSBmYWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHRoaXMudGhpcmRUcklkRGF0YS5wdXNoKHRtcCk7DQogICAgICAgICAgICAgICAgICAgIGNvdW50ZXIyKys7DQogICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBpZiAoc2Vjb25kVHJUaFtjb3VudGVyMl0pIHsNCiAgICAgICAgICAgICAgICAgICAgICBmb3IgKA0KICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgaW5kZXgzID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgzIDwgc2Vjb25kVHJUaFtjb3VudGVyMl0uY29sU3BhbjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgzKysNCiAgICAgICAgICAgICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBhcnJheSA9IHRoaXJkVHJUaFtjb3VudGVyM10uaWQuc3BsaXQoIiwiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0bXAgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbklkOiBhcnJheVswXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUNvZGU6IGFycmF5WzFdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICByZWZDb2RlOiBhcnJheVsyXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlVXJsOiBhcnJheVszXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlQXBwZW5kVXJsOiBhcnJheVs0XSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlQ29kZTogYXJyYXlbNV0sDQogICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVVejogYXJyYXlbNl0sDQogICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVMdDogYXJyYXlbN10sDQogICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVSdTogYXJyYXlbOF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFBheWxvYWQ6IE9iamVjdC5hc3NpZ24oe30sIHRoaXMudmFyX2RlZmF1bHRfc2VhcmNoX3BheWxvYWQpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNOZXh0UGFnZTogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IFtdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICByb3dJZDogW10sDQogICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBbXSwNCiAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBHRVQgRFlOQU1JQyBSRUZSRU5DRSBPUFRJT05TDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodG1wLnR5cGVDb2RlID09PSAnU0VMRUNUJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJvd3NDb3VudDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wLnZhbHVlLnB1c2goeyBzZWxlY3RlZEl0ZW06IG51bGwgfSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICBjcnVkQW5kTGlzdHNTZXJ2aWNlLnNlYXJjaExpc3RXaXRoS2V5d29yZCh0bXAucmVmZXJlbmNlVXJsLCB0bXAuc2VhcmNoUGF5bG9hZCwgdG1wLnJlZmVyZW5jZUFwcGVuZFVybCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChbJ0RlcGFydG1lbnRGb3JEb2N1bWVudCcsICdEZXBhcnRtZW50J10uaW5jbHVkZXMoaS5yZWZDb2RlKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5vcHRpb25zLnB1c2goLi4ucmVzLmRhdGEpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wLm9wdGlvbnMucHVzaCguLi5yZXMuZGF0YS5saXN0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5oYXNOZXh0UGFnZSA9IHJlcy5kYXRhLnRvdGFsIC8gdG1wLnNlYXJjaFBheWxvYWQuaXRlbXNQZXJQYWdlID4gdG1wLnNlYXJjaFBheWxvYWQucGFnZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAuc2VhcmNoUGF5bG9hZC5wYWdlICs9IDENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogaWYgKCF0aGlzLmlzTW9kZUNyZWF0ZSAmJiB0aGlzLmVkaXRpbmdJdGVtLm9rZWRJZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZvdW5kSXRtID0gdGhpcy5va2Vkcy5maW5kKGVsID0+IGVsLmlkID09IHRoaXMuZWRpdGluZ0l0ZW0ub2tlZElkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmb3VuZEl0bSAmJiB0aGlzLmVkaXRpbmdJdGVtLmluZm9Pa2VkRHRvKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5va2Vkcy5wdXNoKHRoaXMuZWRpdGluZ0l0ZW0uaW5mb09rZWREdG8pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gKi8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMub2tlZHMgPSBbXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maW5hbGx5KCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5pc0xvYWRpbmdPa2VkID0gZmFsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRoaXJkVHJJZERhdGEucHVzaCh0bXApOw0KICAgICAgICAgICAgICAgICAgICAgICAgY291bnRlcjMrKzsNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgY291bnRlcjIrKzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICB9LCAzMDApOw0KICAgIH0sDQogICAgc2V0Um93KHYpIHsNCiAgICAgIHRoaXMuc2VsZWN0ZWRSb3dzID0gdjsNCiAgICAgIHRoaXMubGFzdFJlcG9ydERhdGFSb3dzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh2KSk7DQogICAgICBpZiAodGhpcy5zZWxlY3RlZFJvd3MubGVuZ3RoID09IDAgJiYgIXRoaXMuaXNHZW5lcmF0ZWQpIHsNCiAgICAgICAgdGhpcy5zZWxlY3RlZFJvd3MgPSBbeyBpZDogdGhpcy5nZXRSYW5kb21JbnQoKSB9XTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHJvd3NwYW5GaXJzdChlbCkgew0KICAgICAgcmV0dXJuIGVsLmNoaWxkcmVuLmxlbmd0aCA+IDANCiAgICAgICAgICA/IDENCiAgICAgICAgICA6IGVsLmNoaWxkcmVuLmxlbmd0aCA+IDAgJiYgdGhpcy50aGlyZENvbHVtbnMubGVuZ3RoID4gMA0KICAgICAgICAgICAgICA/IDMNCiAgICAgICAgICAgICAgOiAzOw0KICAgIH0sDQogICAgY29sc3BhbkZpcnN0KGVsKSB7DQogICAgICBsZXQgZm91bmQgPSB0aGlzLnRoaXJkQ29sdW1ucy5maWx0ZXIoKGkpID0+IGkuZklkID09PSBlbC5pZCk7DQogICAgICBsZXQgdG90YWxOb3RDaGlsZCA9IGVsLmNoaWxkcmVuLmZpbHRlcigoZCkgPT4gZC5jaGlsZHJlbi5sZW5ndGggPT0gMCk7DQogICAgICByZXR1cm4gZWwuY2hpbGRyZW4ubGVuZ3RoID4gMCAmJiBmb3VuZC5sZW5ndGggPT0gMA0KICAgICAgICAgID8gZWwuY2hpbGRyZW4ubGVuZ3RoDQogICAgICAgICAgOiBlbC5jaGlsZHJlbi5sZW5ndGggPiAwICYmIGZvdW5kLmxlbmd0aCA+IDANCiAgICAgICAgICAgICAgPyB0b3RhbE5vdENoaWxkLmxlbmd0aCArIGZvdW5kLmxlbmd0aA0KICAgICAgICAgICAgICA6IDE7DQogICAgfSwNCiAgICByb3dzcGFuU2Vjb25kKGVsKSB7DQogICAgICByZXR1cm4gZWwuY2hpbGRyZW4ubGVuZ3RoID09IDAgJiYgdGhpcy50aGlyZENvbHVtbnMubGVuZ3RoID09IDANCiAgICAgICAgICA/IDENCiAgICAgICAgICA6IGVsLmNoaWxkcmVuLmxlbmd0aCA9PSAwICYmIHRoaXMudGhpcmRDb2x1bW5zLmxlbmd0aCA+IDANCiAgICAgICAgICAgICAgPyAyDQogICAgICAgICAgICAgIDogMTsNCiAgICB9LA0KICAgIGNvbHNwYW5TZWNvbmQoZWwpIHsNCiAgICAgIHJldHVybiBlbC5jaGlsZHJlbi5sZW5ndGggPiAwID8gZWwuY2hpbGRyZW4ubGVuZ3RoIDogMTsNCiAgICB9LA0KICAgIHJvd3NwYW5GaXJzdENsYXNzKGVsKSB7DQogICAgICByZXR1cm4gZWwuY2hpbGRyZW4ubGVuZ3RoID4gMA0KICAgICAgICAgID8gIiINCiAgICAgICAgICA6IGVsLmNoaWxkcmVuLmxlbmd0aCA+IDAgJiYgdGhpcy50aGlyZENvbHVtbnMubGVuZ3RoID4gMA0KICAgICAgICAgICAgICA/ICJ0aGlyZFRySWQiDQogICAgICAgICAgICAgIDogInRoaXJkVHJJZCI7DQogICAgfSwNCiAgICByb3dzcGFuU2Vjb25kQ2xhc3MoZWwpIHsNCiAgICAgIHJldHVybiBlbC5jaGlsZHJlbi5sZW5ndGggPT0gMCAmJiB0aGlzLnRoaXJkQ29sdW1ucy5sZW5ndGggPT0gMA0KICAgICAgICAgID8gInRoaXJkVHJJZCINCiAgICAgICAgICA6IGVsLmNoaWxkcmVuLmxlbmd0aCA9PSAwICYmIHRoaXMudGhpcmRDb2x1bW5zLmxlbmd0aCA+IDANCiAgICAgICAgICAgICAgPyAidGhpcmRUcklkIg0KICAgICAgICAgICAgICA6ICIiOw0KICAgIH0sDQogICAgbm9ybWFsaXplcihub2RlKSB7DQogICAgICBpZiAoIW5vZGUuY2hpbGRyZW4gfHwgbm9kZS5jaGlsZHJlbi5sZW5ndGggPT09IDApIHsNCiAgICAgICAgZGVsZXRlIG5vZGUuY2hpbGRyZW4NCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICBpZDogbm9kZS5pZCwNCiAgICAgICAgICBsYWJlbDogdGhpcy5nZXROYW1lKHsNCiAgICAgICAgICAgIG5hbWVSdTogbm9kZS5uYW1lUnUsDQogICAgICAgICAgICBuYW1lTHQ6IG5vZGUubmFtZUx0LA0KICAgICAgICAgICAgbmFtZVV6OiBub2RlLm5hbWVVeiwNCiAgICAgICAgICB9KSwNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgaWQ6IG5vZGUuaWQsDQogICAgICAgIGxhYmVsOiB0aGlzLmdldE5hbWUoew0KICAgICAgICAgIG5hbWVSdTogbm9kZS5uYW1lUnUsDQogICAgICAgICAgbmFtZUx0OiBub2RlLm5hbWVMdCwNCiAgICAgICAgICBuYW1lVXo6IG5vZGUubmFtZVV6LA0KICAgICAgICB9KSwNCiAgICAgICAgY2hpbGRyZW46IG5vZGUuY2hpbGRyZW4gJiYgbm9kZS5jaGlsZHJlbi5sZW5ndGggPiAwID8gbm9kZS5jaGlsZHJlbiA6IFtdLA0KICAgICAgfQ0KICAgIH0sDQogICAgY2FsY3VsYXRlRG9jRm9ybXVsYXMocm93SWQsIHZhbHVlLCByb3dJbmRleCwgY29sdW1uSW5kZXgsIGNvbHVtbklkLCB0eXBlQ29kZSkgew0KICAgICAgLy8gcm93SW5kZXggaXMgYHNlbGVjdGVkUm93c2AgaW5kZXgNCg0KICAgICAgaWYgKHRoaXMuZG9jVGFibGVGb3JtdWxhc0xpc3RlbkNvbHVtbklkW2NvbHVtbklkXSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCiAgICAgIGxldCB0YXJnZXRzID0gdGhpcy5kb2NUYWJsZUZvcm11bGFzTGlzdGVuQ29sdW1uSWRbY29sdW1uSWRdOw0KICAgICAgZm9yIChjb25zdCB0YXJnZXRJbmRleCBpbiB0YXJnZXRzKSB7DQogICAgICAgIGNvbnN0IGRvY1RhYmxlRm9ybXVsYSA9IHRoaXMuZG9jVGFibGVGb3JtdWxhc0xpc3RbdGFyZ2V0c1t0YXJnZXRJbmRleF1dOw0KICAgICAgICBsZXQgZXZhbFN0cmluZyA9IGRvY1RhYmxlRm9ybXVsYS5ldmFsOw0KICAgICAgICBmb3IgKGNvbnN0IGxpc3RlbkNvbHVtbiBvZiBkb2NUYWJsZUZvcm11bGEubGlzdGVuQ29sdW1ucykgew0KICAgICAgICAgIGxldCB0aGlyZEluZGV4ID0gdGhpcy50ckNvbHVtbklkT25Eb2NDb2x1bW5JZE1hcFtsaXN0ZW5Db2x1bW5dOw0KICAgICAgICAgIGxldCB2YWwgPSBwYXJzZUZsb2F0KHRoaXMudGhpcmRUcklkRGF0YVt0aGlyZEluZGV4XT8udmFsdWVbcm93SW5kZXhdPy52YWx1ZSA/PyAwKTsNCiAgICAgICAgICBpZiAoIXZhbCkgew0KICAgICAgICAgICAgdGhpcy5yZXBvcnQNCiAgICAgICAgICB9DQogICAgICAgICAgdmFsID0gaXNOYU4odmFsKSA/IDAgOiB2YWw7DQogICAgICAgICAgZXZhbFN0cmluZyA9IGV2YWxTdHJpbmcucmVwbGFjZSgieyIgKyBsaXN0ZW5Db2x1bW4gKyAifSIsIHZhbCk7DQogICAgICAgIH0NCiAgICAgICAgbGV0IHZhbCA9IGV2YWwoZXZhbFN0cmluZyk7DQoNCiAgICAgICAgLy8gdG9kbyBvcHRpbWl6ZSBxaWxpc2gga2VyYWsuIHYtbW9kZWwgYmlsYW4gcWlsaXNoIGtlcmFrDQogICAgICAgIHRoaXMuJHNldChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChKU09OLnN0cmluZ2lmeSh7DQogICAgICAgICAgInJvd0lkIjogcm93SWQsDQogICAgICAgICAgImNvbHVtbklkIjogZG9jVGFibGVGb3JtdWxhLnRhcmdldENvbHVtbklkLnRvU3RyaW5nKCkNCiAgICAgICAgfSkpLCAidmFsdWUiLCB2YWwpOw0KDQogICAgICAgIHRoaXMuc2V0VmFsdWUocm93SWQsIHZhbCwgcm93SW5kZXgsIHRoaXMudHJDb2x1bW5JZE9uRG9jQ29sdW1uSWRNYXBbZG9jVGFibGVGb3JtdWxhLnRhcmdldENvbHVtbklkXSwgZG9jVGFibGVGb3JtdWxhLnRhcmdldENvbHVtbklkLCB0eXBlQ29kZSk7DQogICAgICB9DQogICAgfSwNCiAgICB0cmVlQ2xvc2VkKHZlZU5hbWUpIHsNCiAgICAgIHRoaXMuY29tcHV0ZWRPYnNlcnZlci5yZWZzW3ZlZU5hbWVdLnZhbGlkYXRlKCk7DQogICAgfSwNCiAgICBzZWxlY3RDdXN0b21MYWJlbCh7IG5hbWVVeiwgbmFtZUx0LCBuYW1lUnUsIG5hbWUsIGZ1bGxOYW1lIH0pIHsNCiAgICAgIGlmIChuYW1lVXopIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TmFtZSh7IG5hbWVVejogbmFtZVV6LCBuYW1lTHQ6IG5hbWVMdCwgbmFtZVJ1OiBuYW1lUnUgfSk7DQogICAgICB9DQogICAgICBpZiAoZnVsbE5hbWUpIHsNCiAgICAgICAgcmV0dXJuIGZ1bGxOYW1lOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIG5hbWU7DQogICAgfSwNCiAgfSwNCn07DQo="},{"version":3,"sources":["editReportDynamicModal.vue"],"names":[],"mappings":";AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"editReportDynamicModal.vue","sourceRoot":"src/modules/report/organizitional/components","sourcesContent":["<script>\r\nimport Service from \"@/modules/report/reportService\";\r\nimport crudAndListsService from \"@/shared/services/crud_and_list.service\"\r\nimport Checkbox from \"vue-material-checkbox\";\r\n\r\nconst OKED_API_URL = 'reestr/info-oked'\r\nexport default {\r\n  props: {\r\n    isGenerated: {\r\n      type: Boolean,\r\n      default: false\r\n    }\r\n  },\r\n  components: { Checkbox },\r\n  data() {\r\n    return {\r\n      lastReportData: [],\r\n      lastReportDataRows: [],\r\n      lastReportFormulas: [],\r\n      debounce: null,\r\n      // OKED VARIABLES\r\n      okeds: [],\r\n      hasNextPageOked: false,\r\n      isLoadingOked: false,\r\n      okedSearchPayload: {},\r\n      // ----------------\r\n      f1Ids: [],\r\n      f2Ids: [],\r\n      fRowId: null,\r\n      tableId: null,\r\n      tableInfo: {},\r\n      reportId: null,\r\n      // getName: getName,\r\n      selectedColumns: [],\r\n      selectedRows: [],\r\n\r\n      firstColumns: [],\r\n      secondColumns: [],\r\n      thirdColumns: [],\r\n\r\n      thirdTrIdData: [],\r\n      currentRowId: null,\r\n      invalidEntries: 0,\r\n      currentItemData: [],\r\n      showData: [],\r\n      loader: false,\r\n      showResult: false,\r\n      report: {},\r\n      table: {},\r\n      formulas: [],\r\n      currentPosition: {\r\n        rowIndex: null,\r\n        columnIndex: null,\r\n        rowId: null,\r\n        columnId: null,\r\n      },\r\n      docTableFormulasList: {},\r\n      docTableFormulasListenColumnId: {},\r\n      trColumnIdOnDocColumnIdMap: {},\r\n    };\r\n  },\r\n  watch: {\r\n    thirdTrIdData: function (newThirdTrIdData) {\r\n      if (typeof newThirdTrIdData === 'object' && newThirdTrIdData.length > 0) {\r\n        let length = newThirdTrIdData.length;\r\n        for (let i = 0; i < length; i++) {\r\n          this.trColumnIdOnDocColumnIdMap[newThirdTrIdData[i].columnId] = i\r\n        }\r\n      }\r\n    },\r\n  },\r\n  methods: {\r\n    getColumnData(i) {\r\n      let found = this.showData.find((e) => e.columnId == i.columnId)\r\n      if (found) {\r\n        return found.columnData\r\n      } else {\r\n        return \"\"\r\n      }\r\n    },\r\n    // DYNAMIC_REFERENCES METHODS\r\n    getRandomInt() {\r\n      let number = Math.floor(Math.random() * 10000000);\r\n      let bool = true\r\n      this.selectedRows.find(el => {\r\n        if (el.id == number) {\r\n          bool = false\r\n        } else if (el.id == number) {\r\n          bool = false\r\n        }\r\n        return bool\r\n      })\r\n      if (bool) {\r\n        return number;\r\n      } else {\r\n        this.getRandomInt()\r\n      }\r\n\r\n    },\r\n    async addNewRow() {\r\n      await this.selectedRows.push({ id: this.getRandomInt() })\r\n      await this.setDocumentColumnValues(this.lastReportData, this.lastReportFormulas)\r\n    },\r\n    async closeReport() {\r\n      this.$emit(\"closedReportLoader\");\r\n      this.cnf().then(async (rs) => {\r\n        if (rs.value) {\r\n          this.$emit('save', true)\r\n        }\r\n      });\r\n    },\r\n    stopFormingRows() {\r\n      Service.stopFormingTheReport(this.reportId)\r\n          .then(async (rs) => {\r\n            this.$set(this.tableInfo, 'hasDynamicRows', false)\r\n            // await this.deleteSuccess();\r\n          })\r\n          .catch((err) => {\r\n            // this.catchErr(err);\r\n          });\r\n    },\r\n    async deleteRow(index, data) {\r\n      let findElement = this.lastReportDataRows.findIndex(el => el.id == data.id)\r\n      if (findElement > -1) {\r\n        this.cnf().then(async (rs) => {\r\n          if (rs.value) {\r\n            await Service.deleteRowId(data.id, this.reportId)\r\n                .then(async (rs) => {\r\n                  // await this.deleteSuccess();\r\n                  this.selectedRows.splice(index, 1)\r\n                  await this.$forceUpdate()\r\n                  await this.resetIndex()\r\n                  await this.setDocumentColumnValues(this.lastReportData.filter(e => e.rowId != data.id), this.lastReportFormulas)\r\n                })\r\n                .catch((err) => {\r\n                  // this.catchErr(err);\r\n                })\r\n                .finally(async () => {\r\n                  await this.getById(this.tableId, this.reportId, this.tableInfo)\r\n                })\r\n            ;\r\n          }\r\n        });\r\n      } else {\r\n        this.cnf().then(async (rs) => {\r\n          if (rs.value) {\r\n            let newThirdTrIdData = []\r\n            this.thirdTrIdData = this.thirdTrIdData.map((e) => {\r\n              e.value = e.value.filter(d => {\r\n                if (d && d.rowId != data.id) {\r\n                  if (d.typeCode === \"BOOLEAN\") {\r\n                    d.valueBoolean = d.value\r\n                    d.valueString = null\r\n                    d.valueBigDecimal = null\r\n                    d.valueDate = null\r\n                    d.selectValueNameUz = null\r\n                  } else if (d.typeCode === \"STRING\") {\r\n                    d.valueString = d.value\r\n                    d.valueBigDecimal = null\r\n                    d.valueDate = null\r\n                    d.valueBoolean = null\r\n                    d.selectValueNameUz = null\r\n                  } else if (d.typeCode === \"BIGDECIMAL\") {\r\n                    d.valueBigDecimal = d.value\r\n                    d.valueString = null\r\n                    d.valueDate = null\r\n                    d.valueBoolean = null\r\n                    d.selectValueNameUz = null\r\n                  } else if (d.typeCode === \"DATE\") {\r\n                    d.valueDate = d.value\r\n                    d.valueString = null\r\n                    d.valueBigDecimal = null\r\n                    d.valueBoolean = null\r\n                    d.selectValueNameUz = null\r\n                  } else if (d.typeCode === \"YEAR\") {\r\n                    d.valueDate = null\r\n                    d.valueString = d.value\r\n                    d.valueBigDecimal = null\r\n                    d.valueBoolean = null\r\n                    d.selectValueNameUz = null\r\n                  } else if (d.typeCode === \"SELECT\") {\r\n                    d.valueString = null\r\n                    d.valueBigDecimal = null\r\n                    d.valueDate = null\r\n                    d.valueBoolean = null\r\n                  }\r\n                  newThirdTrIdData.push(d)\r\n                  return d\r\n                }\r\n              })\r\n              return e\r\n            })\r\n            this.selectedRows.splice(index, 1)\r\n            await this.$forceUpdate()\r\n            await this.resetIndex()\r\n            newThirdTrIdData.forEach(e => this.lastReportData.push(e))\r\n            await this.setDocumentColumnValues(this.lastReportData, this.lastReportFormulas)\r\n          }\r\n        });\r\n\r\n\r\n      }\r\n    },\r\n\r\n    dynamicRefsReachedEndOfList(e) {\r\n      if (e) {\r\n        this.fetchDynamicRefs()\r\n      }\r\n    },\r\n    async debounceSearchDynamicRefs(searchText) {\r\n      clearTimeout(this.debounce);\r\n      this.debounce = setTimeout(async () => {\r\n        await this.fetchDynamicRefsWithKeyword(searchText);\r\n      }, 1000);\r\n    },\r\n    fetchDynamicRefsWithKeyword(keyword) {\r\n      this.okeds = []\r\n      this.okedSearchPayload.page = 1\r\n      this.okedSearchPayload.keyword = keyword ? keyword : ''\r\n      this.fetchDynamicRefs()\r\n    },\r\n    async fetchDynamicRefs() {\r\n      this.isLoadingOked = true\r\n      await crudAndListsService.searchListWithKeyword(OKED_API_URL, this.okedSearchPayload)\r\n          .then(res => {\r\n            this.okeds.push(...res.data.list)\r\n            this.hasNextPageOked = res.data.total / this.okedSearchPayload.itemsPerPage > this.okedSearchPayload.page\r\n            this.okedSearchPayload.page += 1\r\n            if (!this.isModeCreate && this.editingItem.okedId) {\r\n              let foundItm = this.okeds.find(el => el.id == this.editingItem.okedId)\r\n              if (!foundItm && this.editingItem.infoOkedDto) {\r\n                this.okeds.push(this.editingItem.infoOkedDto)\r\n              }\r\n            }\r\n          })\r\n          .catch(e => {\r\n            console.log(e)\r\n            this.okeds = []\r\n          })\r\n          .finally(() => {\r\n            this.isLoadingOked = false\r\n          })\r\n    },\r\n    customLabelDynamicRef(opt) {\r\n      let selected = this.okeds.find(e => e.id == opt.id);\r\n      if (selected) {\r\n        return `${selected.code} - ${\r\n            selected.nameUz ?\r\n                this.getName({\r\n                  nameRu: selected.nameRu,\r\n                  nameLt: selected.nameLt,\r\n                  nameUz: selected.nameUz,\r\n                })\r\n                :\r\n                selected.name\r\n        }`\r\n      }\r\n      return ``;\r\n    },\r\n    // --------------------------\r\n    clearAll() {\r\n      this.selectedColumns = [];\r\n      this.selectedRows = [];\r\n      this.firstColumns = [];\r\n      this.secondColumns = [];\r\n      this.thirdColumns = [];\r\n      this.thirdTrIdData = [];\r\n      this.formulas = [];\r\n      this.table = [];\r\n      this.f1Ids = [];\r\n      this.f2Ids = [];\r\n    },\r\n    keydownEvt(evt, rowId, value, rowIndex, columnIndex, columnId, typeCode) {\r\n      this.keyUpEventsDisable(evt);\r\n      if (columnId != null) {\r\n        if (evt.keyCode == 40 && rowId != null) {\r\n          evt.preventDefault();\r\n          // down\r\n          if (rowIndex < this.selectedRows.length - 1) {\r\n            let currentColumn = this.thirdTrIdData[columnIndex];\r\n            let downRowColumn = this.selectedRows[rowIndex + 1];\r\n            let downInput = document.getElementById(\r\n                JSON.stringify({\r\n                  rowId: downRowColumn.id,\r\n                  columnId: currentColumn.columnId,\r\n                })\r\n            );\r\n            if (downInput) {\r\n              downInput.focus();\r\n            }\r\n          }\r\n        } else if (evt.keyCode == 38 && rowId != null) {\r\n          evt.preventDefault();\r\n          if (rowIndex != 0) {\r\n            let currentColumn = this.thirdTrIdData[columnIndex];\r\n            let upRowColumn = this.selectedRows[rowIndex - 1];\r\n            let upInput = document.getElementById(\r\n                JSON.stringify({\r\n                  rowId: upRowColumn.id,\r\n                  columnId: currentColumn.columnId,\r\n                })\r\n            );\r\n            if (upInput) {\r\n              upInput.focus();\r\n            }\r\n          }\r\n          //up\r\n        } else if (evt.keyCode == 37) {\r\n          evt.preventDefault();\r\n          //left\r\n          if (columnIndex != 0) {\r\n            let prevColumn = this.thirdTrIdData[columnIndex - 1];\r\n\r\n            let currentRow = this.selectedRows[rowIndex];\r\n            let prevInput = document.getElementById(\r\n                JSON.stringify({\r\n                  rowId: currentRow.id,\r\n                  columnId: prevColumn.columnId,\r\n                })\r\n            );\r\n            if (prevInput) {\r\n              if (prevInput.disabled) {\r\n                let count = this.thirdTrIdData.length - (columnIndex - 1);\r\n                for (let i = 0; i < count; i++) {\r\n                  let prevColumn2 = this.thirdTrIdData[columnIndex - 1 - i];\r\n                  if (prevColumn2) {\r\n                    let input = document.getElementById(\r\n                        JSON.stringify({\r\n                          rowId: currentRow.id,\r\n                          columnId: prevColumn2.columnId,\r\n                        })\r\n                    );\r\n                    if (input && input.disabled) {\r\n                      continue;\r\n                    } else {\r\n                      if (input) {\r\n                        input.focus();\r\n                      }\r\n                      break;\r\n                    }\r\n                  }\r\n                }\r\n              } else {\r\n                prevInput.focus();\r\n              }\r\n            }\r\n          }\r\n        } else if (evt.keyCode == 39) {\r\n          //right\r\n          evt.preventDefault();\r\n          if (this.thirdTrIdData.length - 1 > columnIndex) {\r\n            let nextColumn = this.thirdTrIdData[columnIndex + 1];\r\n            let currentRow = this.selectedRows[rowIndex];\r\n            let nextInput = document.getElementById(\r\n                JSON.stringify({\r\n                  rowId: currentRow.id,\r\n                  columnId: nextColumn.columnId,\r\n                })\r\n            );\r\n            if (nextInput) {\r\n              if (nextInput.disabled) {\r\n                let forCount = this.thirdTrIdData.length - (columnIndex + 1);\r\n                for (let i = 0; i < forCount; i++) {\r\n                  let nextColumn2 = this.thirdTrIdData[columnIndex + 1 + i];\r\n\r\n                  let input = document.getElementById(\r\n                      JSON.stringify({\r\n                        rowId: currentRow.id,\r\n                        columnId: nextColumn2.columnId,\r\n                      })\r\n                  );\r\n                  if (input.disabled) {\r\n                    continue;\r\n                  } else {\r\n                    if (input) {\r\n                      input.focus();\r\n                    }\r\n                    break;\r\n                  }\r\n                }\r\n              } else {\r\n                nextInput.focus();\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    async resetIndex() {\r\n      await this.$set(this.currentPosition, \"rowIndex\", null);\r\n      await this.$set(this.currentPosition, \"columnIndex\", null);\r\n      await this.$set(this.currentPosition, \"rowId\", null);\r\n      await this.$set(this.currentPosition, \"columnId\", null);\r\n      // await document.addEventListener(\"keydown\", this.keyUpEvents);\r\n    },\r\n    setError(f1, f2, frowId) {\r\n      this.f1Ids = f1;\r\n      this.f2Ids = f2;\r\n      this.fRowId = frowId;\r\n    },\r\n    keyUpEventsDisable(e) {\r\n      if (this.currentPosition.columnId != null) {\r\n        if (e.which === 38 || e.which === 40) {\r\n          e.preventDefault();\r\n        }\r\n      }\r\n    },\r\n    keyUpEvents(evt) {\r\n      this.keyUpEventsDisable(evt);\r\n      // if (this.currentPosition.columnId != null) {\r\n      //   if (evt.keyCode == 40 && this.currentPosition.rowId != null) {\r\n      //     evt.preventDefault();\r\n      //     // down\r\n      //     if (this.currentPosition.rowIndex < this.selectedRows.length - 1) {\r\n      //       let currentColumn =\r\n      //         this.thirdTrIdData[this.currentPosition.columnIndex];\r\n      //       let downRowColumn =\r\n      //         this.selectedRows[this.currentPosition.rowIndex + 1];\r\n      //       let downInput = document.getElementById(\r\n      //         JSON.stringify({\r\n      //           rowId: downRowColumn.id,\r\n      //           columnId: currentColumn.columnId,\r\n      //         })\r\n      //       );\r\n      //       if (downInput) {\r\n      //         downInput.focus();\r\n      //       }\r\n      //     }\r\n      //   } else if (evt.keyCode == 38 && this.currentPosition.rowId != null) {\r\n      //     evt.preventDefault();\r\n      //     if (this.currentPosition.rowIndex != 0) {\r\n      //       let currentColumn =\r\n      //         this.thirdTrIdData[this.currentPosition.columnIndex];\r\n      //       let upRowColumn =\r\n      //         this.selectedRows[this.currentPosition.rowIndex - 1];\r\n      //       let upInput = document.getElementById(\r\n      //         JSON.stringify({\r\n      //           rowId: upRowColumn.id,\r\n      //           columnId: currentColumn.columnId,\r\n      //         })\r\n      //       );\r\n      //       if (upInput) {\r\n      //         upInput.focus();\r\n      //       }\r\n      //     }\r\n      //     //up\r\n      //   } else if (evt.keyCode == 37) {\r\n      //     evt.preventDefault();\r\n      //     //left\r\n      //     if (this.currentPosition.columnIndex != 0) {\r\n      //       let prevColumn =\r\n      //         this.thirdTrIdData[this.currentPosition.columnIndex - 1];\r\n      //       let currentRow = this.selectedRows[this.currentPosition.rowIndex];\r\n      //       let prevInput = document.getElementById(\r\n      //         JSON.stringify({\r\n      //           rowId: currentRow.id,\r\n      //           columnId: prevColumn.columnId,\r\n      //         })\r\n      //       );\r\n      //       if (prevInput) {\r\n      //         if (prevInput.disabled) {\r\n      //           let count =\r\n      //             this.thirdTrIdData.length -\r\n      //             (this.currentPosition.columnIndex - 1);\r\n      //           for (let i = 0; i < count; i++) {\r\n      //             let prevColumn2 =\r\n      //               this.thirdTrIdData[\r\n      //                 this.currentPosition.columnIndex - 1 - i\r\n      //               ];\r\n      //             let input = document.getElementById(\r\n      //               JSON.stringify({\r\n      //                 rowId: currentRow.id,\r\n      //                 columnId: prevColumn2.columnId,\r\n      //               })\r\n      //             );\r\n      //             if (input && input.disabled) {\r\n      //               continue;\r\n      //             } else {\r\n      //               if (input) {\r\n      //                 input.focus();\r\n      //               }\r\n      //               break;\r\n      //             }\r\n      //           }\r\n      //         } else {\r\n      //           prevInput.focus();\r\n      //         }\r\n      //       }\r\n      //     }\r\n      //   } else if (evt.keyCode == 39) {\r\n      //     //right\r\n      //     evt.preventDefault();\r\n      //     if (\r\n      //       this.thirdTrIdData.length - 1 >\r\n      //       this.currentPosition.columnIndex\r\n      //     ) {\r\n      //       let nextColumn =\r\n      //         this.thirdTrIdData[this.currentPosition.columnIndex + 1];\r\n      //       let currentRow = this.selectedRows[this.currentPosition.rowIndex];\r\n      //       let nextInput = document.getElementById(\r\n      //         JSON.stringify({\r\n      //           rowId: currentRow.id,\r\n      //           columnId: nextColumn.columnId,\r\n      //         })\r\n      //       );\r\n      //       if (nextInput) {\r\n      //         if (nextInput.disabled) {\r\n      //           let forCount =\r\n      //             this.thirdTrIdData.length -\r\n      //             (this.currentPosition.columnIndex + 1);\r\n      //           for (let i = 0; i < forCount; i++) {\r\n      //             let nextColumn2 =\r\n      //               this.thirdTrIdData[\r\n      //                 this.currentPosition.columnIndex + 1 + i\r\n      //               ];\r\n\r\n      //             let input = document.getElementById(\r\n      //               JSON.stringify({\r\n      //                 rowId: currentRow.id,\r\n      //                 columnId: nextColumn2.columnId,\r\n      //               })\r\n      //             );\r\n      //             if (input.disabled) {\r\n      //               continue;\r\n      //             } else {\r\n      //               if (input) {\r\n      //                 input.focus();\r\n      //               }\r\n      //               break;\r\n      //             }\r\n      //           }\r\n      //         } else {\r\n      //           nextInput.focus();\r\n      //         }\r\n      //       }\r\n      //     }\r\n      //   }\r\n      // }\r\n    }\r\n    ,\r\n\r\n    focusVal(rowId, value, rowIndex, columnIndex, columnId, typeCode) {\r\n      this.$set(this.currentPosition, \"rowIndex\", parseFloat(rowIndex));\r\n      this.$set(this.currentPosition, \"columnIndex\", parseFloat(columnIndex));\r\n      this.$set(this.currentPosition, \"rowId\", parseFloat(rowId));\r\n      this.$set(this.currentPosition, \"columnId\", parseFloat(columnId));\r\n    },\r\n    getFormulas_2() {\r\n      return new Promise((res, rej) => {\r\n        if (this.tableId) {\r\n          Service.formulasByTableId_2(this.tableId)\r\n              .then(({ data }) => {\r\n                this.formulas = data;\r\n                res(data);\r\n              })\r\n              .catch((e) => rej(e));\r\n        } else {\r\n          rej();\r\n        }\r\n      });\r\n    },\r\n    getDataById(id) {\r\n      return new Promise((res, rej) => {\r\n        Service.getReportById(id)\r\n            .then(({ data }) => {\r\n              res(data);\r\n            })\r\n            .catch((e) => rej(e));\r\n      });\r\n    },\r\n    editValue(rowIndex, index) {\r\n      this.$set(this.thirdTrIdData[index].value[rowIndex], 'notEditable', false)\r\n      this.$forceUpdate();\r\n    },\r\n    resetValue(rowIndex, index) {\r\n      this.$set(this.thirdTrIdData[index].value[rowIndex], 'selectValueId', this.thirdTrIdData[index].value[rowIndex].originalSelectValueId)\r\n      this.$set(this.thirdTrIdData[index].value[rowIndex], 'selectValueNameUz', this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameUz)\r\n      this.$set(this.thirdTrIdData[index].value[rowIndex], 'selectValueNameLt', this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameLt)\r\n      this.$set(this.thirdTrIdData[index].value[rowIndex], 'selectValueNameRu', this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameRu)\r\n      this.$set(this.thirdTrIdData[index].value[rowIndex], 'notEditable', true)\r\n      this.$forceUpdate();\r\n    },\r\n    setValue(rowId, value, rowIndex, index, id, typeCode, notEditable = false, initialLoadCall = false) {\r\n      // value.rowId = rowId\r\n      // value.typeCode = typeCode\r\n      //\r\n      // value.notEditable = notEditable\r\n      // value.selectValueNameLt = value.nameLt\r\n      // value.selectValueNameRu = value.nameRu\r\n      // value.selectValueNameUz = value.nameUz\r\n      //\r\n      /* this.thirdTrIdData[index].value[rowIndex] = {\r\n        rowId: rowId ? rowId : null,\r\n        value: typeCode === 'SELECT' ? '' : value,\r\n        selectValueNameUz: value ? value.nameUz : null,\r\n        selectValueNameLt: value ? value.nameLt : null,\r\n        selectValueNameRu: value ? value.nameRu : null,\r\n        originalSelectValueNameUz: this.thirdTrIdData[index].value[rowIndex] ? this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameUz : '',\r\n        originalSelectValueNameLt: this.thirdTrIdData[index].value[rowIndex] ? this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameLt : '',\r\n        originalSelectValueNameRu: this.thirdTrIdData[index].value[rowIndex] ? this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameRu : '',\r\n        typeCode: typeCode,\r\n        columnId: id,\r\n        notEditable: notEditable\r\n      }; */\r\n      if (initialLoadCall && typeCode === 'SELECT') {\r\n        let rowIndex = this.selectedRows.findIndex(el => el.id == rowId)\r\n        if (!this.thirdTrIdData[index].value[rowIndex].rowId) {\r\n          this.thirdTrIdData[index].value[rowIndex] = {\r\n            rowId: rowId,\r\n            value: typeCode === 'SELECT' ? '' : value,\r\n            selectValueId: value ? value.id : null,\r\n            selectValueNameUz: value ? (value.nameUz ? value.nameUz : value.name) : null,\r\n            selectValueNameLt: value ? value.nameLt : null,\r\n            selectValueNameRu: value ? value.nameRu : null,\r\n            originalSelectValueNameUz: this.thirdTrIdData[index].value[rowIndex] ? this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameUz : '',\r\n            originalSelectValueNameLt: this.thirdTrIdData[index].value[rowIndex] ? this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameLt : '',\r\n            originalSelectValueNameRu: this.thirdTrIdData[index].value[rowIndex] ? this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameRu : '',\r\n            typeCode: typeCode,\r\n            columnId: id,\r\n            notEditable: notEditable,\r\n          }\r\n          this.thirdTrIdData[index].value[rowIndex].originalselectValueId = value.id\r\n          this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameUz = value.nameUz\r\n          this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameLt = value.nameLt\r\n          this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameRu = value.nameRu\r\n        }\r\n      } else {\r\n        if (typeCode === 'SELECT') {\r\n          value.rowId = rowId\r\n          value.columnId = id\r\n          value.typeCode = typeCode\r\n          value.notEditable = notEditable\r\n          value.selectValueId = value.id\r\n          value.selectValueNameLt = value.nameLt\r\n          value.selectValueNameRu = value.nameRu\r\n          value.selectValueNameUz = value.nameUz ? value.nameUz : value.name\r\n        }\r\n\r\n        this.thirdTrIdData[index].value[rowIndex] = {\r\n          rowId: rowId,\r\n          value: typeCode === 'SELECT' ? '' : value,\r\n          selectValueId: value ? value.id : null,\r\n          selectValueNameUz: value ? value.nameUz : null,\r\n          selectValueNameLt: value ? value.nameLt : null,\r\n          selectValueNameRu: value ? value.nameRu : null,\r\n          originalSelectValueNameUz: this.thirdTrIdData[index].value[rowIndex] ? this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameUz : '',\r\n          originalSelectValueNameLt: this.thirdTrIdData[index].value[rowIndex] ? this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameLt : '',\r\n          originalSelectValueNameRu: this.thirdTrIdData[index].value[rowIndex] ? this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameRu : '',\r\n          typeCode: typeCode,\r\n          columnId: id,\r\n          notEditable: notEditable,\r\n        };\r\n      }\r\n\r\n      document.getElementsByClassName(\"no_enter_value\").forEach((input) => {\r\n        if (JSON.parse(input.id).rowId) {\r\n          this.formulas.forEach((e) => {\r\n            let index_f2 = JSON.parse(e.f2).findIndex((d) => d == parseFloat(id));\r\n            let index_f1 = JSON.parse(e.f1).findIndex((d) => d == parseFloat(JSON.parse(input.id).columnId));\r\n            if (\r\n                index_f2 > -1 &&\r\n                index_f1 > -1 &&\r\n                parseFloat(JSON.parse(input.id).rowId) === parseFloat(rowId)\r\n            ) {\r\n\r\n              let allVal = 0;\r\n              document.getElementsByClassName(\"input_val\").forEach((vInput) => {\r\n                let e_index_f2 = JSON.parse(e.f2).findIndex(\r\n                    (d) => d == parseFloat(JSON.parse(vInput.id).columnId)\r\n                );\r\n\r\n                if (\r\n                    e_index_f2 > -1 &&\r\n                    parseFloat(JSON.parse(vInput.id).rowId) === parseFloat(rowId)\r\n                ) {\r\n                  if (this._empty(vInput.value)) {\r\n                  } else {\r\n                    if (typeof parseFloat(vInput.value) == \"number\") {\r\n                      allVal += parseFloat(vInput.value);\r\n                    } else {\r\n                      allVal += 0;\r\n                    }\r\n                  }\r\n\r\n                  this.$set(input, \"value\", parseFloat(allVal));\r\n                  let foundIndex = this.thirdTrIdData.findIndex(\r\n                      (e) => e.columnId == JSON.parse(input.id).columnId\r\n                  );\r\n                  this.thirdTrIdData[foundIndex].value[rowIndex] = {\r\n                    rowId: rowId ? rowId : null,\r\n                    value: allVal,\r\n                    typeCode: typeCode,\r\n                    columnId: JSON.parse(input.id).columnId,\r\n                  };\r\n                  this.$forceUpdate();\r\n                }\r\n              });\r\n            }\r\n          });\r\n        } else {\r\n          this.formulas.forEach((e) => {\r\n            let index_f2 = JSON.parse(e.f2).findIndex(\r\n                (d) => d == parseFloat(id)\r\n            );\r\n            let index_f1 = JSON.parse(e.f1).findIndex(\r\n                (d) => d == parseFloat(JSON.parse(input.id).columnId)\r\n            );\r\n            if (index_f2 > -1 && index_f1 > -1) {\r\n              let allVal = 0;\r\n              document.getElementsByClassName(\"input_val\").forEach((vInput) => {\r\n                let e_index_f2 = JSON.parse(e.f2).findIndex(\r\n                    (d) => d == parseFloat(JSON.parse(vInput.id).columnId)\r\n                );\r\n                if (e_index_f2 > -1) {\r\n                  if (this._empty(vInput.value)) {\r\n                  } else {\r\n                    if (typeof parseFloat(vInput.value) == \"number\") {\r\n                      allVal += parseFloat(vInput.value);\r\n                    } else {\r\n                      allVal += 0;\r\n                    }\r\n                  }\r\n                }\r\n                this.$set(input, \"value\", parseFloat(allVal));\r\n                let foundIndex = this.thirdTrIdData.findIndex(\r\n                    (e) => e.columnId == JSON.parse(input.id).columnId\r\n                );\r\n                this.thirdTrIdData[foundIndex].value[0] = {\r\n                  rowId: null,\r\n                  value: allVal,\r\n                  typeCode: typeCode,\r\n                  columnId: JSON.parse(input.id).columnId,\r\n                };\r\n                this.$forceUpdate();\r\n              });\r\n            }\r\n          });\r\n        }\r\n      });\r\n\r\n      this.$forceUpdate();\r\n\r\n    },\r\n    async setDocumentColumnValues(data, formulas) {\r\n      this.showData = []\r\n      this.currentItemData = data\r\n      if (data && data.length) {\r\n        data.forEach((e) => {\r\n          if (e.valueString || e.valueBigDecimal) {\r\n            if (e.typeCode === \"YEAR\") {\r\n              document.getElementsByClassName(\"custom-datepicker mx-datepicker dynamic-year\").forEach((field, idx) => {\r\n                if (JSON.parse(field.id).rowId) {\r\n                  if (\r\n                      parseFloat(JSON.parse(field.id).columnId) === parseFloat(e.columnId) &&\r\n                      parseFloat(JSON.parse(field.id).rowId) === parseFloat(e.rowId)\r\n                  ) {\r\n                    let rowIndex = this.selectedRows.findIndex(el => el.id == JSON.parse(field.id).rowId)\r\n                    let colIndex = this.thirdTrIdData.findIndex(item => item.columnId === e.columnId)\r\n                    this.setValue(e.rowId, e.value, rowIndex, colIndex, e.columnId, 'DATE')\r\n                  }\r\n                }\r\n              })\r\n            } else {\r\n              if (e.typeCode === 'BIGDECIMAL') {\r\n                let foundColumnId = this.showData.findIndex((d) => d.columnId === e.columnId)\r\n                if (foundColumnId > -1) {\r\n                  this.showData.map(f => {\r\n                    if (f.columnId == e.columnId) {\r\n                      f.columnData = (+f.columnData) + (+e.value)\r\n                    }\r\n                  })\r\n                } else {\r\n                  this.showData.push({\r\n                    columnId: e.columnId,\r\n                    columnData: (e.value)\r\n                  })\r\n                }\r\n              }\r\n\r\n              document\r\n                  .getElementsByClassName(\"input_val\").forEach((input) => {\r\n                formulas.forEach((element) => {\r\n                  let index_V = JSON.parse(element.f1).findIndex((e) => e == JSON.parse(input.id).columnId);\r\n                  if (index_V > -1) {\r\n                    this.$set(input, \"disabled\", true);\r\n                    this.$set(input.style, \"border\", \"none\");\r\n                    input.classList.add(\"no_enter_value\");\r\n                    input.style.fontWeight = \"bold\";\r\n                  }\r\n                });\r\n\r\n                if (JSON.parse(input.id).rowId) {\r\n                  if (\r\n                      parseFloat(JSON.parse(input.id).columnId) === parseFloat(e.columnId) &&\r\n                      parseFloat(JSON.parse(input.id).rowId) === parseFloat(e.rowId)\r\n                  ) {\r\n                    this.$set(input, \"value\", e.value);\r\n                  }\r\n                } else {\r\n                  if (\r\n                      parseFloat(JSON.parse(input.id).columnId) === parseFloat(e.columnId)\r\n                  ) {\r\n                    this.$set(input, \"value\", e.value);\r\n                  }\r\n                }\r\n              });\r\n            }\r\n          } else if (e.valueDate) {\r\n            document.getElementsByClassName(\"custom-datepicker mx-datepicker dynamic-datepicker\").forEach((field, idx) => {\r\n              if (JSON.parse(field.id).rowId) {\r\n                if (\r\n                    parseFloat(JSON.parse(field.id).columnId) === parseFloat(e.columnId) &&\r\n                    parseFloat(JSON.parse(field.id).rowId) === parseFloat(e.rowId)\r\n                ) {\r\n                  let rowIndex = this.selectedRows.findIndex(el => el.id == JSON.parse(field.id).rowId)\r\n                  let colIndex = this.thirdTrIdData.findIndex(item => item.columnId === e.columnId)\r\n                  this.setValue(e.rowId, e.value, rowIndex, colIndex, e.columnId, 'DATE')\r\n                }\r\n              }\r\n            })\r\n          } else if (e.valueBoolean !== null) {\r\n            document.getElementsByClassName(\"checkbox_field\").forEach((field, idx) => {\r\n              let checkboxInput = field.classList.contains('active') ? field.children[0].children[1].children[0] : field.children[0].children[0].children[0]\r\n              if (checkboxInput.id && JSON.parse(checkboxInput.id) && JSON.parse(checkboxInput.id).rowId) {\r\n                if (\r\n                    parseFloat(JSON.parse(checkboxInput.id).columnId) === parseFloat(e.columnId) &&\r\n                    parseFloat(JSON.parse(checkboxInput.id).rowId) === parseFloat(e.rowId)\r\n                ) {\r\n                  let rowIndex = this.selectedRows.findIndex(el => el.id == JSON.parse(checkboxInput.id).rowId)\r\n                  let colIndex = this.thirdTrIdData.findIndex(item => item.columnId == e.columnId)\r\n                  this.setValue(e.rowId, JSON.parse(e.value), rowIndex, colIndex, e.columnId, 'BOOLEAN')\r\n                }\r\n              }\r\n            })\r\n          } else if (e.selectValueNameUz) {\r\n            document.getElementsByClassName(\"select_field\").forEach((field, idx) => {\r\n              if (JSON.parse(field.id).rowId) {\r\n                if (\r\n                    parseFloat(JSON.parse(field.id).columnId) === parseFloat(e.columnId) &&\r\n                    parseFloat(JSON.parse(field.id).rowId) === parseFloat(e.rowId)\r\n                ) {\r\n                  let rowIndex = this.selectedRows.findIndex(el => el.id == JSON.parse(field.id).rowId)\r\n                  let colIndex = this.thirdTrIdData.findIndex(item => item.columnId == e.columnId)\r\n                  this.setValue(\r\n                      e.rowId,\r\n                      {\r\n                        nameUz: e.selectValueNameUz,\r\n                        nameLt: e.selectValueNameLt,\r\n                        nameRu: e.selectValueNameRu,\r\n                        id: e.selectValueId\r\n                      }, rowIndex, colIndex, e.columnId, 'SELECT', true, true)\r\n                }\r\n              }\r\n            })\r\n          }\r\n        });\r\n      } else {\r\n        document\r\n            .getElementsByClassName(\"input_val\")\r\n            .forEach((input) => {\r\n              formulas.forEach((element) => {\r\n                let index_V = JSON.parse(element.f1).findIndex(\r\n                    (e) => e == JSON.parse(input.id).columnId\r\n                );\r\n                if (index_V > -1) {\r\n                  this.$set(input, \"disabled\", true);\r\n                  this.$set(input.style, \"border\", \"none\");\r\n                  input.classList.add(\"no_enter_value\");\r\n                  input.style.fontWeight = \"bold\";\r\n                }\r\n              });\r\n            });\r\n      }\r\n      for (const docTableFormulaTargetId in this.docTableFormulasList) {\r\n        let disabledElements = document.querySelectorAll('input[data-column-id=\"' + docTableFormulaTargetId + '\"]');\r\n        disabledElements.forEach((element) => {\r\n          element.classList.add(\"no_enter_value\");\r\n          element.disabled = true;\r\n        });\r\n      }\r\n    },\r\n    async getById(id, reportId, info) {\r\n      this.clearAll();\r\n      this.tableId = id;\r\n      this.reportId = reportId;\r\n      this.tableInfo = info;\r\n      this.loader = true;\r\n      await Service.reportGetById(reportId).then(({ data }) => {\r\n        this.report = data;\r\n        this.$emit('setReportGenerated', this.report.generated);\r\n      });\r\n      await Service.getByIdTableWithReportId(id, reportId)\r\n        .then(async (rs) => {\r\n          if (rs.data) {\r\n            await this.setColumns(rs.data.columns, rs.data.rows.length);\r\n            this.setRow(rs.data.rows);\r\n            this.table = rs.data.table;\r\n            setTimeout(() => {\r\n              Promise.all([\r\n                this.getDataById(reportId),\r\n                this.getFormulas_2(),\r\n              ]).then(([data, formulas]) => {\r\n                    this.lastReportData = data\r\n                    this.lastReportFormulas = formulas\r\n                    this.setDocumentColumnValues(data, formulas)\r\n                    this.loader = false;\r\n                  });\r\n            },500);\r\n          }\r\n        })\r\n        .catch((e) => {\r\n          this.loader = false;\r\n        });\r\n      await Service.getDocTableFormulasList(id).then(({ data }) => {\r\n        this.docTableFormulasList = {};\r\n        let length = data.length;\r\n        let currentTargetColumnId = null;\r\n        for (let i = 0; i < length; i++) {\r\n          if (this.docTableFormulasList[data[i].targetColumnId] === undefined) {\r\n            currentTargetColumnId = data[i].targetColumnId;\r\n            this.docTableFormulasList[data[i].targetColumnId] = {\r\n              eval: \"\",\r\n              list: [],\r\n              listenColumns: [],\r\n              targetColumnId: data[i].targetColumnId\r\n            };\r\n          }\r\n          this.docTableFormulasList[data[i].targetColumnId].list.push(data[i]);\r\n          if (data[i].docColumnId) {\r\n            if (data[i].docColumnId && this.docTableFormulasList[data[i].targetColumnId].listenColumns.indexOf(data[i].docColumnId) === -1) {\r\n              this.docTableFormulasList[data[i].targetColumnId].listenColumns.push(data[i].docColumnId)\r\n            }\r\n            if (this.docTableFormulasListenColumnId[data[i].docColumnId] === undefined) {\r\n              this.docTableFormulasListenColumnId[data[i].docColumnId] = [data[i].targetColumnId];\r\n            } else {\r\n              if (this.docTableFormulasListenColumnId[data[i].docColumnId].indexOf(data[i].targetColumnId) === -1) {\r\n                this.docTableFormulasListenColumnId[data[i].docColumnId].push(data[i].targetColumnId);\r\n              }\r\n            }\r\n          }\r\n          if (data[i].type === \"ARGUMENTS\") {\r\n            this.docTableFormulasList[data[i].targetColumnId].eval += \"{\" + data[i].docColumnId + \"}\";\r\n          } else {\r\n            this.docTableFormulasList[data[i].targetColumnId].eval += data[i].code;\r\n          }\r\n        }\r\n      });\r\n    },\r\n\r\n    async setColumns(v, rowsCount) {\r\n      this.selectedColumns = v;\r\n      this.firstColumns = [];\r\n      this.secondColumns = [];\r\n      this.thirdColumns = [];\r\n      v.forEach((el1) => {\r\n        this.firstColumns.push(el1);\r\n        el1.children.forEach((el2) => {\r\n          this.secondColumns.push(el2);\r\n          el2.children.forEach((el3) => {\r\n            this.thirdColumns.push({ ...el3, fId: el1.id });\r\n          });\r\n        });\r\n      });\r\n      setTimeout(async () => {\r\n        let firstTrTh = document.getElementsByClassName(\"firstTrTh\");\r\n        let secondTrTh = document.getElementsByClassName(\"secondTrTh\");\r\n        let thirdTrTh = document.getElementsByClassName(\"thirdTrTh\");\r\n        let counter2 = 0,\r\n            counter3 = 0;\r\n        await firstTrTh.forEach(async (th) => {\r\n          if (th.colSpan > 1) {\r\n            for (let index2 = 0; index2 < th.colSpan; index2++) {\r\n              if (secondTrTh[counter2] && secondTrTh[counter2].colSpan > 1) {\r\n                for (\r\n                    let index3 = 0;\r\n                    index3 < secondTrTh[counter2].colSpan;\r\n                    index3++\r\n                ) {\r\n                  let array = thirdTrTh[counter3].id.split(\",\");\r\n                  let tmp = {\r\n                    columnId: array[0],\r\n                    typeCode: array[1],\r\n                    refCode: array[2],\r\n                    referenceUrl: array[3],\r\n                    referenceAppendUrl: array[4],\r\n                    referenceCode: array[5],\r\n                    referenceNameUz: array[6],\r\n                    referenceNameLt: array[7],\r\n                    referenceNameRu: array[8],\r\n                    searchPayload: Object.assign({}, this.var_default_search_payload),\r\n                    hasNextPage: false,\r\n                    options: [],\r\n                    rowId: [],\r\n                    value: [],\r\n                  };\r\n                  // GET DYNAMIC REFRENCE OPTIONS\r\n                  if (tmp.typeCode === 'SELECT') {\r\n                    for (let i = 0; i < rowsCount; i++) {\r\n                      tmp.value.push({ selectedItem: null })\r\n                    }\r\n                    crudAndListsService.searchListWithKeyword(tmp.referenceUrl, tmp.searchPayload, tmp.referenceAppendUrl)\r\n                        .then(res => {\r\n                          if (['DepartmentForDocument', 'Department'].includes(i.refCode)) {\r\n                            tmp.options.push(...res.data)\r\n                          } else {\r\n                            tmp.options.push(...res.data.list)\r\n                          }\r\n                          tmp.hasNextPage = res.data.total / tmp.searchPayload.itemsPerPage > tmp.searchPayload.page\r\n                          tmp.searchPayload.page += 1\r\n                          /* if (!this.isModeCreate && this.editingItem.okedId) {\r\n                              let foundItm = this.okeds.find(el => el.id == this.editingItem.okedId)\r\n                              if (!foundItm && this.editingItem.infoOkedDto) {\r\n                                  this.okeds.push(this.editingItem.infoOkedDto)\r\n                              }\r\n                          } */\r\n                        })\r\n                        .catch(e => {\r\n                          console.log(e)\r\n                          // this.okeds = []\r\n                        })\r\n                        .finally(() => {\r\n                          // this.isLoadingOked = false\r\n                        })\r\n                  }\r\n                  this.thirdTrIdData.push(tmp);\r\n                  counter3++;\r\n                }\r\n                counter2++;\r\n              } else {\r\n                if (\r\n                    secondTrTh[counter2] &&\r\n                    secondTrTh[counter2].classList.contains(\"thirdTrId\")\r\n                ) {\r\n                  let array = secondTrTh[counter2].id.split(\",\");\r\n                  let tmp = {\r\n                    columnId: array[0],\r\n                    typeCode: array[1],\r\n                    refCode: array[2],\r\n                    referenceUrl: array[3],\r\n                    referenceAppendUrl: array[4],\r\n                    referenceCode: array[5],\r\n                    referenceNameUz: array[6],\r\n                    referenceNameLt: array[7],\r\n                    referenceNameRu: array[8],\r\n                    searchPayload: Object.assign({}, this.var_default_search_payload),\r\n                    hasNextPage: false,\r\n                    options: [],\r\n                    rowId: [],\r\n                    value: [],\r\n                  };\r\n                  // GET DYNAMIC REFRENCE OPTIONS\r\n                  if (tmp.typeCode === 'SELECT') {\r\n                    for (let i = 0; i < rowsCount; i++) {\r\n                      tmp.value.push({ selectedItem: null })\r\n                    }\r\n                    crudAndListsService.searchListWithKeyword(tmp.referenceUrl, tmp.searchPayload, tmp.referenceAppendUrl)\r\n                        .then(res => {\r\n                          if (['DepartmentForDocument', 'Department'].includes(i.refCode)) {\r\n                            tmp.options.push(...res.data)\r\n                          } else {\r\n                            tmp.options.push(...res.data.list)\r\n                          }\r\n                          tmp.hasNextPage = res.data.total / tmp.searchPayload.itemsPerPage > tmp.searchPayload.page\r\n                          tmp.searchPayload.page += 1\r\n                          /* if (!this.isModeCreate && this.editingItem.okedId) {\r\n                              let foundItm = this.okeds.find(el => el.id == this.editingItem.okedId)\r\n                              if (!foundItm && this.editingItem.infoOkedDto) {\r\n                                  this.okeds.push(this.editingItem.infoOkedDto)\r\n                              }\r\n                          } */\r\n                        })\r\n                        .catch(e => {\r\n                          console.log(e)\r\n                          // this.okeds = []\r\n                        })\r\n                        .finally(() => {\r\n                          // this.isLoadingOked = false\r\n                        })\r\n                  }\r\n                  this.thirdTrIdData.push(tmp);\r\n                  counter2++;\r\n                } else {\r\n                  if (secondTrTh[counter2]) {\r\n                    for (\r\n                        let index3 = 0;\r\n                        index3 < secondTrTh[counter2].colSpan;\r\n                        index3++\r\n                    ) {\r\n                      let array = thirdTrTh[counter3].id.split(\",\");\r\n                      let tmp = {\r\n                        columnId: array[0],\r\n                        typeCode: array[1],\r\n                        refCode: array[2],\r\n                        referenceUrl: array[3],\r\n                        referenceAppendUrl: array[4],\r\n                        referenceCode: array[5],\r\n                        referenceNameUz: array[6],\r\n                        referenceNameLt: array[7],\r\n                        referenceNameRu: array[8],\r\n                        searchPayload: Object.assign({}, this.var_default_search_payload),\r\n                        hasNextPage: false,\r\n                        options: [],\r\n                        rowId: [],\r\n                        value: [],\r\n                      };\r\n                      // GET DYNAMIC REFRENCE OPTIONS\r\n                      if (tmp.typeCode === 'SELECT') {\r\n                        for (let i = 0; i < rowsCount; i++) {\r\n                          tmp.value.push({ selectedItem: null })\r\n                        }\r\n                        crudAndListsService.searchListWithKeyword(tmp.referenceUrl, tmp.searchPayload, tmp.referenceAppendUrl)\r\n                            .then(res => {\r\n                              if (['DepartmentForDocument', 'Department'].includes(i.refCode)) {\r\n                                tmp.options.push(...res.data)\r\n                              } else {\r\n                                tmp.options.push(...res.data.list)\r\n                              }\r\n                              tmp.hasNextPage = res.data.total / tmp.searchPayload.itemsPerPage > tmp.searchPayload.page\r\n                              tmp.searchPayload.page += 1\r\n                              /* if (!this.isModeCreate && this.editingItem.okedId) {\r\n                                  let foundItm = this.okeds.find(el => el.id == this.editingItem.okedId)\r\n                                  if (!foundItm && this.editingItem.infoOkedDto) {\r\n                                      this.okeds.push(this.editingItem.infoOkedDto)\r\n                                  }\r\n                              } */\r\n                            })\r\n                            .catch(e => {\r\n                              console.log(e)\r\n                              // this.okeds = []\r\n                            })\r\n                            .finally(() => {\r\n                              // this.isLoadingOked = false\r\n                            })\r\n                      }\r\n                      this.thirdTrIdData.push(tmp);\r\n                      counter3++;\r\n                    }\r\n\r\n                    counter2++;\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          } else {\r\n            if (th.classList.contains(\"thirdTrId\")) {\r\n              let array = th.id.split(\",\");\r\n              let tmp = {\r\n                columnId: array[0],\r\n                typeCode: array[1],\r\n                refCode: array[2],\r\n                referenceUrl: array[3],\r\n                referenceAppendUrl: array[4],\r\n                referenceCode: array[5],\r\n                referenceNameUz: array[6],\r\n                referenceNameLt: array[7],\r\n                referenceNameRu: array[8],\r\n                searchPayload: Object.assign({}, this.var_default_search_payload),\r\n                hasNextPage: false,\r\n                options: [],\r\n                rowId: [],\r\n                value: [],\r\n              };\r\n              // GET DYNAMIC REFRENCE OPTIONS\r\n              if (tmp.typeCode === 'SELECT') {\r\n                for (let i = 0; i < rowsCount; i++) {\r\n                  tmp.value.push({ selectedItem: null })\r\n                }\r\n                crudAndListsService.searchListWithKeyword(tmp.referenceUrl, tmp.searchPayload, tmp.referenceAppendUrl)\r\n                    .then(res => {\r\n                      if ([\"DepartmentForDocument\", \"Department\"].includes(tmp.refCode)) {\r\n                        tmp.options.push(...res.data)\r\n                      } else {\r\n                        tmp.options.push(...res.data.list)\r\n                      }\r\n                      tmp.hasNextPage = res.data.total / tmp.searchPayload.itemsPerPage > tmp.searchPayload.page\r\n                      tmp.searchPayload.page += 1\r\n                      /* if (!this.isModeCreate && this.editingItem.okedId) {\r\n                          let foundItm = this.okeds.find(el => el.id == this.editingItem.okedId)\r\n                          if (!foundItm && this.editingItem.infoOkedDto) {\r\n                              this.okeds.push(this.editingItem.infoOkedDto)\r\n                          }\r\n                      } */\r\n                    })\r\n                    .catch(e => {\r\n                      console.log(e)\r\n                      // this.okeds = []\r\n                    })\r\n                    .finally(() => {\r\n                      // this.isLoadingOked = false\r\n                    })\r\n              }\r\n              this.thirdTrIdData.push(tmp);\r\n            } else {\r\n              for (let index2 = 0; index2 < th.colSpan; index2++) {\r\n                if (secondTrTh[counter2].colSpan > 1) {\r\n                  for (\r\n                      let index3 = 0;\r\n                      index3 < secondTrTh[counter2].colSpan;\r\n                      index3++\r\n                  ) {\r\n                    let array = thirdTrTh[counter3].id.split(\",\");\r\n                    let tmp = {\r\n                      columnId: array[0],\r\n                      typeCode: array[1],\r\n                      refCode: array[2],\r\n                      referenceUrl: array[3],\r\n                      referenceAppendUrl: array[4],\r\n                      referenceCode: array[5],\r\n                      referenceNameUz: array[6],\r\n                      referenceNameLt: array[7],\r\n                      referenceNameRu: array[8],\r\n                      searchPayload: Object.assign({}, this.var_default_search_payload),\r\n                      hasNextPage: false,\r\n                      options: [],\r\n                      rowId: [],\r\n                      value: [],\r\n                    };\r\n                    // GET DYNAMIC REFRENCE OPTIONS\r\n                    if (tmp.typeCode === 'SELECT') {\r\n                      for (let i = 0; i < rowsCount; i++) {\r\n                        tmp.value.push({ selectedItem: null })\r\n                      }\r\n                      crudAndListsService.searchListWithKeyword(tmp.referenceUrl, tmp.searchPayload, tmp.referenceAppendUrl)\r\n                          .then(res => {\r\n                            if (['DepartmentForDocument', 'Department'].includes(i.refCode)) {\r\n                              tmp.options.push(...res.data)\r\n                            } else {\r\n                              tmp.options.push(...res.data.list)\r\n                            }\r\n                            tmp.hasNextPage = res.data.total / tmp.searchPayload.itemsPerPage > tmp.searchPayload.page\r\n                            tmp.searchPayload.page += 1\r\n                            /* if (!this.isModeCreate && this.editingItem.okedId) {\r\n                                let foundItm = this.okeds.find(el => el.id == this.editingItem.okedId)\r\n                                if (!foundItm && this.editingItem.infoOkedDto) {\r\n                                    this.okeds.push(this.editingItem.infoOkedDto)\r\n                                }\r\n                            } */\r\n                          })\r\n                          .catch(e => {\r\n                            console.log(e)\r\n                            // this.okeds = []\r\n                          })\r\n                          .finally(() => {\r\n                            // this.isLoadingOked = false\r\n                          })\r\n                    }\r\n                    this.thirdTrIdData.push(tmp);\r\n                    counter3++;\r\n                  }\r\n                  counter2++;\r\n                } else {\r\n                  if (\r\n                      secondTrTh[counter2] &&\r\n                      secondTrTh[counter2].classList.contains(\"thirdTrId\")\r\n                  ) {\r\n                    let array = secondTrTh[counter2].id.split(\",\");\r\n                    let tmp = {\r\n                      columnId: array[0],\r\n                      typeCode: array[1],\r\n                      refCode: array[2],\r\n                      referenceUrl: array[3],\r\n                      referenceAppendUrl: array[4],\r\n                      referenceCode: array[5],\r\n                      referenceNameUz: array[6],\r\n                      referenceNameLt: array[7],\r\n                      referenceNameRu: array[8],\r\n                      searchPayload: Object.assign({}, this.var_default_search_payload),\r\n                      hasNextPage: false,\r\n                      options: [],\r\n                      rowId: [],\r\n                      value: [],\r\n                    };\r\n                    // GET DYNAMIC REFRENCE OPTIONS\r\n                    if (tmp.typeCode === 'SELECT') {\r\n                      for (let i = 0; i < rowsCount; i++) {\r\n                        tmp.value.push({ selectedItem: null })\r\n                      }\r\n                      crudAndListsService.searchListWithKeyword(tmp.referenceUrl, tmp.searchPayload, tmp.referenceAppendUrl)\r\n                          .then(res => {\r\n                            if (['DepartmentForDocument', 'Department'].includes(i.refCode)) {\r\n                              tmp.options.push(...res.data)\r\n                            } else {\r\n                              tmp.options.push(...res.data.list)\r\n                            }\r\n                            tmp.hasNextPage = res.data.total / tmp.searchPayload.itemsPerPage > tmp.searchPayload.page\r\n                            tmp.searchPayload.page += 1\r\n                            /* if (!this.isModeCreate && this.editingItem.okedId) {\r\n                                let foundItm = this.okeds.find(el => el.id == this.editingItem.okedId)\r\n                                if (!foundItm && this.editingItem.infoOkedDto) {\r\n                                    this.okeds.push(this.editingItem.infoOkedDto)\r\n                                }\r\n                            } */\r\n                          })\r\n                          .catch(e => {\r\n                            console.log(e)\r\n                            // this.okeds = []\r\n                          })\r\n                          .finally(() => {\r\n                            // this.isLoadingOked = false\r\n                          })\r\n                    }\r\n                    this.thirdTrIdData.push(tmp);\r\n                    counter2++;\r\n                  } else {\r\n                    if (secondTrTh[counter2]) {\r\n                      for (\r\n                          let index3 = 0;\r\n                          index3 < secondTrTh[counter2].colSpan;\r\n                          index3++\r\n                      ) {\r\n                        let array = thirdTrTh[counter3].id.split(\",\");\r\n                        let tmp = {\r\n                          columnId: array[0],\r\n                          typeCode: array[1],\r\n                          refCode: array[2],\r\n                          referenceUrl: array[3],\r\n                          referenceAppendUrl: array[4],\r\n                          referenceCode: array[5],\r\n                          referenceNameUz: array[6],\r\n                          referenceNameLt: array[7],\r\n                          referenceNameRu: array[8],\r\n                          searchPayload: Object.assign({}, this.var_default_search_payload),\r\n                          hasNextPage: false,\r\n                          options: [],\r\n                          rowId: [],\r\n                          value: [],\r\n                        };\r\n                        // GET DYNAMIC REFRENCE OPTIONS\r\n                        if (tmp.typeCode === 'SELECT') {\r\n                          for (let i = 0; i < rowsCount; i++) {\r\n                            tmp.value.push({ selectedItem: null })\r\n                          }\r\n                          crudAndListsService.searchListWithKeyword(tmp.referenceUrl, tmp.searchPayload, tmp.referenceAppendUrl)\r\n                              .then(res => {\r\n                                if (['DepartmentForDocument', 'Department'].includes(i.refCode)) {\r\n                                  tmp.options.push(...res.data)\r\n                                } else {\r\n                                  tmp.options.push(...res.data.list)\r\n                                }\r\n                                tmp.hasNextPage = res.data.total / tmp.searchPayload.itemsPerPage > tmp.searchPayload.page\r\n                                tmp.searchPayload.page += 1\r\n                                /* if (!this.isModeCreate && this.editingItem.okedId) {\r\n                                    let foundItm = this.okeds.find(el => el.id == this.editingItem.okedId)\r\n                                    if (!foundItm && this.editingItem.infoOkedDto) {\r\n                                        this.okeds.push(this.editingItem.infoOkedDto)\r\n                                    }\r\n                                } */\r\n                              })\r\n                              .catch(e => {\r\n                                console.log(e)\r\n                                // this.okeds = []\r\n                              })\r\n                              .finally(() => {\r\n                                // this.isLoadingOked = false\r\n                              })\r\n                        }\r\n                        this.thirdTrIdData.push(tmp);\r\n                        counter3++;\r\n                      }\r\n                      counter2++;\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        });\r\n      }, 300);\r\n    },\r\n    setRow(v) {\r\n      this.selectedRows = v;\r\n      this.lastReportDataRows = JSON.parse(JSON.stringify(v));\r\n      if (this.selectedRows.length == 0 && !this.isGenerated) {\r\n        this.selectedRows = [{ id: this.getRandomInt() }];\r\n      }\r\n    },\r\n    rowspanFirst(el) {\r\n      return el.children.length > 0\r\n          ? 1\r\n          : el.children.length > 0 && this.thirdColumns.length > 0\r\n              ? 3\r\n              : 3;\r\n    },\r\n    colspanFirst(el) {\r\n      let found = this.thirdColumns.filter((i) => i.fId === el.id);\r\n      let totalNotChild = el.children.filter((d) => d.children.length == 0);\r\n      return el.children.length > 0 && found.length == 0\r\n          ? el.children.length\r\n          : el.children.length > 0 && found.length > 0\r\n              ? totalNotChild.length + found.length\r\n              : 1;\r\n    },\r\n    rowspanSecond(el) {\r\n      return el.children.length == 0 && this.thirdColumns.length == 0\r\n          ? 1\r\n          : el.children.length == 0 && this.thirdColumns.length > 0\r\n              ? 2\r\n              : 1;\r\n    },\r\n    colspanSecond(el) {\r\n      return el.children.length > 0 ? el.children.length : 1;\r\n    },\r\n    rowspanFirstClass(el) {\r\n      return el.children.length > 0\r\n          ? \"\"\r\n          : el.children.length > 0 && this.thirdColumns.length > 0\r\n              ? \"thirdTrId\"\r\n              : \"thirdTrId\";\r\n    },\r\n    rowspanSecondClass(el) {\r\n      return el.children.length == 0 && this.thirdColumns.length == 0\r\n          ? \"thirdTrId\"\r\n          : el.children.length == 0 && this.thirdColumns.length > 0\r\n              ? \"thirdTrId\"\r\n              : \"\";\r\n    },\r\n    normalizer(node) {\r\n      if (!node.children || node.children.length === 0) {\r\n        delete node.children\r\n        return {\r\n          id: node.id,\r\n          label: this.getName({\r\n            nameRu: node.nameRu,\r\n            nameLt: node.nameLt,\r\n            nameUz: node.nameUz,\r\n          }),\r\n        }\r\n      }\r\n      return {\r\n        id: node.id,\r\n        label: this.getName({\r\n          nameRu: node.nameRu,\r\n          nameLt: node.nameLt,\r\n          nameUz: node.nameUz,\r\n        }),\r\n        children: node.children && node.children.length > 0 ? node.children : [],\r\n      }\r\n    },\r\n    calculateDocFormulas(rowId, value, rowIndex, columnIndex, columnId, typeCode) {\r\n      // rowIndex is `selectedRows` index\r\n\r\n      if (this.docTableFormulasListenColumnId[columnId] === undefined) {\r\n        return false;\r\n      }\r\n      let targets = this.docTableFormulasListenColumnId[columnId];\r\n      for (const targetIndex in targets) {\r\n        const docTableFormula = this.docTableFormulasList[targets[targetIndex]];\r\n        let evalString = docTableFormula.eval;\r\n        for (const listenColumn of docTableFormula.listenColumns) {\r\n          let thirdIndex = this.trColumnIdOnDocColumnIdMap[listenColumn];\r\n          let val = parseFloat(this.thirdTrIdData[thirdIndex]?.value[rowIndex]?.value ?? 0);\r\n          if (!val) {\r\n            this.report\r\n          }\r\n          val = isNaN(val) ? 0 : val;\r\n          evalString = evalString.replace(\"{\" + listenColumn + \"}\", val);\r\n        }\r\n        let val = eval(evalString);\r\n\r\n        // todo optimize qilish kerak. v-model bilan qilish kerak\r\n        this.$set(document.getElementById(JSON.stringify({\r\n          \"rowId\": rowId,\r\n          \"columnId\": docTableFormula.targetColumnId.toString()\r\n        })), \"value\", val);\r\n\r\n        this.setValue(rowId, val, rowIndex, this.trColumnIdOnDocColumnIdMap[docTableFormula.targetColumnId], docTableFormula.targetColumnId, typeCode);\r\n      }\r\n    },\r\n    treeClosed(veeName) {\r\n      this.computedObserver.refs[veeName].validate();\r\n    },\r\n    selectCustomLabel({ nameUz, nameLt, nameRu, name, fullName }) {\r\n      if (nameUz) {\r\n        return this.getName({ nameUz: nameUz, nameLt: nameLt, nameRu: nameRu });\r\n      }\r\n      if (fullName) {\r\n        return fullName;\r\n      }\r\n      return name;\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <div>\r\n      <div class=\"row\">\r\n        <div class=\"col-lg-12\">\r\n          <h5 class=\"text-center mb-1\">\r\n            <strong>\r\n              {{ getName({ nameLt: table.nameLt, nameUz: table.nameUz, nameRu: table.nameRu }) }}\r\n\r\n            </strong>\r\n          </h5>\r\n          <p class=\"text-center m-0\">\r\n            {{ getName({ nameLt: table.titleLt, nameUz: table.titleUz, nameRu: table.titleRu }) }}\r\n\r\n          </p>\r\n        </div>\r\n        <div class=\"col-lg-12\">\r\n          <div class=\"d-flex justify-content-between align-items-end pl-3 pr-3\">\r\n            <div>\r\n              <strong>\r\n                {{\r\n                  getName({\r\n                    nameLt: report.nameLt,\r\n                    nameRu: report.nameRu,\r\n                    nameUz: report.nameUz\r\n                  })\r\n                }}\r\n              </strong><br>\r\n              <span>\r\n                {{\r\n                  report.reportDate\r\n                }}\r\n              </span>\r\n            </div>\r\n            <div>\r\n              <strong>\r\n                {{\r\n                  getName({\r\n                    nameLt: table.conditionLt,\r\n                    nameRu: table.conditionRu,\r\n                    nameUz: table.conditionUz,\r\n                  })\r\n                }}\r\n              </strong>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-lg-12\">\r\n          <b-overlay :opacity=\"0.1\" :show=\"loader\" rounded=\"sm\">\r\n            <div class=\"bg-white pl-3 pr-3 pt-1\" style=\"min-height: 60vh; overflow: auto;\">\r\n              <div class=\"pb-5\">\r\n                <table class=\"table thead-table table-centered table-custom-bordered\">\r\n                  <thead>\r\n                  <tr class=\"tr-text-center\">\r\n                    <th\r\n                        :id=\"[el.id, el.typeCode, el.refCode, el.referenceUrl, el.referenceAppendUrl, el.referenceCode, el.referenceNameUz, el.referenceNameLt, el.referenceNameRu]\"\r\n                        :class=\"rowspanFirstClass(el, index)\"\r\n                        class=\"firstTrTh\"\r\n                        style=\"min-width: 70px\"\r\n                        :rowspan=\"rowspanFirst(el)\"\r\n                        :colspan=\"colspanFirst(el)\"\r\n                        v-for=\"(el, index) in firstColumns\"\r\n                        :key=\"index + 'first'\"\r\n                    >\r\n                      <div style=\" max-height: 200px; display: inline-block; \" >\r\n                        <div :class=\" (el.isVertical == 1 ) ? 'rotate_text' : ''\">\r\n                          {{ getName({ nameLt: el.nameLt, nameUz: el.nameUz, nameRu: el.nameRu }) }}\r\n                        </div>\r\n                      </div>\r\n                    </th>\r\n                    <th\r\n                        v-show=\"tableInfo.hasDynamicRows &&  !tableInfo.isGenerated && !loader\"\r\n                        :rowspan=\"thirdColumns.length > 0 ? 3 : secondColumns.length > 0 ? 2 : 1\"\r\n                    >\r\n                      <div style=\"max-height: 200px; display: inline-block;\">\r\n                        <div>\r\n                          {{ $t('column.actions') }}\r\n                        </div>\r\n                      </div>\r\n                    </th>\r\n                  </tr>\r\n                  <tr class=\"tr-text-center\">\r\n                    <th\r\n                        style=\"min-width: 70px\"\r\n                        :id=\"[el.id, el.typeCode, el.refCode, el.referenceUrl, el.referenceAppendUrl, el.referenceCode, el.referenceNameUz, el.referenceNameLt, el.referenceNameRu]\"\r\n                        :class=\"rowspanSecondClass(el)\"\r\n                        class=\"secondTrTh\"\r\n                        :rowspan=\"rowspanSecond(el)\"\r\n                        :colspan=\"colspanSecond(el)\"\r\n                        v-for=\"(el, index) in secondColumns\"\r\n                        :key=\"index + 'second'\"\r\n                    >\r\n                      <div\r\n                          style=\"\r\n                          max-height: 200px;\r\n                          position: relative;\r\n                          display: inline-block;\r\n                          cursor: pointer;\"\r\n                      >\r\n                        <div\r\n\r\n                            :class=\"(el.isVertical == 1 )  ? 'rotate_text' : ''\"\r\n                        >\r\n                          {{\r\n                            getName({ nameLt: el.nameLt, nameRu: el.nameRu, nameUz: el.nameUz })\r\n                          }}\r\n                        </div>\r\n                      </div>\r\n                    </th>\r\n                  </tr>\r\n\r\n                  <tr class=\"tr-text-center\">\r\n                    <th\r\n                        style=\"min-width: 70px\"\r\n                        :id=\"[el.id, el.typeCode, el.refCode, el.referenceUrl, el.referenceAppendUrl, el.referenceCode, el.referenceNameUz, el.referenceNameLt, el.referenceNameRu]\"\r\n                        class=\"thirdTrId thirdTrTh\"\r\n                        :colspan=\"el.children.length > 0 ? el.children.length : 1\"\r\n                        v-for=\"(el, index) in thirdColumns\"\r\n                        :key=\"index + 'third'\"\r\n                    >\r\n                      <div\r\n                          style=\"\r\n                            max-height: 200px;\r\n                            position: relative;\r\n                            display: inline-block;\r\n                            cursor: pointer;\r\n                          \"\r\n                      >\r\n                        <div :class=\"(el.isVertical == 1 )  ? 'rotate_text' : ''\">\r\n                          {{\r\n                            getName({ nameLt: el.nameLt, nameRu: el.nameRu, nameUz: el.nameUz })\r\n                          }}\r\n                        </div>\r\n                      </div>\r\n                    </th>\r\n                  </tr>\r\n\r\n                  <tr class=\"tr-text-center\">\r\n                    <td\r\n                        v-for=\"(item, index) of (tableInfo.hasDynamicRows &&  !tableInfo.isGenerated) ? thirdTrIdData.length  + 1 :  thirdTrIdData.length \"\r\n                        :key=\"index + 'I-1'\"\r\n                    >\r\n                      <strong v-if=\"selectedRows.length > 1\">\r\n                        {{\r\n                          selectedRows.length > 1 && index == 0 ? \"\" : index\r\n                        }}\r\n                      </strong\r\n                      >\r\n\r\n                      <strong v-else>\r\n                        {{ index + 1 }}\r\n                      </strong>\r\n                    </td>\r\n                  </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                  <tr v-if=\"isGenerated && !selectedRows.length && !loader\">\r\n                    <td class=\"text-center\" colspan=\"4000\">\r\n                      <h5 class=\"m-3 p-0\">\r\n                        {{ $t('messages.data_not_found') }}\r\n                      </h5>\r\n                    </td>\r\n                  </tr>\r\n                  <tr v-for=\"(data, index1) in selectedRows\" :key=\"index1 + 'MM'\">\r\n                    <td\r\n                        :class=\"[\r\n                          f1Ids &&\r\n                          f1Ids.indexOf(i.columnId) > -1 &&\r\n                          selectedRows.length > 1 &&\r\n                          fRowId == data.id\r\n                            ? 'bg-success'\r\n                            : f1Ids &&\r\n                              f1Ids.indexOf(i.columnId) > -1 &&\r\n                              selectedRows.length <= 1\r\n                            ? 'bg-success'\r\n                            : '',\r\n                          f2Ids &&\r\n                          f2Ids.indexOf(i.columnId) > -1 &&\r\n                          selectedRows.length > 1 &&\r\n                          fRowId == data.id\r\n                            ? 'bg-primary'\r\n                            : f2Ids &&\r\n                              f2Ids.indexOf(i.columnId) > -1 &&\r\n                              selectedRows.length <= 1\r\n                            ? 'bg-primary'\r\n                            : '',\r\n                        ]\"\r\n                        v-for=\"(i, index) in thirdTrIdData\"\r\n                        :key=\"index + 'td'\"\r\n                        class=\"text-center p\"\r\n                    >\r\n                      <p class=\"m-0 p-2\" v-if=\"i.typeCode === 'SEQUENCE'\">\r\n                        {{ index1 + 1 }}\r\n                      </p>\r\n                      <div\r\n                          v-else-if=\"i.typeCode === 'SELECT' && thirdTrIdData[index].value[index1] && thirdTrIdData[index].value[index1].notEditable\"\r\n                          :v-b-tooltip=\"tableInfo.isGenerated ? '' :{ variant: 'info' }\"\r\n                          class=\"cursor-pointer\"\r\n                          @click=\"tableInfo.isGenerated ? '' : editValue(index1, index)\"\r\n                          :title=\"tableInfo.isGenerated ? '' :  $t('actions.click_to_edit')\"\r\n                      >\r\n                        {{\r\n                          getName({\r\n                            nameUz: thirdTrIdData[index].value[index1].selectValueNameUz,\r\n                            nameLt: thirdTrIdData[index].value[index1].selectValueNameLt,\r\n                            nameRu: thirdTrIdData[index].value[index1].selectValueNameRu\r\n                          })\r\n                        }}\r\n                      </div>\r\n                      <!-- FOR SELECT -->\r\n                      <div v-else-if=\"i.typeCode === 'SELECT'\" style=\"min-width: 300px;\">\r\n                        <BaseTreeselectWithValidation\r\n                            not-required\r\n                            ref=\"parentDepVeeName\"\r\n                            name=\"parentDepVeeName\"\r\n                            class=\"select_field\"\r\n                            v-if=\"thirdTrIdData[index].value[index1] && ['DepartmentForDocument', 'Department'].includes(i.refCode)\"\r\n                            v-model=\"thirdTrIdData[index].value[index1].selectedItem\"\r\n                            form-label=\"__none\"\r\n                            :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId})\"\r\n                            :options=\"i.options\"\r\n                            :show-count=\"true\"\r\n                            :normalizer=\"normalizer\"\r\n                            :placeholder=\"$t('column.parent_department')\"\r\n                            :custom-label=\"selectCustomLabel\"\r\n                            :default-expand-level=\"1\"\r\n                            @select=\"setValue(data.id,$event,index1,index,i.columnId,i.typeCode,i.notEditable)\"\r\n                            @search-change=\"debounceSearchDynamicRefs\"\r\n                        >\r\n                          <div slot=\"value-label\">-{{ thirdTrIdData[index].value[index1].selectValueNameUz }}</div>\r\n                        </BaseTreeselectWithValidation>\r\n                        <BaseTreeselectWithValidation\r\n                            not-required\r\n                            ref=\"parentDepVeeName\"\r\n                            name=\"parentDepVeeName\"\r\n                            class=\"select_field\"\r\n                            v-if=\"!thirdTrIdData[index].value[index1] && ['DepartmentForDocument', 'Department'].includes(i.refCode)\"\r\n                            v-model=\"thirdTrIdData[index].value[index1]\"\r\n                            form-label=\"__none\"\r\n                            :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId})\"\r\n                            :options=\"i.options\"\r\n                            :show-count=\"true\"\r\n                            :normalizer=\"normalizer\"\r\n                            :placeholder=\"$t('column.parent_department')\"\r\n                            :default-expand-level=\"1\"\r\n                            :custom-label=\"({nameUz, nameLt, nameRu, name})  => nameUz ? getName({nameUz: nameUz, nameLt: nameLt, nameRu: nameRu}) : name\"\r\n                            @select=\"setValue(data.id,$event,index1,index,i.columnId,i.typeCode,i.notEditable)\"\r\n                            @search-change=\"debounceSearchDynamicRefs\"\r\n                        >\r\n                        </BaseTreeselectWithValidation>\r\n                        <BaseMultiselectWithValidation\r\n                            v-if=\"thirdTrIdData[index].value[index1] && !['DepartmentForDocument', 'Department'].includes(i.refCode)\"\r\n                            not-required\r\n                            only-form-element\r\n                            v-model=\"thirdTrIdData[index].value[index1].selectedItem\"\r\n                            class=\"select_field\"\r\n                            :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId})\"\r\n                            :custom-label=\"selectCustomLabel\"\r\n                            label=\"name\"\r\n                            @select=\"setValue(data.id,$event,index1,index,i.columnId,i.typeCode,i.notEditable)\"\r\n                            :options=\"i.options\"\r\n                            :placeholder=\"getName({nameUz: i.referenceNameUz, nameLt: i.referenceNameLt, nameRu: i.referenceNameRu})\"\r\n                            open-direction=\"bottom\"\r\n                            :max-height=\"600\"\r\n                            :show-labels=\"false\"\r\n                            :has-next-page=\"i.hasNextPage\"\r\n                            @reachedEndOfList=\"dynamicRefsReachedEndOfList\"\r\n                            @search-change=\"debounceSearchDynamicRefs\"\r\n                            :searchable=\"true\"\r\n                            preserve-search\r\n                            :clear-on-select=\"false\"\r\n                            :loading=\"i.isLoading\"\r\n                            :internal-search=\"false\"\r\n                            :with-create-addition=\"(thirdTrIdData[index].value[index1] && thirdTrIdData[index].value[index1].originalSelectValueNameUz) ? true : false\"\r\n                        >\r\n                          <template v-slot:append-slot>\r\n                            <b-btn\r\n                                v-if=\"thirdTrIdData[index].value[index1] && thirdTrIdData[index].value[index1].originalSelectValueNameUz\"\r\n                                variant=\"link\"\r\n                                class=\"text-decoration-none p-0 text-danger\"\r\n                                style=\"font-size: 1.2rem;\"\r\n                            >\r\n                              <i\r\n                                  @click=\"resetValue(index1, index)\"\r\n                                  class=\"mdi mdi-refresh\"\r\n                              ></i>\r\n                            </b-btn>\r\n                          </template>\r\n                        </BaseMultiselectWithValidation>\r\n                        <BaseMultiselectWithValidation\r\n                            v-else-if=\"!thirdTrIdData[index].value[index1] && !['DepartmentForDocument', 'Department'].includes(i.refCode)\"\r\n                            not-required\r\n                            only-form-element\r\n                            class=\"select_field\"\r\n                            :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId})\"\r\n                            v-model=\"thirdTrIdData[index].value[index1]\"\r\n                            :custom-label=\"selectCustomLabel\"\r\n                            label=\"name\"\r\n                            @select=\"setValue(data.id,$event,index1,index,i.columnId,i.typeCode,i.notEditable)\"\r\n                            :options=\"i.options\"\r\n                            :placeholder=\"getName({nameUz: i.referenceNameUz, nameLt: i.referenceNameLt, nameRu: i.referenceNameRu})\"\r\n                            open-direction=\"bottom\"\r\n                            :max-height=\"600\"\r\n                            :show-labels=\"false\"\r\n                            :has-next-page=\"i.hasNextPage\"\r\n                            @reachedEndOfList=\"dynamicRefsReachedEndOfList\"\r\n                            @search-change=\"debounceSearchDynamicRefs\"\r\n                            :searchable=\"true\"\r\n                            preserve-search\r\n                            :clear-on-select=\"false\"\r\n                            :loading=\"i.isLoading\"\r\n                            :internal-search=\"false\"\r\n                        />\r\n                      </div>\r\n                      <!-- FOR DATE -->\r\n                      <BaseDatePickerWithValidation\r\n                          v-else-if=\"i.typeCode === 'DATE' && thirdTrIdData[index].value[index1]\"\r\n                          not-required\r\n                          only-form-element\r\n                          custom-styles=\"min-width: 140px;\"\r\n                          placeholder=\"\"\r\n                          v-model=\"thirdTrIdData[index].value[index1].value\"\r\n                          class=\"datepicker_field\"\r\n                          :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId,})\"\r\n                          @input=\"(e) => setValue( data.id, e, index1, index, i.columnId, i.typeCode ) \"\r\n                          lang=\"ru\"\r\n                      />\r\n                      <BaseDatePickerWithValidation\r\n                          v-else-if=\"i.typeCode === 'DATE'\"\r\n                          not-required\r\n                          only-form-element\r\n                          custom-styles=\"min-width: 140px;\"\r\n                          class=\"datepicker_field\"\r\n                          :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId,})\"\r\n                          placeholder=\"\"\r\n                          @input=\"(e) =>setValue(data.id,e,index1,index,i.columnId,i.typeCode)\"\r\n                          lang=\"ru\"\r\n                      />\r\n\r\n                      <!-- FOR YEAR -->\r\n                      <BaseDatePickerWithValidation\r\n                          v-else-if=\"i.typeCode === 'YEAR' && thirdTrIdData[index].value[index1]\"\r\n                          not-required\r\n                          only-form-element\r\n                          custom-styles=\"min-width: 140px;\"\r\n                          placeholder=\"\"\r\n                          v-model=\"thirdTrIdData[index].value[index1].value\"\r\n                          class=\"datepicker_field dynamic-year\"\r\n                          :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId,})\"\r\n                          @input=\"(e) => setValue( data.id, e, index1, index, i.columnId, i.typeCode ) \"\r\n                          type=\"year\"\r\n                          format=\"YYYY\"\r\n                      />\r\n                      <BaseDatePickerWithValidation\r\n                          v-else-if=\"i.typeCode === 'YEAR'\"\r\n                          not-required\r\n                          only-form-element\r\n                          custom-styles=\"min-width: 140px;\"\r\n                          class=\"datepicker_field dynamic-year\"\r\n                          :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId,})\"\r\n                          placeholder=\"\"\r\n                          @input=\"(e) =>setValue(data.id,e,index1,index,i.columnId,i.typeCode)\"\r\n                          type=\"year\"\r\n                          format=\"YYYY\"\r\n                      />\r\n\r\n                      <!-- FOR STRING -->\r\n                      <div v-else-if=\"i.typeCode === 'STRING'\" style=\"min-width: 300px;\">\r\n                        <b-form-input\r\n                            @keydown=\" (evt) => keydownEvt( evt, data.id, evt.target.value, index1, index, i.columnId, i.typeCode ) \"\r\n                            @keyup=\"(event) => calculateDocFormulas(data.id, event.target.value, index1, index, i.columnId, i.typeCode)\"\r\n                            :class=\"\r\n                              currentPosition.rowId &&\r\n                              currentPosition.columnId &&\r\n                              i.columnId == currentPosition.columnId &&\r\n                              data.id == currentPosition.rowId\r\n                                ? 'borderInput'\r\n                                : currentPosition.columnId &&\r\n                                  !currentPosition.rowId &&\r\n                                  i.columnId == currentPosition.columnId\r\n                                ? 'borderInput'\r\n                                : ''\r\n                            \"\r\n                            @focus=\" (e) => focusVal( data.id, e, index1, index, i.columnId, i.typeCode ) \"\r\n                            :style=\" report.status && report.status !== 'CREATED' ? 'border: none !important' : ''\"\r\n                            :disabled=\"report.status && report.status !== 'CREATED'\"\r\n                            :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId,})\"\r\n                            @input=\"(e) => setValue( data.id, e, index1, index, i.columnId, i.typeCode)\"\r\n                            class=\"text-center input_val p-0\"\r\n                        >\r\n                        </b-form-input>\r\n                      </div>\r\n                      <!-- FOR BOOLEAN -->\r\n                      <Checkbox\r\n                          v-else-if=\"i.typeCode === 'BOOLEAN' && thirdTrIdData[index].value[index1]\"\r\n                          v-model=\"thirdTrIdData[index].value[index1].value\"\r\n                          :font-size=\"0\"\r\n                          :disabled=\"\r\n                            report.status && report.status !== 'CREATED'\r\n                          \"\r\n                          :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId,})\"\r\n                          class=\"justify-content-center checkbox_field\"\r\n                          @change=\"(e) =>setValue(data.id,e,index1,index,i.columnId,i.typeCode)\"\r\n                      />\r\n                      <Checkbox\r\n                          v-else-if=\"i.typeCode === 'BOOLEAN'\"\r\n                          :font-size=\"0\"\r\n                          :disabled=\"\r\n                            report.status && report.status !== 'CREATED'\r\n                          \"\r\n                          :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId,})\"\r\n                          class=\"justify-content-center checkbox_field\"\r\n                          @change=\"(e) =>setValue(data.id,e,index1,index,i.columnId,i.typeCode)\"\r\n                      />\r\n                      <!-- FOR INTEGER -->\r\n                      <div v-else>\r\n                        <b-form-input\r\n                            @keydown=\"(evt) => keydownEvt(evt,data.id,evt.target.value,index1,index,i.columnId,i.typeCode) \"\r\n                            @keyup=\"(event) => calculateDocFormulas(data.id, event.target.value, index1, index, i.columnId, i.typeCode)\"\r\n                            :class=\"\r\n                              currentPosition.rowId &&\r\n                              currentPosition.columnId &&\r\n                              i.columnId == currentPosition.columnId &&\r\n                              data.id == currentPosition.rowId\r\n                                ? 'borderInput'\r\n                                : currentPosition.columnId &&\r\n                                  !currentPosition.rowId &&\r\n                                  i.columnId == currentPosition.columnId\r\n                                ? 'borderInput'\r\n                                : ''\r\n                            \"\r\n                            :data-column-id=\"i.columnId\"\r\n                            @focus=\"(e) => focusVal(data.id, e, index1, index, i.columnId, i.typeCode)\"\r\n                            :style=\"report.status && report.status !== 'CREATED' ? 'border: none !important' : ''\"\r\n                            :disabled=\"report.status && report.status !== 'CREATED'\"\r\n                            :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId,})\"\r\n                            @input=\"(e) => setValue(data.id, e, index1, index, i.columnId, i.typeCode)\"\r\n                            type=\"number\"\r\n                            class=\"text-center input_val p-0\"\r\n                        >\r\n                        </b-form-input>\r\n                      </div>\r\n                    </td>\r\n                    <td style=\"width: 30px\" v-show=\"tableInfo.hasDynamicRows &&  !tableInfo.isGenerated\">\r\n                      <div style=\"display: block; text-align: center\" class=\"mt-1\">\r\n                        <i v-if=\"selectedRows.length > 1\" @click=\"deleteRow(index1, data)\" style=\"color: red\"\r\n                           class=\"mdi mdi-trash-can delete grow \"></i>\r\n                        <i v-if=\"selectedRows.length-1 === index1\" @click=\"addNewRow\" style=\"color: #0059ff\"\r\n                           class=\"mdi mdi-plus-circle grow \"> </i>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                  </tbody>\r\n                  <tfoot>\r\n                  <tr class=\"mt-5\" v-show=\"showResult\"\r\n                  >\r\n                    <td v-for=\"(i, index) in thirdTrIdData\"\r\n                        :key=\"index + 'td'\"\r\n                        class=\"text-center p\"\r\n                    >\r\n                      <p v-if=\"index === 0\">Jami</p>\r\n                      <div v-else-if=\"i.typeCode === 'BIGDECIMAL'\">\r\n                        {{ getColumnData(i) }}\r\n                      </div>\r\n                      <div v-else>---</div>\r\n                    </td>\r\n                    <td></td>\r\n                  </tr>\r\n                  </tfoot>\r\n                </table>\r\n              </div>\r\n              <div v-show=\"tableInfo.hasDynamicRows &&  !tableInfo.isGenerated\">\r\n                <!-- <b-button variant=\"primary\" class=\"mr-1\" @click=\"showResult = !showResult \">\r\n                  {{ $t( 'submodules.reports.report_result_see' ) }}\r\n                </b-button> -->\r\n                <b-button closed variant=\"warning\" class=\"ml-1\" @click=\"closeReport\">\r\n                  {{ $t('submodules.reports.stop_forming_report') }}\r\n                </b-button>\r\n              </div>\r\n            </div>\r\n          </b-overlay>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<style lang=\"scss\">\r\n.borderInput {\r\n  border: 2px solid green !important;\r\n}\r\n\r\nth {\r\n  /* &#SELECT {\r\n    width: 20%;\r\n  } */\r\n  &[id*=\"SELECT\"] {\r\n    width: 150px;\r\n  }\r\n}\r\n\r\n.check {\r\n  margin-top: 5px;\r\n\r\n  .m-chckbox--container {\r\n    margin: 0px !important;\r\n    width: 22px !important;\r\n  }\r\n\r\n  label {\r\n    margin: 0;\r\n    display: none;\r\n  }\r\n}\r\n\r\n.vue-treeselect__list-item {\r\n  padding-left: 15px !important;\r\n}\r\n\r\n.vue-treeselect__list-item.vue-treeselect__indent-level-0 {\r\n  padding-left: 0px !important;\r\n}\r\n</style>\r\n<style lang=\"scss\">\r\n/* Chrome, Safari, Edge, Opera */\r\ninput::-webkit-outer-spin-button,\r\ninput::-webkit-inner-spin-button {\r\n  -webkit-appearance: none;\r\n  margin: 0;\r\n}\r\n\r\n/* Firefox */\r\ninput[type=\"number\"] {\r\n  -moz-appearance: textfield;\r\n}\r\n\r\n.rotate_text {\r\n  height: 100%;\r\n  word-break: normal;\r\n  writing-mode: vertical-rl;\r\n  -ms-writing-mode: vertical-lr;\r\n  -webkit-transform: rotate(-180deg);\r\n  -moz-transform: rotate(-180deg);\r\n  -o-transform: rotate(-180deg);\r\n  transform: rotate(-180deg);\r\n  padding-bottom: 20px !important;\r\n  padding-top: 20px !important;\r\n}\r\n\r\n.no_enter_value {\r\n  padding: 0px !important;\r\n  min-width: auto !important;\r\n}\r\n\r\n.grow {\r\n  font-size: 1.3em;\r\n  cursor: pointer;\r\n}\r\n\r\n.grow:hover,\r\n.grow:focus,\r\n.grow:active {\r\n  transition: all .2s ease-in-out;\r\n  -webkit-transform: scale(1.3);\r\n  transform: scale(1.3);\r\n}\r\n</style>\r\n"]}]}