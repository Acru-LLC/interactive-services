{"remainingRequest":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\src\\modules\\report\\organizitional\\components\\editReportDynamicModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\src\\modules\\report\\organizitional\\components\\editReportDynamicModal.vue","mtime":1675054786286},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\babel.config.js","mtime":1667352074157},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1667355378280},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1675061970665},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1667355378280},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1675061970715}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIkM6L0FDUlUgUFJPSkVDVC9GYWlyIFRlY2gvYWNydS1mcm9udGVuZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlci5qcyI7CmltcG9ydCBfb2JqZWN0U3ByZWFkIGZyb20gIkM6L0FDUlUgUFJPSkVDVC9GYWlyIFRlY2gvYWNydS1mcm9udGVuZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMi5qcyI7CmltcG9ydCBfc2xpY2VkVG9BcnJheSBmcm9tICJDOi9BQ1JVIFBST0pFQ1QvRmFpciBUZWNoL2FjcnUtZnJvbnRlbmQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3NsaWNlZFRvQXJyYXkuanMiOwppbXBvcnQgX3RvQ29uc3VtYWJsZUFycmF5IGZyb20gIkM6L0FDUlUgUFJPSkVDVC9GYWlyIFRlY2gvYWNydS1mcm9udGVuZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdG9Db25zdW1hYmxlQXJyYXkuanMiOwppbXBvcnQgX3JlZ2VuZXJhdG9yUnVudGltZSBmcm9tICJDOi9BQ1JVIFBST0pFQ1QvRmFpciBUZWNoL2FjcnUtZnJvbnRlbmQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3JlZ2VuZXJhdG9yUnVudGltZS5qcyI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJDOi9BQ1JVIFBST0pFQ1QvRmFpciBUZWNoL2FjcnUtZnJvbnRlbmQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IuanMiOwppbXBvcnQgX3R5cGVvZiBmcm9tICJDOi9BQ1JVIFBST0pFQ1QvRmFpciBUZWNoL2FjcnUtZnJvbnRlbmQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3R5cGVvZi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXguanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmpzb24uc3RyaW5naWZ5LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UuanMiOwppbXBvcnQgU2VydmljZSBmcm9tICJAL21vZHVsZXMvcmVwb3J0L3JlcG9ydFNlcnZpY2UiOwppbXBvcnQgY3J1ZEFuZExpc3RzU2VydmljZSBmcm9tICJAL3NoYXJlZC9zZXJ2aWNlcy9jcnVkX2FuZF9saXN0LnNlcnZpY2UiOwppbXBvcnQgQ2hlY2tib3ggZnJvbSAidnVlLW1hdGVyaWFsLWNoZWNrYm94IjsKdmFyIE9LRURfQVBJX1VSTCA9ICdyZWVzdHIvaW5mby1va2VkJzsKZXhwb3J0IGRlZmF1bHQgewogIHByb3BzOiB7CiAgICBpc0dlbmVyYXRlZDogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfQogIH0sCiAgY29tcG9uZW50czogewogICAgQ2hlY2tib3g6IENoZWNrYm94CiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbGFzdFJlcG9ydERhdGE6IFtdLAogICAgICBsYXN0UmVwb3J0RGF0YVJvd3M6IFtdLAogICAgICBsYXN0UmVwb3J0Rm9ybXVsYXM6IFtdLAogICAgICBkZWJvdW5jZTogbnVsbCwKICAgICAgLy8gT0tFRCBWQVJJQUJMRVMKICAgICAgb2tlZHM6IFtdLAogICAgICBoYXNOZXh0UGFnZU9rZWQ6IGZhbHNlLAogICAgICBpc0xvYWRpbmdPa2VkOiBmYWxzZSwKICAgICAgb2tlZFNlYXJjaFBheWxvYWQ6IHt9LAogICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tCiAgICAgIGYxSWRzOiBbXSwKICAgICAgZjJJZHM6IFtdLAogICAgICBmUm93SWQ6IG51bGwsCiAgICAgIHRhYmxlSWQ6IG51bGwsCiAgICAgIHRhYmxlSW5mbzoge30sCiAgICAgIHJlcG9ydElkOiBudWxsLAogICAgICAvLyBnZXROYW1lOiBnZXROYW1lLAogICAgICBzZWxlY3RlZENvbHVtbnM6IFtdLAogICAgICBzZWxlY3RlZFJvd3M6IFtdLAogICAgICBmaXJzdENvbHVtbnM6IFtdLAogICAgICBzZWNvbmRDb2x1bW5zOiBbXSwKICAgICAgdGhpcmRDb2x1bW5zOiBbXSwKICAgICAgdGhpcmRUcklkRGF0YTogW10sCiAgICAgIGN1cnJlbnRSb3dJZDogbnVsbCwKICAgICAgaW52YWxpZEVudHJpZXM6IDAsCiAgICAgIGN1cnJlbnRJdGVtRGF0YTogW10sCiAgICAgIHNob3dEYXRhOiBbXSwKICAgICAgbG9hZGVyOiBmYWxzZSwKICAgICAgc2hvd1Jlc3VsdDogZmFsc2UsCiAgICAgIHJlcG9ydDoge30sCiAgICAgIHRhYmxlOiB7fSwKICAgICAgZm9ybXVsYXM6IFtdLAogICAgICBjdXJyZW50UG9zaXRpb246IHsKICAgICAgICByb3dJbmRleDogbnVsbCwKICAgICAgICBjb2x1bW5JbmRleDogbnVsbCwKICAgICAgICByb3dJZDogbnVsbCwKICAgICAgICBjb2x1bW5JZDogbnVsbAogICAgICB9LAogICAgICBkb2NUYWJsZUZvcm11bGFzTGlzdDoge30sCiAgICAgIGRvY1RhYmxlRm9ybXVsYXNMaXN0ZW5Db2x1bW5JZDoge30sCiAgICAgIHRyQ29sdW1uSWRPbkRvY0NvbHVtbklkTWFwOiB7fQogICAgfTsKICB9LAogIHdhdGNoOiB7CiAgICB0aGlyZFRySWREYXRhOiBmdW5jdGlvbiB0aGlyZFRySWREYXRhKG5ld1RoaXJkVHJJZERhdGEpIHsKICAgICAgaWYgKF90eXBlb2YobmV3VGhpcmRUcklkRGF0YSkgPT09ICdvYmplY3QnICYmIG5ld1RoaXJkVHJJZERhdGEubGVuZ3RoID4gMCkgewogICAgICAgIHZhciBsZW5ndGggPSBuZXdUaGlyZFRySWREYXRhLmxlbmd0aDsKICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgbGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICB0aGlzLnRyQ29sdW1uSWRPbkRvY0NvbHVtbklkTWFwW25ld1RoaXJkVHJJZERhdGFbX2ldLmNvbHVtbklkXSA9IF9pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgZ2V0Q29sdW1uRGF0YTogZnVuY3Rpb24gZ2V0Q29sdW1uRGF0YShpKSB7CiAgICAgIHZhciBmb3VuZCA9IHRoaXMuc2hvd0RhdGEuZmluZChmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBlLmNvbHVtbklkID09IGkuY29sdW1uSWQ7CiAgICAgIH0pOwogICAgICBpZiAoZm91bmQpIHsKICAgICAgICByZXR1cm4gZm91bmQuY29sdW1uRGF0YTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0sCiAgICAvLyBEWU5BTUlDX1JFRkVSRU5DRVMgTUVUSE9EUwogICAgZ2V0UmFuZG9tSW50OiBmdW5jdGlvbiBnZXRSYW5kb21JbnQoKSB7CiAgICAgIHZhciBudW1iZXIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwMCk7CiAgICAgIHZhciBib29sID0gdHJ1ZTsKICAgICAgdGhpcy5zZWxlY3RlZFJvd3MuZmluZChmdW5jdGlvbiAoZWwpIHsKICAgICAgICBpZiAoZWwuaWQgPT0gbnVtYmVyKSB7CiAgICAgICAgICBib29sID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIGlmIChlbC5pZCA9PSBudW1iZXIpIHsKICAgICAgICAgIGJvb2wgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJvb2w7CiAgICAgIH0pOwogICAgICBpZiAoYm9vbCkgewogICAgICAgIHJldHVybiBudW1iZXI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5nZXRSYW5kb21JbnQoKTsKICAgICAgfQogICAgfSwKICAgIGFkZE5ld1JvdzogZnVuY3Rpb24gYWRkTmV3Um93KCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgIHJldHVybiBfdGhpcy5zZWxlY3RlZFJvd3MucHVzaCh7CiAgICAgICAgICAgICAgICBpZDogX3RoaXMuZ2V0UmFuZG9tSW50KCkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0OwogICAgICAgICAgICAgIHJldHVybiBfdGhpcy5zZXREb2N1bWVudENvbHVtblZhbHVlcyhfdGhpcy5sYXN0UmVwb3J0RGF0YSwgX3RoaXMubGFzdFJlcG9ydEZvcm11bGFzKTsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIGNsb3NlUmVwb3J0OiBmdW5jdGlvbiBjbG9zZVJlcG9ydCgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfdGhpczIuJGVtaXQoImNsb3NlZFJlcG9ydExvYWRlciIpOwogICAgICAgICAgICAgIF90aGlzMi5jbmYoKS50aGVuKCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKHJzKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAocnMudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczIuJGVtaXQoJ3NhdmUnLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlMik7CiAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKF94KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0oKSk7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMyk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIHN0b3BGb3JtaW5nUm93czogZnVuY3Rpb24gc3RvcEZvcm1pbmdSb3dzKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKICAgICAgU2VydmljZS5zdG9wRm9ybWluZ1RoZVJlcG9ydCh0aGlzLnJlcG9ydElkKS50aGVuKCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfcmVmMiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQocnMpIHsKICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfdGhpczMuJHNldChfdGhpczMudGFibGVJbmZvLCAnaGFzRHluYW1pY1Jvd3MnLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAvLyBhd2FpdCB0aGlzLmRlbGV0ZVN1Y2Nlc3MoKTsKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlNCk7CiAgICAgICAgfSkpOwogICAgICAgIHJldHVybiBmdW5jdGlvbiAoX3gyKSB7CiAgICAgICAgICByZXR1cm4gX3JlZjIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9OwogICAgICB9KCkpLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAvLyB0aGlzLmNhdGNoRXJyKGVycik7CiAgICAgIH0pOwogICAgfSwKICAgIGRlbGV0ZVJvdzogZnVuY3Rpb24gZGVsZXRlUm93KGluZGV4LCBkYXRhKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlOSgpIHsKICAgICAgICB2YXIgZmluZEVsZW1lbnQ7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU5JChfY29udGV4dDkpIHsKICAgICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGZpbmRFbGVtZW50ID0gX3RoaXM0Lmxhc3RSZXBvcnREYXRhUm93cy5maW5kSW5kZXgoZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZWwuaWQgPT0gZGF0YS5pZDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBpZiAoZmluZEVsZW1lbnQgPiAtMSkgewogICAgICAgICAgICAgICAgX3RoaXM0LmNuZigpLnRoZW4oIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBfcmVmMyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTcocnMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0NykgewogICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ3LnByZXYgPSBfY29udGV4dDcubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFycy52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU2VydmljZS5kZWxldGVSb3dJZChkYXRhLmlkLCBfdGhpczQucmVwb3J0SWQpLnRoZW4oIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3JlZjQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KHJzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ1KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhd2FpdCB0aGlzLmRlbGV0ZVN1Y2Nlc3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM0LnNlbGVjdGVkUm93cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczQuJGZvcmNlVXBkYXRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzNC5yZXNldEluZGV4KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzNC5zZXREb2N1bWVudENvbHVtblZhbHVlcyhfdGhpczQubGFzdFJlcG9ydERhdGEuZmlsdGVyKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUucm93SWQgIT0gZGF0YS5pZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIF90aGlzNC5sYXN0UmVwb3J0Rm9ybXVsYXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlNSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKF94NCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZjQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSgpKS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmNhdGNoRXJyKGVycik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmluYWxseSggLyojX19QVVJFX18qL19hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTYkKF9jb250ZXh0NikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzNC5nZXRCeUlkKF90aGlzNC50YWJsZUlkLCBfdGhpczQucmVwb3J0SWQsIF90aGlzNC50YWJsZUluZm8pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWU2KTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkpOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgX2NhbGxlZTcpOwogICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoX3gzKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWYzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9KCkpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfdGhpczQuY25mKCkudGhlbiggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgdmFyIF9yZWY2ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlOChycykgewogICAgICAgICAgICAgICAgICAgIHZhciBuZXdUaGlyZFRySWREYXRhOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlOCQoX2NvbnRleHQ4KSB7CiAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDgucHJldiA9IF9jb250ZXh0OC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJzLnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1RoaXJkVHJJZERhdGEgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczQudGhpcmRUcklkRGF0YSA9IF90aGlzNC50aGlyZFRySWREYXRhLm1hcChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZS52YWx1ZSA9IGUudmFsdWUuZmlsdGVyKGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkICYmIGQucm93SWQgIT0gZGF0YS5pZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkLnR5cGVDb2RlID09PSAiQk9PTEVBTiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQudmFsdWVCb29sZWFuID0gZC52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQudmFsdWVTdHJpbmcgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC52YWx1ZUJpZ0RlY2ltYWwgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC52YWx1ZURhdGUgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5zZWxlY3RWYWx1ZU5hbWVVeiA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkLnR5cGVDb2RlID09PSAiU1RSSU5HIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC52YWx1ZVN0cmluZyA9IGQudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnZhbHVlQmlnRGVjaW1hbCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnZhbHVlRGF0ZSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnZhbHVlQm9vbGVhbiA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnNlbGVjdFZhbHVlTmFtZVV6ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGQudHlwZUNvZGUgPT09ICJCSUdERUNJTUFMIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC52YWx1ZUJpZ0RlY2ltYWwgPSBkLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC52YWx1ZVN0cmluZyA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnZhbHVlRGF0ZSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnZhbHVlQm9vbGVhbiA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnNlbGVjdFZhbHVlTmFtZVV6ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGQudHlwZUNvZGUgPT09ICJEQVRFIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC52YWx1ZURhdGUgPSBkLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC52YWx1ZVN0cmluZyA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnZhbHVlQmlnRGVjaW1hbCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnZhbHVlQm9vbGVhbiA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnNlbGVjdFZhbHVlTmFtZVV6ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGQudHlwZUNvZGUgPT09ICJZRUFSIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC52YWx1ZURhdGUgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC52YWx1ZVN0cmluZyA9IGQudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnZhbHVlQmlnRGVjaW1hbCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnZhbHVlQm9vbGVhbiA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnNlbGVjdFZhbHVlTmFtZVV6ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGQudHlwZUNvZGUgPT09ICJTRUxFQ1QiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnZhbHVlU3RyaW5nID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQudmFsdWVCaWdEZWNpbWFsID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQudmFsdWVEYXRlID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQudmFsdWVCb29sZWFuID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3VGhpcmRUcklkRGF0YS5wdXNoKGQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNC5zZWxlY3RlZFJvd3Muc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzNC4kZm9yY2VVcGRhdGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gODsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXM0LnJlc2V0SW5kZXgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1RoaXJkVHJJZERhdGEuZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzNC5sYXN0UmVwb3J0RGF0YS5wdXNoKGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzNC5zZXREb2N1bWVudENvbHVtblZhbHVlcyhfdGhpczQubGFzdFJlcG9ydERhdGEsIF90aGlzNC5sYXN0UmVwb3J0Rm9ybXVsYXMpOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWU4KTsKICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKF94NSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmNi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSgpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOSk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIGR5bmFtaWNSZWZzUmVhY2hlZEVuZE9mTGlzdDogZnVuY3Rpb24gZHluYW1pY1JlZnNSZWFjaGVkRW5kT2ZMaXN0KGUpIHsKICAgICAgaWYgKGUpIHsKICAgICAgICB0aGlzLmZldGNoRHluYW1pY1JlZnMoKTsKICAgICAgfQogICAgfSwKICAgIGRlYm91bmNlU2VhcmNoRHluYW1pY1JlZnM6IGZ1bmN0aW9uIGRlYm91bmNlU2VhcmNoRHluYW1pY1JlZnMoc2VhcmNoVGV4dCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTExKCkgewogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTEkKF9jb250ZXh0MTEpIHsKICAgICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MTEucHJldiA9IF9jb250ZXh0MTEubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KF90aGlzNS5kZWJvdW5jZSk7CiAgICAgICAgICAgICAgX3RoaXM1LmRlYm91bmNlID0gc2V0VGltZW91dCggLyojX19QVVJFX18qL19hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEwKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMCQoX2NvbnRleHQxMCkgewogICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDEwLnByZXYgPSBfY29udGV4dDEwLm5leHQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzNS5mZXRjaER5bmFtaWNSZWZzV2l0aEtleXdvcmQoc2VhcmNoVGV4dCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIF9jYWxsZWUxMCk7CiAgICAgICAgICAgICAgfSkpLCAxMDAwKTsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTEpOwogICAgICB9KSkoKTsKICAgIH0sCiAgICBmZXRjaER5bmFtaWNSZWZzV2l0aEtleXdvcmQ6IGZ1bmN0aW9uIGZldGNoRHluYW1pY1JlZnNXaXRoS2V5d29yZChrZXl3b3JkKSB7CiAgICAgIHRoaXMub2tlZHMgPSBbXTsKICAgICAgdGhpcy5va2VkU2VhcmNoUGF5bG9hZC5wYWdlID0gMTsKICAgICAgdGhpcy5va2VkU2VhcmNoUGF5bG9hZC5rZXl3b3JkID0ga2V5d29yZCA/IGtleXdvcmQgOiAnJzsKICAgICAgdGhpcy5mZXRjaER5bmFtaWNSZWZzKCk7CiAgICB9LAogICAgZmV0Y2hEeW5hbWljUmVmczogZnVuY3Rpb24gZmV0Y2hEeW5hbWljUmVmcygpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMigpIHsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEyJChfY29udGV4dDEyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDEyLnByZXYgPSBfY29udGV4dDEyLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF90aGlzNi5pc0xvYWRpbmdPa2VkID0gdHJ1ZTsKICAgICAgICAgICAgICBfY29udGV4dDEyLm5leHQgPSAzOwogICAgICAgICAgICAgIHJldHVybiBjcnVkQW5kTGlzdHNTZXJ2aWNlLnNlYXJjaExpc3RXaXRoS2V5d29yZChPS0VEX0FQSV9VUkwsIF90aGlzNi5va2VkU2VhcmNoUGF5bG9hZCkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgICB2YXIgX3RoaXM2JG9rZWRzOwogICAgICAgICAgICAgICAgKF90aGlzNiRva2VkcyA9IF90aGlzNi5va2VkcykucHVzaC5hcHBseShfdGhpczYkb2tlZHMsIF90b0NvbnN1bWFibGVBcnJheShyZXMuZGF0YS5saXN0KSk7CiAgICAgICAgICAgICAgICBfdGhpczYuaGFzTmV4dFBhZ2VPa2VkID0gcmVzLmRhdGEudG90YWwgLyBfdGhpczYub2tlZFNlYXJjaFBheWxvYWQuaXRlbXNQZXJQYWdlID4gX3RoaXM2Lm9rZWRTZWFyY2hQYXlsb2FkLnBhZ2U7CiAgICAgICAgICAgICAgICBfdGhpczYub2tlZFNlYXJjaFBheWxvYWQucGFnZSArPSAxOwogICAgICAgICAgICAgICAgaWYgKCFfdGhpczYuaXNNb2RlQ3JlYXRlICYmIF90aGlzNi5lZGl0aW5nSXRlbS5va2VkSWQpIHsKICAgICAgICAgICAgICAgICAgdmFyIGZvdW5kSXRtID0gX3RoaXM2Lm9rZWRzLmZpbmQoZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsLmlkID09IF90aGlzNi5lZGl0aW5nSXRlbS5va2VkSWQ7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBpZiAoIWZvdW5kSXRtICYmIF90aGlzNi5lZGl0aW5nSXRlbS5pbmZvT2tlZER0bykgewogICAgICAgICAgICAgICAgICAgIF90aGlzNi5va2Vkcy5wdXNoKF90aGlzNi5lZGl0aW5nSXRlbS5pbmZvT2tlZER0byk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgICAgICBfdGhpczYub2tlZHMgPSBbXTsKICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIF90aGlzNi5pc0xvYWRpbmdPa2VkID0gZmFsc2U7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMi5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEyKTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgY3VzdG9tTGFiZWxEeW5hbWljUmVmOiBmdW5jdGlvbiBjdXN0b21MYWJlbER5bmFtaWNSZWYob3B0KSB7CiAgICAgIHZhciBzZWxlY3RlZCA9IHRoaXMub2tlZHMuZmluZChmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBlLmlkID09IG9wdC5pZDsKICAgICAgfSk7CiAgICAgIGlmIChzZWxlY3RlZCkgewogICAgICAgIHJldHVybiAiIi5jb25jYXQoc2VsZWN0ZWQuY29kZSwgIiAtICIpLmNvbmNhdChzZWxlY3RlZC5uYW1lVXogPyB0aGlzLmdldE5hbWUoewogICAgICAgICAgbmFtZVJ1OiBzZWxlY3RlZC5uYW1lUnUsCiAgICAgICAgICBuYW1lTHQ6IHNlbGVjdGVkLm5hbWVMdCwKICAgICAgICAgIG5hbWVVejogc2VsZWN0ZWQubmFtZVV6CiAgICAgICAgfSkgOiBzZWxlY3RlZC5uYW1lKTsKICAgICAgfQogICAgICByZXR1cm4gIiI7CiAgICB9LAogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGNsZWFyQWxsOiBmdW5jdGlvbiBjbGVhckFsbCgpIHsKICAgICAgdGhpcy5zZWxlY3RlZENvbHVtbnMgPSBbXTsKICAgICAgdGhpcy5zZWxlY3RlZFJvd3MgPSBbXTsKICAgICAgdGhpcy5maXJzdENvbHVtbnMgPSBbXTsKICAgICAgdGhpcy5zZWNvbmRDb2x1bW5zID0gW107CiAgICAgIHRoaXMudGhpcmRDb2x1bW5zID0gW107CiAgICAgIHRoaXMudGhpcmRUcklkRGF0YSA9IFtdOwogICAgICB0aGlzLmZvcm11bGFzID0gW107CiAgICAgIHRoaXMudGFibGUgPSBbXTsKICAgICAgdGhpcy5mMUlkcyA9IFtdOwogICAgICB0aGlzLmYySWRzID0gW107CiAgICB9LAogICAga2V5ZG93bkV2dDogZnVuY3Rpb24ga2V5ZG93bkV2dChldnQsIHJvd0lkLCB2YWx1ZSwgcm93SW5kZXgsIGNvbHVtbkluZGV4LCBjb2x1bW5JZCwgdHlwZUNvZGUpIHsKICAgICAgdGhpcy5rZXlVcEV2ZW50c0Rpc2FibGUoZXZ0KTsKICAgICAgaWYgKGNvbHVtbklkICE9IG51bGwpIHsKICAgICAgICBpZiAoZXZ0LmtleUNvZGUgPT0gNDAgJiYgcm93SWQgIT0gbnVsbCkgewogICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAvLyBkb3duCiAgICAgICAgICBpZiAocm93SW5kZXggPCB0aGlzLnNlbGVjdGVkUm93cy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50Q29sdW1uID0gdGhpcy50aGlyZFRySWREYXRhW2NvbHVtbkluZGV4XTsKICAgICAgICAgICAgdmFyIGRvd25Sb3dDb2x1bW4gPSB0aGlzLnNlbGVjdGVkUm93c1tyb3dJbmRleCArIDFdOwogICAgICAgICAgICB2YXIgZG93bklucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgIHJvd0lkOiBkb3duUm93Q29sdW1uLmlkLAogICAgICAgICAgICAgIGNvbHVtbklkOiBjdXJyZW50Q29sdW1uLmNvbHVtbklkCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgaWYgKGRvd25JbnB1dCkgewogICAgICAgICAgICAgIGRvd25JbnB1dC5mb2N1cygpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChldnQua2V5Q29kZSA9PSAzOCAmJiByb3dJZCAhPSBudWxsKSB7CiAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIGlmIChyb3dJbmRleCAhPSAwKSB7CiAgICAgICAgICAgIHZhciBfY3VycmVudENvbHVtbiA9IHRoaXMudGhpcmRUcklkRGF0YVtjb2x1bW5JbmRleF07CiAgICAgICAgICAgIHZhciB1cFJvd0NvbHVtbiA9IHRoaXMuc2VsZWN0ZWRSb3dzW3Jvd0luZGV4IC0gMV07CiAgICAgICAgICAgIHZhciB1cElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgIHJvd0lkOiB1cFJvd0NvbHVtbi5pZCwKICAgICAgICAgICAgICBjb2x1bW5JZDogX2N1cnJlbnRDb2x1bW4uY29sdW1uSWQKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBpZiAodXBJbnB1dCkgewogICAgICAgICAgICAgIHVwSW5wdXQuZm9jdXMoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLy91cAogICAgICAgIH0gZWxzZSBpZiAoZXZ0LmtleUNvZGUgPT0gMzcpIHsKICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgLy9sZWZ0CiAgICAgICAgICBpZiAoY29sdW1uSW5kZXggIT0gMCkgewogICAgICAgICAgICB2YXIgcHJldkNvbHVtbiA9IHRoaXMudGhpcmRUcklkRGF0YVtjb2x1bW5JbmRleCAtIDFdOwogICAgICAgICAgICB2YXIgY3VycmVudFJvdyA9IHRoaXMuc2VsZWN0ZWRSb3dzW3Jvd0luZGV4XTsKICAgICAgICAgICAgdmFyIHByZXZJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICByb3dJZDogY3VycmVudFJvdy5pZCwKICAgICAgICAgICAgICBjb2x1bW5JZDogcHJldkNvbHVtbi5jb2x1bW5JZAogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIGlmIChwcmV2SW5wdXQpIHsKICAgICAgICAgICAgICBpZiAocHJldklucHV0LmRpc2FibGVkKSB7CiAgICAgICAgICAgICAgICB2YXIgY291bnQgPSB0aGlzLnRoaXJkVHJJZERhdGEubGVuZ3RoIC0gKGNvbHVtbkluZGV4IC0gMSk7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBfaTIgPSAwOyBfaTIgPCBjb3VudDsgX2kyKyspIHsKICAgICAgICAgICAgICAgICAgdmFyIHByZXZDb2x1bW4yID0gdGhpcy50aGlyZFRySWREYXRhW2NvbHVtbkluZGV4IC0gMSAtIF9pMl07CiAgICAgICAgICAgICAgICAgIGlmIChwcmV2Q29sdW1uMikgewogICAgICAgICAgICAgICAgICAgIHZhciBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICAgIHJvd0lkOiBjdXJyZW50Um93LmlkLAogICAgICAgICAgICAgICAgICAgICAgY29sdW1uSWQ6IHByZXZDb2x1bW4yLmNvbHVtbklkCiAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dCAmJiBpbnB1dC5kaXNhYmxlZCkgewogICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dCkgewogICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5mb2N1cygpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHByZXZJbnB1dC5mb2N1cygpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZXZ0LmtleUNvZGUgPT0gMzkpIHsKICAgICAgICAgIC8vcmlnaHQKICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgaWYgKHRoaXMudGhpcmRUcklkRGF0YS5sZW5ndGggLSAxID4gY29sdW1uSW5kZXgpIHsKICAgICAgICAgICAgdmFyIG5leHRDb2x1bW4gPSB0aGlzLnRoaXJkVHJJZERhdGFbY29sdW1uSW5kZXggKyAxXTsKICAgICAgICAgICAgdmFyIF9jdXJyZW50Um93ID0gdGhpcy5zZWxlY3RlZFJvd3Nbcm93SW5kZXhdOwogICAgICAgICAgICB2YXIgbmV4dElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgIHJvd0lkOiBfY3VycmVudFJvdy5pZCwKICAgICAgICAgICAgICBjb2x1bW5JZDogbmV4dENvbHVtbi5jb2x1bW5JZAogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIGlmIChuZXh0SW5wdXQpIHsKICAgICAgICAgICAgICBpZiAobmV4dElucHV0LmRpc2FibGVkKSB7CiAgICAgICAgICAgICAgICB2YXIgZm9yQ291bnQgPSB0aGlzLnRoaXJkVHJJZERhdGEubGVuZ3RoIC0gKGNvbHVtbkluZGV4ICsgMSk7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBfaTMgPSAwOyBfaTMgPCBmb3JDb3VudDsgX2kzKyspIHsKICAgICAgICAgICAgICAgICAgdmFyIG5leHRDb2x1bW4yID0gdGhpcy50aGlyZFRySWREYXRhW2NvbHVtbkluZGV4ICsgMSArIF9pM107CiAgICAgICAgICAgICAgICAgIHZhciBfaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgcm93SWQ6IF9jdXJyZW50Um93LmlkLAogICAgICAgICAgICAgICAgICAgIGNvbHVtbklkOiBuZXh0Q29sdW1uMi5jb2x1bW5JZAogICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgIGlmIChfaW5wdXQuZGlzYWJsZWQpIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoX2lucHV0KSB7CiAgICAgICAgICAgICAgICAgICAgICBfaW5wdXQuZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbmV4dElucHV0LmZvY3VzKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgcmVzZXRJbmRleDogZnVuY3Rpb24gcmVzZXRJbmRleCgpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMygpIHsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEzJChfY29udGV4dDEzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDEzLnByZXYgPSBfY29udGV4dDEzLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0MTMubmV4dCA9IDI7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzNy4kc2V0KF90aGlzNy5jdXJyZW50UG9zaXRpb24sICJyb3dJbmRleCIsIG51bGwpOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgX2NvbnRleHQxMy5uZXh0ID0gNDsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXM3LiRzZXQoX3RoaXM3LmN1cnJlbnRQb3NpdGlvbiwgImNvbHVtbkluZGV4IiwgbnVsbCk7CiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBfY29udGV4dDEzLm5leHQgPSA2OwogICAgICAgICAgICAgIHJldHVybiBfdGhpczcuJHNldChfdGhpczcuY3VycmVudFBvc2l0aW9uLCAicm93SWQiLCBudWxsKTsKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIF9jb250ZXh0MTMubmV4dCA9IDg7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzNy4kc2V0KF90aGlzNy5jdXJyZW50UG9zaXRpb24sICJjb2x1bW5JZCIsIG51bGwpOwogICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMyk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIHNldEVycm9yOiBmdW5jdGlvbiBzZXRFcnJvcihmMSwgZjIsIGZyb3dJZCkgewogICAgICB0aGlzLmYxSWRzID0gZjE7CiAgICAgIHRoaXMuZjJJZHMgPSBmMjsKICAgICAgdGhpcy5mUm93SWQgPSBmcm93SWQ7CiAgICB9LAogICAga2V5VXBFdmVudHNEaXNhYmxlOiBmdW5jdGlvbiBrZXlVcEV2ZW50c0Rpc2FibGUoZSkgewogICAgICBpZiAodGhpcy5jdXJyZW50UG9zaXRpb24uY29sdW1uSWQgIT0gbnVsbCkgewogICAgICAgIGlmIChlLndoaWNoID09PSAzOCB8fCBlLndoaWNoID09PSA0MCkgewogICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGtleVVwRXZlbnRzOiBmdW5jdGlvbiBrZXlVcEV2ZW50cyhldnQpIHsKICAgICAgdGhpcy5rZXlVcEV2ZW50c0Rpc2FibGUoZXZ0KTsKICAgICAgLy8gaWYgKHRoaXMuY3VycmVudFBvc2l0aW9uLmNvbHVtbklkICE9IG51bGwpIHsKICAgICAgLy8gICBpZiAoZXZ0LmtleUNvZGUgPT0gNDAgJiYgdGhpcy5jdXJyZW50UG9zaXRpb24ucm93SWQgIT0gbnVsbCkgewogICAgICAvLyAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIC8vICAgICAvLyBkb3duCiAgICAgIC8vICAgICBpZiAodGhpcy5jdXJyZW50UG9zaXRpb24ucm93SW5kZXggPCB0aGlzLnNlbGVjdGVkUm93cy5sZW5ndGggLSAxKSB7CiAgICAgIC8vICAgICAgIGxldCBjdXJyZW50Q29sdW1uID0KICAgICAgLy8gICAgICAgICB0aGlzLnRoaXJkVHJJZERhdGFbdGhpcy5jdXJyZW50UG9zaXRpb24uY29sdW1uSW5kZXhdOwogICAgICAvLyAgICAgICBsZXQgZG93blJvd0NvbHVtbiA9CiAgICAgIC8vICAgICAgICAgdGhpcy5zZWxlY3RlZFJvd3NbdGhpcy5jdXJyZW50UG9zaXRpb24ucm93SW5kZXggKyAxXTsKICAgICAgLy8gICAgICAgbGV0IGRvd25JbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKAogICAgICAvLyAgICAgICAgIEpTT04uc3RyaW5naWZ5KHsKICAgICAgLy8gICAgICAgICAgIHJvd0lkOiBkb3duUm93Q29sdW1uLmlkLAogICAgICAvLyAgICAgICAgICAgY29sdW1uSWQ6IGN1cnJlbnRDb2x1bW4uY29sdW1uSWQsCiAgICAgIC8vICAgICAgICAgfSkKICAgICAgLy8gICAgICAgKTsKICAgICAgLy8gICAgICAgaWYgKGRvd25JbnB1dCkgewogICAgICAvLyAgICAgICAgIGRvd25JbnB1dC5mb2N1cygpOwogICAgICAvLyAgICAgICB9CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgfSBlbHNlIGlmIChldnQua2V5Q29kZSA9PSAzOCAmJiB0aGlzLmN1cnJlbnRQb3NpdGlvbi5yb3dJZCAhPSBudWxsKSB7CiAgICAgIC8vICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgLy8gICAgIGlmICh0aGlzLmN1cnJlbnRQb3NpdGlvbi5yb3dJbmRleCAhPSAwKSB7CiAgICAgIC8vICAgICAgIGxldCBjdXJyZW50Q29sdW1uID0KICAgICAgLy8gICAgICAgICB0aGlzLnRoaXJkVHJJZERhdGFbdGhpcy5jdXJyZW50UG9zaXRpb24uY29sdW1uSW5kZXhdOwogICAgICAvLyAgICAgICBsZXQgdXBSb3dDb2x1bW4gPQogICAgICAvLyAgICAgICAgIHRoaXMuc2VsZWN0ZWRSb3dzW3RoaXMuY3VycmVudFBvc2l0aW9uLnJvd0luZGV4IC0gMV07CiAgICAgIC8vICAgICAgIGxldCB1cElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoCiAgICAgIC8vICAgICAgICAgSlNPTi5zdHJpbmdpZnkoewogICAgICAvLyAgICAgICAgICAgcm93SWQ6IHVwUm93Q29sdW1uLmlkLAogICAgICAvLyAgICAgICAgICAgY29sdW1uSWQ6IGN1cnJlbnRDb2x1bW4uY29sdW1uSWQsCiAgICAgIC8vICAgICAgICAgfSkKICAgICAgLy8gICAgICAgKTsKICAgICAgLy8gICAgICAgaWYgKHVwSW5wdXQpIHsKICAgICAgLy8gICAgICAgICB1cElucHV0LmZvY3VzKCk7CiAgICAgIC8vICAgICAgIH0KICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIC8vdXAKICAgICAgLy8gICB9IGVsc2UgaWYgKGV2dC5rZXlDb2RlID09IDM3KSB7CiAgICAgIC8vICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgLy8gICAgIC8vbGVmdAogICAgICAvLyAgICAgaWYgKHRoaXMuY3VycmVudFBvc2l0aW9uLmNvbHVtbkluZGV4ICE9IDApIHsKICAgICAgLy8gICAgICAgbGV0IHByZXZDb2x1bW4gPQogICAgICAvLyAgICAgICAgIHRoaXMudGhpcmRUcklkRGF0YVt0aGlzLmN1cnJlbnRQb3NpdGlvbi5jb2x1bW5JbmRleCAtIDFdOwogICAgICAvLyAgICAgICBsZXQgY3VycmVudFJvdyA9IHRoaXMuc2VsZWN0ZWRSb3dzW3RoaXMuY3VycmVudFBvc2l0aW9uLnJvd0luZGV4XTsKICAgICAgLy8gICAgICAgbGV0IHByZXZJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKAogICAgICAvLyAgICAgICAgIEpTT04uc3RyaW5naWZ5KHsKICAgICAgLy8gICAgICAgICAgIHJvd0lkOiBjdXJyZW50Um93LmlkLAogICAgICAvLyAgICAgICAgICAgY29sdW1uSWQ6IHByZXZDb2x1bW4uY29sdW1uSWQsCiAgICAgIC8vICAgICAgICAgfSkKICAgICAgLy8gICAgICAgKTsKICAgICAgLy8gICAgICAgaWYgKHByZXZJbnB1dCkgewogICAgICAvLyAgICAgICAgIGlmIChwcmV2SW5wdXQuZGlzYWJsZWQpIHsKICAgICAgLy8gICAgICAgICAgIGxldCBjb3VudCA9CiAgICAgIC8vICAgICAgICAgICAgIHRoaXMudGhpcmRUcklkRGF0YS5sZW5ndGggLQogICAgICAvLyAgICAgICAgICAgICAodGhpcy5jdXJyZW50UG9zaXRpb24uY29sdW1uSW5kZXggLSAxKTsKICAgICAgLy8gICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICAvLyAgICAgICAgICAgICBsZXQgcHJldkNvbHVtbjIgPQogICAgICAvLyAgICAgICAgICAgICAgIHRoaXMudGhpcmRUcklkRGF0YVsKICAgICAgLy8gICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFBvc2l0aW9uLmNvbHVtbkluZGV4IC0gMSAtIGkKICAgICAgLy8gICAgICAgICAgICAgICBdOwogICAgICAvLyAgICAgICAgICAgICBsZXQgaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgKICAgICAgLy8gICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7CiAgICAgIC8vICAgICAgICAgICAgICAgICByb3dJZDogY3VycmVudFJvdy5pZCwKICAgICAgLy8gICAgICAgICAgICAgICAgIGNvbHVtbklkOiBwcmV2Q29sdW1uMi5jb2x1bW5JZCwKICAgICAgLy8gICAgICAgICAgICAgICB9KQogICAgICAvLyAgICAgICAgICAgICApOwogICAgICAvLyAgICAgICAgICAgICBpZiAoaW5wdXQgJiYgaW5wdXQuZGlzYWJsZWQpIHsKICAgICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgLy8gICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgLy8gICAgICAgICAgICAgICBpZiAoaW5wdXQpIHsKICAgICAgLy8gICAgICAgICAgICAgICAgIGlucHV0LmZvY3VzKCk7CiAgICAgIC8vICAgICAgICAgICAgICAgfQogICAgICAvLyAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAvLyAgICAgICAgICAgICB9CiAgICAgIC8vICAgICAgICAgICB9CiAgICAgIC8vICAgICAgICAgfSBlbHNlIHsKICAgICAgLy8gICAgICAgICAgIHByZXZJbnB1dC5mb2N1cygpOwogICAgICAvLyAgICAgICAgIH0KICAgICAgLy8gICAgICAgfQogICAgICAvLyAgICAgfQogICAgICAvLyAgIH0gZWxzZSBpZiAoZXZ0LmtleUNvZGUgPT0gMzkpIHsKICAgICAgLy8gICAgIC8vcmlnaHQKICAgICAgLy8gICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAvLyAgICAgaWYgKAogICAgICAvLyAgICAgICB0aGlzLnRoaXJkVHJJZERhdGEubGVuZ3RoIC0gMSA+CiAgICAgIC8vICAgICAgIHRoaXMuY3VycmVudFBvc2l0aW9uLmNvbHVtbkluZGV4CiAgICAgIC8vICAgICApIHsKICAgICAgLy8gICAgICAgbGV0IG5leHRDb2x1bW4gPQogICAgICAvLyAgICAgICAgIHRoaXMudGhpcmRUcklkRGF0YVt0aGlzLmN1cnJlbnRQb3NpdGlvbi5jb2x1bW5JbmRleCArIDFdOwogICAgICAvLyAgICAgICBsZXQgY3VycmVudFJvdyA9IHRoaXMuc2VsZWN0ZWRSb3dzW3RoaXMuY3VycmVudFBvc2l0aW9uLnJvd0luZGV4XTsKICAgICAgLy8gICAgICAgbGV0IG5leHRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKAogICAgICAvLyAgICAgICAgIEpTT04uc3RyaW5naWZ5KHsKICAgICAgLy8gICAgICAgICAgIHJvd0lkOiBjdXJyZW50Um93LmlkLAogICAgICAvLyAgICAgICAgICAgY29sdW1uSWQ6IG5leHRDb2x1bW4uY29sdW1uSWQsCiAgICAgIC8vICAgICAgICAgfSkKICAgICAgLy8gICAgICAgKTsKICAgICAgLy8gICAgICAgaWYgKG5leHRJbnB1dCkgewogICAgICAvLyAgICAgICAgIGlmIChuZXh0SW5wdXQuZGlzYWJsZWQpIHsKICAgICAgLy8gICAgICAgICAgIGxldCBmb3JDb3VudCA9CiAgICAgIC8vICAgICAgICAgICAgIHRoaXMudGhpcmRUcklkRGF0YS5sZW5ndGggLQogICAgICAvLyAgICAgICAgICAgICAodGhpcy5jdXJyZW50UG9zaXRpb24uY29sdW1uSW5kZXggKyAxKTsKICAgICAgLy8gICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZm9yQ291bnQ7IGkrKykgewogICAgICAvLyAgICAgICAgICAgICBsZXQgbmV4dENvbHVtbjIgPQogICAgICAvLyAgICAgICAgICAgICAgIHRoaXMudGhpcmRUcklkRGF0YVsKICAgICAgLy8gICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFBvc2l0aW9uLmNvbHVtbkluZGV4ICsgMSArIGkKICAgICAgLy8gICAgICAgICAgICAgICBdOwoKICAgICAgLy8gICAgICAgICAgICAgbGV0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoCiAgICAgIC8vICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkoewogICAgICAvLyAgICAgICAgICAgICAgICAgcm93SWQ6IGN1cnJlbnRSb3cuaWQsCiAgICAgIC8vICAgICAgICAgICAgICAgICBjb2x1bW5JZDogbmV4dENvbHVtbjIuY29sdW1uSWQsCiAgICAgIC8vICAgICAgICAgICAgICAgfSkKICAgICAgLy8gICAgICAgICAgICAgKTsKICAgICAgLy8gICAgICAgICAgICAgaWYgKGlucHV0LmRpc2FibGVkKSB7CiAgICAgIC8vICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgIC8vICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgIC8vICAgICAgICAgICAgICAgaWYgKGlucHV0KSB7CiAgICAgIC8vICAgICAgICAgICAgICAgICBpbnB1dC5mb2N1cygpOwogICAgICAvLyAgICAgICAgICAgICAgIH0KICAgICAgLy8gICAgICAgICAgICAgICBicmVhazsKICAgICAgLy8gICAgICAgICAgICAgfQogICAgICAvLyAgICAgICAgICAgfQogICAgICAvLyAgICAgICAgIH0gZWxzZSB7CiAgICAgIC8vICAgICAgICAgICBuZXh0SW5wdXQuZm9jdXMoKTsKICAgICAgLy8gICAgICAgICB9CiAgICAgIC8vICAgICAgIH0KICAgICAgLy8gICAgIH0KICAgICAgLy8gICB9CiAgICAgIC8vIH0KICAgIH0sCiAgICBmb2N1c1ZhbDogZnVuY3Rpb24gZm9jdXNWYWwocm93SWQsIHZhbHVlLCByb3dJbmRleCwgY29sdW1uSW5kZXgsIGNvbHVtbklkLCB0eXBlQ29kZSkgewogICAgICB0aGlzLiRzZXQodGhpcy5jdXJyZW50UG9zaXRpb24sICJyb3dJbmRleCIsIHBhcnNlRmxvYXQocm93SW5kZXgpKTsKICAgICAgdGhpcy4kc2V0KHRoaXMuY3VycmVudFBvc2l0aW9uLCAiY29sdW1uSW5kZXgiLCBwYXJzZUZsb2F0KGNvbHVtbkluZGV4KSk7CiAgICAgIHRoaXMuJHNldCh0aGlzLmN1cnJlbnRQb3NpdGlvbiwgInJvd0lkIiwgcGFyc2VGbG9hdChyb3dJZCkpOwogICAgICB0aGlzLiRzZXQodGhpcy5jdXJyZW50UG9zaXRpb24sICJjb2x1bW5JZCIsIHBhcnNlRmxvYXQoY29sdW1uSWQpKTsKICAgIH0sCiAgICBnZXRGb3JtdWxhc18yOiBmdW5jdGlvbiBnZXRGb3JtdWxhc18yKCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXMsIHJlaikgewogICAgICAgIGlmIChfdGhpczgudGFibGVJZCkgewogICAgICAgICAgU2VydmljZS5mb3JtdWxhc0J5VGFibGVJZF8yKF90aGlzOC50YWJsZUlkKS50aGVuKGZ1bmN0aW9uIChfcmVmOCkgewogICAgICAgICAgICB2YXIgZGF0YSA9IF9yZWY4LmRhdGE7CiAgICAgICAgICAgIF90aGlzOC5mb3JtdWxhcyA9IGRhdGE7CiAgICAgICAgICAgIHJlcyhkYXRhKTsKICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHJldHVybiByZWooZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVqKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBnZXREYXRhQnlJZDogZnVuY3Rpb24gZ2V0RGF0YUJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXMsIHJlaikgewogICAgICAgIFNlcnZpY2UuZ2V0UmVwb3J0QnlJZChpZCkudGhlbihmdW5jdGlvbiAoX3JlZjkpIHsKICAgICAgICAgIHZhciBkYXRhID0gX3JlZjkuZGF0YTsKICAgICAgICAgIHJlcyhkYXRhKTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgcmV0dXJuIHJlaihlKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgZWRpdFZhbHVlOiBmdW5jdGlvbiBlZGl0VmFsdWUocm93SW5kZXgsIGluZGV4KSB7CiAgICAgIHRoaXMuJHNldCh0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XSwgJ25vdEVkaXRhYmxlJywgZmFsc2UpOwogICAgICB0aGlzLiRmb3JjZVVwZGF0ZSgpOwogICAgfSwKICAgIHJlc2V0VmFsdWU6IGZ1bmN0aW9uIHJlc2V0VmFsdWUocm93SW5kZXgsIGluZGV4KSB7CiAgICAgIHRoaXMuJHNldCh0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XSwgJ3NlbGVjdFZhbHVlSWQnLCB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XS5vcmlnaW5hbFNlbGVjdFZhbHVlSWQpOwogICAgICB0aGlzLiRzZXQodGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtyb3dJbmRleF0sICdzZWxlY3RWYWx1ZU5hbWVVeicsIHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdLm9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lVXopOwogICAgICB0aGlzLiRzZXQodGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtyb3dJbmRleF0sICdzZWxlY3RWYWx1ZU5hbWVMdCcsIHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdLm9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lTHQpOwogICAgICB0aGlzLiRzZXQodGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtyb3dJbmRleF0sICdzZWxlY3RWYWx1ZU5hbWVSdScsIHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdLm9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lUnUpOwogICAgICB0aGlzLiRzZXQodGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtyb3dJbmRleF0sICdub3RFZGl0YWJsZScsIHRydWUpOwogICAgICB0aGlzLiRmb3JjZVVwZGF0ZSgpOwogICAgfSwKICAgIHNldFZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZShyb3dJZCwgdmFsdWUsIHJvd0luZGV4LCBpbmRleCwgaWQsIHR5cGVDb2RlKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwogICAgICB2YXIgbm90RWRpdGFibGUgPSBhcmd1bWVudHMubGVuZ3RoID4gNiAmJiBhcmd1bWVudHNbNl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1s2XSA6IGZhbHNlOwogICAgICB2YXIgaW5pdGlhbExvYWRDYWxsID0gYXJndW1lbnRzLmxlbmd0aCA+IDcgJiYgYXJndW1lbnRzWzddICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbN10gOiBmYWxzZTsKICAgICAgLy8gdmFsdWUucm93SWQgPSByb3dJZAogICAgICAvLyB2YWx1ZS50eXBlQ29kZSA9IHR5cGVDb2RlCiAgICAgIC8vCiAgICAgIC8vIHZhbHVlLm5vdEVkaXRhYmxlID0gbm90RWRpdGFibGUKICAgICAgLy8gdmFsdWUuc2VsZWN0VmFsdWVOYW1lTHQgPSB2YWx1ZS5uYW1lTHQKICAgICAgLy8gdmFsdWUuc2VsZWN0VmFsdWVOYW1lUnUgPSB2YWx1ZS5uYW1lUnUKICAgICAgLy8gdmFsdWUuc2VsZWN0VmFsdWVOYW1lVXogPSB2YWx1ZS5uYW1lVXoKICAgICAgLy8KICAgICAgLyogdGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtyb3dJbmRleF0gPSB7DQogICAgICAgIHJvd0lkOiByb3dJZCA/IHJvd0lkIDogbnVsbCwNCiAgICAgICAgdmFsdWU6IHR5cGVDb2RlID09PSAnU0VMRUNUJyA/ICcnIDogdmFsdWUsDQogICAgICAgIHNlbGVjdFZhbHVlTmFtZVV6OiB2YWx1ZSA/IHZhbHVlLm5hbWVVeiA6IG51bGwsDQogICAgICAgIHNlbGVjdFZhbHVlTmFtZUx0OiB2YWx1ZSA/IHZhbHVlLm5hbWVMdCA6IG51bGwsDQogICAgICAgIHNlbGVjdFZhbHVlTmFtZVJ1OiB2YWx1ZSA/IHZhbHVlLm5hbWVSdSA6IG51bGwsDQogICAgICAgIG9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lVXo6IHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdID8gdGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtyb3dJbmRleF0ub3JpZ2luYWxTZWxlY3RWYWx1ZU5hbWVVeiA6ICcnLA0KICAgICAgICBvcmlnaW5hbFNlbGVjdFZhbHVlTmFtZUx0OiB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XSA/IHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdLm9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lTHQgOiAnJywNCiAgICAgICAgb3JpZ2luYWxTZWxlY3RWYWx1ZU5hbWVSdTogdGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtyb3dJbmRleF0gPyB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XS5vcmlnaW5hbFNlbGVjdFZhbHVlTmFtZVJ1IDogJycsDQogICAgICAgIHR5cGVDb2RlOiB0eXBlQ29kZSwNCiAgICAgICAgY29sdW1uSWQ6IGlkLA0KICAgICAgICBub3RFZGl0YWJsZTogbm90RWRpdGFibGUNCiAgICAgIH07ICovCiAgICAgIGlmIChpbml0aWFsTG9hZENhbGwgJiYgdHlwZUNvZGUgPT09ICdTRUxFQ1QnKSB7CiAgICAgICAgdmFyIF9yb3dJbmRleCA9IHRoaXMuc2VsZWN0ZWRSb3dzLmZpbmRJbmRleChmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgIHJldHVybiBlbC5pZCA9PSByb3dJZDsKICAgICAgICB9KTsKICAgICAgICBpZiAoIXRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbX3Jvd0luZGV4XS5yb3dJZCkgewogICAgICAgICAgdGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtfcm93SW5kZXhdID0gewogICAgICAgICAgICByb3dJZDogcm93SWQsCiAgICAgICAgICAgIHZhbHVlOiB0eXBlQ29kZSA9PT0gJ1NFTEVDVCcgPyAnJyA6IHZhbHVlLAogICAgICAgICAgICBzZWxlY3RWYWx1ZUlkOiB2YWx1ZSA/IHZhbHVlLmlkIDogbnVsbCwKICAgICAgICAgICAgc2VsZWN0VmFsdWVOYW1lVXo6IHZhbHVlID8gdmFsdWUubmFtZVV6ID8gdmFsdWUubmFtZVV6IDogdmFsdWUubmFtZSA6IG51bGwsCiAgICAgICAgICAgIHNlbGVjdFZhbHVlTmFtZUx0OiB2YWx1ZSA/IHZhbHVlLm5hbWVMdCA6IG51bGwsCiAgICAgICAgICAgIHNlbGVjdFZhbHVlTmFtZVJ1OiB2YWx1ZSA/IHZhbHVlLm5hbWVSdSA6IG51bGwsCiAgICAgICAgICAgIG9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lVXo6IHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbX3Jvd0luZGV4XSA/IHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbX3Jvd0luZGV4XS5vcmlnaW5hbFNlbGVjdFZhbHVlTmFtZVV6IDogJycsCiAgICAgICAgICAgIG9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lTHQ6IHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbX3Jvd0luZGV4XSA/IHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbX3Jvd0luZGV4XS5vcmlnaW5hbFNlbGVjdFZhbHVlTmFtZUx0IDogJycsCiAgICAgICAgICAgIG9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lUnU6IHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbX3Jvd0luZGV4XSA/IHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbX3Jvd0luZGV4XS5vcmlnaW5hbFNlbGVjdFZhbHVlTmFtZVJ1IDogJycsCiAgICAgICAgICAgIHR5cGVDb2RlOiB0eXBlQ29kZSwKICAgICAgICAgICAgY29sdW1uSWQ6IGlkLAogICAgICAgICAgICBub3RFZGl0YWJsZTogbm90RWRpdGFibGUKICAgICAgICAgIH07CiAgICAgICAgICB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW19yb3dJbmRleF0ub3JpZ2luYWxzZWxlY3RWYWx1ZUlkID0gdmFsdWUuaWQ7CiAgICAgICAgICB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW19yb3dJbmRleF0ub3JpZ2luYWxTZWxlY3RWYWx1ZU5hbWVVeiA9IHZhbHVlLm5hbWVVejsKICAgICAgICAgIHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbX3Jvd0luZGV4XS5vcmlnaW5hbFNlbGVjdFZhbHVlTmFtZUx0ID0gdmFsdWUubmFtZUx0OwogICAgICAgICAgdGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtfcm93SW5kZXhdLm9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lUnUgPSB2YWx1ZS5uYW1lUnU7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0eXBlQ29kZSA9PT0gJ1NFTEVDVCcpIHsKICAgICAgICAgIHZhbHVlLnJvd0lkID0gcm93SWQ7CiAgICAgICAgICB2YWx1ZS5jb2x1bW5JZCA9IGlkOwogICAgICAgICAgdmFsdWUudHlwZUNvZGUgPSB0eXBlQ29kZTsKICAgICAgICAgIHZhbHVlLm5vdEVkaXRhYmxlID0gbm90RWRpdGFibGU7CiAgICAgICAgICB2YWx1ZS5zZWxlY3RWYWx1ZUlkID0gdmFsdWUuaWQ7CiAgICAgICAgICB2YWx1ZS5zZWxlY3RWYWx1ZU5hbWVMdCA9IHZhbHVlLm5hbWVMdDsKICAgICAgICAgIHZhbHVlLnNlbGVjdFZhbHVlTmFtZVJ1ID0gdmFsdWUubmFtZVJ1OwogICAgICAgICAgdmFsdWUuc2VsZWN0VmFsdWVOYW1lVXogPSB2YWx1ZS5uYW1lVXogPyB2YWx1ZS5uYW1lVXogOiB2YWx1ZS5uYW1lOwogICAgICAgIH0KICAgICAgICB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XSA9IHsKICAgICAgICAgIHJvd0lkOiByb3dJZCwKICAgICAgICAgIHZhbHVlOiB0eXBlQ29kZSA9PT0gJ1NFTEVDVCcgPyAnJyA6IHZhbHVlLAogICAgICAgICAgc2VsZWN0VmFsdWVJZDogdmFsdWUgPyB2YWx1ZS5pZCA6IG51bGwsCiAgICAgICAgICBzZWxlY3RWYWx1ZU5hbWVVejogdmFsdWUgPyB2YWx1ZS5uYW1lVXogOiBudWxsLAogICAgICAgICAgc2VsZWN0VmFsdWVOYW1lTHQ6IHZhbHVlID8gdmFsdWUubmFtZUx0IDogbnVsbCwKICAgICAgICAgIHNlbGVjdFZhbHVlTmFtZVJ1OiB2YWx1ZSA/IHZhbHVlLm5hbWVSdSA6IG51bGwsCiAgICAgICAgICBvcmlnaW5hbFNlbGVjdFZhbHVlTmFtZVV6OiB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XSA/IHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdLm9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lVXogOiAnJywKICAgICAgICAgIG9yaWdpbmFsU2VsZWN0VmFsdWVOYW1lTHQ6IHRoaXMudGhpcmRUcklkRGF0YVtpbmRleF0udmFsdWVbcm93SW5kZXhdID8gdGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtyb3dJbmRleF0ub3JpZ2luYWxTZWxlY3RWYWx1ZU5hbWVMdCA6ICcnLAogICAgICAgICAgb3JpZ2luYWxTZWxlY3RWYWx1ZU5hbWVSdTogdGhpcy50aGlyZFRySWREYXRhW2luZGV4XS52YWx1ZVtyb3dJbmRleF0gPyB0aGlzLnRoaXJkVHJJZERhdGFbaW5kZXhdLnZhbHVlW3Jvd0luZGV4XS5vcmlnaW5hbFNlbGVjdFZhbHVlTmFtZVJ1IDogJycsCiAgICAgICAgICB0eXBlQ29kZTogdHlwZUNvZGUsCiAgICAgICAgICBjb2x1bW5JZDogaWQsCiAgICAgICAgICBub3RFZGl0YWJsZTogbm90RWRpdGFibGUKICAgICAgICB9OwogICAgICB9CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIm5vX2VudGVyX3ZhbHVlIikuZm9yRWFjaChmdW5jdGlvbiAoaW5wdXQpIHsKICAgICAgICBpZiAoSlNPTi5wYXJzZShpbnB1dC5pZCkucm93SWQpIHsKICAgICAgICAgIF90aGlzOS5mb3JtdWxhcy5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciBpbmRleF9mMiA9IEpTT04ucGFyc2UoZS5mMikuZmluZEluZGV4KGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGQgPT0gcGFyc2VGbG9hdChpZCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgaW5kZXhfZjEgPSBKU09OLnBhcnNlKGUuZjEpLmZpbmRJbmRleChmdW5jdGlvbiAoZCkgewogICAgICAgICAgICAgIHJldHVybiBkID09IHBhcnNlRmxvYXQoSlNPTi5wYXJzZShpbnB1dC5pZCkuY29sdW1uSWQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKGluZGV4X2YyID4gLTEgJiYgaW5kZXhfZjEgPiAtMSAmJiBwYXJzZUZsb2F0KEpTT04ucGFyc2UoaW5wdXQuaWQpLnJvd0lkKSA9PT0gcGFyc2VGbG9hdChyb3dJZCkpIHsKICAgICAgICAgICAgICB2YXIgYWxsVmFsID0gMDsKICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJpbnB1dF92YWwiKS5mb3JFYWNoKGZ1bmN0aW9uICh2SW5wdXQpIHsKICAgICAgICAgICAgICAgIHZhciBlX2luZGV4X2YyID0gSlNPTi5wYXJzZShlLmYyKS5maW5kSW5kZXgoZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGQgPT0gcGFyc2VGbG9hdChKU09OLnBhcnNlKHZJbnB1dC5pZCkuY29sdW1uSWQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBpZiAoZV9pbmRleF9mMiA+IC0xICYmIHBhcnNlRmxvYXQoSlNPTi5wYXJzZSh2SW5wdXQuaWQpLnJvd0lkKSA9PT0gcGFyc2VGbG9hdChyb3dJZCkpIHsKICAgICAgICAgICAgICAgICAgaWYgKF90aGlzOS5fZW1wdHkodklucHV0LnZhbHVlKSkge30gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJzZUZsb2F0KHZJbnB1dC52YWx1ZSkgPT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICAgICAgICAgIGFsbFZhbCArPSBwYXJzZUZsb2F0KHZJbnB1dC52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGFsbFZhbCArPSAwOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBfdGhpczkuJHNldChpbnB1dCwgInZhbHVlIiwgcGFyc2VGbG9hdChhbGxWYWwpKTsKICAgICAgICAgICAgICAgICAgdmFyIGZvdW5kSW5kZXggPSBfdGhpczkudGhpcmRUcklkRGF0YS5maW5kSW5kZXgoZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZS5jb2x1bW5JZCA9PSBKU09OLnBhcnNlKGlucHV0LmlkKS5jb2x1bW5JZDsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIF90aGlzOS50aGlyZFRySWREYXRhW2ZvdW5kSW5kZXhdLnZhbHVlW3Jvd0luZGV4XSA9IHsKICAgICAgICAgICAgICAgICAgICByb3dJZDogcm93SWQgPyByb3dJZCA6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGFsbFZhbCwKICAgICAgICAgICAgICAgICAgICB0eXBlQ29kZTogdHlwZUNvZGUsCiAgICAgICAgICAgICAgICAgICAgY29sdW1uSWQ6IEpTT04ucGFyc2UoaW5wdXQuaWQpLmNvbHVtbklkCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIF90aGlzOS4kZm9yY2VVcGRhdGUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF90aGlzOS5mb3JtdWxhcy5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciBpbmRleF9mMiA9IEpTT04ucGFyc2UoZS5mMikuZmluZEluZGV4KGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGQgPT0gcGFyc2VGbG9hdChpZCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgaW5kZXhfZjEgPSBKU09OLnBhcnNlKGUuZjEpLmZpbmRJbmRleChmdW5jdGlvbiAoZCkgewogICAgICAgICAgICAgIHJldHVybiBkID09IHBhcnNlRmxvYXQoSlNPTi5wYXJzZShpbnB1dC5pZCkuY29sdW1uSWQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKGluZGV4X2YyID4gLTEgJiYgaW5kZXhfZjEgPiAtMSkgewogICAgICAgICAgICAgIHZhciBhbGxWYWwgPSAwOwogICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImlucHV0X3ZhbCIpLmZvckVhY2goZnVuY3Rpb24gKHZJbnB1dCkgewogICAgICAgICAgICAgICAgdmFyIGVfaW5kZXhfZjIgPSBKU09OLnBhcnNlKGUuZjIpLmZpbmRJbmRleChmdW5jdGlvbiAoZCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gZCA9PSBwYXJzZUZsb2F0KEpTT04ucGFyc2UodklucHV0LmlkKS5jb2x1bW5JZCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGlmIChlX2luZGV4X2YyID4gLTEpIHsKICAgICAgICAgICAgICAgICAgaWYgKF90aGlzOS5fZW1wdHkodklucHV0LnZhbHVlKSkge30gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJzZUZsb2F0KHZJbnB1dC52YWx1ZSkgPT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICAgICAgICAgIGFsbFZhbCArPSBwYXJzZUZsb2F0KHZJbnB1dC52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGFsbFZhbCArPSAwOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgX3RoaXM5LiRzZXQoaW5wdXQsICJ2YWx1ZSIsIHBhcnNlRmxvYXQoYWxsVmFsKSk7CiAgICAgICAgICAgICAgICB2YXIgZm91bmRJbmRleCA9IF90aGlzOS50aGlyZFRySWREYXRhLmZpbmRJbmRleChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gZS5jb2x1bW5JZCA9PSBKU09OLnBhcnNlKGlucHV0LmlkKS5jb2x1bW5JZDsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX3RoaXM5LnRoaXJkVHJJZERhdGFbZm91bmRJbmRleF0udmFsdWVbMF0gPSB7CiAgICAgICAgICAgICAgICAgIHJvd0lkOiBudWxsLAogICAgICAgICAgICAgICAgICB2YWx1ZTogYWxsVmFsLAogICAgICAgICAgICAgICAgICB0eXBlQ29kZTogdHlwZUNvZGUsCiAgICAgICAgICAgICAgICAgIGNvbHVtbklkOiBKU09OLnBhcnNlKGlucHV0LmlkKS5jb2x1bW5JZAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIF90aGlzOS4kZm9yY2VVcGRhdGUoKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy4kZm9yY2VVcGRhdGUoKTsKICAgIH0sCiAgICBzZXREb2N1bWVudENvbHVtblZhbHVlczogZnVuY3Rpb24gc2V0RG9jdW1lbnRDb2x1bW5WYWx1ZXMoZGF0YSwgZm9ybXVsYXMpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTQoKSB7CiAgICAgICAgdmFyIGRvY1RhYmxlRm9ybXVsYVRhcmdldElkLCBkaXNhYmxlZEVsZW1lbnRzOwogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTQkKF9jb250ZXh0MTQpIHsKICAgICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MTQucHJldiA9IF9jb250ZXh0MTQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX3RoaXMxMC5zaG93RGF0YSA9IFtdOwogICAgICAgICAgICAgIF90aGlzMTAuY3VycmVudEl0ZW1EYXRhID0gZGF0YTsKICAgICAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCkgewogICAgICAgICAgICAgICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgIGlmIChlLnZhbHVlU3RyaW5nIHx8IGUudmFsdWVCaWdEZWNpbWFsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGUudHlwZUNvZGUgPT09ICJZRUFSIikgewogICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiY3VzdG9tLWRhdGVwaWNrZXIgbXgtZGF0ZXBpY2tlciBkeW5hbWljLXllYXIiKS5mb3JFYWNoKGZ1bmN0aW9uIChmaWVsZCwgaWR4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKU09OLnBhcnNlKGZpZWxkLmlkKS5yb3dJZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUZsb2F0KEpTT04ucGFyc2UoZmllbGQuaWQpLmNvbHVtbklkKSA9PT0gcGFyc2VGbG9hdChlLmNvbHVtbklkKSAmJiBwYXJzZUZsb2F0KEpTT04ucGFyc2UoZmllbGQuaWQpLnJvd0lkKSA9PT0gcGFyc2VGbG9hdChlLnJvd0lkKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJvd0luZGV4ID0gX3RoaXMxMC5zZWxlY3RlZFJvd3MuZmluZEluZGV4KGZ1bmN0aW9uIChlbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWwuaWQgPT0gSlNPTi5wYXJzZShmaWVsZC5pZCkucm93SWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2xJbmRleCA9IF90aGlzMTAudGhpcmRUcklkRGF0YS5maW5kSW5kZXgoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uY29sdW1uSWQgPT09IGUuY29sdW1uSWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMTAuc2V0VmFsdWUoZS5yb3dJZCwgZS52YWx1ZSwgcm93SW5kZXgsIGNvbEluZGV4LCBlLmNvbHVtbklkLCAnREFURScpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnR5cGVDb2RlID09PSAnQklHREVDSU1BTCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZvdW5kQ29sdW1uSWQgPSBfdGhpczEwLnNob3dEYXRhLmZpbmRJbmRleChmdW5jdGlvbiAoZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLmNvbHVtbklkID09PSBlLmNvbHVtbklkOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvdW5kQ29sdW1uSWQgPiAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMTAuc2hvd0RhdGEubWFwKGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZi5jb2x1bW5JZCA9PSBlLmNvbHVtbklkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuY29sdW1uRGF0YSA9ICtmLmNvbHVtbkRhdGEgKyArZS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczEwLnNob3dEYXRhLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uSWQ6IGUuY29sdW1uSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5EYXRhOiBlLnZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImlucHV0X3ZhbCIpLmZvckVhY2goZnVuY3Rpb24gKGlucHV0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm11bGFzLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXhfViA9IEpTT04ucGFyc2UoZWxlbWVudC5mMSkuZmluZEluZGV4KGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZSA9PSBKU09OLnBhcnNlKGlucHV0LmlkKS5jb2x1bW5JZDsKICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXhfViA+IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczEwLiRzZXQoaW5wdXQsICJkaXNhYmxlZCIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMxMC4kc2V0KGlucHV0LnN0eWxlLCAiYm9yZGVyIiwgIm5vbmUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoIm5vX2VudGVyX3ZhbHVlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5zdHlsZS5mb250V2VpZ2h0ID0gImJvbGQiOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChKU09OLnBhcnNlKGlucHV0LmlkKS5yb3dJZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUZsb2F0KEpTT04ucGFyc2UoaW5wdXQuaWQpLmNvbHVtbklkKSA9PT0gcGFyc2VGbG9hdChlLmNvbHVtbklkKSAmJiBwYXJzZUZsb2F0KEpTT04ucGFyc2UoaW5wdXQuaWQpLnJvd0lkKSA9PT0gcGFyc2VGbG9hdChlLnJvd0lkKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMxMC4kc2V0KGlucHV0LCAidmFsdWUiLCBlLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlRmxvYXQoSlNPTi5wYXJzZShpbnB1dC5pZCkuY29sdW1uSWQpID09PSBwYXJzZUZsb2F0KGUuY29sdW1uSWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczEwLiRzZXQoaW5wdXQsICJ2YWx1ZSIsIGUudmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUudmFsdWVEYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiY3VzdG9tLWRhdGVwaWNrZXIgbXgtZGF0ZXBpY2tlciBkeW5hbWljLWRhdGVwaWNrZXIiKS5mb3JFYWNoKGZ1bmN0aW9uIChmaWVsZCwgaWR4KSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoSlNPTi5wYXJzZShmaWVsZC5pZCkucm93SWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlRmxvYXQoSlNPTi5wYXJzZShmaWVsZC5pZCkuY29sdW1uSWQpID09PSBwYXJzZUZsb2F0KGUuY29sdW1uSWQpICYmIHBhcnNlRmxvYXQoSlNPTi5wYXJzZShmaWVsZC5pZCkucm93SWQpID09PSBwYXJzZUZsb2F0KGUucm93SWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJvd0luZGV4ID0gX3RoaXMxMC5zZWxlY3RlZFJvd3MuZmluZEluZGV4KGZ1bmN0aW9uIChlbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsLmlkID09IEpTT04ucGFyc2UoZmllbGQuaWQpLnJvd0lkOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2xJbmRleCA9IF90aGlzMTAudGhpcmRUcklkRGF0YS5maW5kSW5kZXgoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmNvbHVtbklkID09PSBlLmNvbHVtbklkOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMTAuc2V0VmFsdWUoZS5yb3dJZCwgZS52YWx1ZSwgcm93SW5kZXgsIGNvbEluZGV4LCBlLmNvbHVtbklkLCAnREFURScpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS52YWx1ZUJvb2xlYW4gIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJjaGVja2JveF9maWVsZCIpLmZvckVhY2goZnVuY3Rpb24gKGZpZWxkLCBpZHgpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGVja2JveElucHV0ID0gZmllbGQuY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSA/IGZpZWxkLmNoaWxkcmVuWzBdLmNoaWxkcmVuWzFdLmNoaWxkcmVuWzBdIDogZmllbGQuY2hpbGRyZW5bMF0uY2hpbGRyZW5bMF0uY2hpbGRyZW5bMF07CiAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tib3hJbnB1dC5pZCAmJiBKU09OLnBhcnNlKGNoZWNrYm94SW5wdXQuaWQpICYmIEpTT04ucGFyc2UoY2hlY2tib3hJbnB1dC5pZCkucm93SWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlRmxvYXQoSlNPTi5wYXJzZShjaGVja2JveElucHV0LmlkKS5jb2x1bW5JZCkgPT09IHBhcnNlRmxvYXQoZS5jb2x1bW5JZCkgJiYgcGFyc2VGbG9hdChKU09OLnBhcnNlKGNoZWNrYm94SW5wdXQuaWQpLnJvd0lkKSA9PT0gcGFyc2VGbG9hdChlLnJvd0lkKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByb3dJbmRleCA9IF90aGlzMTAuc2VsZWN0ZWRSb3dzLmZpbmRJbmRleChmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbC5pZCA9PSBKU09OLnBhcnNlKGNoZWNrYm94SW5wdXQuaWQpLnJvd0lkOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2xJbmRleCA9IF90aGlzMTAudGhpcmRUcklkRGF0YS5maW5kSW5kZXgoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmNvbHVtbklkID09IGUuY29sdW1uSWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMxMC5zZXRWYWx1ZShlLnJvd0lkLCBKU09OLnBhcnNlKGUudmFsdWUpLCByb3dJbmRleCwgY29sSW5kZXgsIGUuY29sdW1uSWQsICdCT09MRUFOJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLnNlbGVjdFZhbHVlTmFtZVV6KSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgic2VsZWN0X2ZpZWxkIikuZm9yRWFjaChmdW5jdGlvbiAoZmllbGQsIGlkeCkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKEpTT04ucGFyc2UoZmllbGQuaWQpLnJvd0lkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUZsb2F0KEpTT04ucGFyc2UoZmllbGQuaWQpLmNvbHVtbklkKSA9PT0gcGFyc2VGbG9hdChlLmNvbHVtbklkKSAmJiBwYXJzZUZsb2F0KEpTT04ucGFyc2UoZmllbGQuaWQpLnJvd0lkKSA9PT0gcGFyc2VGbG9hdChlLnJvd0lkKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByb3dJbmRleCA9IF90aGlzMTAuc2VsZWN0ZWRSb3dzLmZpbmRJbmRleChmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbC5pZCA9PSBKU09OLnBhcnNlKGZpZWxkLmlkKS5yb3dJZDsKICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sSW5kZXggPSBfdGhpczEwLnRoaXJkVHJJZERhdGEuZmluZEluZGV4KGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5jb2x1bW5JZCA9PSBlLmNvbHVtbklkOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMTAuc2V0VmFsdWUoZS5yb3dJZCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZVV6OiBlLnNlbGVjdFZhbHVlTmFtZVV6LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZUx0OiBlLnNlbGVjdFZhbHVlTmFtZUx0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZVJ1OiBlLnNlbGVjdFZhbHVlTmFtZVJ1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGUuc2VsZWN0VmFsdWVJZAogICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJvd0luZGV4LCBjb2xJbmRleCwgZS5jb2x1bW5JZCwgJ1NFTEVDVCcsIHRydWUsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJpbnB1dF92YWwiKS5mb3JFYWNoKGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgICAgICAgICBmb3JtdWxhcy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4X1YgPSBKU09OLnBhcnNlKGVsZW1lbnQuZjEpLmZpbmRJbmRleChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUgPT0gSlNPTi5wYXJzZShpbnB1dC5pZCkuY29sdW1uSWQ7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4X1YgPiAtMSkgewogICAgICAgICAgICAgICAgICAgICAgX3RoaXMxMC4kc2V0KGlucHV0LCAiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgIF90aGlzMTAuJHNldChpbnB1dC5zdHlsZSwgImJvcmRlciIsICJub25lIik7CiAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5jbGFzc0xpc3QuYWRkKCJub19lbnRlcl92YWx1ZSIpOwogICAgICAgICAgICAgICAgICAgICAgaW5wdXQuc3R5bGUuZm9udFdlaWdodCA9ICJib2xkIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGZvciAoZG9jVGFibGVGb3JtdWxhVGFyZ2V0SWQgaW4gX3RoaXMxMC5kb2NUYWJsZUZvcm11bGFzTGlzdCkgewogICAgICAgICAgICAgICAgZGlzYWJsZWRFbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W2RhdGEtY29sdW1uLWlkPSInICsgZG9jVGFibGVGb3JtdWxhVGFyZ2V0SWQgKyAnIl0nKTsKICAgICAgICAgICAgICAgIGRpc2FibGVkRWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCkgewogICAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoIm5vX2VudGVyX3ZhbHVlIik7CiAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxNCk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIGdldEJ5SWQ6IGZ1bmN0aW9uIGdldEJ5SWQoaWQsIHJlcG9ydElkLCBpbmZvKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE2KCkgewogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTYkKF9jb250ZXh0MTYpIHsKICAgICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MTYucHJldiA9IF9jb250ZXh0MTYubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX3RoaXMxMS5jbGVhckFsbCgpOwogICAgICAgICAgICAgIF90aGlzMTEudGFibGVJZCA9IGlkOwogICAgICAgICAgICAgIF90aGlzMTEucmVwb3J0SWQgPSByZXBvcnRJZDsKICAgICAgICAgICAgICBfdGhpczExLnRhYmxlSW5mbyA9IGluZm87CiAgICAgICAgICAgICAgX3RoaXMxMS5sb2FkZXIgPSB0cnVlOwogICAgICAgICAgICAgIF9jb250ZXh0MTYubmV4dCA9IDc7CiAgICAgICAgICAgICAgcmV0dXJuIFNlcnZpY2UucmVwb3J0R2V0QnlJZChyZXBvcnRJZCkudGhlbihmdW5jdGlvbiAoX3JlZjEwKSB7CiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IF9yZWYxMC5kYXRhOwogICAgICAgICAgICAgICAgX3RoaXMxMS5yZXBvcnQgPSBkYXRhOwogICAgICAgICAgICAgICAgX3RoaXMxMS4kZW1pdCgnc2V0UmVwb3J0R2VuZXJhdGVkJywgX3RoaXMxMS5yZXBvcnQuZ2VuZXJhdGVkKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIF9jb250ZXh0MTYubmV4dCA9IDk7CiAgICAgICAgICAgICAgcmV0dXJuIFNlcnZpY2UuZ2V0QnlJZFRhYmxlV2l0aFJlcG9ydElkKGlkLCByZXBvcnRJZCkudGhlbiggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBfcmVmMTEgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNShycykgewogICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE1JChfY29udGV4dDE1KSB7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQxNS5wcmV2ID0gX2NvbnRleHQxNS5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcnMuZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTUubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNS5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMTEuc2V0Q29sdW1ucyhycy5kYXRhLmNvbHVtbnMsIHJzLmRhdGEucm93cy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczExLnNldFJvdyhycy5kYXRhLnJvd3MpOwogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczExLnRhYmxlID0gcnMuZGF0YS50YWJsZTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5hbGwoW190aGlzMTEuZ2V0RGF0YUJ5SWQocmVwb3J0SWQpLCBfdGhpczExLmdldEZvcm11bGFzXzIoKV0pLnRoZW4oZnVuY3Rpb24gKF9yZWYxMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWYxMyA9IF9zbGljZWRUb0FycmF5KF9yZWYxMiwgMiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBfcmVmMTNbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm11bGFzID0gX3JlZjEzWzFdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMxMS5sYXN0UmVwb3J0RGF0YSA9IGRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczExLmxhc3RSZXBvcnRGb3JtdWxhcyA9IGZvcm11bGFzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMxMS5zZXREb2N1bWVudENvbHVtblZhbHVlcyhkYXRhLCBmb3JtdWxhcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczExLmxvYWRlciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9LCA1MDApOwogICAgICAgICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTUuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSwgX2NhbGxlZTE1KTsKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoX3g2KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmMTEuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSgpKS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgX3RoaXMxMS5sb2FkZXIgPSBmYWxzZTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgIF9jb250ZXh0MTYubmV4dCA9IDExOwogICAgICAgICAgICAgIHJldHVybiBTZXJ2aWNlLmdldERvY1RhYmxlRm9ybXVsYXNMaXN0KGlkKS50aGVuKGZ1bmN0aW9uIChfcmVmMTQpIHsKICAgICAgICAgICAgICAgIHZhciBkYXRhID0gX3JlZjE0LmRhdGE7CiAgICAgICAgICAgICAgICBfdGhpczExLmRvY1RhYmxlRm9ybXVsYXNMaXN0ID0ge307CiAgICAgICAgICAgICAgICB2YXIgbGVuZ3RoID0gZGF0YS5sZW5ndGg7CiAgICAgICAgICAgICAgICB2YXIgY3VycmVudFRhcmdldENvbHVtbklkID0gbnVsbDsKICAgICAgICAgICAgICAgIGZvciAodmFyIF9pNCA9IDA7IF9pNCA8IGxlbmd0aDsgX2k0KyspIHsKICAgICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuZG9jVGFibGVGb3JtdWxhc0xpc3RbZGF0YVtfaTRdLnRhcmdldENvbHVtbklkXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudFRhcmdldENvbHVtbklkID0gZGF0YVtfaTRdLnRhcmdldENvbHVtbklkOwogICAgICAgICAgICAgICAgICAgIF90aGlzMTEuZG9jVGFibGVGb3JtdWxhc0xpc3RbZGF0YVtfaTRdLnRhcmdldENvbHVtbklkXSA9IHsKICAgICAgICAgICAgICAgICAgICAgIGV2YWw6ICIiLAogICAgICAgICAgICAgICAgICAgICAgbGlzdDogW10sCiAgICAgICAgICAgICAgICAgICAgICBsaXN0ZW5Db2x1bW5zOiBbXSwKICAgICAgICAgICAgICAgICAgICAgIHRhcmdldENvbHVtbklkOiBkYXRhW19pNF0udGFyZ2V0Q29sdW1uSWQKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIF90aGlzMTEuZG9jVGFibGVGb3JtdWxhc0xpc3RbZGF0YVtfaTRdLnRhcmdldENvbHVtbklkXS5saXN0LnB1c2goZGF0YVtfaTRdKTsKICAgICAgICAgICAgICAgICAgaWYgKGRhdGFbX2k0XS5kb2NDb2x1bW5JZCkgewogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhW19pNF0uZG9jQ29sdW1uSWQgJiYgX3RoaXMxMS5kb2NUYWJsZUZvcm11bGFzTGlzdFtkYXRhW19pNF0udGFyZ2V0Q29sdW1uSWRdLmxpc3RlbkNvbHVtbnMuaW5kZXhPZihkYXRhW19pNF0uZG9jQ29sdW1uSWQpID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgX3RoaXMxMS5kb2NUYWJsZUZvcm11bGFzTGlzdFtkYXRhW19pNF0udGFyZ2V0Q29sdW1uSWRdLmxpc3RlbkNvbHVtbnMucHVzaChkYXRhW19pNF0uZG9jQ29sdW1uSWQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5kb2NUYWJsZUZvcm11bGFzTGlzdGVuQ29sdW1uSWRbZGF0YVtfaTRdLmRvY0NvbHVtbklkXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICBfdGhpczExLmRvY1RhYmxlRm9ybXVsYXNMaXN0ZW5Db2x1bW5JZFtkYXRhW19pNF0uZG9jQ29sdW1uSWRdID0gW2RhdGFbX2k0XS50YXJnZXRDb2x1bW5JZF07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmRvY1RhYmxlRm9ybXVsYXNMaXN0ZW5Db2x1bW5JZFtkYXRhW19pNF0uZG9jQ29sdW1uSWRdLmluZGV4T2YoZGF0YVtfaTRdLnRhcmdldENvbHVtbklkKSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMxMS5kb2NUYWJsZUZvcm11bGFzTGlzdGVuQ29sdW1uSWRbZGF0YVtfaTRdLmRvY0NvbHVtbklkXS5wdXNoKGRhdGFbX2k0XS50YXJnZXRDb2x1bW5JZCk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChkYXRhW19pNF0udHlwZSA9PT0gIkFSR1VNRU5UUyIpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczExLmRvY1RhYmxlRm9ybXVsYXNMaXN0W2RhdGFbX2k0XS50YXJnZXRDb2x1bW5JZF0uZXZhbCArPSAieyIgKyBkYXRhW19pNF0uZG9jQ29sdW1uSWQgKyAifSI7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMxMS5kb2NUYWJsZUZvcm11bGFzTGlzdFtkYXRhW19pNF0udGFyZ2V0Q29sdW1uSWRdLmV2YWwgKz0gZGF0YVtfaTRdLmNvZGU7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNi5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTE2KTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgc2V0Q29sdW1uczogZnVuY3Rpb24gc2V0Q29sdW1ucyh2LCByb3dzQ291bnQpIHsKICAgICAgdmFyIF90aGlzMTIgPSB0aGlzOwogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTkoKSB7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxOSQoX2NvbnRleHQyNSkgewogICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQyNS5wcmV2ID0gX2NvbnRleHQyNS5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfdGhpczEyLnNlbGVjdGVkQ29sdW1ucyA9IHY7CiAgICAgICAgICAgICAgX3RoaXMxMi5maXJzdENvbHVtbnMgPSBbXTsKICAgICAgICAgICAgICBfdGhpczEyLnNlY29uZENvbHVtbnMgPSBbXTsKICAgICAgICAgICAgICBfdGhpczEyLnRoaXJkQ29sdW1ucyA9IFtdOwogICAgICAgICAgICAgIHYuZm9yRWFjaChmdW5jdGlvbiAoZWwxKSB7CiAgICAgICAgICAgICAgICBfdGhpczEyLmZpcnN0Q29sdW1ucy5wdXNoKGVsMSk7CiAgICAgICAgICAgICAgICBlbDEuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoZWwyKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTIuc2Vjb25kQ29sdW1ucy5wdXNoKGVsMik7CiAgICAgICAgICAgICAgICAgIGVsMi5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChlbDMpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczEyLnRoaXJkQ29sdW1ucy5wdXNoKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgZWwzKSwge30sIHsKICAgICAgICAgICAgICAgICAgICAgIGZJZDogZWwxLmlkCiAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHNldFRpbWVvdXQoIC8qI19fUFVSRV9fKi9fYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxOCgpIHsKICAgICAgICAgICAgICAgIHZhciBmaXJzdFRyVGgsIHNlY29uZFRyVGgsIHRoaXJkVHJUaCwgY291bnRlcjIsIGNvdW50ZXIzOwogICAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxOCQoX2NvbnRleHQyNCkgewogICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDI0LnByZXYgPSBfY29udGV4dDI0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBmaXJzdFRyVGggPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJmaXJzdFRyVGgiKTsKICAgICAgICAgICAgICAgICAgICAgIHNlY29uZFRyVGggPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJzZWNvbmRUclRoIik7CiAgICAgICAgICAgICAgICAgICAgICB0aGlyZFRyVGggPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJ0aGlyZFRyVGgiKTsKICAgICAgICAgICAgICAgICAgICAgIGNvdW50ZXIyID0gMCwgY291bnRlcjMgPSAwOwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyNC5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmaXJzdFRyVGguZm9yRWFjaCggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWYxNiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE3KHRoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9sb29wLCBpbmRleDIsIGFycmF5LCB0bXAsIF9pOCwgX2xvb3A0LCBfaW5kZXgyOwogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTckKF9jb250ZXh0MjMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MjMucHJldiA9IF9jb250ZXh0MjMubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEodGguY29sU3BhbiA+IDEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIzLm5leHQgPSAxMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfbG9vcCA9IC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfbG9vcCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfbG9vcDIsIGluZGV4MywgYXJyYXksIHRtcCwgX2k2LCBfbG9vcDMsIF9pbmRleDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfbG9vcCQoX2NvbnRleHQxOSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDE5LnByZXYgPSBfY29udGV4dDE5Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShzZWNvbmRUclRoW2NvdW50ZXIyXSAmJiBzZWNvbmRUclRoW2NvdW50ZXIyXS5jb2xTcGFuID4gMSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxOS5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvb3AyID0gLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9sb29wMigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFycmF5LCB0bXAsIF9pNTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9sb29wMiQoX2NvbnRleHQxNykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MTcucHJldiA9IF9jb250ZXh0MTcubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheSA9IHRoaXJkVHJUaFtjb3VudGVyM10uaWQuc3BsaXQoIiwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbklkOiBhcnJheVswXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlQ29kZTogYXJyYXlbMV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmQ29kZTogYXJyYXlbMl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlVXJsOiBhcnJheVszXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VBcHBlbmRVcmw6IGFycmF5WzRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZUNvZGU6IGFycmF5WzVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVVejogYXJyYXlbNl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlTmFtZUx0OiBhcnJheVs3XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VOYW1lUnU6IGFycmF5WzhdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFBheWxvYWQ6IE9iamVjdC5hc3NpZ24oe30sIF90aGlzMTIudmFyX2RlZmF1bHRfc2VhcmNoX3BheWxvYWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc05leHRQYWdlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dJZDogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07IC8vIEdFVCBEWU5BTUlDIFJFRlJFTkNFIE9QVElPTlMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRtcC50eXBlQ29kZSA9PT0gJ1NFTEVDVCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKF9pNSA9IDA7IF9pNSA8IHJvd3NDb3VudDsgX2k1KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcC52YWx1ZS5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRJdGVtOiBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3J1ZEFuZExpc3RzU2VydmljZS5zZWFyY2hMaXN0V2l0aEtleXdvcmQodG1wLnJlZmVyZW5jZVVybCwgdG1wLnNlYXJjaFBheWxvYWQsIHRtcC5yZWZlcmVuY2VBcHBlbmRVcmwpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFsnRGVwYXJ0bWVudEZvckRvY3VtZW50JywgJ0RlcGFydG1lbnQnXS5pbmNsdWRlcyhpLnJlZkNvZGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfdG1wJG9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChfdG1wJG9wdGlvbnMgPSB0bXAub3B0aW9ucykucHVzaC5hcHBseShfdG1wJG9wdGlvbnMsIF90b0NvbnN1bWFibGVBcnJheShyZXMuZGF0YSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF90bXAkb3B0aW9uczI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChfdG1wJG9wdGlvbnMyID0gdG1wLm9wdGlvbnMpLnB1c2guYXBwbHkoX3RtcCRvcHRpb25zMiwgX3RvQ29uc3VtYWJsZUFycmF5KHJlcy5kYXRhLmxpc3QpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5oYXNOZXh0UGFnZSA9IHJlcy5kYXRhLnRvdGFsIC8gdG1wLnNlYXJjaFBheWxvYWQuaXRlbXNQZXJQYWdlID4gdG1wLnNlYXJjaFBheWxvYWQucGFnZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5zZWFyY2hQYXlsb2FkLnBhZ2UgKz0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGlmICghdGhpcy5pc01vZGVDcmVhdGUgJiYgdGhpcy5lZGl0aW5nSXRlbS5va2VkSWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZvdW5kSXRtID0gdGhpcy5va2Vkcy5maW5kKGVsID0+IGVsLmlkID09IHRoaXMuZWRpdGluZ0l0ZW0ub2tlZElkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZvdW5kSXRtICYmIHRoaXMuZWRpdGluZ0l0ZW0uaW5mb09rZWREdG8pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub2tlZHMucHVzaCh0aGlzLmVkaXRpbmdJdGVtLmluZm9Pa2VkRHRvKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMub2tlZHMgPSBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5pc0xvYWRpbmdPa2VkID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczEyLnRoaXJkVHJJZERhdGEucHVzaCh0bXApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudGVyMysrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTcuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgX2xvb3AyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgzID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShpbmRleDMgPCBzZWNvbmRUclRoW2NvdW50ZXIyXS5jb2xTcGFuKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE5Lm5leHQgPSA4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE5LmRlbGVnYXRlWWllbGQoX2xvb3AyKCksICJ0MCIsIDUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4MysrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxOS5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50ZXIyKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE5Lm5leHQgPSAyODsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShzZWNvbmRUclRoW2NvdW50ZXIyXSAmJiBzZWNvbmRUclRoW2NvdW50ZXIyXS5jbGFzc0xpc3QuY29udGFpbnMoInRoaXJkVHJJZCIpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE5Lm5leHQgPSAxOTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheSA9IHNlY29uZFRyVGhbY291bnRlcjJdLmlkLnNwbGl0KCIsIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbklkOiBhcnJheVswXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUNvZGU6IGFycmF5WzFdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZDb2RlOiBhcnJheVsyXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlVXJsOiBhcnJheVszXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlQXBwZW5kVXJsOiBhcnJheVs0XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlQ29kZTogYXJyYXlbNV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVVejogYXJyYXlbNl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVMdDogYXJyYXlbN10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVSdTogYXJyYXlbOF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFBheWxvYWQ6IE9iamVjdC5hc3NpZ24oe30sIF90aGlzMTIudmFyX2RlZmF1bHRfc2VhcmNoX3BheWxvYWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNOZXh0UGFnZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dJZDogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsgLy8gR0VUIERZTkFNSUMgUkVGUkVOQ0UgT1BUSU9OUwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRtcC50eXBlQ29kZSA9PT0gJ1NFTEVDVCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChfaTYgPSAwOyBfaTYgPCByb3dzQ291bnQ7IF9pNisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wLnZhbHVlLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRJdGVtOiBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3J1ZEFuZExpc3RzU2VydmljZS5zZWFyY2hMaXN0V2l0aEtleXdvcmQodG1wLnJlZmVyZW5jZVVybCwgdG1wLnNlYXJjaFBheWxvYWQsIHRtcC5yZWZlcmVuY2VBcHBlbmRVcmwpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChbJ0RlcGFydG1lbnRGb3JEb2N1bWVudCcsICdEZXBhcnRtZW50J10uaW5jbHVkZXMoaS5yZWZDb2RlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF90bXAkb3B0aW9uczM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoX3RtcCRvcHRpb25zMyA9IHRtcC5vcHRpb25zKS5wdXNoLmFwcGx5KF90bXAkb3B0aW9uczMsIF90b0NvbnN1bWFibGVBcnJheShyZXMuZGF0YSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3RtcCRvcHRpb25zNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChfdG1wJG9wdGlvbnM0ID0gdG1wLm9wdGlvbnMpLnB1c2guYXBwbHkoX3RtcCRvcHRpb25zNCwgX3RvQ29uc3VtYWJsZUFycmF5KHJlcy5kYXRhLmxpc3QpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wLmhhc05leHRQYWdlID0gcmVzLmRhdGEudG90YWwgLyB0bXAuc2VhcmNoUGF5bG9hZC5pdGVtc1BlclBhZ2UgPiB0bXAuc2VhcmNoUGF5bG9hZC5wYWdlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5zZWFyY2hQYXlsb2FkLnBhZ2UgKz0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBpZiAoIXRoaXMuaXNNb2RlQ3JlYXRlICYmIHRoaXMuZWRpdGluZ0l0ZW0ub2tlZElkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZm91bmRJdG0gPSB0aGlzLm9rZWRzLmZpbmQoZWwgPT4gZWwuaWQgPT0gdGhpcy5lZGl0aW5nSXRlbS5va2VkSWQpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZvdW5kSXRtICYmIHRoaXMuZWRpdGluZ0l0ZW0uaW5mb09rZWREdG8pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9rZWRzLnB1c2godGhpcy5lZGl0aW5nSXRlbS5pbmZvT2tlZER0bykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMub2tlZHMgPSBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmlzTG9hZGluZ09rZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMTIudGhpcmRUcklkRGF0YS5wdXNoKHRtcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudGVyMisrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxOS5uZXh0ID0gMjg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzZWNvbmRUclRoW2NvdW50ZXIyXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE5Lm5leHQgPSAyODsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfbG9vcDMgPSAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2xvb3AzKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXJyYXksIHRtcCwgX2k3OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2xvb3AzJChfY29udGV4dDE4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQxOC5wcmV2ID0gX2NvbnRleHQxOC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5ID0gdGhpcmRUclRoW2NvdW50ZXIzXS5pZC5zcGxpdCgiLCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uSWQ6IGFycmF5WzBdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVDb2RlOiBhcnJheVsxXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZDb2RlOiBhcnJheVsyXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VVcmw6IGFycmF5WzNdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZUFwcGVuZFVybDogYXJyYXlbNF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlQ29kZTogYXJyYXlbNV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlTmFtZVV6OiBhcnJheVs2XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VOYW1lTHQ6IGFycmF5WzddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVSdTogYXJyYXlbOF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoUGF5bG9hZDogT2JqZWN0LmFzc2lnbih7fSwgX3RoaXMxMi52YXJfZGVmYXVsdF9zZWFyY2hfcGF5bG9hZCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzTmV4dFBhZ2U6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd0lkOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsgLy8gR0VUIERZTkFNSUMgUkVGUkVOQ0UgT1BUSU9OUwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG1wLnR5cGVDb2RlID09PSAnU0VMRUNUJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoX2k3ID0gMDsgX2k3IDwgcm93c0NvdW50OyBfaTcrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wLnZhbHVlLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEl0ZW06IG51bGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcnVkQW5kTGlzdHNTZXJ2aWNlLnNlYXJjaExpc3RXaXRoS2V5d29yZCh0bXAucmVmZXJlbmNlVXJsLCB0bXAuc2VhcmNoUGF5bG9hZCwgdG1wLnJlZmVyZW5jZUFwcGVuZFVybCkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoWydEZXBhcnRtZW50Rm9yRG9jdW1lbnQnLCAnRGVwYXJ0bWVudCddLmluY2x1ZGVzKGkucmVmQ29kZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF90bXAkb3B0aW9uczU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChfdG1wJG9wdGlvbnM1ID0gdG1wLm9wdGlvbnMpLnB1c2guYXBwbHkoX3RtcCRvcHRpb25zNSwgX3RvQ29uc3VtYWJsZUFycmF5KHJlcy5kYXRhKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3RtcCRvcHRpb25zNjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKF90bXAkb3B0aW9uczYgPSB0bXAub3B0aW9ucykucHVzaC5hcHBseShfdG1wJG9wdGlvbnM2LCBfdG9Db25zdW1hYmxlQXJyYXkocmVzLmRhdGEubGlzdCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wLmhhc05leHRQYWdlID0gcmVzLmRhdGEudG90YWwgLyB0bXAuc2VhcmNoUGF5bG9hZC5pdGVtc1BlclBhZ2UgPiB0bXAuc2VhcmNoUGF5bG9hZC5wYWdlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wLnNlYXJjaFBheWxvYWQucGFnZSArPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogaWYgKCF0aGlzLmlzTW9kZUNyZWF0ZSAmJiB0aGlzLmVkaXRpbmdJdGVtLm9rZWRJZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZm91bmRJdG0gPSB0aGlzLm9rZWRzLmZpbmQoZWwgPT4gZWwuaWQgPT0gdGhpcy5lZGl0aW5nSXRlbS5va2VkSWQpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZm91bmRJdG0gJiYgdGhpcy5lZGl0aW5nSXRlbS5pbmZvT2tlZER0bykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5va2Vkcy5wdXNoKHRoaXMuZWRpdGluZ0l0ZW0uaW5mb09rZWREdG8pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5va2VkcyA9IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmlzTG9hZGluZ09rZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMTIudGhpcmRUcklkRGF0YS5wdXNoKHRtcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50ZXIzKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxOC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBfbG9vcDMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfaW5kZXggPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShfaW5kZXggPCBzZWNvbmRUclRoW2NvdW50ZXIyXS5jb2xTcGFuKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE5Lm5leHQgPSAyNzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxOS5kZWxlZ2F0ZVlpZWxkKF9sb29wMygpLCAidDEiLCAyNCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyNDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9pbmRleCsrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxOS5uZXh0ID0gMjI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRlcjIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI4OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxOS5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIF9sb29wKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleDIgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoaW5kZXgyIDwgdGguY29sU3BhbikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MjMubmV4dCA9IDg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjMuZGVsZWdhdGVZaWVsZChfbG9vcCgpLCAidDAiLCA1KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4MisrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MjMubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIzLm5leHQgPSAyNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoLmNsYXNzTGlzdC5jb250YWlucygidGhpcmRUcklkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MjMubmV4dCA9IDE3OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5ID0gdGguaWQuc3BsaXQoIiwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5JZDogYXJyYXlbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlQ29kZTogYXJyYXlbMV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZDb2RlOiBhcnJheVsyXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZVVybDogYXJyYXlbM10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VBcHBlbmRVcmw6IGFycmF5WzRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlQ29kZTogYXJyYXlbNV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VOYW1lVXo6IGFycmF5WzZdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlTmFtZUx0OiBhcnJheVs3XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVSdTogYXJyYXlbOF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hQYXlsb2FkOiBPYmplY3QuYXNzaWduKHt9LCBfdGhpczEyLnZhcl9kZWZhdWx0X3NlYXJjaF9wYXlsb2FkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc05leHRQYWdlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93SWQ6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsgLy8gR0VUIERZTkFNSUMgUkVGUkVOQ0UgT1BUSU9OUwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0bXAudHlwZUNvZGUgPT09ICdTRUxFQ1QnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKF9pOCA9IDA7IF9pOCA8IHJvd3NDb3VudDsgX2k4KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wLnZhbHVlLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkSXRlbTogbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNydWRBbmRMaXN0c1NlcnZpY2Uuc2VhcmNoTGlzdFdpdGhLZXl3b3JkKHRtcC5yZWZlcmVuY2VVcmwsIHRtcC5zZWFyY2hQYXlsb2FkLCB0bXAucmVmZXJlbmNlQXBwZW5kVXJsKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFsiRGVwYXJ0bWVudEZvckRvY3VtZW50IiwgIkRlcGFydG1lbnQiXS5pbmNsdWRlcyh0bXAucmVmQ29kZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3RtcCRvcHRpb25zNzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoX3RtcCRvcHRpb25zNyA9IHRtcC5vcHRpb25zKS5wdXNoLmFwcGx5KF90bXAkb3B0aW9uczcsIF90b0NvbnN1bWFibGVBcnJheShyZXMuZGF0YSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfdG1wJG9wdGlvbnM4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChfdG1wJG9wdGlvbnM4ID0gdG1wLm9wdGlvbnMpLnB1c2guYXBwbHkoX3RtcCRvcHRpb25zOCwgX3RvQ29uc3VtYWJsZUFycmF5KHJlcy5kYXRhLmxpc3QpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAuaGFzTmV4dFBhZ2UgPSByZXMuZGF0YS50b3RhbCAvIHRtcC5zZWFyY2hQYXlsb2FkLml0ZW1zUGVyUGFnZSA+IHRtcC5zZWFyY2hQYXlsb2FkLnBhZ2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5zZWFyY2hQYXlsb2FkLnBhZ2UgKz0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogaWYgKCF0aGlzLmlzTW9kZUNyZWF0ZSAmJiB0aGlzLmVkaXRpbmdJdGVtLm9rZWRJZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBmb3VuZEl0bSA9IHRoaXMub2tlZHMuZmluZChlbCA9PiBlbC5pZCA9PSB0aGlzLmVkaXRpbmdJdGVtLm9rZWRJZCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZvdW5kSXRtICYmIHRoaXMuZWRpdGluZ0l0ZW0uaW5mb09rZWREdG8pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5va2Vkcy5wdXNoKHRoaXMuZWRpdGluZ0l0ZW0uaW5mb09rZWREdG8pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMub2tlZHMgPSBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuaXNMb2FkaW5nT2tlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMxMi50aGlyZFRySWREYXRhLnB1c2godG1wKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIzLm5leHQgPSAyNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfbG9vcDQgPSAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2xvb3A0KCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9sb29wNSwgaW5kZXgzLCBfYXJyYXksIF90bXAsIF9pMTAsIF9sb29wNiwgX2luZGV4MzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfbG9vcDQkKF9jb250ZXh0MjIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQyMi5wcmV2ID0gX2NvbnRleHQyMi5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoc2Vjb25kVHJUaFtjb3VudGVyMl0uY29sU3BhbiA+IDEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MjIubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9sb29wNSA9IC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfbG9vcDUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhcnJheSwgdG1wLCBfaTk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfbG9vcDUkKF9jb250ZXh0MjApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDIwLnByZXYgPSBfY29udGV4dDIwLm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXkgPSB0aGlyZFRyVGhbY291bnRlcjNdLmlkLnNwbGl0KCIsIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5JZDogYXJyYXlbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUNvZGU6IGFycmF5WzFdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZkNvZGU6IGFycmF5WzJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZVVybDogYXJyYXlbM10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlQXBwZW5kVXJsOiBhcnJheVs0XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VDb2RlOiBhcnJheVs1XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VOYW1lVXo6IGFycmF5WzZdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVMdDogYXJyYXlbN10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlTmFtZVJ1OiBhcnJheVs4XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hQYXlsb2FkOiBPYmplY3QuYXNzaWduKHt9LCBfdGhpczEyLnZhcl9kZWZhdWx0X3NlYXJjaF9wYXlsb2FkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNOZXh0UGFnZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uczogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93SWQ6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OyAvLyBHRVQgRFlOQU1JQyBSRUZSRU5DRSBPUFRJT05TCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0bXAudHlwZUNvZGUgPT09ICdTRUxFQ1QnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChfaTkgPSAwOyBfaTkgPCByb3dzQ291bnQ7IF9pOSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAudmFsdWUucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkSXRlbTogbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNydWRBbmRMaXN0c1NlcnZpY2Uuc2VhcmNoTGlzdFdpdGhLZXl3b3JkKHRtcC5yZWZlcmVuY2VVcmwsIHRtcC5zZWFyY2hQYXlsb2FkLCB0bXAucmVmZXJlbmNlQXBwZW5kVXJsKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChbJ0RlcGFydG1lbnRGb3JEb2N1bWVudCcsICdEZXBhcnRtZW50J10uaW5jbHVkZXMoaS5yZWZDb2RlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3RtcCRvcHRpb25zOTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKF90bXAkb3B0aW9uczkgPSB0bXAub3B0aW9ucykucHVzaC5hcHBseShfdG1wJG9wdGlvbnM5LCBfdG9Db25zdW1hYmxlQXJyYXkocmVzLmRhdGEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfdG1wJG9wdGlvbnMxMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKF90bXAkb3B0aW9uczEwID0gdG1wLm9wdGlvbnMpLnB1c2guYXBwbHkoX3RtcCRvcHRpb25zMTAsIF90b0NvbnN1bWFibGVBcnJheShyZXMuZGF0YS5saXN0KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAuaGFzTmV4dFBhZ2UgPSByZXMuZGF0YS50b3RhbCAvIHRtcC5zZWFyY2hQYXlsb2FkLml0ZW1zUGVyUGFnZSA+IHRtcC5zZWFyY2hQYXlsb2FkLnBhZ2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAuc2VhcmNoUGF5bG9hZC5wYWdlICs9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBpZiAoIXRoaXMuaXNNb2RlQ3JlYXRlICYmIHRoaXMuZWRpdGluZ0l0ZW0ub2tlZElkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBmb3VuZEl0bSA9IHRoaXMub2tlZHMuZmluZChlbCA9PiBlbC5pZCA9PSB0aGlzLmVkaXRpbmdJdGVtLm9rZWRJZCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmb3VuZEl0bSAmJiB0aGlzLmVkaXRpbmdJdGVtLmluZm9Pa2VkRHRvKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9rZWRzLnB1c2godGhpcy5lZGl0aW5nSXRlbS5pbmZvT2tlZER0bykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLm9rZWRzID0gW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuaXNMb2FkaW5nT2tlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMxMi50aGlyZFRySWREYXRhLnB1c2godG1wKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRlcjMrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIwLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIF9sb29wNSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4MyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoaW5kZXgzIDwgc2Vjb25kVHJUaFtjb3VudGVyMl0uY29sU3BhbikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyMi5uZXh0ID0gODsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMi5kZWxlZ2F0ZVlpZWxkKF9sb29wNSgpLCAidDAiLCA1KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleDMrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MjIubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudGVyMisrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyMi5uZXh0ID0gMjg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoc2Vjb25kVHJUaFtjb3VudGVyMl0gJiYgc2Vjb25kVHJUaFtjb3VudGVyMl0uY2xhc3NMaXN0LmNvbnRhaW5zKCJ0aGlyZFRySWQiKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyMi5uZXh0ID0gMTk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2FycmF5ID0gc2Vjb25kVHJUaFtjb3VudGVyMl0uaWQuc3BsaXQoIiwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90bXAgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbklkOiBfYXJyYXlbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVDb2RlOiBfYXJyYXlbMV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZkNvZGU6IF9hcnJheVsyXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlVXJsOiBfYXJyYXlbM10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZUFwcGVuZFVybDogX2FycmF5WzRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VDb2RlOiBfYXJyYXlbNV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVVejogX2FycmF5WzZdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VOYW1lTHQ6IF9hcnJheVs3XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlTmFtZVJ1OiBfYXJyYXlbOF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFBheWxvYWQ6IE9iamVjdC5hc3NpZ24oe30sIF90aGlzMTIudmFyX2RlZmF1bHRfc2VhcmNoX3BheWxvYWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNOZXh0UGFnZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dJZDogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsgLy8gR0VUIERZTkFNSUMgUkVGUkVOQ0UgT1BUSU9OUwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF90bXAudHlwZUNvZGUgPT09ICdTRUxFQ1QnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoX2kxMCA9IDA7IF9pMTAgPCByb3dzQ291bnQ7IF9pMTArKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90bXAudmFsdWUucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEl0ZW06IG51bGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcnVkQW5kTGlzdHNTZXJ2aWNlLnNlYXJjaExpc3RXaXRoS2V5d29yZChfdG1wLnJlZmVyZW5jZVVybCwgX3RtcC5zZWFyY2hQYXlsb2FkLCBfdG1wLnJlZmVyZW5jZUFwcGVuZFVybCkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFsnRGVwYXJ0bWVudEZvckRvY3VtZW50JywgJ0RlcGFydG1lbnQnXS5pbmNsdWRlcyhpLnJlZkNvZGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3RtcCRvcHRpb25zMTE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoX3RtcCRvcHRpb25zMTEgPSBfdG1wLm9wdGlvbnMpLnB1c2guYXBwbHkoX3RtcCRvcHRpb25zMTEsIF90b0NvbnN1bWFibGVBcnJheShyZXMuZGF0YSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3RtcCRvcHRpb25zMTI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoX3RtcCRvcHRpb25zMTIgPSBfdG1wLm9wdGlvbnMpLnB1c2guYXBwbHkoX3RtcCRvcHRpb25zMTIsIF90b0NvbnN1bWFibGVBcnJheShyZXMuZGF0YS5saXN0KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90bXAuaGFzTmV4dFBhZ2UgPSByZXMuZGF0YS50b3RhbCAvIF90bXAuc2VhcmNoUGF5bG9hZC5pdGVtc1BlclBhZ2UgPiBfdG1wLnNlYXJjaFBheWxvYWQucGFnZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdG1wLnNlYXJjaFBheWxvYWQucGFnZSArPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGlmICghdGhpcy5pc01vZGVDcmVhdGUgJiYgdGhpcy5lZGl0aW5nSXRlbS5va2VkSWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBmb3VuZEl0bSA9IHRoaXMub2tlZHMuZmluZChlbCA9PiBlbC5pZCA9PSB0aGlzLmVkaXRpbmdJdGVtLm9rZWRJZCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZm91bmRJdG0gJiYgdGhpcy5lZGl0aW5nSXRlbS5pbmZvT2tlZER0bykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub2tlZHMucHVzaCh0aGlzLmVkaXRpbmdJdGVtLmluZm9Pa2VkRHRvKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5va2VkcyA9IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuaXNMb2FkaW5nT2tlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMxMi50aGlyZFRySWREYXRhLnB1c2goX3RtcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudGVyMisrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyMi5uZXh0ID0gMjg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzZWNvbmRUclRoW2NvdW50ZXIyXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIyLm5leHQgPSAyODsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfbG9vcDYgPSAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2xvb3A2KCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXJyYXksIHRtcCwgX2kxMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9sb29wNiQoX2NvbnRleHQyMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MjEucHJldiA9IF9jb250ZXh0MjEubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheSA9IHRoaXJkVHJUaFtjb3VudGVyM10uaWQuc3BsaXQoIiwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbklkOiBhcnJheVswXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlQ29kZTogYXJyYXlbMV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmQ29kZTogYXJyYXlbMl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlVXJsOiBhcnJheVszXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VBcHBlbmRVcmw6IGFycmF5WzRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZUNvZGU6IGFycmF5WzVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZU5hbWVVejogYXJyYXlbNl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlTmFtZUx0OiBhcnJheVs3XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VOYW1lUnU6IGFycmF5WzhdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFBheWxvYWQ6IE9iamVjdC5hc3NpZ24oe30sIF90aGlzMTIudmFyX2RlZmF1bHRfc2VhcmNoX3BheWxvYWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc05leHRQYWdlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dJZDogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07IC8vIEdFVCBEWU5BTUlDIFJFRlJFTkNFIE9QVElPTlMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRtcC50eXBlQ29kZSA9PT0gJ1NFTEVDVCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKF9pMTEgPSAwOyBfaTExIDwgcm93c0NvdW50OyBfaTExKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcC52YWx1ZS5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRJdGVtOiBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3J1ZEFuZExpc3RzU2VydmljZS5zZWFyY2hMaXN0V2l0aEtleXdvcmQodG1wLnJlZmVyZW5jZVVybCwgdG1wLnNlYXJjaFBheWxvYWQsIHRtcC5yZWZlcmVuY2VBcHBlbmRVcmwpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFsnRGVwYXJ0bWVudEZvckRvY3VtZW50JywgJ0RlcGFydG1lbnQnXS5pbmNsdWRlcyhpLnJlZkNvZGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfdG1wJG9wdGlvbnMxMzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKF90bXAkb3B0aW9uczEzID0gdG1wLm9wdGlvbnMpLnB1c2guYXBwbHkoX3RtcCRvcHRpb25zMTMsIF90b0NvbnN1bWFibGVBcnJheShyZXMuZGF0YSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF90bXAkb3B0aW9uczE0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoX3RtcCRvcHRpb25zMTQgPSB0bXAub3B0aW9ucykucHVzaC5hcHBseShfdG1wJG9wdGlvbnMxNCwgX3RvQ29uc3VtYWJsZUFycmF5KHJlcy5kYXRhLmxpc3QpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5oYXNOZXh0UGFnZSA9IHJlcy5kYXRhLnRvdGFsIC8gdG1wLnNlYXJjaFBheWxvYWQuaXRlbXNQZXJQYWdlID4gdG1wLnNlYXJjaFBheWxvYWQucGFnZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5zZWFyY2hQYXlsb2FkLnBhZ2UgKz0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGlmICghdGhpcy5pc01vZGVDcmVhdGUgJiYgdGhpcy5lZGl0aW5nSXRlbS5va2VkSWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZvdW5kSXRtID0gdGhpcy5va2Vkcy5maW5kKGVsID0+IGVsLmlkID09IHRoaXMuZWRpdGluZ0l0ZW0ub2tlZElkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZvdW5kSXRtICYmIHRoaXMuZWRpdGluZ0l0ZW0uaW5mb09rZWREdG8pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub2tlZHMucHVzaCh0aGlzLmVkaXRpbmdJdGVtLmluZm9Pa2VkRHRvKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMub2tlZHMgPSBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5pc0xvYWRpbmdPa2VkID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczEyLnRoaXJkVHJJZERhdGEucHVzaCh0bXApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudGVyMysrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjEuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgX2xvb3A2KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2luZGV4MyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKF9pbmRleDMgPCBzZWNvbmRUclRoW2NvdW50ZXIyXS5jb2xTcGFuKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIyLm5leHQgPSAyNzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMi5kZWxlZ2F0ZVlpZWxkKF9sb29wNigpLCAidDEiLCAyNCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyNDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9pbmRleDMrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MjIubmV4dCA9IDIyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyNzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50ZXIyKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyODoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjIuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBfbG9vcDQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9pbmRleDIgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKF9pbmRleDIgPCB0aC5jb2xTcGFuKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyMy5uZXh0ID0gMjQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjMuZGVsZWdhdGVZaWVsZChfbG9vcDQoKSwgInQxIiwgMjEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9pbmRleDIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIzLm5leHQgPSAxOTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyNDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMy5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgX2NhbGxlZTE3KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKF94NykgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmMTYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgIH0oKSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyNC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIF9jYWxsZWUxOCk7CiAgICAgICAgICAgICAgfSkpLCAzMDApOwogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjUuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxOSk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIHNldFJvdzogZnVuY3Rpb24gc2V0Um93KHYpIHsKICAgICAgdGhpcy5zZWxlY3RlZFJvd3MgPSB2OwogICAgICB0aGlzLmxhc3RSZXBvcnREYXRhUm93cyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodikpOwogICAgICBpZiAodGhpcy5zZWxlY3RlZFJvd3MubGVuZ3RoID09IDAgJiYgIXRoaXMuaXNHZW5lcmF0ZWQpIHsKICAgICAgICB0aGlzLnNlbGVjdGVkUm93cyA9IFt7CiAgICAgICAgICBpZDogdGhpcy5nZXRSYW5kb21JbnQoKQogICAgICAgIH1dOwogICAgICB9CiAgICB9LAogICAgcm93c3BhbkZpcnN0OiBmdW5jdGlvbiByb3dzcGFuRmlyc3QoZWwpIHsKICAgICAgcmV0dXJuIGVsLmNoaWxkcmVuLmxlbmd0aCA+IDAgPyAxIDogZWwuY2hpbGRyZW4ubGVuZ3RoID4gMCAmJiB0aGlzLnRoaXJkQ29sdW1ucy5sZW5ndGggPiAwID8gMyA6IDM7CiAgICB9LAogICAgY29sc3BhbkZpcnN0OiBmdW5jdGlvbiBjb2xzcGFuRmlyc3QoZWwpIHsKICAgICAgdmFyIGZvdW5kID0gdGhpcy50aGlyZENvbHVtbnMuZmlsdGVyKGZ1bmN0aW9uIChpKSB7CiAgICAgICAgcmV0dXJuIGkuZklkID09PSBlbC5pZDsKICAgICAgfSk7CiAgICAgIHZhciB0b3RhbE5vdENoaWxkID0gZWwuY2hpbGRyZW4uZmlsdGVyKGZ1bmN0aW9uIChkKSB7CiAgICAgICAgcmV0dXJuIGQuY2hpbGRyZW4ubGVuZ3RoID09IDA7CiAgICAgIH0pOwogICAgICByZXR1cm4gZWwuY2hpbGRyZW4ubGVuZ3RoID4gMCAmJiBmb3VuZC5sZW5ndGggPT0gMCA/IGVsLmNoaWxkcmVuLmxlbmd0aCA6IGVsLmNoaWxkcmVuLmxlbmd0aCA+IDAgJiYgZm91bmQubGVuZ3RoID4gMCA/IHRvdGFsTm90Q2hpbGQubGVuZ3RoICsgZm91bmQubGVuZ3RoIDogMTsKICAgIH0sCiAgICByb3dzcGFuU2Vjb25kOiBmdW5jdGlvbiByb3dzcGFuU2Vjb25kKGVsKSB7CiAgICAgIHJldHVybiBlbC5jaGlsZHJlbi5sZW5ndGggPT0gMCAmJiB0aGlzLnRoaXJkQ29sdW1ucy5sZW5ndGggPT0gMCA/IDEgOiBlbC5jaGlsZHJlbi5sZW5ndGggPT0gMCAmJiB0aGlzLnRoaXJkQ29sdW1ucy5sZW5ndGggPiAwID8gMiA6IDE7CiAgICB9LAogICAgY29sc3BhblNlY29uZDogZnVuY3Rpb24gY29sc3BhblNlY29uZChlbCkgewogICAgICByZXR1cm4gZWwuY2hpbGRyZW4ubGVuZ3RoID4gMCA/IGVsLmNoaWxkcmVuLmxlbmd0aCA6IDE7CiAgICB9LAogICAgcm93c3BhbkZpcnN0Q2xhc3M6IGZ1bmN0aW9uIHJvd3NwYW5GaXJzdENsYXNzKGVsKSB7CiAgICAgIHJldHVybiBlbC5jaGlsZHJlbi5sZW5ndGggPiAwID8gIiIgOiBlbC5jaGlsZHJlbi5sZW5ndGggPiAwICYmIHRoaXMudGhpcmRDb2x1bW5zLmxlbmd0aCA+IDAgPyAidGhpcmRUcklkIiA6ICJ0aGlyZFRySWQiOwogICAgfSwKICAgIHJvd3NwYW5TZWNvbmRDbGFzczogZnVuY3Rpb24gcm93c3BhblNlY29uZENsYXNzKGVsKSB7CiAgICAgIHJldHVybiBlbC5jaGlsZHJlbi5sZW5ndGggPT0gMCAmJiB0aGlzLnRoaXJkQ29sdW1ucy5sZW5ndGggPT0gMCA/ICJ0aGlyZFRySWQiIDogZWwuY2hpbGRyZW4ubGVuZ3RoID09IDAgJiYgdGhpcy50aGlyZENvbHVtbnMubGVuZ3RoID4gMCA/ICJ0aGlyZFRySWQiIDogIiI7CiAgICB9LAogICAgbm9ybWFsaXplcjogZnVuY3Rpb24gbm9ybWFsaXplcihub2RlKSB7CiAgICAgIGlmICghbm9kZS5jaGlsZHJlbiB8fCBub2RlLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkgewogICAgICAgIGRlbGV0ZSBub2RlLmNoaWxkcmVuOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBpZDogbm9kZS5pZCwKICAgICAgICAgIGxhYmVsOiB0aGlzLmdldE5hbWUoewogICAgICAgICAgICBuYW1lUnU6IG5vZGUubmFtZVJ1LAogICAgICAgICAgICBuYW1lTHQ6IG5vZGUubmFtZUx0LAogICAgICAgICAgICBuYW1lVXo6IG5vZGUubmFtZVV6CiAgICAgICAgICB9KQogICAgICAgIH07CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICBpZDogbm9kZS5pZCwKICAgICAgICBsYWJlbDogdGhpcy5nZXROYW1lKHsKICAgICAgICAgIG5hbWVSdTogbm9kZS5uYW1lUnUsCiAgICAgICAgICBuYW1lTHQ6IG5vZGUubmFtZUx0LAogICAgICAgICAgbmFtZVV6OiBub2RlLm5hbWVVegogICAgICAgIH0pLAogICAgICAgIGNoaWxkcmVuOiBub2RlLmNoaWxkcmVuICYmIG5vZGUuY2hpbGRyZW4ubGVuZ3RoID4gMCA/IG5vZGUuY2hpbGRyZW4gOiBbXQogICAgICB9OwogICAgfSwKICAgIGNhbGN1bGF0ZURvY0Zvcm11bGFzOiBmdW5jdGlvbiBjYWxjdWxhdGVEb2NGb3JtdWxhcyhyb3dJZCwgdmFsdWUsIHJvd0luZGV4LCBjb2x1bW5JbmRleCwgY29sdW1uSWQsIHR5cGVDb2RlKSB7CiAgICAgIC8vIHJvd0luZGV4IGlzIGBzZWxlY3RlZFJvd3NgIGluZGV4CgogICAgICBpZiAodGhpcy5kb2NUYWJsZUZvcm11bGFzTGlzdGVuQ29sdW1uSWRbY29sdW1uSWRdID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgdmFyIHRhcmdldHMgPSB0aGlzLmRvY1RhYmxlRm9ybXVsYXNMaXN0ZW5Db2x1bW5JZFtjb2x1bW5JZF07CiAgICAgIGZvciAodmFyIHRhcmdldEluZGV4IGluIHRhcmdldHMpIHsKICAgICAgICB2YXIgZG9jVGFibGVGb3JtdWxhID0gdGhpcy5kb2NUYWJsZUZvcm11bGFzTGlzdFt0YXJnZXRzW3RhcmdldEluZGV4XV07CiAgICAgICAgdmFyIGV2YWxTdHJpbmcgPSBkb2NUYWJsZUZvcm11bGEuZXZhbDsKICAgICAgICB2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoZG9jVGFibGVGb3JtdWxhLmxpc3RlbkNvbHVtbnMpLAogICAgICAgICAgX3N0ZXA7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgIHZhciBfdGhpcyR0aGlyZFRySWREYXRhJHQsIF90aGlzJHRoaXJkVHJJZERhdGEkdDIsIF90aGlzJHRoaXJkVHJJZERhdGEkdDM7CiAgICAgICAgICAgIHZhciBsaXN0ZW5Db2x1bW4gPSBfc3RlcC52YWx1ZTsKICAgICAgICAgICAgdmFyIHRoaXJkSW5kZXggPSB0aGlzLnRyQ29sdW1uSWRPbkRvY0NvbHVtbklkTWFwW2xpc3RlbkNvbHVtbl07CiAgICAgICAgICAgIHZhciBfdmFsID0gcGFyc2VGbG9hdCgoX3RoaXMkdGhpcmRUcklkRGF0YSR0ID0gKF90aGlzJHRoaXJkVHJJZERhdGEkdDIgPSB0aGlzLnRoaXJkVHJJZERhdGFbdGhpcmRJbmRleF0pID09PSBudWxsIHx8IF90aGlzJHRoaXJkVHJJZERhdGEkdDIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfdGhpcyR0aGlyZFRySWREYXRhJHQzID0gX3RoaXMkdGhpcmRUcklkRGF0YSR0Mi52YWx1ZVtyb3dJbmRleF0pID09PSBudWxsIHx8IF90aGlzJHRoaXJkVHJJZERhdGEkdDMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzJHRoaXJkVHJJZERhdGEkdDMudmFsdWUpICE9PSBudWxsICYmIF90aGlzJHRoaXJkVHJJZERhdGEkdCAhPT0gdm9pZCAwID8gX3RoaXMkdGhpcmRUcklkRGF0YSR0IDogMCk7CiAgICAgICAgICAgIGlmICghX3ZhbCkgewogICAgICAgICAgICAgIHRoaXMucmVwb3J0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIF92YWwgPSBpc05hTihfdmFsKSA/IDAgOiBfdmFsOwogICAgICAgICAgICBldmFsU3RyaW5nID0gZXZhbFN0cmluZy5yZXBsYWNlKCJ7IiArIGxpc3RlbkNvbHVtbiArICJ9IiwgX3ZhbCk7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICBfaXRlcmF0b3IuZShlcnIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBfaXRlcmF0b3IuZigpOwogICAgICAgIH0KICAgICAgICB2YXIgdmFsID0gZXZhbChldmFsU3RyaW5nKTsKCiAgICAgICAgLy8gdG9kbyBvcHRpbWl6ZSBxaWxpc2gga2VyYWsuIHYtbW9kZWwgYmlsYW4gcWlsaXNoIGtlcmFrCiAgICAgICAgdGhpcy4kc2V0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICJyb3dJZCI6IHJvd0lkLAogICAgICAgICAgImNvbHVtbklkIjogZG9jVGFibGVGb3JtdWxhLnRhcmdldENvbHVtbklkLnRvU3RyaW5nKCkKICAgICAgICB9KSksICJ2YWx1ZSIsIHZhbCk7CiAgICAgICAgdGhpcy5zZXRWYWx1ZShyb3dJZCwgdmFsLCByb3dJbmRleCwgdGhpcy50ckNvbHVtbklkT25Eb2NDb2x1bW5JZE1hcFtkb2NUYWJsZUZvcm11bGEudGFyZ2V0Q29sdW1uSWRdLCBkb2NUYWJsZUZvcm11bGEudGFyZ2V0Q29sdW1uSWQsIHR5cGVDb2RlKTsKICAgICAgfQogICAgfSwKICAgIHRyZWVDbG9zZWQ6IGZ1bmN0aW9uIHRyZWVDbG9zZWQodmVlTmFtZSkgewogICAgICB0aGlzLmNvbXB1dGVkT2JzZXJ2ZXIucmVmc1t2ZWVOYW1lXS52YWxpZGF0ZSgpOwogICAgfSwKICAgIHNlbGVjdEN1c3RvbUxhYmVsOiBmdW5jdGlvbiBzZWxlY3RDdXN0b21MYWJlbChfcmVmMTcpIHsKICAgICAgdmFyIG5hbWVVeiA9IF9yZWYxNy5uYW1lVXosCiAgICAgICAgbmFtZUx0ID0gX3JlZjE3Lm5hbWVMdCwKICAgICAgICBuYW1lUnUgPSBfcmVmMTcubmFtZVJ1LAogICAgICAgIG5hbWUgPSBfcmVmMTcubmFtZSwKICAgICAgICBmdWxsTmFtZSA9IF9yZWYxNy5mdWxsTmFtZTsKICAgICAgaWYgKG5hbWVVeikgewogICAgICAgIHJldHVybiB0aGlzLmdldE5hbWUoewogICAgICAgICAgbmFtZVV6OiBuYW1lVXosCiAgICAgICAgICBuYW1lTHQ6IG5hbWVMdCwKICAgICAgICAgIG5hbWVSdTogbmFtZVJ1CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgaWYgKGZ1bGxOYW1lKSB7CiAgICAgICAgcmV0dXJuIGZ1bGxOYW1lOwogICAgICB9CiAgICAgIHJldHVybiBuYW1lOwogICAgfQogIH0KfTs="},{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AACA;AACA;AACA;AAEA;AACA;EACAA;IACAC;MACAC;MACAC;IACA;EACA;EACAC;IAAAC;EAAA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACA;MACAC;MACAC;MACAC;MACAC;MACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACA;MACAC;MACAC;MAEAC;MACAC;MACAC;MAEAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACAlB;MACA;QACA;QACA;UACA;QACA;MACA;IACA;EACA;EACAmB;IACAC;MACA;QAAA;MAAA;MACA;QACA;MACA;QACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;QACA;UACAC;QACA;UACAA;QACA;QACA;MACA;MACA;QACA;MACA;QACA;MACA;IAEA;IACAC;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACA;gBAAAC;cAAA;YAAA;cAAA;cAAA,OACA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IACA;IACAC;MAAA;MAAA;QAAA;UAAA;YAAA;cACA;cACA;gBAAA;kBAAA;oBAAA;sBAAA;wBACA;0BACA;wBACA;sBAAA;sBAAA;wBAAA;oBAAA;kBAAA;gBAAA,CACA;gBAAA;kBAAA;gBAAA;cAAA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IACA;IACAC;MAAA;MACAC,4CACAC;QAAA;UAAA;YAAA;cAAA;gBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA,CACA;QAAA;UAAA;QAAA;MAAA,KACAC;QACA;MAAA,CACA;IACA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cACAC;gBAAA;cAAA;cACA;gBACA;kBAAA;oBAAA;sBAAA;wBAAA;0BAAA,KACAC;4BAAA;4BAAA;0BAAA;0BAAA;0BAAA,OACAL,8CACAC;4BAAA;8BAAA;gCAAA;kCAAA;oCACA;oCACA;oCAAA;oCAAA,OACA;kCAAA;oCAAA;oCAAA,OACA;kCAAA;oCAAA;oCAAA,OACA;sCAAA;oCAAA;kCAAA;kCAAA;oCAAA;gCAAA;8BAAA;4BAAA,CACA;4BAAA;8BAAA;4BAAA;0BAAA,KACAC;4BACA;0BAAA,CACA,EACAI;4BAAA;8BAAA;gCAAA;kCAAA;kCAAA,OACA;gCAAA;gCAAA;kCAAA;8BAAA;4BAAA;0BAAA,CACA;wBAAA;wBAAA;0BAAA;sBAAA;oBAAA;kBAAA,CAGA;kBAAA;oBAAA;kBAAA;gBAAA;cACA;gBACA;kBAAA;oBAAA;oBAAA;sBAAA;wBAAA;0BAAA,KACAD;4BAAA;4BAAA;0BAAA;0BACAE;0BACA;4BACAC;8BACA;gCACA;kCACAC;kCACAA;kCACAA;kCACAA;kCACAA;gCACA;kCACAA;kCACAA;kCACAA;kCACAA;kCACAA;gCACA;kCACAA;kCACAA;kCACAA;kCACAA;kCACAA;gCACA;kCACAA;kCACAA;kCACAA;kCACAA;kCACAA;gCACA;kCACAA;kCACAA;kCACAA;kCACAA;kCACAA;gCACA;kCACAA;kCACAA;kCACAA;kCACAA;gCACA;gCACAF;gCACA;8BACA;4BACA;4BACA;0BACA;0BACA;0BAAA;0BAAA,OACA;wBAAA;0BAAA;0BAAA,OACA;wBAAA;0BACAA;4BAAA;0BAAA;0BAAA;0BAAA,OACA;wBAAA;wBAAA;0BAAA;sBAAA;oBAAA;kBAAA,CAEA;kBAAA;oBAAA;kBAAA;gBAAA;cAGA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IACA;IAEAG;MACA;QACA;MACA;IACA;IACAC;MAAA;MAAA;QAAA;UAAA;YAAA;cACAC;cACA;gBAAA;kBAAA;oBAAA;sBAAA;sBAAA,OACA;oBAAA;oBAAA;sBAAA;kBAAA;gBAAA;cAAA,CACA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IACA;IACAC;MACA;MACA;MACA;MACA;IACA;IACAC;MAAA;MAAA;QAAA;UAAA;YAAA;cACA;cAAA;cAAA,OACAC,kFACAd;gBAAA;gBACA;gBACA;gBACA;gBACA;kBACA;oBAAA;kBAAA;kBACA;oBACA;kBACA;gBACA;cACA,GACAC;gBACAc;gBACA;cACA,GACAV;gBACA;cACA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IACA;IACAW;MACA;QAAA;MAAA;MACA;QACA,8CACAC,kBACA;UACAC;UACAC;UACAC;QACA,KAEAH;MAEA;MACA;IACA;IACA;IACAI;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IACAC;MACA;MACA;QACA;UACAC;UACA;UACA;YACA;YACA;YACA,wCACAC;cACAvC;cACAC;YACA,GACA;YACA;cACAuC;YACA;UACA;QACA;UACAF;UACA;YACA;YACA;YACA,sCACAC;cACAvC;cACAC;YACA,GACA;YACA;cACAwC;YACA;UACA;UACA;QACA;UACAH;UACA;UACA;YACA;YAEA;YACA,wCACAC;cACAvC;cACAC;YACA,GACA;YACA;cACA;gBACA;gBACA;kBACA;kBACA;oBACA,oCACAsC;sBACAvC;sBACAC;oBACA,GACA;oBACA;sBACA;oBACA;sBACA;wBACAyC;sBACA;sBACA;oBACA;kBACA;gBACA;cACA;gBACAC;cACA;YACA;UACA;QACA;UACA;UACAL;UACA;YACA;YACA;YACA,wCACAC;cACAvC;cACAC;YACA,GACA;YACA;cACA;gBACA;gBACA;kBACA;kBAEA,qCACAsC;oBACAvC;oBACAC;kBACA,GACA;kBACA;oBACA;kBACA;oBACA;sBACAyC;oBACA;oBACA;kBACA;gBACA;cACA;gBACAE;cACA;YACA;UACA;QACA;MACA;IACA;IACAC;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACA;YAAA;cAAA;cAAA,OACA;YAAA;cAAA;cAAA,OACA;YAAA;cAAA;cAAA,OACA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAEA;IACAC;MACA;MACA;MACA;IACA;IACAC;MACA;QACA;UACAzB;QACA;MACA;IACA;IACA0B;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;;MAEA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IAGAC;MACA;MACA;MACA;MACA;IACA;IACAC;MAAA;MACA;QACA;UACApC,4CACAC;YAAA;YACA;YACAoC;UACA,GACAnC;YAAA;UAAA;QACA;UACAoC;QACA;MACA;IACA;IACAC;MACA;QACAvC,0BACAC;UAAA;UACAoC;QACA,GACAnC;UAAA;QAAA;MACA;IACA;IACAsC;MACA;MACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IACAC;MAAA;MAAA;MAAA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACA;QACA;UAAA;QAAA;QACA;UACA;YACAxD;YACAyD;YACAC;YACAC;YACAC;YACAC;YACAC;YACAC;YACAC;YACAC;YACAhE;YACAiE;UACA;UACA;UACA;UACA;UACA;QACA;MACA;QACA;UACAT;UACAA;UACAA;UACAA;UACAA;UACAA;UACAA;UACAA;QACA;QAEA;UACAzD;UACAyD;UACAC;UACAC;UACAC;UACAC;UACAC;UACAC;UACAC;UACAC;UACAhE;UACAiE;QACA;MACA;MAEAC;QACA;UACA;YACA;cAAA;YAAA;YACA;cAAA;YAAA;YACA,IACAC,iBACAC,iBACAC,8DACA;cAEA;cACAH;gBACA,4CACA;kBAAA;gBAAA,EACA;gBAEA,IACAI,mBACAD,+DACA;kBACA,kCACA;oBACA;sBACAE;oBACA;sBACAA;oBACA;kBACA;kBAEA;kBACA,gDACA;oBAAA;kBAAA,EACA;kBACA;oBACAxE;oBACAyD;oBACAQ;oBACAhE;kBACA;kBACA;gBACA;cACA;YACA;UACA;QACA;UACA;YACA,0CACA;cAAA;YAAA,EACA;YACA,0CACA;cAAA;YAAA,EACA;YACA;cACA;cACAkE;gBACA,4CACA;kBAAA;gBAAA,EACA;gBACA;kBACA,kCACA;oBACA;sBACAK;oBACA;sBACAA;oBACA;kBACA;gBACA;gBACA;gBACA,gDACA;kBAAA;gBAAA,EACA;gBACA;kBACAxE;kBACAyD;kBACAQ;kBACAhE;gBACA;gBACA;cACA;YACA;UACA;QACA;MACA;MAEA;IAEA;IACAwE;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cACA;cACA;cACA;gBACA1G;kBACA;oBACA;sBACAoG;wBACA;0BACA,IACAG,wEACAA,gEACA;4BACA;8BAAA;4BAAA;4BACA;8BAAA;4BAAA;4BACA;0BACA;wBACA;sBACA;oBACA;sBACA;wBACA;0BAAA;wBAAA;wBACA;0BACA;4BACA;8BACAI;4BACA;0BACA;wBACA;0BACA;4BACAzE;4BACA0E;0BACA;wBACA;sBACA;sBAEAR,SACAS;wBACAhF;0BACA;4BAAA;0BAAA;0BACA;4BACA;4BACA;4BACA8C;4BACAA;0BACA;wBACA;wBAEA;0BACA,IACA4B,wEACAA,gEACA;4BACA;0BACA;wBACA;0BACA,IACAA,sEACA;4BACA;0BACA;wBACA;sBACA;oBACA;kBACA;oBACAH;sBACA;wBACA,IACAG,wEACAA,gEACA;0BACA;4BAAA;0BAAA;0BACA;4BAAA;0BAAA;0BACA;wBACA;sBACA;oBACA;kBACA;oBACAH;sBACA;sBACA;wBACA,IACAG,gFACAA,wEACA;0BACA;4BAAA;0BAAA;0BACA;4BAAA;0BAAA;0BACA;wBACA;sBACA;oBACA;kBACA;oBACAH;sBACA;wBACA,IACAG,wEACAA,gEACA;0BACA;4BAAA;0BAAA;0BACA;4BAAA;0BAAA;0BACA,iBACAhD,SACA;4BACAa;4BACAD;4BACAD;4BACAtB;0BACA;wBACA;sBACA;oBACA;kBACA;gBACA;cACA;gBACAwD,SACAS,oCACAC;kBACAjF;oBACA,+CACA;sBAAA;oBAAA,EACA;oBACA;sBACA;sBACA;sBACA8C;sBACAA;oBACA;kBACA;gBACA;cACA;cACA;gBACAoC;gBACAA;kBACAC;kBACAA;gBACA;cACA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IACA;IACAC;MAAA;MAAA;QAAA;UAAA;YAAA;cACA;cACA;cACA;cACA;cACA;cAAA;cAAA,OACAlE;gBAAA;gBACA;gBACA;cACA;YAAA;cAAA;cAAA,OACAA,+CACAC;gBAAA;kBAAA;oBAAA;sBAAA;wBAAA,KACAI;0BAAA;0BAAA;wBAAA;wBAAA;wBAAA,OACA;sBAAA;wBACA;wBACA;wBACA8D;0BACAC,aACA,+BACA,wBACA;4BAAA;8BAAAnH;8BAAA6B;4BACA;4BACA;4BACA;4BACA;0BACA;wBACA;sBAAA;sBAAA;wBAAA;oBAAA;kBAAA;gBAAA,CAEA;gBAAA;kBAAA;gBAAA;cAAA,KACAoB;gBACA;cACA;YAAA;cAAA;cAAA,OACAF;gBAAA;gBACA;gBACA;gBACA;gBACA;kBACA;oBACAqE;oBACA;sBACAC;sBACAC;sBACAC;sBACAC;oBACA;kBACA;kBACA;kBACA;oBACA;sBACA;oBACA;oBACA;sBACA;oBACA;sBACA;wBACA;sBACA;oBACA;kBACA;kBACA;oBACA;kBACA;oBACA;kBACA;gBACA;cACA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IACA;IAEAC;MAAA;MAAA;QAAA;UAAA;YAAA;cACA;cACA;cACA;cACA;cACAC;gBACA;gBACAC;kBACA;kBACAC;oBACA;sBAAAC;oBAAA;kBACA;gBACA;cACA;cACAX;gBAAA;gBAAA;kBAAA;oBAAA;sBACAY;sBACAC;sBACAC;sBACAC,cACAC;sBAAA;sBAAA,OACAJ;wBAAA;0BAAA;0BAAA;4BAAA;8BAAA;gCAAA,MACAK;kCAAA;kCAAA;gCAAA;gCAAA;kCAAA;kCAAA;oCAAA;sCAAA;wCAAA,MAEAJ;0CAAA;0CAAA;wCAAA;wCAAA;0CAAA;0CAAA;4CAAA;8CAAA;gDAMAK;gDACAC;kDACAnG;kDACAgE;kDACAoC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACA9G;kDACAyD;gDACA,GACA;gDACA;kDACA;oDACA2C;sDAAAW;oDAAA;kDACA;kDACAlF,uGACAd;oDACA;sDAAA;sDACA;oDACA;sDAAA;sDACA;oDACA;oDACAqF;oDACAA;oDACA;AACA;AACA;AACA;AACA;AACA;kDACA,GACApF;oDACAc;oDACA;kDACA,GACAV;oDACA;kDAAA,CACA;gDACA;gDACA;gDACA6E;8CAAA;8CAAA;gDAAA;4CAAA;0CAAA;wCAAA;wCAnDAe;sCAAA;wCAAA,MACAA;0CAAA;0CAAA;wCAAA;wCAAA;sCAAA;wCACAA;wCAAA;wCAAA;sCAAA;wCAmDAhB;wCAAA;wCAAA;sCAAA;wCAAA,MAGAF,wBACAA;0CAAA;0CAAA;wCAAA;wCAEAK;wCACAC;0CACAnG;0CACAgE;0CACAoC;0CACAC;0CACAC;0CACAC;0CACAC;0CACAC;0CACAC;0CACAC;0CACAC;0CACAC;0CACA9G;0CACAyD;wCACA,GACA;wCACA;0CACA;4CACA2C;8CAAAW;4CAAA;0CACA;0CACAlF,uGACAd;4CACA;8CAAA;8CACA;4CACA;8CAAA;8CACA;4CACA;4CACAqF;4CACAA;4CACA;AACA;AACA;AACA;AACA;AACA;0CACA,GACApF;4CACAc;4CACA;0CACA,GACAV;4CACA;0CAAA,CACA;wCACA;wCACA;wCACA4E;wCAAA;wCAAA;sCAAA;wCAAA,KAEAF;0CAAA;0CAAA;wCAAA;wCAAA;0CAAA;0CAAA;4CAAA;8CAAA;gDAMAK;gDACAC;kDACAnG;kDACAgE;kDACAoC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACA9G;kDACAyD;gDACA,GACA;gDACA;kDACA;oDACA2C;sDAAAW;oDAAA;kDACA;kDACAlF,uGACAd;oDACA;sDAAA;sDACA;oDACA;sDAAA;sDACA;oDACA;oDACAqF;oDACAA;oDACA;AACA;AACA;AACA;AACA;AACA;kDACA,GACApF;oDACAc;oDACA;kDACA,GACAV;oDACA;kDAAA,CACA;gDACA;gDACA;gDACA6E;8CAAA;8CAAA;gDAAA;4CAAA;0CAAA;wCAAA;wCAnDAe;sCAAA;wCAAA,MACAA;0CAAA;0CAAA;wCAAA;wCAAA;sCAAA;wCACAA;wCAAA;wCAAA;sCAAA;wCAoDAhB;sCAAA;sCAAA;wCAAA;oCAAA;kCAAA;gCAAA;gCAvKAiB;8BAAA;gCAAA;kCAAA;kCAAA;gCAAA;gCAAA;8BAAA;gCAAAA;gCAAA;gCAAA;8BAAA;gCAAA;gCAAA;8BAAA;gCAAA,KA6KAf;kCAAA;kCAAA;gCAAA;gCACAC;gCACAC;kCACAnG;kCACAgE;kCACAoC;kCACAC;kCACAC;kCACAC;kCACAC;kCACAC;kCACAC;kCACAC;kCACAC;kCACAC;kCACA9G;kCACAyD;gCACA,GACA;gCACA;kCACA;oCACA2C;sCAAAW;oCAAA;kCACA;kCACAlF,uGACAd;oCACA;sCAAA;sCACA;oCACA;sCAAA;sCACA;oCACA;oCACAqF;oCACAA;oCACA;AACA;AACA;AACA;AACA;AACA;kCACA,GACApF;oCACAc;oCACA;kCACA,GACAV;oCACA;kCAAA,CACA;gCACA;gCACA;gCAAA;gCAAA;8BAAA;gCAAA;kCAAA;kCAAA;oCAAA;sCAAA;wCAAA,MAGA0E;0CAAA;0CAAA;wCAAA;wCAAA;0CAAA;0CAAA;4CAAA;8CAAA;gDAMAK;gDACAC;kDACAnG;kDACAgE;kDACAoC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACA9G;kDACAyD;gDACA,GACA;gDACA;kDACA;oDACA2C;sDAAAW;oDAAA;kDACA;kDACAlF,uGACAd;oDACA;sDAAA;sDACA;oDACA;sDAAA;sDACA;oDACA;oDACAqF;oDACAA;oDACA;AACA;AACA;AACA;AACA;AACA;kDACA,GACApF;oDACAc;oDACA;kDACA,GACAV;oDACA;kDAAA,CACA;gDACA;gDACA;gDACA6E;8CAAA;8CAAA;gDAAA;4CAAA;0CAAA;wCAAA;wCAnDAe;sCAAA;wCAAA,MACAA;0CAAA;0CAAA;wCAAA;wCAAA;sCAAA;wCACAA;wCAAA;wCAAA;sCAAA;wCAmDAhB;wCAAA;wCAAA;sCAAA;wCAAA,MAGAF,wBACAA;0CAAA;0CAAA;wCAAA;wCAEAK;wCACAC;0CACAnG;0CACAgE;0CACAoC;0CACAC;0CACAC;0CACAC;0CACAC;0CACAC;0CACAC;0CACAC;0CACAC;0CACAC;0CACA9G;0CACAyD;wCACA,GACA;wCACA;0CACA;4CACA2C;8CAAAW;4CAAA;0CACA;0CACAlF,0GACAd;4CACA;8CAAA;8CACA;4CACA;8CAAA;8CACA;4CACA;4CACAqF;4CACAA;4CACA;AACA;AACA;AACA;AACA;AACA;0CACA,GACApF;4CACAc;4CACA;0CACA,GACAV;4CACA;0CAAA,CACA;wCACA;wCACA;wCACA4E;wCAAA;wCAAA;sCAAA;wCAAA,KAEAF;0CAAA;0CAAA;wCAAA;wCAAA;0CAAA;0CAAA;4CAAA;8CAAA;gDAMAK;gDACAC;kDACAnG;kDACAgE;kDACAoC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACAC;kDACA9G;kDACAyD;gDACA,GACA;gDACA;kDACA;oDACA2C;sDAAAW;oDAAA;kDACA;kDACAlF,uGACAd;oDACA;sDAAA;sDACA;oDACA;sDAAA;sDACA;oDACA;oDACAqF;oDACAA;oDACA;AACA;AACA;AACA;AACA;AACA;kDACA,GACApF;oDACAc;oDACA;kDACA,GACAV;oDACA;kDAAA,CACA;gDACA;gDACA;gDACA6E;8CAAA;8CAAA;gDAAA;4CAAA;0CAAA;wCAAA;wCAnDAe;sCAAA;wCAAA,MACAA;0CAAA;0CAAA;wCAAA;wCAAA;sCAAA;wCACAA;wCAAA;wCAAA;sCAAA;wCAmDAhB;sCAAA;sCAAA;wCAAA;oCAAA;kCAAA;gCAAA;gCAtKAiB;8BAAA;gCAAA;kCAAA;kCAAA;gCAAA;gCAAA;8BAAA;gCAAAA;gCAAA;gCAAA;8BAAA;8BAAA;gCAAA;4BAAA;0BAAA;wBAAA,CA6KA;wBAAA;0BAAA;wBAAA;sBAAA;oBAAA;oBAAA;sBAAA;kBAAA;gBAAA;cAAA,CACA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IACA;IACAC;MACA;MACA;MACA;QACA;UAAAvG;QAAA;MACA;IACA;IACAwG;MACA,gCACA,IACAC,yDACA,IACA;IACA;IACAC;MACA;QAAA;MAAA;MACA;QAAA;MAAA;MACA,qDACAD,qBACAA,6CACAE,sCACA;IACA;IACAC;MACA,kEACA,IACAH,0DACA,IACA;IACA;IACAI;MACA;IACA;IACAC;MACA,gCACA,KACAL,yDACA,cACA;IACA;IACAM;MACA,kEACA,cACAN,0DACA,cACA;IACA;IACAO;MACA;QACA;QACA;UACAhH;UACAiH;YACA3F;YACAC;YACAC;UACA;QACA;MACA;MACA;QACAxB;QACAiH;UACA3F;UACAC;UACAC;QACA;QACA0F;MACA;IACA;IACAC;MACA;;MAEA;QACA;MACA;MACA;MACA;QACA;QACA;QAAA,2CACAC;UAAA;QAAA;UAAA;YAAA;YAAA;YACA;YACA;YACA;cACA;YACA;YACAC;YACAC;UACA;QAAA;UAAA;QAAA;UAAA;QAAA;QACA;;QAEA;QACA;UACA;UACA;QACA;QAEA;MACA;IACA;IACAC;MACA;IACA;IACAC;MAAA;QAAAjG;QAAAD;QAAAmG;QAAAC;MACA;QACA;UAAAlG;UAAAD;UAAAD;QAAA;MACA;MACA;QACA;MACA;MACA;IACA;EACA;AACA","names":["props","isGenerated","type","default","components","Checkbox","data","lastReportData","lastReportDataRows","lastReportFormulas","debounce","okeds","hasNextPageOked","isLoadingOked","okedSearchPayload","f1Ids","f2Ids","fRowId","tableId","tableInfo","reportId","selectedColumns","selectedRows","firstColumns","secondColumns","thirdColumns","thirdTrIdData","currentRowId","invalidEntries","currentItemData","showData","loader","showResult","report","table","formulas","currentPosition","rowIndex","columnIndex","rowId","columnId","docTableFormulasList","docTableFormulasListenColumnId","trColumnIdOnDocColumnIdMap","watch","methods","getColumnData","getRandomInt","bool","addNewRow","id","closeReport","stopFormingRows","Service","then","catch","deleteRow","findElement","rs","finally","newThirdTrIdData","e","d","dynamicRefsReachedEndOfList","debounceSearchDynamicRefs","clearTimeout","fetchDynamicRefsWithKeyword","fetchDynamicRefs","crudAndListsService","console","customLabelDynamicRef","selected","nameRu","nameLt","nameUz","clearAll","keydownEvt","evt","JSON","downInput","upInput","input","prevInput","nextInput","resetIndex","setError","keyUpEventsDisable","keyUpEvents","focusVal","getFormulas_2","res","rej","getDataById","editValue","resetValue","setValue","value","selectValueId","selectValueNameUz","selectValueNameLt","selectValueNameRu","originalSelectValueNameUz","originalSelectValueNameLt","originalSelectValueNameRu","typeCode","notEditable","document","index_f2","index_f1","parseFloat","e_index_f2","allVal","setDocumentColumnValues","f","columnData","getElementsByClassName","forEach","disabledElements","element","getById","setTimeout","Promise","currentTargetColumnId","eval","list","listenColumns","targetColumnId","setColumns","v","el1","el2","fId","firstTrTh","secondTrTh","thirdTrTh","counter2","counter3","th","array","tmp","refCode","referenceUrl","referenceAppendUrl","referenceCode","referenceNameUz","referenceNameLt","referenceNameRu","searchPayload","hasNextPage","options","selectedItem","index3","index2","setRow","rowspanFirst","el","colspanFirst","totalNotChild","rowspanSecond","colspanSecond","rowspanFirstClass","rowspanSecondClass","normalizer","label","children","calculateDocFormulas","docTableFormula","val","evalString","treeClosed","selectCustomLabel","name","fullName"],"sourceRoot":"src/modules/report/organizitional/components","sources":["editReportDynamicModal.vue"],"sourcesContent":["<script>\r\nimport Service from \"@/modules/report/reportService\";\r\nimport crudAndListsService from \"@/shared/services/crud_and_list.service\"\r\nimport Checkbox from \"vue-material-checkbox\";\r\n\r\nconst OKED_API_URL = 'reestr/info-oked'\r\nexport default {\r\n  props: {\r\n    isGenerated: {\r\n      type: Boolean,\r\n      default: false\r\n    }\r\n  },\r\n  components: { Checkbox },\r\n  data() {\r\n    return {\r\n      lastReportData: [],\r\n      lastReportDataRows: [],\r\n      lastReportFormulas: [],\r\n      debounce: null,\r\n      // OKED VARIABLES\r\n      okeds: [],\r\n      hasNextPageOked: false,\r\n      isLoadingOked: false,\r\n      okedSearchPayload: {},\r\n      // ----------------\r\n      f1Ids: [],\r\n      f2Ids: [],\r\n      fRowId: null,\r\n      tableId: null,\r\n      tableInfo: {},\r\n      reportId: null,\r\n      // getName: getName,\r\n      selectedColumns: [],\r\n      selectedRows: [],\r\n\r\n      firstColumns: [],\r\n      secondColumns: [],\r\n      thirdColumns: [],\r\n\r\n      thirdTrIdData: [],\r\n      currentRowId: null,\r\n      invalidEntries: 0,\r\n      currentItemData: [],\r\n      showData: [],\r\n      loader: false,\r\n      showResult: false,\r\n      report: {},\r\n      table: {},\r\n      formulas: [],\r\n      currentPosition: {\r\n        rowIndex: null,\r\n        columnIndex: null,\r\n        rowId: null,\r\n        columnId: null,\r\n      },\r\n      docTableFormulasList: {},\r\n      docTableFormulasListenColumnId: {},\r\n      trColumnIdOnDocColumnIdMap: {},\r\n    };\r\n  },\r\n  watch: {\r\n    thirdTrIdData: function (newThirdTrIdData) {\r\n      if (typeof newThirdTrIdData === 'object' && newThirdTrIdData.length > 0) {\r\n        let length = newThirdTrIdData.length;\r\n        for (let i = 0; i < length; i++) {\r\n          this.trColumnIdOnDocColumnIdMap[newThirdTrIdData[i].columnId] = i\r\n        }\r\n      }\r\n    },\r\n  },\r\n  methods: {\r\n    getColumnData(i) {\r\n      let found = this.showData.find((e) => e.columnId == i.columnId)\r\n      if (found) {\r\n        return found.columnData\r\n      } else {\r\n        return \"\"\r\n      }\r\n    },\r\n    // DYNAMIC_REFERENCES METHODS\r\n    getRandomInt() {\r\n      let number = Math.floor(Math.random() * 10000000);\r\n      let bool = true\r\n      this.selectedRows.find(el => {\r\n        if (el.id == number) {\r\n          bool = false\r\n        } else if (el.id == number) {\r\n          bool = false\r\n        }\r\n        return bool\r\n      })\r\n      if (bool) {\r\n        return number;\r\n      } else {\r\n        this.getRandomInt()\r\n      }\r\n\r\n    },\r\n    async addNewRow() {\r\n      await this.selectedRows.push({ id: this.getRandomInt() })\r\n      await this.setDocumentColumnValues(this.lastReportData, this.lastReportFormulas)\r\n    },\r\n    async closeReport() {\r\n      this.$emit(\"closedReportLoader\");\r\n      this.cnf().then(async (rs) => {\r\n        if (rs.value) {\r\n          this.$emit('save', true)\r\n        }\r\n      });\r\n    },\r\n    stopFormingRows() {\r\n      Service.stopFormingTheReport(this.reportId)\r\n          .then(async (rs) => {\r\n            this.$set(this.tableInfo, 'hasDynamicRows', false)\r\n            // await this.deleteSuccess();\r\n          })\r\n          .catch((err) => {\r\n            // this.catchErr(err);\r\n          });\r\n    },\r\n    async deleteRow(index, data) {\r\n      let findElement = this.lastReportDataRows.findIndex(el => el.id == data.id)\r\n      if (findElement > -1) {\r\n        this.cnf().then(async (rs) => {\r\n          if (rs.value) {\r\n            await Service.deleteRowId(data.id, this.reportId)\r\n                .then(async (rs) => {\r\n                  // await this.deleteSuccess();\r\n                  this.selectedRows.splice(index, 1)\r\n                  await this.$forceUpdate()\r\n                  await this.resetIndex()\r\n                  await this.setDocumentColumnValues(this.lastReportData.filter(e => e.rowId != data.id), this.lastReportFormulas)\r\n                })\r\n                .catch((err) => {\r\n                  // this.catchErr(err);\r\n                })\r\n                .finally(async () => {\r\n                  await this.getById(this.tableId, this.reportId, this.tableInfo)\r\n                })\r\n            ;\r\n          }\r\n        });\r\n      } else {\r\n        this.cnf().then(async (rs) => {\r\n          if (rs.value) {\r\n            let newThirdTrIdData = []\r\n            this.thirdTrIdData = this.thirdTrIdData.map((e) => {\r\n              e.value = e.value.filter(d => {\r\n                if (d && d.rowId != data.id) {\r\n                  if (d.typeCode === \"BOOLEAN\") {\r\n                    d.valueBoolean = d.value\r\n                    d.valueString = null\r\n                    d.valueBigDecimal = null\r\n                    d.valueDate = null\r\n                    d.selectValueNameUz = null\r\n                  } else if (d.typeCode === \"STRING\") {\r\n                    d.valueString = d.value\r\n                    d.valueBigDecimal = null\r\n                    d.valueDate = null\r\n                    d.valueBoolean = null\r\n                    d.selectValueNameUz = null\r\n                  } else if (d.typeCode === \"BIGDECIMAL\") {\r\n                    d.valueBigDecimal = d.value\r\n                    d.valueString = null\r\n                    d.valueDate = null\r\n                    d.valueBoolean = null\r\n                    d.selectValueNameUz = null\r\n                  } else if (d.typeCode === \"DATE\") {\r\n                    d.valueDate = d.value\r\n                    d.valueString = null\r\n                    d.valueBigDecimal = null\r\n                    d.valueBoolean = null\r\n                    d.selectValueNameUz = null\r\n                  } else if (d.typeCode === \"YEAR\") {\r\n                    d.valueDate = null\r\n                    d.valueString = d.value\r\n                    d.valueBigDecimal = null\r\n                    d.valueBoolean = null\r\n                    d.selectValueNameUz = null\r\n                  } else if (d.typeCode === \"SELECT\") {\r\n                    d.valueString = null\r\n                    d.valueBigDecimal = null\r\n                    d.valueDate = null\r\n                    d.valueBoolean = null\r\n                  }\r\n                  newThirdTrIdData.push(d)\r\n                  return d\r\n                }\r\n              })\r\n              return e\r\n            })\r\n            this.selectedRows.splice(index, 1)\r\n            await this.$forceUpdate()\r\n            await this.resetIndex()\r\n            newThirdTrIdData.forEach(e => this.lastReportData.push(e))\r\n            await this.setDocumentColumnValues(this.lastReportData, this.lastReportFormulas)\r\n          }\r\n        });\r\n\r\n\r\n      }\r\n    },\r\n\r\n    dynamicRefsReachedEndOfList(e) {\r\n      if (e) {\r\n        this.fetchDynamicRefs()\r\n      }\r\n    },\r\n    async debounceSearchDynamicRefs(searchText) {\r\n      clearTimeout(this.debounce);\r\n      this.debounce = setTimeout(async () => {\r\n        await this.fetchDynamicRefsWithKeyword(searchText);\r\n      }, 1000);\r\n    },\r\n    fetchDynamicRefsWithKeyword(keyword) {\r\n      this.okeds = []\r\n      this.okedSearchPayload.page = 1\r\n      this.okedSearchPayload.keyword = keyword ? keyword : ''\r\n      this.fetchDynamicRefs()\r\n    },\r\n    async fetchDynamicRefs() {\r\n      this.isLoadingOked = true\r\n      await crudAndListsService.searchListWithKeyword(OKED_API_URL, this.okedSearchPayload)\r\n          .then(res => {\r\n            this.okeds.push(...res.data.list)\r\n            this.hasNextPageOked = res.data.total / this.okedSearchPayload.itemsPerPage > this.okedSearchPayload.page\r\n            this.okedSearchPayload.page += 1\r\n            if (!this.isModeCreate && this.editingItem.okedId) {\r\n              let foundItm = this.okeds.find(el => el.id == this.editingItem.okedId)\r\n              if (!foundItm && this.editingItem.infoOkedDto) {\r\n                this.okeds.push(this.editingItem.infoOkedDto)\r\n              }\r\n            }\r\n          })\r\n          .catch(e => {\r\n            console.log(e)\r\n            this.okeds = []\r\n          })\r\n          .finally(() => {\r\n            this.isLoadingOked = false\r\n          })\r\n    },\r\n    customLabelDynamicRef(opt) {\r\n      let selected = this.okeds.find(e => e.id == opt.id);\r\n      if (selected) {\r\n        return `${selected.code} - ${\r\n            selected.nameUz ?\r\n                this.getName({\r\n                  nameRu: selected.nameRu,\r\n                  nameLt: selected.nameLt,\r\n                  nameUz: selected.nameUz,\r\n                })\r\n                :\r\n                selected.name\r\n        }`\r\n      }\r\n      return ``;\r\n    },\r\n    // --------------------------\r\n    clearAll() {\r\n      this.selectedColumns = [];\r\n      this.selectedRows = [];\r\n      this.firstColumns = [];\r\n      this.secondColumns = [];\r\n      this.thirdColumns = [];\r\n      this.thirdTrIdData = [];\r\n      this.formulas = [];\r\n      this.table = [];\r\n      this.f1Ids = [];\r\n      this.f2Ids = [];\r\n    },\r\n    keydownEvt(evt, rowId, value, rowIndex, columnIndex, columnId, typeCode) {\r\n      this.keyUpEventsDisable(evt);\r\n      if (columnId != null) {\r\n        if (evt.keyCode == 40 && rowId != null) {\r\n          evt.preventDefault();\r\n          // down\r\n          if (rowIndex < this.selectedRows.length - 1) {\r\n            let currentColumn = this.thirdTrIdData[columnIndex];\r\n            let downRowColumn = this.selectedRows[rowIndex + 1];\r\n            let downInput = document.getElementById(\r\n                JSON.stringify({\r\n                  rowId: downRowColumn.id,\r\n                  columnId: currentColumn.columnId,\r\n                })\r\n            );\r\n            if (downInput) {\r\n              downInput.focus();\r\n            }\r\n          }\r\n        } else if (evt.keyCode == 38 && rowId != null) {\r\n          evt.preventDefault();\r\n          if (rowIndex != 0) {\r\n            let currentColumn = this.thirdTrIdData[columnIndex];\r\n            let upRowColumn = this.selectedRows[rowIndex - 1];\r\n            let upInput = document.getElementById(\r\n                JSON.stringify({\r\n                  rowId: upRowColumn.id,\r\n                  columnId: currentColumn.columnId,\r\n                })\r\n            );\r\n            if (upInput) {\r\n              upInput.focus();\r\n            }\r\n          }\r\n          //up\r\n        } else if (evt.keyCode == 37) {\r\n          evt.preventDefault();\r\n          //left\r\n          if (columnIndex != 0) {\r\n            let prevColumn = this.thirdTrIdData[columnIndex - 1];\r\n\r\n            let currentRow = this.selectedRows[rowIndex];\r\n            let prevInput = document.getElementById(\r\n                JSON.stringify({\r\n                  rowId: currentRow.id,\r\n                  columnId: prevColumn.columnId,\r\n                })\r\n            );\r\n            if (prevInput) {\r\n              if (prevInput.disabled) {\r\n                let count = this.thirdTrIdData.length - (columnIndex - 1);\r\n                for (let i = 0; i < count; i++) {\r\n                  let prevColumn2 = this.thirdTrIdData[columnIndex - 1 - i];\r\n                  if (prevColumn2) {\r\n                    let input = document.getElementById(\r\n                        JSON.stringify({\r\n                          rowId: currentRow.id,\r\n                          columnId: prevColumn2.columnId,\r\n                        })\r\n                    );\r\n                    if (input && input.disabled) {\r\n                      continue;\r\n                    } else {\r\n                      if (input) {\r\n                        input.focus();\r\n                      }\r\n                      break;\r\n                    }\r\n                  }\r\n                }\r\n              } else {\r\n                prevInput.focus();\r\n              }\r\n            }\r\n          }\r\n        } else if (evt.keyCode == 39) {\r\n          //right\r\n          evt.preventDefault();\r\n          if (this.thirdTrIdData.length - 1 > columnIndex) {\r\n            let nextColumn = this.thirdTrIdData[columnIndex + 1];\r\n            let currentRow = this.selectedRows[rowIndex];\r\n            let nextInput = document.getElementById(\r\n                JSON.stringify({\r\n                  rowId: currentRow.id,\r\n                  columnId: nextColumn.columnId,\r\n                })\r\n            );\r\n            if (nextInput) {\r\n              if (nextInput.disabled) {\r\n                let forCount = this.thirdTrIdData.length - (columnIndex + 1);\r\n                for (let i = 0; i < forCount; i++) {\r\n                  let nextColumn2 = this.thirdTrIdData[columnIndex + 1 + i];\r\n\r\n                  let input = document.getElementById(\r\n                      JSON.stringify({\r\n                        rowId: currentRow.id,\r\n                        columnId: nextColumn2.columnId,\r\n                      })\r\n                  );\r\n                  if (input.disabled) {\r\n                    continue;\r\n                  } else {\r\n                    if (input) {\r\n                      input.focus();\r\n                    }\r\n                    break;\r\n                  }\r\n                }\r\n              } else {\r\n                nextInput.focus();\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    async resetIndex() {\r\n      await this.$set(this.currentPosition, \"rowIndex\", null);\r\n      await this.$set(this.currentPosition, \"columnIndex\", null);\r\n      await this.$set(this.currentPosition, \"rowId\", null);\r\n      await this.$set(this.currentPosition, \"columnId\", null);\r\n      // await document.addEventListener(\"keydown\", this.keyUpEvents);\r\n    },\r\n    setError(f1, f2, frowId) {\r\n      this.f1Ids = f1;\r\n      this.f2Ids = f2;\r\n      this.fRowId = frowId;\r\n    },\r\n    keyUpEventsDisable(e) {\r\n      if (this.currentPosition.columnId != null) {\r\n        if (e.which === 38 || e.which === 40) {\r\n          e.preventDefault();\r\n        }\r\n      }\r\n    },\r\n    keyUpEvents(evt) {\r\n      this.keyUpEventsDisable(evt);\r\n      // if (this.currentPosition.columnId != null) {\r\n      //   if (evt.keyCode == 40 && this.currentPosition.rowId != null) {\r\n      //     evt.preventDefault();\r\n      //     // down\r\n      //     if (this.currentPosition.rowIndex < this.selectedRows.length - 1) {\r\n      //       let currentColumn =\r\n      //         this.thirdTrIdData[this.currentPosition.columnIndex];\r\n      //       let downRowColumn =\r\n      //         this.selectedRows[this.currentPosition.rowIndex + 1];\r\n      //       let downInput = document.getElementById(\r\n      //         JSON.stringify({\r\n      //           rowId: downRowColumn.id,\r\n      //           columnId: currentColumn.columnId,\r\n      //         })\r\n      //       );\r\n      //       if (downInput) {\r\n      //         downInput.focus();\r\n      //       }\r\n      //     }\r\n      //   } else if (evt.keyCode == 38 && this.currentPosition.rowId != null) {\r\n      //     evt.preventDefault();\r\n      //     if (this.currentPosition.rowIndex != 0) {\r\n      //       let currentColumn =\r\n      //         this.thirdTrIdData[this.currentPosition.columnIndex];\r\n      //       let upRowColumn =\r\n      //         this.selectedRows[this.currentPosition.rowIndex - 1];\r\n      //       let upInput = document.getElementById(\r\n      //         JSON.stringify({\r\n      //           rowId: upRowColumn.id,\r\n      //           columnId: currentColumn.columnId,\r\n      //         })\r\n      //       );\r\n      //       if (upInput) {\r\n      //         upInput.focus();\r\n      //       }\r\n      //     }\r\n      //     //up\r\n      //   } else if (evt.keyCode == 37) {\r\n      //     evt.preventDefault();\r\n      //     //left\r\n      //     if (this.currentPosition.columnIndex != 0) {\r\n      //       let prevColumn =\r\n      //         this.thirdTrIdData[this.currentPosition.columnIndex - 1];\r\n      //       let currentRow = this.selectedRows[this.currentPosition.rowIndex];\r\n      //       let prevInput = document.getElementById(\r\n      //         JSON.stringify({\r\n      //           rowId: currentRow.id,\r\n      //           columnId: prevColumn.columnId,\r\n      //         })\r\n      //       );\r\n      //       if (prevInput) {\r\n      //         if (prevInput.disabled) {\r\n      //           let count =\r\n      //             this.thirdTrIdData.length -\r\n      //             (this.currentPosition.columnIndex - 1);\r\n      //           for (let i = 0; i < count; i++) {\r\n      //             let prevColumn2 =\r\n      //               this.thirdTrIdData[\r\n      //                 this.currentPosition.columnIndex - 1 - i\r\n      //               ];\r\n      //             let input = document.getElementById(\r\n      //               JSON.stringify({\r\n      //                 rowId: currentRow.id,\r\n      //                 columnId: prevColumn2.columnId,\r\n      //               })\r\n      //             );\r\n      //             if (input && input.disabled) {\r\n      //               continue;\r\n      //             } else {\r\n      //               if (input) {\r\n      //                 input.focus();\r\n      //               }\r\n      //               break;\r\n      //             }\r\n      //           }\r\n      //         } else {\r\n      //           prevInput.focus();\r\n      //         }\r\n      //       }\r\n      //     }\r\n      //   } else if (evt.keyCode == 39) {\r\n      //     //right\r\n      //     evt.preventDefault();\r\n      //     if (\r\n      //       this.thirdTrIdData.length - 1 >\r\n      //       this.currentPosition.columnIndex\r\n      //     ) {\r\n      //       let nextColumn =\r\n      //         this.thirdTrIdData[this.currentPosition.columnIndex + 1];\r\n      //       let currentRow = this.selectedRows[this.currentPosition.rowIndex];\r\n      //       let nextInput = document.getElementById(\r\n      //         JSON.stringify({\r\n      //           rowId: currentRow.id,\r\n      //           columnId: nextColumn.columnId,\r\n      //         })\r\n      //       );\r\n      //       if (nextInput) {\r\n      //         if (nextInput.disabled) {\r\n      //           let forCount =\r\n      //             this.thirdTrIdData.length -\r\n      //             (this.currentPosition.columnIndex + 1);\r\n      //           for (let i = 0; i < forCount; i++) {\r\n      //             let nextColumn2 =\r\n      //               this.thirdTrIdData[\r\n      //                 this.currentPosition.columnIndex + 1 + i\r\n      //               ];\r\n\r\n      //             let input = document.getElementById(\r\n      //               JSON.stringify({\r\n      //                 rowId: currentRow.id,\r\n      //                 columnId: nextColumn2.columnId,\r\n      //               })\r\n      //             );\r\n      //             if (input.disabled) {\r\n      //               continue;\r\n      //             } else {\r\n      //               if (input) {\r\n      //                 input.focus();\r\n      //               }\r\n      //               break;\r\n      //             }\r\n      //           }\r\n      //         } else {\r\n      //           nextInput.focus();\r\n      //         }\r\n      //       }\r\n      //     }\r\n      //   }\r\n      // }\r\n    }\r\n    ,\r\n\r\n    focusVal(rowId, value, rowIndex, columnIndex, columnId, typeCode) {\r\n      this.$set(this.currentPosition, \"rowIndex\", parseFloat(rowIndex));\r\n      this.$set(this.currentPosition, \"columnIndex\", parseFloat(columnIndex));\r\n      this.$set(this.currentPosition, \"rowId\", parseFloat(rowId));\r\n      this.$set(this.currentPosition, \"columnId\", parseFloat(columnId));\r\n    },\r\n    getFormulas_2() {\r\n      return new Promise((res, rej) => {\r\n        if (this.tableId) {\r\n          Service.formulasByTableId_2(this.tableId)\r\n              .then(({ data }) => {\r\n                this.formulas = data;\r\n                res(data);\r\n              })\r\n              .catch((e) => rej(e));\r\n        } else {\r\n          rej();\r\n        }\r\n      });\r\n    },\r\n    getDataById(id) {\r\n      return new Promise((res, rej) => {\r\n        Service.getReportById(id)\r\n            .then(({ data }) => {\r\n              res(data);\r\n            })\r\n            .catch((e) => rej(e));\r\n      });\r\n    },\r\n    editValue(rowIndex, index) {\r\n      this.$set(this.thirdTrIdData[index].value[rowIndex], 'notEditable', false)\r\n      this.$forceUpdate();\r\n    },\r\n    resetValue(rowIndex, index) {\r\n      this.$set(this.thirdTrIdData[index].value[rowIndex], 'selectValueId', this.thirdTrIdData[index].value[rowIndex].originalSelectValueId)\r\n      this.$set(this.thirdTrIdData[index].value[rowIndex], 'selectValueNameUz', this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameUz)\r\n      this.$set(this.thirdTrIdData[index].value[rowIndex], 'selectValueNameLt', this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameLt)\r\n      this.$set(this.thirdTrIdData[index].value[rowIndex], 'selectValueNameRu', this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameRu)\r\n      this.$set(this.thirdTrIdData[index].value[rowIndex], 'notEditable', true)\r\n      this.$forceUpdate();\r\n    },\r\n    setValue(rowId, value, rowIndex, index, id, typeCode, notEditable = false, initialLoadCall = false) {\r\n      // value.rowId = rowId\r\n      // value.typeCode = typeCode\r\n      //\r\n      // value.notEditable = notEditable\r\n      // value.selectValueNameLt = value.nameLt\r\n      // value.selectValueNameRu = value.nameRu\r\n      // value.selectValueNameUz = value.nameUz\r\n      //\r\n      /* this.thirdTrIdData[index].value[rowIndex] = {\r\n        rowId: rowId ? rowId : null,\r\n        value: typeCode === 'SELECT' ? '' : value,\r\n        selectValueNameUz: value ? value.nameUz : null,\r\n        selectValueNameLt: value ? value.nameLt : null,\r\n        selectValueNameRu: value ? value.nameRu : null,\r\n        originalSelectValueNameUz: this.thirdTrIdData[index].value[rowIndex] ? this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameUz : '',\r\n        originalSelectValueNameLt: this.thirdTrIdData[index].value[rowIndex] ? this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameLt : '',\r\n        originalSelectValueNameRu: this.thirdTrIdData[index].value[rowIndex] ? this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameRu : '',\r\n        typeCode: typeCode,\r\n        columnId: id,\r\n        notEditable: notEditable\r\n      }; */\r\n      if (initialLoadCall && typeCode === 'SELECT') {\r\n        let rowIndex = this.selectedRows.findIndex(el => el.id == rowId)\r\n        if (!this.thirdTrIdData[index].value[rowIndex].rowId) {\r\n          this.thirdTrIdData[index].value[rowIndex] = {\r\n            rowId: rowId,\r\n            value: typeCode === 'SELECT' ? '' : value,\r\n            selectValueId: value ? value.id : null,\r\n            selectValueNameUz: value ? (value.nameUz ? value.nameUz : value.name) : null,\r\n            selectValueNameLt: value ? value.nameLt : null,\r\n            selectValueNameRu: value ? value.nameRu : null,\r\n            originalSelectValueNameUz: this.thirdTrIdData[index].value[rowIndex] ? this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameUz : '',\r\n            originalSelectValueNameLt: this.thirdTrIdData[index].value[rowIndex] ? this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameLt : '',\r\n            originalSelectValueNameRu: this.thirdTrIdData[index].value[rowIndex] ? this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameRu : '',\r\n            typeCode: typeCode,\r\n            columnId: id,\r\n            notEditable: notEditable,\r\n          }\r\n          this.thirdTrIdData[index].value[rowIndex].originalselectValueId = value.id\r\n          this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameUz = value.nameUz\r\n          this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameLt = value.nameLt\r\n          this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameRu = value.nameRu\r\n        }\r\n      } else {\r\n        if (typeCode === 'SELECT') {\r\n          value.rowId = rowId\r\n          value.columnId = id\r\n          value.typeCode = typeCode\r\n          value.notEditable = notEditable\r\n          value.selectValueId = value.id\r\n          value.selectValueNameLt = value.nameLt\r\n          value.selectValueNameRu = value.nameRu\r\n          value.selectValueNameUz = value.nameUz ? value.nameUz : value.name\r\n        }\r\n\r\n        this.thirdTrIdData[index].value[rowIndex] = {\r\n          rowId: rowId,\r\n          value: typeCode === 'SELECT' ? '' : value,\r\n          selectValueId: value ? value.id : null,\r\n          selectValueNameUz: value ? value.nameUz : null,\r\n          selectValueNameLt: value ? value.nameLt : null,\r\n          selectValueNameRu: value ? value.nameRu : null,\r\n          originalSelectValueNameUz: this.thirdTrIdData[index].value[rowIndex] ? this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameUz : '',\r\n          originalSelectValueNameLt: this.thirdTrIdData[index].value[rowIndex] ? this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameLt : '',\r\n          originalSelectValueNameRu: this.thirdTrIdData[index].value[rowIndex] ? this.thirdTrIdData[index].value[rowIndex].originalSelectValueNameRu : '',\r\n          typeCode: typeCode,\r\n          columnId: id,\r\n          notEditable: notEditable,\r\n        };\r\n      }\r\n\r\n      document.getElementsByClassName(\"no_enter_value\").forEach((input) => {\r\n        if (JSON.parse(input.id).rowId) {\r\n          this.formulas.forEach((e) => {\r\n            let index_f2 = JSON.parse(e.f2).findIndex((d) => d == parseFloat(id));\r\n            let index_f1 = JSON.parse(e.f1).findIndex((d) => d == parseFloat(JSON.parse(input.id).columnId));\r\n            if (\r\n                index_f2 > -1 &&\r\n                index_f1 > -1 &&\r\n                parseFloat(JSON.parse(input.id).rowId) === parseFloat(rowId)\r\n            ) {\r\n\r\n              let allVal = 0;\r\n              document.getElementsByClassName(\"input_val\").forEach((vInput) => {\r\n                let e_index_f2 = JSON.parse(e.f2).findIndex(\r\n                    (d) => d == parseFloat(JSON.parse(vInput.id).columnId)\r\n                );\r\n\r\n                if (\r\n                    e_index_f2 > -1 &&\r\n                    parseFloat(JSON.parse(vInput.id).rowId) === parseFloat(rowId)\r\n                ) {\r\n                  if (this._empty(vInput.value)) {\r\n                  } else {\r\n                    if (typeof parseFloat(vInput.value) == \"number\") {\r\n                      allVal += parseFloat(vInput.value);\r\n                    } else {\r\n                      allVal += 0;\r\n                    }\r\n                  }\r\n\r\n                  this.$set(input, \"value\", parseFloat(allVal));\r\n                  let foundIndex = this.thirdTrIdData.findIndex(\r\n                      (e) => e.columnId == JSON.parse(input.id).columnId\r\n                  );\r\n                  this.thirdTrIdData[foundIndex].value[rowIndex] = {\r\n                    rowId: rowId ? rowId : null,\r\n                    value: allVal,\r\n                    typeCode: typeCode,\r\n                    columnId: JSON.parse(input.id).columnId,\r\n                  };\r\n                  this.$forceUpdate();\r\n                }\r\n              });\r\n            }\r\n          });\r\n        } else {\r\n          this.formulas.forEach((e) => {\r\n            let index_f2 = JSON.parse(e.f2).findIndex(\r\n                (d) => d == parseFloat(id)\r\n            );\r\n            let index_f1 = JSON.parse(e.f1).findIndex(\r\n                (d) => d == parseFloat(JSON.parse(input.id).columnId)\r\n            );\r\n            if (index_f2 > -1 && index_f1 > -1) {\r\n              let allVal = 0;\r\n              document.getElementsByClassName(\"input_val\").forEach((vInput) => {\r\n                let e_index_f2 = JSON.parse(e.f2).findIndex(\r\n                    (d) => d == parseFloat(JSON.parse(vInput.id).columnId)\r\n                );\r\n                if (e_index_f2 > -1) {\r\n                  if (this._empty(vInput.value)) {\r\n                  } else {\r\n                    if (typeof parseFloat(vInput.value) == \"number\") {\r\n                      allVal += parseFloat(vInput.value);\r\n                    } else {\r\n                      allVal += 0;\r\n                    }\r\n                  }\r\n                }\r\n                this.$set(input, \"value\", parseFloat(allVal));\r\n                let foundIndex = this.thirdTrIdData.findIndex(\r\n                    (e) => e.columnId == JSON.parse(input.id).columnId\r\n                );\r\n                this.thirdTrIdData[foundIndex].value[0] = {\r\n                  rowId: null,\r\n                  value: allVal,\r\n                  typeCode: typeCode,\r\n                  columnId: JSON.parse(input.id).columnId,\r\n                };\r\n                this.$forceUpdate();\r\n              });\r\n            }\r\n          });\r\n        }\r\n      });\r\n\r\n      this.$forceUpdate();\r\n\r\n    },\r\n    async setDocumentColumnValues(data, formulas) {\r\n      this.showData = []\r\n      this.currentItemData = data\r\n      if (data && data.length) {\r\n        data.forEach((e) => {\r\n          if (e.valueString || e.valueBigDecimal) {\r\n            if (e.typeCode === \"YEAR\") {\r\n              document.getElementsByClassName(\"custom-datepicker mx-datepicker dynamic-year\").forEach((field, idx) => {\r\n                if (JSON.parse(field.id).rowId) {\r\n                  if (\r\n                      parseFloat(JSON.parse(field.id).columnId) === parseFloat(e.columnId) &&\r\n                      parseFloat(JSON.parse(field.id).rowId) === parseFloat(e.rowId)\r\n                  ) {\r\n                    let rowIndex = this.selectedRows.findIndex(el => el.id == JSON.parse(field.id).rowId)\r\n                    let colIndex = this.thirdTrIdData.findIndex(item => item.columnId === e.columnId)\r\n                    this.setValue(e.rowId, e.value, rowIndex, colIndex, e.columnId, 'DATE')\r\n                  }\r\n                }\r\n              })\r\n            } else {\r\n              if (e.typeCode === 'BIGDECIMAL') {\r\n                let foundColumnId = this.showData.findIndex((d) => d.columnId === e.columnId)\r\n                if (foundColumnId > -1) {\r\n                  this.showData.map(f => {\r\n                    if (f.columnId == e.columnId) {\r\n                      f.columnData = (+f.columnData) + (+e.value)\r\n                    }\r\n                  })\r\n                } else {\r\n                  this.showData.push({\r\n                    columnId: e.columnId,\r\n                    columnData: (e.value)\r\n                  })\r\n                }\r\n              }\r\n\r\n              document\r\n                  .getElementsByClassName(\"input_val\").forEach((input) => {\r\n                formulas.forEach((element) => {\r\n                  let index_V = JSON.parse(element.f1).findIndex((e) => e == JSON.parse(input.id).columnId);\r\n                  if (index_V > -1) {\r\n                    this.$set(input, \"disabled\", true);\r\n                    this.$set(input.style, \"border\", \"none\");\r\n                    input.classList.add(\"no_enter_value\");\r\n                    input.style.fontWeight = \"bold\";\r\n                  }\r\n                });\r\n\r\n                if (JSON.parse(input.id).rowId) {\r\n                  if (\r\n                      parseFloat(JSON.parse(input.id).columnId) === parseFloat(e.columnId) &&\r\n                      parseFloat(JSON.parse(input.id).rowId) === parseFloat(e.rowId)\r\n                  ) {\r\n                    this.$set(input, \"value\", e.value);\r\n                  }\r\n                } else {\r\n                  if (\r\n                      parseFloat(JSON.parse(input.id).columnId) === parseFloat(e.columnId)\r\n                  ) {\r\n                    this.$set(input, \"value\", e.value);\r\n                  }\r\n                }\r\n              });\r\n            }\r\n          } else if (e.valueDate) {\r\n            document.getElementsByClassName(\"custom-datepicker mx-datepicker dynamic-datepicker\").forEach((field, idx) => {\r\n              if (JSON.parse(field.id).rowId) {\r\n                if (\r\n                    parseFloat(JSON.parse(field.id).columnId) === parseFloat(e.columnId) &&\r\n                    parseFloat(JSON.parse(field.id).rowId) === parseFloat(e.rowId)\r\n                ) {\r\n                  let rowIndex = this.selectedRows.findIndex(el => el.id == JSON.parse(field.id).rowId)\r\n                  let colIndex = this.thirdTrIdData.findIndex(item => item.columnId === e.columnId)\r\n                  this.setValue(e.rowId, e.value, rowIndex, colIndex, e.columnId, 'DATE')\r\n                }\r\n              }\r\n            })\r\n          } else if (e.valueBoolean !== null) {\r\n            document.getElementsByClassName(\"checkbox_field\").forEach((field, idx) => {\r\n              let checkboxInput = field.classList.contains('active') ? field.children[0].children[1].children[0] : field.children[0].children[0].children[0]\r\n              if (checkboxInput.id && JSON.parse(checkboxInput.id) && JSON.parse(checkboxInput.id).rowId) {\r\n                if (\r\n                    parseFloat(JSON.parse(checkboxInput.id).columnId) === parseFloat(e.columnId) &&\r\n                    parseFloat(JSON.parse(checkboxInput.id).rowId) === parseFloat(e.rowId)\r\n                ) {\r\n                  let rowIndex = this.selectedRows.findIndex(el => el.id == JSON.parse(checkboxInput.id).rowId)\r\n                  let colIndex = this.thirdTrIdData.findIndex(item => item.columnId == e.columnId)\r\n                  this.setValue(e.rowId, JSON.parse(e.value), rowIndex, colIndex, e.columnId, 'BOOLEAN')\r\n                }\r\n              }\r\n            })\r\n          } else if (e.selectValueNameUz) {\r\n            document.getElementsByClassName(\"select_field\").forEach((field, idx) => {\r\n              if (JSON.parse(field.id).rowId) {\r\n                if (\r\n                    parseFloat(JSON.parse(field.id).columnId) === parseFloat(e.columnId) &&\r\n                    parseFloat(JSON.parse(field.id).rowId) === parseFloat(e.rowId)\r\n                ) {\r\n                  let rowIndex = this.selectedRows.findIndex(el => el.id == JSON.parse(field.id).rowId)\r\n                  let colIndex = this.thirdTrIdData.findIndex(item => item.columnId == e.columnId)\r\n                  this.setValue(\r\n                      e.rowId,\r\n                      {\r\n                        nameUz: e.selectValueNameUz,\r\n                        nameLt: e.selectValueNameLt,\r\n                        nameRu: e.selectValueNameRu,\r\n                        id: e.selectValueId\r\n                      }, rowIndex, colIndex, e.columnId, 'SELECT', true, true)\r\n                }\r\n              }\r\n            })\r\n          }\r\n        });\r\n      } else {\r\n        document\r\n            .getElementsByClassName(\"input_val\")\r\n            .forEach((input) => {\r\n              formulas.forEach((element) => {\r\n                let index_V = JSON.parse(element.f1).findIndex(\r\n                    (e) => e == JSON.parse(input.id).columnId\r\n                );\r\n                if (index_V > -1) {\r\n                  this.$set(input, \"disabled\", true);\r\n                  this.$set(input.style, \"border\", \"none\");\r\n                  input.classList.add(\"no_enter_value\");\r\n                  input.style.fontWeight = \"bold\";\r\n                }\r\n              });\r\n            });\r\n      }\r\n      for (const docTableFormulaTargetId in this.docTableFormulasList) {\r\n        let disabledElements = document.querySelectorAll('input[data-column-id=\"' + docTableFormulaTargetId + '\"]');\r\n        disabledElements.forEach((element) => {\r\n          element.classList.add(\"no_enter_value\");\r\n          element.disabled = true;\r\n        });\r\n      }\r\n    },\r\n    async getById(id, reportId, info) {\r\n      this.clearAll();\r\n      this.tableId = id;\r\n      this.reportId = reportId;\r\n      this.tableInfo = info;\r\n      this.loader = true;\r\n      await Service.reportGetById(reportId).then(({ data }) => {\r\n        this.report = data;\r\n        this.$emit('setReportGenerated', this.report.generated);\r\n      });\r\n      await Service.getByIdTableWithReportId(id, reportId)\r\n        .then(async (rs) => {\r\n          if (rs.data) {\r\n            await this.setColumns(rs.data.columns, rs.data.rows.length);\r\n            this.setRow(rs.data.rows);\r\n            this.table = rs.data.table;\r\n            setTimeout(() => {\r\n              Promise.all([\r\n                this.getDataById(reportId),\r\n                this.getFormulas_2(),\r\n              ]).then(([data, formulas]) => {\r\n                    this.lastReportData = data\r\n                    this.lastReportFormulas = formulas\r\n                    this.setDocumentColumnValues(data, formulas)\r\n                    this.loader = false;\r\n                  });\r\n            },500);\r\n          }\r\n        })\r\n        .catch((e) => {\r\n          this.loader = false;\r\n        });\r\n      await Service.getDocTableFormulasList(id).then(({ data }) => {\r\n        this.docTableFormulasList = {};\r\n        let length = data.length;\r\n        let currentTargetColumnId = null;\r\n        for (let i = 0; i < length; i++) {\r\n          if (this.docTableFormulasList[data[i].targetColumnId] === undefined) {\r\n            currentTargetColumnId = data[i].targetColumnId;\r\n            this.docTableFormulasList[data[i].targetColumnId] = {\r\n              eval: \"\",\r\n              list: [],\r\n              listenColumns: [],\r\n              targetColumnId: data[i].targetColumnId\r\n            };\r\n          }\r\n          this.docTableFormulasList[data[i].targetColumnId].list.push(data[i]);\r\n          if (data[i].docColumnId) {\r\n            if (data[i].docColumnId && this.docTableFormulasList[data[i].targetColumnId].listenColumns.indexOf(data[i].docColumnId) === -1) {\r\n              this.docTableFormulasList[data[i].targetColumnId].listenColumns.push(data[i].docColumnId)\r\n            }\r\n            if (this.docTableFormulasListenColumnId[data[i].docColumnId] === undefined) {\r\n              this.docTableFormulasListenColumnId[data[i].docColumnId] = [data[i].targetColumnId];\r\n            } else {\r\n              if (this.docTableFormulasListenColumnId[data[i].docColumnId].indexOf(data[i].targetColumnId) === -1) {\r\n                this.docTableFormulasListenColumnId[data[i].docColumnId].push(data[i].targetColumnId);\r\n              }\r\n            }\r\n          }\r\n          if (data[i].type === \"ARGUMENTS\") {\r\n            this.docTableFormulasList[data[i].targetColumnId].eval += \"{\" + data[i].docColumnId + \"}\";\r\n          } else {\r\n            this.docTableFormulasList[data[i].targetColumnId].eval += data[i].code;\r\n          }\r\n        }\r\n      });\r\n    },\r\n\r\n    async setColumns(v, rowsCount) {\r\n      this.selectedColumns = v;\r\n      this.firstColumns = [];\r\n      this.secondColumns = [];\r\n      this.thirdColumns = [];\r\n      v.forEach((el1) => {\r\n        this.firstColumns.push(el1);\r\n        el1.children.forEach((el2) => {\r\n          this.secondColumns.push(el2);\r\n          el2.children.forEach((el3) => {\r\n            this.thirdColumns.push({ ...el3, fId: el1.id });\r\n          });\r\n        });\r\n      });\r\n      setTimeout(async () => {\r\n        let firstTrTh = document.getElementsByClassName(\"firstTrTh\");\r\n        let secondTrTh = document.getElementsByClassName(\"secondTrTh\");\r\n        let thirdTrTh = document.getElementsByClassName(\"thirdTrTh\");\r\n        let counter2 = 0,\r\n            counter3 = 0;\r\n        await firstTrTh.forEach(async (th) => {\r\n          if (th.colSpan > 1) {\r\n            for (let index2 = 0; index2 < th.colSpan; index2++) {\r\n              if (secondTrTh[counter2] && secondTrTh[counter2].colSpan > 1) {\r\n                for (\r\n                    let index3 = 0;\r\n                    index3 < secondTrTh[counter2].colSpan;\r\n                    index3++\r\n                ) {\r\n                  let array = thirdTrTh[counter3].id.split(\",\");\r\n                  let tmp = {\r\n                    columnId: array[0],\r\n                    typeCode: array[1],\r\n                    refCode: array[2],\r\n                    referenceUrl: array[3],\r\n                    referenceAppendUrl: array[4],\r\n                    referenceCode: array[5],\r\n                    referenceNameUz: array[6],\r\n                    referenceNameLt: array[7],\r\n                    referenceNameRu: array[8],\r\n                    searchPayload: Object.assign({}, this.var_default_search_payload),\r\n                    hasNextPage: false,\r\n                    options: [],\r\n                    rowId: [],\r\n                    value: [],\r\n                  };\r\n                  // GET DYNAMIC REFRENCE OPTIONS\r\n                  if (tmp.typeCode === 'SELECT') {\r\n                    for (let i = 0; i < rowsCount; i++) {\r\n                      tmp.value.push({ selectedItem: null })\r\n                    }\r\n                    crudAndListsService.searchListWithKeyword(tmp.referenceUrl, tmp.searchPayload, tmp.referenceAppendUrl)\r\n                        .then(res => {\r\n                          if (['DepartmentForDocument', 'Department'].includes(i.refCode)) {\r\n                            tmp.options.push(...res.data)\r\n                          } else {\r\n                            tmp.options.push(...res.data.list)\r\n                          }\r\n                          tmp.hasNextPage = res.data.total / tmp.searchPayload.itemsPerPage > tmp.searchPayload.page\r\n                          tmp.searchPayload.page += 1\r\n                          /* if (!this.isModeCreate && this.editingItem.okedId) {\r\n                              let foundItm = this.okeds.find(el => el.id == this.editingItem.okedId)\r\n                              if (!foundItm && this.editingItem.infoOkedDto) {\r\n                                  this.okeds.push(this.editingItem.infoOkedDto)\r\n                              }\r\n                          } */\r\n                        })\r\n                        .catch(e => {\r\n                          console.log(e)\r\n                          // this.okeds = []\r\n                        })\r\n                        .finally(() => {\r\n                          // this.isLoadingOked = false\r\n                        })\r\n                  }\r\n                  this.thirdTrIdData.push(tmp);\r\n                  counter3++;\r\n                }\r\n                counter2++;\r\n              } else {\r\n                if (\r\n                    secondTrTh[counter2] &&\r\n                    secondTrTh[counter2].classList.contains(\"thirdTrId\")\r\n                ) {\r\n                  let array = secondTrTh[counter2].id.split(\",\");\r\n                  let tmp = {\r\n                    columnId: array[0],\r\n                    typeCode: array[1],\r\n                    refCode: array[2],\r\n                    referenceUrl: array[3],\r\n                    referenceAppendUrl: array[4],\r\n                    referenceCode: array[5],\r\n                    referenceNameUz: array[6],\r\n                    referenceNameLt: array[7],\r\n                    referenceNameRu: array[8],\r\n                    searchPayload: Object.assign({}, this.var_default_search_payload),\r\n                    hasNextPage: false,\r\n                    options: [],\r\n                    rowId: [],\r\n                    value: [],\r\n                  };\r\n                  // GET DYNAMIC REFRENCE OPTIONS\r\n                  if (tmp.typeCode === 'SELECT') {\r\n                    for (let i = 0; i < rowsCount; i++) {\r\n                      tmp.value.push({ selectedItem: null })\r\n                    }\r\n                    crudAndListsService.searchListWithKeyword(tmp.referenceUrl, tmp.searchPayload, tmp.referenceAppendUrl)\r\n                        .then(res => {\r\n                          if (['DepartmentForDocument', 'Department'].includes(i.refCode)) {\r\n                            tmp.options.push(...res.data)\r\n                          } else {\r\n                            tmp.options.push(...res.data.list)\r\n                          }\r\n                          tmp.hasNextPage = res.data.total / tmp.searchPayload.itemsPerPage > tmp.searchPayload.page\r\n                          tmp.searchPayload.page += 1\r\n                          /* if (!this.isModeCreate && this.editingItem.okedId) {\r\n                              let foundItm = this.okeds.find(el => el.id == this.editingItem.okedId)\r\n                              if (!foundItm && this.editingItem.infoOkedDto) {\r\n                                  this.okeds.push(this.editingItem.infoOkedDto)\r\n                              }\r\n                          } */\r\n                        })\r\n                        .catch(e => {\r\n                          console.log(e)\r\n                          // this.okeds = []\r\n                        })\r\n                        .finally(() => {\r\n                          // this.isLoadingOked = false\r\n                        })\r\n                  }\r\n                  this.thirdTrIdData.push(tmp);\r\n                  counter2++;\r\n                } else {\r\n                  if (secondTrTh[counter2]) {\r\n                    for (\r\n                        let index3 = 0;\r\n                        index3 < secondTrTh[counter2].colSpan;\r\n                        index3++\r\n                    ) {\r\n                      let array = thirdTrTh[counter3].id.split(\",\");\r\n                      let tmp = {\r\n                        columnId: array[0],\r\n                        typeCode: array[1],\r\n                        refCode: array[2],\r\n                        referenceUrl: array[3],\r\n                        referenceAppendUrl: array[4],\r\n                        referenceCode: array[5],\r\n                        referenceNameUz: array[6],\r\n                        referenceNameLt: array[7],\r\n                        referenceNameRu: array[8],\r\n                        searchPayload: Object.assign({}, this.var_default_search_payload),\r\n                        hasNextPage: false,\r\n                        options: [],\r\n                        rowId: [],\r\n                        value: [],\r\n                      };\r\n                      // GET DYNAMIC REFRENCE OPTIONS\r\n                      if (tmp.typeCode === 'SELECT') {\r\n                        for (let i = 0; i < rowsCount; i++) {\r\n                          tmp.value.push({ selectedItem: null })\r\n                        }\r\n                        crudAndListsService.searchListWithKeyword(tmp.referenceUrl, tmp.searchPayload, tmp.referenceAppendUrl)\r\n                            .then(res => {\r\n                              if (['DepartmentForDocument', 'Department'].includes(i.refCode)) {\r\n                                tmp.options.push(...res.data)\r\n                              } else {\r\n                                tmp.options.push(...res.data.list)\r\n                              }\r\n                              tmp.hasNextPage = res.data.total / tmp.searchPayload.itemsPerPage > tmp.searchPayload.page\r\n                              tmp.searchPayload.page += 1\r\n                              /* if (!this.isModeCreate && this.editingItem.okedId) {\r\n                                  let foundItm = this.okeds.find(el => el.id == this.editingItem.okedId)\r\n                                  if (!foundItm && this.editingItem.infoOkedDto) {\r\n                                      this.okeds.push(this.editingItem.infoOkedDto)\r\n                                  }\r\n                              } */\r\n                            })\r\n                            .catch(e => {\r\n                              console.log(e)\r\n                              // this.okeds = []\r\n                            })\r\n                            .finally(() => {\r\n                              // this.isLoadingOked = false\r\n                            })\r\n                      }\r\n                      this.thirdTrIdData.push(tmp);\r\n                      counter3++;\r\n                    }\r\n\r\n                    counter2++;\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          } else {\r\n            if (th.classList.contains(\"thirdTrId\")) {\r\n              let array = th.id.split(\",\");\r\n              let tmp = {\r\n                columnId: array[0],\r\n                typeCode: array[1],\r\n                refCode: array[2],\r\n                referenceUrl: array[3],\r\n                referenceAppendUrl: array[4],\r\n                referenceCode: array[5],\r\n                referenceNameUz: array[6],\r\n                referenceNameLt: array[7],\r\n                referenceNameRu: array[8],\r\n                searchPayload: Object.assign({}, this.var_default_search_payload),\r\n                hasNextPage: false,\r\n                options: [],\r\n                rowId: [],\r\n                value: [],\r\n              };\r\n              // GET DYNAMIC REFRENCE OPTIONS\r\n              if (tmp.typeCode === 'SELECT') {\r\n                for (let i = 0; i < rowsCount; i++) {\r\n                  tmp.value.push({ selectedItem: null })\r\n                }\r\n                crudAndListsService.searchListWithKeyword(tmp.referenceUrl, tmp.searchPayload, tmp.referenceAppendUrl)\r\n                    .then(res => {\r\n                      if ([\"DepartmentForDocument\", \"Department\"].includes(tmp.refCode)) {\r\n                        tmp.options.push(...res.data)\r\n                      } else {\r\n                        tmp.options.push(...res.data.list)\r\n                      }\r\n                      tmp.hasNextPage = res.data.total / tmp.searchPayload.itemsPerPage > tmp.searchPayload.page\r\n                      tmp.searchPayload.page += 1\r\n                      /* if (!this.isModeCreate && this.editingItem.okedId) {\r\n                          let foundItm = this.okeds.find(el => el.id == this.editingItem.okedId)\r\n                          if (!foundItm && this.editingItem.infoOkedDto) {\r\n                              this.okeds.push(this.editingItem.infoOkedDto)\r\n                          }\r\n                      } */\r\n                    })\r\n                    .catch(e => {\r\n                      console.log(e)\r\n                      // this.okeds = []\r\n                    })\r\n                    .finally(() => {\r\n                      // this.isLoadingOked = false\r\n                    })\r\n              }\r\n              this.thirdTrIdData.push(tmp);\r\n            } else {\r\n              for (let index2 = 0; index2 < th.colSpan; index2++) {\r\n                if (secondTrTh[counter2].colSpan > 1) {\r\n                  for (\r\n                      let index3 = 0;\r\n                      index3 < secondTrTh[counter2].colSpan;\r\n                      index3++\r\n                  ) {\r\n                    let array = thirdTrTh[counter3].id.split(\",\");\r\n                    let tmp = {\r\n                      columnId: array[0],\r\n                      typeCode: array[1],\r\n                      refCode: array[2],\r\n                      referenceUrl: array[3],\r\n                      referenceAppendUrl: array[4],\r\n                      referenceCode: array[5],\r\n                      referenceNameUz: array[6],\r\n                      referenceNameLt: array[7],\r\n                      referenceNameRu: array[8],\r\n                      searchPayload: Object.assign({}, this.var_default_search_payload),\r\n                      hasNextPage: false,\r\n                      options: [],\r\n                      rowId: [],\r\n                      value: [],\r\n                    };\r\n                    // GET DYNAMIC REFRENCE OPTIONS\r\n                    if (tmp.typeCode === 'SELECT') {\r\n                      for (let i = 0; i < rowsCount; i++) {\r\n                        tmp.value.push({ selectedItem: null })\r\n                      }\r\n                      crudAndListsService.searchListWithKeyword(tmp.referenceUrl, tmp.searchPayload, tmp.referenceAppendUrl)\r\n                          .then(res => {\r\n                            if (['DepartmentForDocument', 'Department'].includes(i.refCode)) {\r\n                              tmp.options.push(...res.data)\r\n                            } else {\r\n                              tmp.options.push(...res.data.list)\r\n                            }\r\n                            tmp.hasNextPage = res.data.total / tmp.searchPayload.itemsPerPage > tmp.searchPayload.page\r\n                            tmp.searchPayload.page += 1\r\n                            /* if (!this.isModeCreate && this.editingItem.okedId) {\r\n                                let foundItm = this.okeds.find(el => el.id == this.editingItem.okedId)\r\n                                if (!foundItm && this.editingItem.infoOkedDto) {\r\n                                    this.okeds.push(this.editingItem.infoOkedDto)\r\n                                }\r\n                            } */\r\n                          })\r\n                          .catch(e => {\r\n                            console.log(e)\r\n                            // this.okeds = []\r\n                          })\r\n                          .finally(() => {\r\n                            // this.isLoadingOked = false\r\n                          })\r\n                    }\r\n                    this.thirdTrIdData.push(tmp);\r\n                    counter3++;\r\n                  }\r\n                  counter2++;\r\n                } else {\r\n                  if (\r\n                      secondTrTh[counter2] &&\r\n                      secondTrTh[counter2].classList.contains(\"thirdTrId\")\r\n                  ) {\r\n                    let array = secondTrTh[counter2].id.split(\",\");\r\n                    let tmp = {\r\n                      columnId: array[0],\r\n                      typeCode: array[1],\r\n                      refCode: array[2],\r\n                      referenceUrl: array[3],\r\n                      referenceAppendUrl: array[4],\r\n                      referenceCode: array[5],\r\n                      referenceNameUz: array[6],\r\n                      referenceNameLt: array[7],\r\n                      referenceNameRu: array[8],\r\n                      searchPayload: Object.assign({}, this.var_default_search_payload),\r\n                      hasNextPage: false,\r\n                      options: [],\r\n                      rowId: [],\r\n                      value: [],\r\n                    };\r\n                    // GET DYNAMIC REFRENCE OPTIONS\r\n                    if (tmp.typeCode === 'SELECT') {\r\n                      for (let i = 0; i < rowsCount; i++) {\r\n                        tmp.value.push({ selectedItem: null })\r\n                      }\r\n                      crudAndListsService.searchListWithKeyword(tmp.referenceUrl, tmp.searchPayload, tmp.referenceAppendUrl)\r\n                          .then(res => {\r\n                            if (['DepartmentForDocument', 'Department'].includes(i.refCode)) {\r\n                              tmp.options.push(...res.data)\r\n                            } else {\r\n                              tmp.options.push(...res.data.list)\r\n                            }\r\n                            tmp.hasNextPage = res.data.total / tmp.searchPayload.itemsPerPage > tmp.searchPayload.page\r\n                            tmp.searchPayload.page += 1\r\n                            /* if (!this.isModeCreate && this.editingItem.okedId) {\r\n                                let foundItm = this.okeds.find(el => el.id == this.editingItem.okedId)\r\n                                if (!foundItm && this.editingItem.infoOkedDto) {\r\n                                    this.okeds.push(this.editingItem.infoOkedDto)\r\n                                }\r\n                            } */\r\n                          })\r\n                          .catch(e => {\r\n                            console.log(e)\r\n                            // this.okeds = []\r\n                          })\r\n                          .finally(() => {\r\n                            // this.isLoadingOked = false\r\n                          })\r\n                    }\r\n                    this.thirdTrIdData.push(tmp);\r\n                    counter2++;\r\n                  } else {\r\n                    if (secondTrTh[counter2]) {\r\n                      for (\r\n                          let index3 = 0;\r\n                          index3 < secondTrTh[counter2].colSpan;\r\n                          index3++\r\n                      ) {\r\n                        let array = thirdTrTh[counter3].id.split(\",\");\r\n                        let tmp = {\r\n                          columnId: array[0],\r\n                          typeCode: array[1],\r\n                          refCode: array[2],\r\n                          referenceUrl: array[3],\r\n                          referenceAppendUrl: array[4],\r\n                          referenceCode: array[5],\r\n                          referenceNameUz: array[6],\r\n                          referenceNameLt: array[7],\r\n                          referenceNameRu: array[8],\r\n                          searchPayload: Object.assign({}, this.var_default_search_payload),\r\n                          hasNextPage: false,\r\n                          options: [],\r\n                          rowId: [],\r\n                          value: [],\r\n                        };\r\n                        // GET DYNAMIC REFRENCE OPTIONS\r\n                        if (tmp.typeCode === 'SELECT') {\r\n                          for (let i = 0; i < rowsCount; i++) {\r\n                            tmp.value.push({ selectedItem: null })\r\n                          }\r\n                          crudAndListsService.searchListWithKeyword(tmp.referenceUrl, tmp.searchPayload, tmp.referenceAppendUrl)\r\n                              .then(res => {\r\n                                if (['DepartmentForDocument', 'Department'].includes(i.refCode)) {\r\n                                  tmp.options.push(...res.data)\r\n                                } else {\r\n                                  tmp.options.push(...res.data.list)\r\n                                }\r\n                                tmp.hasNextPage = res.data.total / tmp.searchPayload.itemsPerPage > tmp.searchPayload.page\r\n                                tmp.searchPayload.page += 1\r\n                                /* if (!this.isModeCreate && this.editingItem.okedId) {\r\n                                    let foundItm = this.okeds.find(el => el.id == this.editingItem.okedId)\r\n                                    if (!foundItm && this.editingItem.infoOkedDto) {\r\n                                        this.okeds.push(this.editingItem.infoOkedDto)\r\n                                    }\r\n                                } */\r\n                              })\r\n                              .catch(e => {\r\n                                console.log(e)\r\n                                // this.okeds = []\r\n                              })\r\n                              .finally(() => {\r\n                                // this.isLoadingOked = false\r\n                              })\r\n                        }\r\n                        this.thirdTrIdData.push(tmp);\r\n                        counter3++;\r\n                      }\r\n                      counter2++;\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        });\r\n      }, 300);\r\n    },\r\n    setRow(v) {\r\n      this.selectedRows = v;\r\n      this.lastReportDataRows = JSON.parse(JSON.stringify(v));\r\n      if (this.selectedRows.length == 0 && !this.isGenerated) {\r\n        this.selectedRows = [{ id: this.getRandomInt() }];\r\n      }\r\n    },\r\n    rowspanFirst(el) {\r\n      return el.children.length > 0\r\n          ? 1\r\n          : el.children.length > 0 && this.thirdColumns.length > 0\r\n              ? 3\r\n              : 3;\r\n    },\r\n    colspanFirst(el) {\r\n      let found = this.thirdColumns.filter((i) => i.fId === el.id);\r\n      let totalNotChild = el.children.filter((d) => d.children.length == 0);\r\n      return el.children.length > 0 && found.length == 0\r\n          ? el.children.length\r\n          : el.children.length > 0 && found.length > 0\r\n              ? totalNotChild.length + found.length\r\n              : 1;\r\n    },\r\n    rowspanSecond(el) {\r\n      return el.children.length == 0 && this.thirdColumns.length == 0\r\n          ? 1\r\n          : el.children.length == 0 && this.thirdColumns.length > 0\r\n              ? 2\r\n              : 1;\r\n    },\r\n    colspanSecond(el) {\r\n      return el.children.length > 0 ? el.children.length : 1;\r\n    },\r\n    rowspanFirstClass(el) {\r\n      return el.children.length > 0\r\n          ? \"\"\r\n          : el.children.length > 0 && this.thirdColumns.length > 0\r\n              ? \"thirdTrId\"\r\n              : \"thirdTrId\";\r\n    },\r\n    rowspanSecondClass(el) {\r\n      return el.children.length == 0 && this.thirdColumns.length == 0\r\n          ? \"thirdTrId\"\r\n          : el.children.length == 0 && this.thirdColumns.length > 0\r\n              ? \"thirdTrId\"\r\n              : \"\";\r\n    },\r\n    normalizer(node) {\r\n      if (!node.children || node.children.length === 0) {\r\n        delete node.children\r\n        return {\r\n          id: node.id,\r\n          label: this.getName({\r\n            nameRu: node.nameRu,\r\n            nameLt: node.nameLt,\r\n            nameUz: node.nameUz,\r\n          }),\r\n        }\r\n      }\r\n      return {\r\n        id: node.id,\r\n        label: this.getName({\r\n          nameRu: node.nameRu,\r\n          nameLt: node.nameLt,\r\n          nameUz: node.nameUz,\r\n        }),\r\n        children: node.children && node.children.length > 0 ? node.children : [],\r\n      }\r\n    },\r\n    calculateDocFormulas(rowId, value, rowIndex, columnIndex, columnId, typeCode) {\r\n      // rowIndex is `selectedRows` index\r\n\r\n      if (this.docTableFormulasListenColumnId[columnId] === undefined) {\r\n        return false;\r\n      }\r\n      let targets = this.docTableFormulasListenColumnId[columnId];\r\n      for (const targetIndex in targets) {\r\n        const docTableFormula = this.docTableFormulasList[targets[targetIndex]];\r\n        let evalString = docTableFormula.eval;\r\n        for (const listenColumn of docTableFormula.listenColumns) {\r\n          let thirdIndex = this.trColumnIdOnDocColumnIdMap[listenColumn];\r\n          let val = parseFloat(this.thirdTrIdData[thirdIndex]?.value[rowIndex]?.value ?? 0);\r\n          if (!val) {\r\n            this.report\r\n          }\r\n          val = isNaN(val) ? 0 : val;\r\n          evalString = evalString.replace(\"{\" + listenColumn + \"}\", val);\r\n        }\r\n        let val = eval(evalString);\r\n\r\n        // todo optimize qilish kerak. v-model bilan qilish kerak\r\n        this.$set(document.getElementById(JSON.stringify({\r\n          \"rowId\": rowId,\r\n          \"columnId\": docTableFormula.targetColumnId.toString()\r\n        })), \"value\", val);\r\n\r\n        this.setValue(rowId, val, rowIndex, this.trColumnIdOnDocColumnIdMap[docTableFormula.targetColumnId], docTableFormula.targetColumnId, typeCode);\r\n      }\r\n    },\r\n    treeClosed(veeName) {\r\n      this.computedObserver.refs[veeName].validate();\r\n    },\r\n    selectCustomLabel({ nameUz, nameLt, nameRu, name, fullName }) {\r\n      if (nameUz) {\r\n        return this.getName({ nameUz: nameUz, nameLt: nameLt, nameRu: nameRu });\r\n      }\r\n      if (fullName) {\r\n        return fullName;\r\n      }\r\n      return name;\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <div>\r\n      <div class=\"row\">\r\n        <div class=\"col-lg-12\">\r\n          <h5 class=\"text-center mb-1\">\r\n            <strong>\r\n              {{ getName({ nameLt: table.nameLt, nameUz: table.nameUz, nameRu: table.nameRu }) }}\r\n\r\n            </strong>\r\n          </h5>\r\n          <p class=\"text-center m-0\">\r\n            {{ getName({ nameLt: table.titleLt, nameUz: table.titleUz, nameRu: table.titleRu }) }}\r\n\r\n          </p>\r\n        </div>\r\n        <div class=\"col-lg-12\">\r\n          <div class=\"d-flex justify-content-between align-items-end pl-3 pr-3\">\r\n            <div>\r\n              <strong>\r\n                {{\r\n                  getName({\r\n                    nameLt: report.nameLt,\r\n                    nameRu: report.nameRu,\r\n                    nameUz: report.nameUz\r\n                  })\r\n                }}\r\n              </strong><br>\r\n              <span>\r\n                {{\r\n                  report.reportDate\r\n                }}\r\n              </span>\r\n            </div>\r\n            <div>\r\n              <strong>\r\n                {{\r\n                  getName({\r\n                    nameLt: table.conditionLt,\r\n                    nameRu: table.conditionRu,\r\n                    nameUz: table.conditionUz,\r\n                  })\r\n                }}\r\n              </strong>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-lg-12\">\r\n          <b-overlay :opacity=\"0.1\" :show=\"loader\" rounded=\"sm\">\r\n            <div class=\"bg-white pl-3 pr-3 pt-1\" style=\"min-height: 60vh; overflow: auto;\">\r\n              <div class=\"pb-5\">\r\n                <table class=\"table thead-table table-centered table-custom-bordered\">\r\n                  <thead>\r\n                  <tr class=\"tr-text-center\">\r\n                    <th\r\n                        :id=\"[el.id, el.typeCode, el.refCode, el.referenceUrl, el.referenceAppendUrl, el.referenceCode, el.referenceNameUz, el.referenceNameLt, el.referenceNameRu]\"\r\n                        :class=\"rowspanFirstClass(el, index)\"\r\n                        class=\"firstTrTh\"\r\n                        style=\"min-width: 70px\"\r\n                        :rowspan=\"rowspanFirst(el)\"\r\n                        :colspan=\"colspanFirst(el)\"\r\n                        v-for=\"(el, index) in firstColumns\"\r\n                        :key=\"index + 'first'\"\r\n                    >\r\n                      <div style=\" max-height: 200px; display: inline-block; \" >\r\n                        <div :class=\" (el.isVertical == 1 ) ? 'rotate_text' : ''\">\r\n                          {{ getName({ nameLt: el.nameLt, nameUz: el.nameUz, nameRu: el.nameRu }) }}\r\n                        </div>\r\n                      </div>\r\n                    </th>\r\n                    <th\r\n                        v-show=\"tableInfo.hasDynamicRows &&  !tableInfo.isGenerated && !loader\"\r\n                        :rowspan=\"thirdColumns.length > 0 ? 3 : secondColumns.length > 0 ? 2 : 1\"\r\n                    >\r\n                      <div style=\"max-height: 200px; display: inline-block;\">\r\n                        <div>\r\n                          {{ $t('column.actions') }}\r\n                        </div>\r\n                      </div>\r\n                    </th>\r\n                  </tr>\r\n                  <tr class=\"tr-text-center\">\r\n                    <th\r\n                        style=\"min-width: 70px\"\r\n                        :id=\"[el.id, el.typeCode, el.refCode, el.referenceUrl, el.referenceAppendUrl, el.referenceCode, el.referenceNameUz, el.referenceNameLt, el.referenceNameRu]\"\r\n                        :class=\"rowspanSecondClass(el)\"\r\n                        class=\"secondTrTh\"\r\n                        :rowspan=\"rowspanSecond(el)\"\r\n                        :colspan=\"colspanSecond(el)\"\r\n                        v-for=\"(el, index) in secondColumns\"\r\n                        :key=\"index + 'second'\"\r\n                    >\r\n                      <div\r\n                          style=\"\r\n                          max-height: 200px;\r\n                          position: relative;\r\n                          display: inline-block;\r\n                          cursor: pointer;\"\r\n                      >\r\n                        <div\r\n\r\n                            :class=\"(el.isVertical == 1 )  ? 'rotate_text' : ''\"\r\n                        >\r\n                          {{\r\n                            getName({ nameLt: el.nameLt, nameRu: el.nameRu, nameUz: el.nameUz })\r\n                          }}\r\n                        </div>\r\n                      </div>\r\n                    </th>\r\n                  </tr>\r\n\r\n                  <tr class=\"tr-text-center\">\r\n                    <th\r\n                        style=\"min-width: 70px\"\r\n                        :id=\"[el.id, el.typeCode, el.refCode, el.referenceUrl, el.referenceAppendUrl, el.referenceCode, el.referenceNameUz, el.referenceNameLt, el.referenceNameRu]\"\r\n                        class=\"thirdTrId thirdTrTh\"\r\n                        :colspan=\"el.children.length > 0 ? el.children.length : 1\"\r\n                        v-for=\"(el, index) in thirdColumns\"\r\n                        :key=\"index + 'third'\"\r\n                    >\r\n                      <div\r\n                          style=\"\r\n                            max-height: 200px;\r\n                            position: relative;\r\n                            display: inline-block;\r\n                            cursor: pointer;\r\n                          \"\r\n                      >\r\n                        <div :class=\"(el.isVertical == 1 )  ? 'rotate_text' : ''\">\r\n                          {{\r\n                            getName({ nameLt: el.nameLt, nameRu: el.nameRu, nameUz: el.nameUz })\r\n                          }}\r\n                        </div>\r\n                      </div>\r\n                    </th>\r\n                  </tr>\r\n\r\n                  <tr class=\"tr-text-center\">\r\n                    <td\r\n                        v-for=\"(item, index) of (tableInfo.hasDynamicRows &&  !tableInfo.isGenerated) ? thirdTrIdData.length  + 1 :  thirdTrIdData.length \"\r\n                        :key=\"index + 'I-1'\"\r\n                    >\r\n                      <strong v-if=\"selectedRows.length > 1\">\r\n                        {{\r\n                          selectedRows.length > 1 && index == 0 ? \"\" : index\r\n                        }}\r\n                      </strong\r\n                      >\r\n\r\n                      <strong v-else>\r\n                        {{ index + 1 }}\r\n                      </strong>\r\n                    </td>\r\n                  </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                  <tr v-if=\"isGenerated && !selectedRows.length && !loader\">\r\n                    <td class=\"text-center\" colspan=\"4000\">\r\n                      <h5 class=\"m-3 p-0\">\r\n                        {{ $t('messages.data_not_found') }}\r\n                      </h5>\r\n                    </td>\r\n                  </tr>\r\n                  <tr v-for=\"(data, index1) in selectedRows\" :key=\"index1 + 'MM'\">\r\n                    <td\r\n                        :class=\"[\r\n                          f1Ids &&\r\n                          f1Ids.indexOf(i.columnId) > -1 &&\r\n                          selectedRows.length > 1 &&\r\n                          fRowId == data.id\r\n                            ? 'bg-success'\r\n                            : f1Ids &&\r\n                              f1Ids.indexOf(i.columnId) > -1 &&\r\n                              selectedRows.length <= 1\r\n                            ? 'bg-success'\r\n                            : '',\r\n                          f2Ids &&\r\n                          f2Ids.indexOf(i.columnId) > -1 &&\r\n                          selectedRows.length > 1 &&\r\n                          fRowId == data.id\r\n                            ? 'bg-primary'\r\n                            : f2Ids &&\r\n                              f2Ids.indexOf(i.columnId) > -1 &&\r\n                              selectedRows.length <= 1\r\n                            ? 'bg-primary'\r\n                            : '',\r\n                        ]\"\r\n                        v-for=\"(i, index) in thirdTrIdData\"\r\n                        :key=\"index + 'td'\"\r\n                        class=\"text-center p\"\r\n                    >\r\n                      <p class=\"m-0 p-2\" v-if=\"i.typeCode === 'SEQUENCE'\">\r\n                        {{ index1 + 1 }}\r\n                      </p>\r\n                      <div\r\n                          v-else-if=\"i.typeCode === 'SELECT' && thirdTrIdData[index].value[index1] && thirdTrIdData[index].value[index1].notEditable\"\r\n                          :v-b-tooltip=\"tableInfo.isGenerated ? '' :{ variant: 'info' }\"\r\n                          class=\"cursor-pointer\"\r\n                          @click=\"tableInfo.isGenerated ? '' : editValue(index1, index)\"\r\n                          :title=\"tableInfo.isGenerated ? '' :  $t('actions.click_to_edit')\"\r\n                      >\r\n                        {{\r\n                          getName({\r\n                            nameUz: thirdTrIdData[index].value[index1].selectValueNameUz,\r\n                            nameLt: thirdTrIdData[index].value[index1].selectValueNameLt,\r\n                            nameRu: thirdTrIdData[index].value[index1].selectValueNameRu\r\n                          })\r\n                        }}\r\n                      </div>\r\n                      <!-- FOR SELECT -->\r\n                      <div v-else-if=\"i.typeCode === 'SELECT'\" style=\"min-width: 300px;\">\r\n                        <BaseTreeselectWithValidation\r\n                            not-required\r\n                            ref=\"parentDepVeeName\"\r\n                            name=\"parentDepVeeName\"\r\n                            class=\"select_field\"\r\n                            v-if=\"thirdTrIdData[index].value[index1] && ['DepartmentForDocument', 'Department'].includes(i.refCode)\"\r\n                            v-model=\"thirdTrIdData[index].value[index1].selectedItem\"\r\n                            form-label=\"__none\"\r\n                            :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId})\"\r\n                            :options=\"i.options\"\r\n                            :show-count=\"true\"\r\n                            :normalizer=\"normalizer\"\r\n                            :placeholder=\"$t('column.parent_department')\"\r\n                            :custom-label=\"selectCustomLabel\"\r\n                            :default-expand-level=\"1\"\r\n                            @select=\"setValue(data.id,$event,index1,index,i.columnId,i.typeCode,i.notEditable)\"\r\n                            @search-change=\"debounceSearchDynamicRefs\"\r\n                        >\r\n                          <div slot=\"value-label\">-{{ thirdTrIdData[index].value[index1].selectValueNameUz }}</div>\r\n                        </BaseTreeselectWithValidation>\r\n                        <BaseTreeselectWithValidation\r\n                            not-required\r\n                            ref=\"parentDepVeeName\"\r\n                            name=\"parentDepVeeName\"\r\n                            class=\"select_field\"\r\n                            v-if=\"!thirdTrIdData[index].value[index1] && ['DepartmentForDocument', 'Department'].includes(i.refCode)\"\r\n                            v-model=\"thirdTrIdData[index].value[index1]\"\r\n                            form-label=\"__none\"\r\n                            :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId})\"\r\n                            :options=\"i.options\"\r\n                            :show-count=\"true\"\r\n                            :normalizer=\"normalizer\"\r\n                            :placeholder=\"$t('column.parent_department')\"\r\n                            :default-expand-level=\"1\"\r\n                            :custom-label=\"({nameUz, nameLt, nameRu, name})  => nameUz ? getName({nameUz: nameUz, nameLt: nameLt, nameRu: nameRu}) : name\"\r\n                            @select=\"setValue(data.id,$event,index1,index,i.columnId,i.typeCode,i.notEditable)\"\r\n                            @search-change=\"debounceSearchDynamicRefs\"\r\n                        >\r\n                        </BaseTreeselectWithValidation>\r\n                        <BaseMultiselectWithValidation\r\n                            v-if=\"thirdTrIdData[index].value[index1] && !['DepartmentForDocument', 'Department'].includes(i.refCode)\"\r\n                            not-required\r\n                            only-form-element\r\n                            v-model=\"thirdTrIdData[index].value[index1].selectedItem\"\r\n                            class=\"select_field\"\r\n                            :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId})\"\r\n                            :custom-label=\"selectCustomLabel\"\r\n                            label=\"name\"\r\n                            @select=\"setValue(data.id,$event,index1,index,i.columnId,i.typeCode,i.notEditable)\"\r\n                            :options=\"i.options\"\r\n                            :placeholder=\"getName({nameUz: i.referenceNameUz, nameLt: i.referenceNameLt, nameRu: i.referenceNameRu})\"\r\n                            open-direction=\"bottom\"\r\n                            :max-height=\"600\"\r\n                            :show-labels=\"false\"\r\n                            :has-next-page=\"i.hasNextPage\"\r\n                            @reachedEndOfList=\"dynamicRefsReachedEndOfList\"\r\n                            @search-change=\"debounceSearchDynamicRefs\"\r\n                            :searchable=\"true\"\r\n                            preserve-search\r\n                            :clear-on-select=\"false\"\r\n                            :loading=\"i.isLoading\"\r\n                            :internal-search=\"false\"\r\n                            :with-create-addition=\"(thirdTrIdData[index].value[index1] && thirdTrIdData[index].value[index1].originalSelectValueNameUz) ? true : false\"\r\n                        >\r\n                          <template v-slot:append-slot>\r\n                            <b-btn\r\n                                v-if=\"thirdTrIdData[index].value[index1] && thirdTrIdData[index].value[index1].originalSelectValueNameUz\"\r\n                                variant=\"link\"\r\n                                class=\"text-decoration-none p-0 text-danger\"\r\n                                style=\"font-size: 1.2rem;\"\r\n                            >\r\n                              <i\r\n                                  @click=\"resetValue(index1, index)\"\r\n                                  class=\"mdi mdi-refresh\"\r\n                              ></i>\r\n                            </b-btn>\r\n                          </template>\r\n                        </BaseMultiselectWithValidation>\r\n                        <BaseMultiselectWithValidation\r\n                            v-else-if=\"!thirdTrIdData[index].value[index1] && !['DepartmentForDocument', 'Department'].includes(i.refCode)\"\r\n                            not-required\r\n                            only-form-element\r\n                            class=\"select_field\"\r\n                            :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId})\"\r\n                            v-model=\"thirdTrIdData[index].value[index1]\"\r\n                            :custom-label=\"selectCustomLabel\"\r\n                            label=\"name\"\r\n                            @select=\"setValue(data.id,$event,index1,index,i.columnId,i.typeCode,i.notEditable)\"\r\n                            :options=\"i.options\"\r\n                            :placeholder=\"getName({nameUz: i.referenceNameUz, nameLt: i.referenceNameLt, nameRu: i.referenceNameRu})\"\r\n                            open-direction=\"bottom\"\r\n                            :max-height=\"600\"\r\n                            :show-labels=\"false\"\r\n                            :has-next-page=\"i.hasNextPage\"\r\n                            @reachedEndOfList=\"dynamicRefsReachedEndOfList\"\r\n                            @search-change=\"debounceSearchDynamicRefs\"\r\n                            :searchable=\"true\"\r\n                            preserve-search\r\n                            :clear-on-select=\"false\"\r\n                            :loading=\"i.isLoading\"\r\n                            :internal-search=\"false\"\r\n                        />\r\n                      </div>\r\n                      <!-- FOR DATE -->\r\n                      <BaseDatePickerWithValidation\r\n                          v-else-if=\"i.typeCode === 'DATE' && thirdTrIdData[index].value[index1]\"\r\n                          not-required\r\n                          only-form-element\r\n                          custom-styles=\"min-width: 140px;\"\r\n                          placeholder=\"\"\r\n                          v-model=\"thirdTrIdData[index].value[index1].value\"\r\n                          class=\"datepicker_field\"\r\n                          :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId,})\"\r\n                          @input=\"(e) => setValue( data.id, e, index1, index, i.columnId, i.typeCode ) \"\r\n                          lang=\"ru\"\r\n                      />\r\n                      <BaseDatePickerWithValidation\r\n                          v-else-if=\"i.typeCode === 'DATE'\"\r\n                          not-required\r\n                          only-form-element\r\n                          custom-styles=\"min-width: 140px;\"\r\n                          class=\"datepicker_field\"\r\n                          :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId,})\"\r\n                          placeholder=\"\"\r\n                          @input=\"(e) =>setValue(data.id,e,index1,index,i.columnId,i.typeCode)\"\r\n                          lang=\"ru\"\r\n                      />\r\n\r\n                      <!-- FOR YEAR -->\r\n                      <BaseDatePickerWithValidation\r\n                          v-else-if=\"i.typeCode === 'YEAR' && thirdTrIdData[index].value[index1]\"\r\n                          not-required\r\n                          only-form-element\r\n                          custom-styles=\"min-width: 140px;\"\r\n                          placeholder=\"\"\r\n                          v-model=\"thirdTrIdData[index].value[index1].value\"\r\n                          class=\"datepicker_field dynamic-year\"\r\n                          :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId,})\"\r\n                          @input=\"(e) => setValue( data.id, e, index1, index, i.columnId, i.typeCode ) \"\r\n                          type=\"year\"\r\n                          format=\"YYYY\"\r\n                      />\r\n                      <BaseDatePickerWithValidation\r\n                          v-else-if=\"i.typeCode === 'YEAR'\"\r\n                          not-required\r\n                          only-form-element\r\n                          custom-styles=\"min-width: 140px;\"\r\n                          class=\"datepicker_field dynamic-year\"\r\n                          :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId,})\"\r\n                          placeholder=\"\"\r\n                          @input=\"(e) =>setValue(data.id,e,index1,index,i.columnId,i.typeCode)\"\r\n                          type=\"year\"\r\n                          format=\"YYYY\"\r\n                      />\r\n\r\n                      <!-- FOR STRING -->\r\n                      <div v-else-if=\"i.typeCode === 'STRING'\" style=\"min-width: 300px;\">\r\n                        <b-form-input\r\n                            @keydown=\" (evt) => keydownEvt( evt, data.id, evt.target.value, index1, index, i.columnId, i.typeCode ) \"\r\n                            @keyup=\"(event) => calculateDocFormulas(data.id, event.target.value, index1, index, i.columnId, i.typeCode)\"\r\n                            :class=\"\r\n                              currentPosition.rowId &&\r\n                              currentPosition.columnId &&\r\n                              i.columnId == currentPosition.columnId &&\r\n                              data.id == currentPosition.rowId\r\n                                ? 'borderInput'\r\n                                : currentPosition.columnId &&\r\n                                  !currentPosition.rowId &&\r\n                                  i.columnId == currentPosition.columnId\r\n                                ? 'borderInput'\r\n                                : ''\r\n                            \"\r\n                            @focus=\" (e) => focusVal( data.id, e, index1, index, i.columnId, i.typeCode ) \"\r\n                            :style=\" report.status && report.status !== 'CREATED' ? 'border: none !important' : ''\"\r\n                            :disabled=\"report.status && report.status !== 'CREATED'\"\r\n                            :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId,})\"\r\n                            @input=\"(e) => setValue( data.id, e, index1, index, i.columnId, i.typeCode)\"\r\n                            class=\"text-center input_val p-0\"\r\n                        >\r\n                        </b-form-input>\r\n                      </div>\r\n                      <!-- FOR BOOLEAN -->\r\n                      <Checkbox\r\n                          v-else-if=\"i.typeCode === 'BOOLEAN' && thirdTrIdData[index].value[index1]\"\r\n                          v-model=\"thirdTrIdData[index].value[index1].value\"\r\n                          :font-size=\"0\"\r\n                          :disabled=\"\r\n                            report.status && report.status !== 'CREATED'\r\n                          \"\r\n                          :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId,})\"\r\n                          class=\"justify-content-center checkbox_field\"\r\n                          @change=\"(e) =>setValue(data.id,e,index1,index,i.columnId,i.typeCode)\"\r\n                      />\r\n                      <Checkbox\r\n                          v-else-if=\"i.typeCode === 'BOOLEAN'\"\r\n                          :font-size=\"0\"\r\n                          :disabled=\"\r\n                            report.status && report.status !== 'CREATED'\r\n                          \"\r\n                          :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId,})\"\r\n                          class=\"justify-content-center checkbox_field\"\r\n                          @change=\"(e) =>setValue(data.id,e,index1,index,i.columnId,i.typeCode)\"\r\n                      />\r\n                      <!-- FOR INTEGER -->\r\n                      <div v-else>\r\n                        <b-form-input\r\n                            @keydown=\"(evt) => keydownEvt(evt,data.id,evt.target.value,index1,index,i.columnId,i.typeCode) \"\r\n                            @keyup=\"(event) => calculateDocFormulas(data.id, event.target.value, index1, index, i.columnId, i.typeCode)\"\r\n                            :class=\"\r\n                              currentPosition.rowId &&\r\n                              currentPosition.columnId &&\r\n                              i.columnId == currentPosition.columnId &&\r\n                              data.id == currentPosition.rowId\r\n                                ? 'borderInput'\r\n                                : currentPosition.columnId &&\r\n                                  !currentPosition.rowId &&\r\n                                  i.columnId == currentPosition.columnId\r\n                                ? 'borderInput'\r\n                                : ''\r\n                            \"\r\n                            :data-column-id=\"i.columnId\"\r\n                            @focus=\"(e) => focusVal(data.id, e, index1, index, i.columnId, i.typeCode)\"\r\n                            :style=\"report.status && report.status !== 'CREATED' ? 'border: none !important' : ''\"\r\n                            :disabled=\"report.status && report.status !== 'CREATED'\"\r\n                            :id=\"JSON.stringify({rowId: data.id,columnId: i.columnId,})\"\r\n                            @input=\"(e) => setValue(data.id, e, index1, index, i.columnId, i.typeCode)\"\r\n                            type=\"number\"\r\n                            class=\"text-center input_val p-0\"\r\n                        >\r\n                        </b-form-input>\r\n                      </div>\r\n                    </td>\r\n                    <td style=\"width: 30px\" v-show=\"tableInfo.hasDynamicRows &&  !tableInfo.isGenerated\">\r\n                      <div style=\"display: block; text-align: center\" class=\"mt-1\">\r\n                        <i v-if=\"selectedRows.length > 1\" @click=\"deleteRow(index1, data)\" style=\"color: red\"\r\n                           class=\"mdi mdi-trash-can delete grow \"></i>\r\n                        <i v-if=\"selectedRows.length-1 === index1\" @click=\"addNewRow\" style=\"color: #0059ff\"\r\n                           class=\"mdi mdi-plus-circle grow \"> </i>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                  </tbody>\r\n                  <tfoot>\r\n                  <tr class=\"mt-5\" v-show=\"showResult\"\r\n                  >\r\n                    <td v-for=\"(i, index) in thirdTrIdData\"\r\n                        :key=\"index + 'td'\"\r\n                        class=\"text-center p\"\r\n                    >\r\n                      <p v-if=\"index === 0\">Jami</p>\r\n                      <div v-else-if=\"i.typeCode === 'BIGDECIMAL'\">\r\n                        {{ getColumnData(i) }}\r\n                      </div>\r\n                      <div v-else>---</div>\r\n                    </td>\r\n                    <td></td>\r\n                  </tr>\r\n                  </tfoot>\r\n                </table>\r\n              </div>\r\n              <div v-show=\"tableInfo.hasDynamicRows &&  !tableInfo.isGenerated\">\r\n                <!-- <b-button variant=\"primary\" class=\"mr-1\" @click=\"showResult = !showResult \">\r\n                  {{ $t( 'submodules.reports.report_result_see' ) }}\r\n                </b-button> -->\r\n                <b-button closed variant=\"warning\" class=\"ml-1\" @click=\"closeReport\">\r\n                  {{ $t('submodules.reports.stop_forming_report') }}\r\n                </b-button>\r\n              </div>\r\n            </div>\r\n          </b-overlay>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<style lang=\"scss\">\r\n.borderInput {\r\n  border: 2px solid green !important;\r\n}\r\n\r\nth {\r\n  /* &#SELECT {\r\n    width: 20%;\r\n  } */\r\n  &[id*=\"SELECT\"] {\r\n    width: 150px;\r\n  }\r\n}\r\n\r\n.check {\r\n  margin-top: 5px;\r\n\r\n  .m-chckbox--container {\r\n    margin: 0px !important;\r\n    width: 22px !important;\r\n  }\r\n\r\n  label {\r\n    margin: 0;\r\n    display: none;\r\n  }\r\n}\r\n\r\n.vue-treeselect__list-item {\r\n  padding-left: 15px !important;\r\n}\r\n\r\n.vue-treeselect__list-item.vue-treeselect__indent-level-0 {\r\n  padding-left: 0px !important;\r\n}\r\n</style>\r\n<style lang=\"scss\">\r\n/* Chrome, Safari, Edge, Opera */\r\ninput::-webkit-outer-spin-button,\r\ninput::-webkit-inner-spin-button {\r\n  -webkit-appearance: none;\r\n  margin: 0;\r\n}\r\n\r\n/* Firefox */\r\ninput[type=\"number\"] {\r\n  -moz-appearance: textfield;\r\n}\r\n\r\n.rotate_text {\r\n  height: 100%;\r\n  word-break: normal;\r\n  writing-mode: vertical-rl;\r\n  -ms-writing-mode: vertical-lr;\r\n  -webkit-transform: rotate(-180deg);\r\n  -moz-transform: rotate(-180deg);\r\n  -o-transform: rotate(-180deg);\r\n  transform: rotate(-180deg);\r\n  padding-bottom: 20px !important;\r\n  padding-top: 20px !important;\r\n}\r\n\r\n.no_enter_value {\r\n  padding: 0px !important;\r\n  min-width: auto !important;\r\n}\r\n\r\n.grow {\r\n  font-size: 1.3em;\r\n  cursor: pointer;\r\n}\r\n\r\n.grow:hover,\r\n.grow:focus,\r\n.grow:active {\r\n  transition: all .2s ease-in-out;\r\n  -webkit-transform: scale(1.3);\r\n  transform: scale(1.3);\r\n}\r\n</style>\r\n"]}]}