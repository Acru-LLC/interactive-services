(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-071cda1b"],{"4b91":function(t,e,o){},"85cc":function(t,e,o){"use strict";o("4b91")},"9df2":function(t,e,o){"use strict";o.r(e);o("d81d");var n=function(){var t=this,e=t._self._c;return e("div",[e("div",[e("div",{staticClass:"card card-body stickyHead",attrs:{id:"myHeader"}},[e("div",{staticClass:"d-flex"},[e("div",{staticStyle:{width:"58%"}},[t.numPages?e("h5",{staticClass:"float-right m-0"},[t._v(" "+t._s(t.currentPage)+" / "+t._s(t.numPages)+" ")]):t._e()]),e("div",{staticStyle:{width:"43%"}},[e("div",{staticClass:"float-right d-flex align-items-center"},[e("b-button-group",[e("b-button",{staticClass:"float-right",attrs:{variant:"primary"},on:{click:t.signData}},[e("b-overlay",{attrs:{opacity:.1,show:t.loaderQrCode,rounded:"sm"}},[e("i",{staticClass:"fa fa-qrcode mr-1"}),t._v(" "+t._s(t.$t("actions.qrcode"))+" ")])],1),e("b-button",{staticClass:"float-right mr-2",attrs:{variant:"success"},on:{click:t.save}},[e("i",{staticClass:"fa fa-save"}),t._v(" "+t._s(t.$t("actions.save"))+" ")])],1),e("b-button",{staticClass:"float-right mr-2",attrs:{to:{name:"LetterIncome"},variant:"primary"}},[e("i",{staticClass:"fa fa-arrow-left"})])],1)])])]),e("div",{staticClass:"mt-5"},[e("b-row",[e("b-col",{attrs:{cols:"12"}},[e("div",{staticClass:"d-flex justify-content-center"},[e("b-overlay",{attrs:{variant:"white",opacity:1,show:t.loaderPdf,rounded:"lg"}},[e("div",{staticStyle:{width:"270mm !important","min-height":"210mm",position:"relative"},attrs:{id:"pdfId"}},[t.imgUrl&&t.qrCodePage==t.currentPage?e("VueDragResize",{staticStyle:{"z-index":"3"},attrs:{isActive:!0,w:110,h:110,x:t.x,y:t.y,parent:!0,isResizable:!1,parentLimitation:!0},on:{resizing:t.resize,dragging:t.resize}},[e("img",{attrs:{src:"".concat(t.imgUrl?"data:image/png;base64, ".concat(t.imgUrl):o("7e77"))},on:{mouseenter:t.mouseEnter,mousemove:t.mousemove,mouseleave:t.mouseLeave}})]):t._e(),t.src?e("pdf",{ref:"myPdfComponent",attrs:{page:t.currentPage,src:t.src},on:{"num-pages":function(e){t.numPages=e}}}):t._e()],1)])],1)])],1),e("b-row",[e("b-col",{attrs:{cols:"12"}},[e("div",{staticClass:"d-flex mt-4 justify-content-center"},[e("div",{staticClass:"d-flex mt-4",staticStyle:{overflow:"auto","max-width":"90%"}},t._l(t.numPages,(function(n){return e("div",{key:n+"page",staticClass:"ml-3 mb-4"},[e("div",{staticClass:"my-card-hovered-pdf",class:t.currentPage==n?"my-card-hovered-pdf-active":"",on:{click:function(e){return e.preventDefault(),t.setCurrentPage(n)}}},[e("div",{staticStyle:{width:"200px",position:"relative"}},[t.imgUrl&&t.qrCodePage==n?e("div",{style:{top:"".concat(t.y/5.1,"px"),left:"".concat(t.x/5.08,"px"),position:"absolute","z-index":999}},[t.imgUrl?e("img",{attrs:{height:20,width:20,src:"".concat(t.imgUrl?"data:image/png;base64, ".concat(t.imgUrl):o("7e77"))}}):t._e()]):t._e(),t.src?e("pdf",{attrs:{src:t.src,page:n}}):t._e()],1)])])})),0)])])],1)],1)]),e("b-modal",{attrs:{scrollable:"",size:"md",title:"".concat(t.$t("submodules.commission.title"))},scopedSlots:t._u([{key:"modal-footer",fn:function(){return[e("b-button",{attrs:{variant:"success"},on:{click:t.openSignatureModalForCommission}},[e("b-overlay",{attrs:{opacity:.1,show:t.commissionModalLoader,rounded:"sm"}},[t._v(" "+t._s(t.$t("actions.continue"))+" ")])],1)]},proxy:!0}]),model:{value:t.commissionsModal,callback:function(e){t.commissionsModal=e},expression:"commissionsModal"}},[e("BaseMultiselectWithValidation",{staticClass:"required",attrs:{rules:"required",options:t.commissionTypes.map((function(t){return t.id})),label:t.$t("submodules.commission.special_commission_type.title"),"label-on-top":"",placeholder:"","custom-label":t.customLabelCommissionTypes,"open-direction":"bottom","max-height":600,"show-labels":!1},model:{value:t.commissionTypeId,callback:function(e){t.commissionTypeId=e},expression:"commissionTypeId"}}),e("b-form-textarea",{staticClass:"mt-3",attrs:{placeholder:t.$t("submodules.doc.summary"),rows:"5"},model:{value:t.commissionComment,callback:function(e){t.commissionComment=e},expression:"commissionComment"}})],1),e("b-modal",{attrs:{scrollable:"",size:"md",title:"".concat(t.$t("submodules.commission.title"))},scopedSlots:t._u([{key:"modal-footer",fn:function(){return[e("b-button",{attrs:{variant:"success"},on:{click:t.openSignatureModalForCommissionForComment}},[e("b-overlay",{attrs:{opacity:.1,show:t.commissionModalLoader,rounded:"sm"}},[t._v(" "+t._s(t.$t("actions.continue"))+" ")])],1)]},proxy:!0}]),model:{value:t.commissionsModalForComment,callback:function(e){t.commissionsModalForComment=e},expression:"commissionsModalForComment"}},[e("b-form-textarea",{staticClass:"mt-3",attrs:{placeholder:t.$t("submodules.doc.summary"),rows:"5"},model:{value:t.comment4Commission,callback:function(e){t.comment4Commission=e},expression:"comment4Commission"}})],1),e("b-modal",{attrs:{scrollable:"","hide-footer":"",size:"lg",title:"".concat(t.$t("submodules.reports.make_sign"))},model:{value:t.signatureModal,callback:function(e){t.signatureModal=e},expression:"signatureModal"}},[e("b-overlay",{attrs:{opacity:.1,show:t.loaderSign,rounded:"sm"}},[e("SignKeys",{attrs:{dataToSign:t.currentDoc},on:{sign:t.signSuccess}})],1)],1)],1)},a=[],s=o("c7eb"),i=o("1da1"),r=(o("7db0"),o("d3b7"),o("14d9"),o("99af"),o("6275")),c=o("858e"),l=o("93c1"),u=o("3b9b"),d=o("3b58"),m=o.n(d),f={data:function(){return{commissionTypeId:null,commissionComment:"",comment4Commission:"",commissionModalLoader:!1,commissionTypes:[],commissionsModal:!1,commissionsModalForComment:!1,currentPage:1,pageCount:0,src:null,imgUrl:null,width:110,height:110,x:200,y:300,numPages:void 0,pageYOffset:0,loaderQrCode:!1,qrCodePage:null,loaderPdf:!1,currentDoc:{},signatureModal:!1,deleteQrPosition:!1,loaderSign:!1}},name:"Signature",components:{VueDragResize:m.a,pdf:c["a"],SignKeys:u["a"]},created:function(){this.getByIdLetter(),document.addEventListener("keyup",this.keyUpEvents)},methods:{openSignatureModalForCommissionForComment:function(){this.signatureModal=!0},openSignatureModalForCommission:function(){this.commissionTypeId?this.signatureModal=!0:this.$toast(this.$t("messages.fill_required_fields"),{type:"error"})},customLabelCommissionTypes:function(t){var e=this.commissionTypes.find((function(e){return e.id==t}));return e?"".concat(this.getName({nameRu:e.nameRu,nameLt:e.nameLt,nameUz:e.nameUz})):""},convertToPdf:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(o,n){var a={url:"".concat(t.url),outputtype:".pdf",forSign:e,key:t.key};l["a"].convertToPdfByApi(a).then((function(t){t.data.uploadPath?o(t.data.uploadPath):o(!1)})).catch((function(t){n(t)}))}))},mouseEnter:function(){this.deleteQrPosition=!0},mouseLeave:function(){this.deleteQrPosition=!1},mousemove:function(){this.deleteQrPosition=!0},signSuccess:function(t){var e=this;return Object(i["a"])(Object(s["a"])().mark((function o(){var n;return Object(s["a"])().wrap((function(o){while(1)switch(o.prev=o.next){case 0:e.loaderSign=!0,n={signedContent:t.content,inn:t.inn,pnfl:t.pnfl},o.t0=e.currentDoc.letterType,o.next="DECISION_COMMISSION"===o.t0?5:"PRESCRIPTION_COMMISSION"===o.t0?7:"PROTOCOL_COMMISSION"===o.t0?9:"COMPROMISE_DECISION_SUSPEND"===o.t0?11:"COMPROMISE_DECISION_DELAY"===o.t0?13:"COMPROMISE_DECISION_RESUME"===o.t0?15:"PROTOCOL_SUSPEND"===o.t0?17:"PROTOCOL_DELAY"===o.t0?19:"PROTOCOL_RESUME"===o.t0?21:"LETTER_INVOKE"===o.t0?23:25;break;case 5:return e.onlyDocSignFORBeforeProject(n),o.abrupt("break",27);case 7:return e.onlyDocSignFORBeforeProject(n),o.abrupt("break",27);case 9:return e.onlyDocSignFORBeforeProject(n),o.abrupt("break",27);case 11:return e.onlyDocSignFORBeforeProject(n),o.abrupt("break",27);case 13:return e.onlyDocSignFORBeforeProject(n),o.abrupt("break",27);case 15:return e.onlyDocSignFORBeforeProject(n),o.abrupt("break",27);case 17:return e.onlyDocSignFORBeforeProject(n),o.abrupt("break",27);case 19:return e.onlyDocSignFORBeforeProject(n),o.abrupt("break",27);case 21:return e.onlyDocSignFORBeforeProject(n),o.abrupt("break",27);case 23:return e.onlyDocSignFORBeforeProject(n),o.abrupt("break",27);case 25:return l["a"].onlyDocSignFORBeforeProject(n,e.$route.params.id,e.x,e.y,e.currentPage-1).then((function(){Object(r["v"])(e.$t("successDocSigned")),e.$router.push("/projects/main")})).catch((function(t){})).finally((function(){e.loaderSign=!1,e.signatureModal=!1})),o.abrupt("break",27);case 27:case"end":return o.stop()}}),o)})))()},onlyDocSignFORBeforeProject:function(t){var e=this;return Object(i["a"])(Object(s["a"])().mark((function o(){return Object(s["a"])().wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,l["a"].onlyDocSignFORBeforeProject(t,e.$route.params.id,e.x,e.y,e.currentPage-1).then(Object(i["a"])(Object(s["a"])().mark((function t(){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return Object(r["v"])(e.$t("successDocSigned")),t.next=3,e.$router.push({name:"CommissionProjects"});case 3:case"end":return t.stop()}}),t)})))).catch((function(t){})).finally((function(){e.loaderSign=!1}));case 2:case"end":return o.stop()}}),o)})))()},getByIdLetter:function(){var t=this;this.loaderPdf=!0,l["a"].getByIdLetter(this.$route.params.id).then((function(e){if(t.currentDoc=e.data,t.loaderPdf=!0,"pdf"===t.currentDoc.fileType)return t.$nextTick((function(){t.src="".concat(t.baseUrl,"/").concat(t.currentDoc.url),t.loaderPdf=!1}));t.convertToPdf(e.data).then((function(o){o?(t.$nextTick((function(){t.src=c["a"].createLoadingTask("".concat(t.baseUrl,"/").concat(o))})),t.loaderPdf=!1):setTimeout((function(){t.convertToPdf(e.data).then((function(e){t.$nextTick((function(){var o=c["a"].createLoadingTask("".concat(t.baseUrl,"/").concat(e));t.src=o})),t.loaderPdf=!1})).catch((function(e){t.loaderPdf=!1}))}),4e3)}))})).catch((function(t){})).finally((function(){t.loaderPdf&&(t.loaderPdf=!1)}))},keyUpEvents:function(t){46==t.keyCode&&this.currentPage==this.qrCodePage&&this.deleteQrPosition?(this.imgUrl=null,this.qrCodePage=null,this.deleteQrPosition=!1):39==t.keyCode&&this.currentPage!=this.numPages&&this.src?this.currentPage++:37==t.keyCode&&this.currentPage>1&&this.src&&this.currentPage--},setCurrentPage:function(t){this.currentPage=t},resize:function(t){this.width=t.width,this.height=t.height,this.y=t.top,this.x=t.left},getPdf:function(){var t=this;return new Promise((function(e,o){t.convertToPdf(),l["a"].getDocPdf(t.$route.params.id).then((function(o){var n=o.data;t.$nextTick((function(){t.src=c["a"].createLoadingTask("data:application/pdf;base64, ".concat(n))})),e(o.data)})).catch((function(t){o(t)})).finally((function(){setTimeout((function(){t.loaderPdf=!1}),500)}))}))},signData:function(){var t=this;this.src?this.qrCodePage&&this.imgUrl?Object(r["u"])(this.$t("qrcodeWaring")):(this.loaderQrCode=!0,l["a"].letterQRCODE(this.$route.params.id).then((function(e){e.data&&(t.qrCodePage=t.currentPage,t.imgUrl=e.data)})).catch((function(t){})).finally((function(){t.loaderQrCode=!1}))):Object(r["u"])(this.$t("docNotUploaded"))},save:function(){null!=this.qrCodePage&&this.imgUrl&&this.src?this.signatureModal=!0:Object(r["u"])(this.$t("qrcodeNotFound"))}}},g=f,p=(o("85cc"),o("2877")),h=Object(p["a"])(g,n,a,!1,null,null,null);e["default"]=h.exports}}]);