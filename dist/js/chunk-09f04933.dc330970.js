(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-09f04933"],{"0641":function(e,t,a){"use strict";a("4238")},4238:function(e,t,a){},"9c7c":function(e,t,a){"use strict";a.r(t);a("d81d");var i=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("div",{staticClass:"card card-body stickyHead",attrs:{id:"myHeader"}},[t("div",{staticClass:"d-flex"},[t("div",{staticStyle:{width:"58%"}},[e.numPages?t("h5",{staticClass:"float-right m-0"},[e._v(" "+e._s(e.currentPage)+" / "+e._s(e.numPages)+" ")]):e._e()]),t("div",{staticStyle:{width:"43%"}},[t("div",{staticClass:"float-right d-flex align-items-center"},[t("b-button-group",[t("b-button",{staticClass:"float-right",attrs:{variant:"primary"},on:{click:e.signData}},[t("b-overlay",{attrs:{opacity:.1,show:e.loaderQrCode,rounded:"sm"}},[t("i",{staticClass:"fa fa-qrcode mr-1"}),e._v(" "+e._s(e.$t("actions.qrcode"))+" ")])],1),t("b-button",{staticClass:"float-right mr-2",attrs:{variant:"success"},on:{click:e.save}},[t("i",{staticClass:"fa fa-save"}),e._v(" "+e._s(e.$t("actions.save"))+" ")])],1),t("b-button",{staticClass:"float-right mr-2",attrs:{to:{name:"CommissionProjects"},variant:"primary"}},[t("i",{staticClass:"fa fa-arrow-left"})])],1)])])]),t("div",{staticClass:"mt-5"},[t("b-row",[t("b-col",{attrs:{cols:"12"}},[t("div",{staticClass:"d-flex justify-content-center"},[t("b-overlay",{attrs:{variant:"white",opacity:1,show:e.loaderPdf,rounded:"lg"}},[t("div",{staticStyle:{width:"270mm !important","min-height":"210mm",position:"relative"},attrs:{id:"pdfId"}},[e.imgUrl&&e.qrCodePage==e.currentPage?t("VueDragResize",{staticStyle:{"z-index":"3"},attrs:{isActive:!0,w:110,h:110,x:e.x,y:e.y,parent:!0,isResizable:!1,parentLimitation:!0},on:{resizing:e.resize,dragging:e.resize}},[t("img",{attrs:{src:"".concat(e.imgUrl?"data:image/png;base64, ".concat(e.imgUrl):a("7e77"))},on:{mouseenter:e.mouseEnter,mousemove:e.mousemove,mouseleave:e.mouseLeave}})]):e._e(),e.src?t("pdf",{ref:"myPdfComponent",attrs:{page:e.currentPage,src:e.src},on:{"num-pages":function(t){e.numPages=t}}}):e._e()],1)])],1)])],1),t("b-row",[t("b-col",{attrs:{cols:"12"}},[t("div",{staticClass:"d-flex mt-4 justify-content-center"},[t("div",{staticClass:"d-flex mt-4",staticStyle:{overflow:"auto","max-width":"90%"}},e._l(e.numPages,(function(i){return t("div",{key:i+"page",staticClass:"ml-3 mb-4"},[t("div",{staticClass:"my-card-hovered-pdf",class:e.currentPage===i?"my-card-hovered-pdf-active":"",on:{click:function(t){return t.preventDefault(),e.setCurrentPage(i)}}},[t("div",{staticStyle:{width:"200px",position:"relative"}},[e.imgUrl&&e.qrCodePage==i?t("div",{staticStyle:{position:"absolute","z-index":"999"},style:{top:"".concat(e.y/5.1,"px"),left:"".concat(e.x/5.08,"px")}},[e.imgUrl?t("img",{attrs:{height:20,width:20,src:"".concat(e.imgUrl?"data:image/png;base64, ".concat(e.imgUrl):a("7e77"))}}):e._e()]):e._e(),e.src?t("pdf",{attrs:{src:e.src,page:i}}):e._e()],1)])])})),0)])])],1)],1)]),t("b-modal",{attrs:{scrollable:"",size:"md",title:"".concat(e.$t("column.employee"))},scopedSlots:e._u([{key:"modal-footer",fn:function(){return[t("b-button",{attrs:{variant:"success"},on:{click:e.openSignatureModalForEmployee}},[t("b-overlay",{attrs:{opacity:.1,show:e.employee.modalLoader,rounded:"sm"}},[e._v(" "+e._s(e.$t("actions.continue"))+" ")])],1)]},proxy:!0}]),model:{value:e.employee.modal,callback:function(t){e.$set(e.employee,"modal",t)},expression:"employee.modal"}},[t("BaseMultiselectWithValidation",{staticClass:"required",attrs:{rules:"required",options:e.employee.list.map((function(e){return e.id})),label:e.$t("column.employee"),"label-on-top":"",placeholder:"","custom-label":e.customLabelEmployee,"open-direction":"bottom","max-height":600,"show-labels":!1},on:{"search-change":e.fetchEmployeeList},model:{value:e.employee.id,callback:function(t){e.$set(e.employee,"id",t)},expression:"employee.id"}}),t("b-form-textarea",{staticClass:"mt-3",attrs:{placeholder:e.$t("submodules.doc.summary"),rows:"5"},model:{value:e.employee.comment,callback:function(t){e.$set(e.employee,"comment",t)},expression:"employee.comment"}})],1),t("b-modal",{attrs:{scrollable:"","hide-footer":"",size:"lg",title:"".concat(e.$t("submodules.reports.make_sign"))},model:{value:e.signatureModal,callback:function(t){e.signatureModal=t},expression:"signatureModal"}},[t("b-overlay",{attrs:{opacity:.1,show:e.loaderSign,rounded:"sm"}},[t("SignKeys",{attrs:{dataToSign:e.currentDoc},on:{sign:e.signSuccess}})],1)],1)],1)},o=[],n=a("5530"),s=a("c7eb"),r=a("1da1"),c=(a("7db0"),a("d3b7"),a("b0c0"),a("14d9"),a("99af"),a("6275")),l=a("858e"),d=a("93c1"),u=a("03f4"),m=a("3b9b"),f=a("3b58"),h=a.n(f),p={data:function(){return{employee:{id:null,comment:"",modal:!1,modalLoader:!1,interval:!1,list:[]},commissionsModal:!1,currentPage:1,pageCount:0,src:null,imgUrl:null,width:110,height:110,x:200,y:300,numPages:void 0,pageYOffset:0,loaderQrCode:!1,qrCodePage:null,loaderPdf:!1,currentDoc:{},signatureModal:!1,deleteQrPosition:!1,loaderSign:!1}},name:"Signature",components:{VueDragResize:h.a,SignKeys:m["a"],pdf:l["a"]},created:function(){this.getByIdLetter(),document.addEventListener("keyup",this.keyUpEvents)},methods:{openSignatureModalForEmployee:function(){this.employee.id?this.signatureModal=!0:this.$toast(this.$t("messages.fill_required_fields"),{type:"error"})},customLabelEmployee:function(e){var t=this.employee.list.find((function(t){return t.id==e}));return t?t.fullName:""},convertToPdf:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(a,i){var o={url:"".concat(e.url),outputtype:".pdf",forSign:t,key:e.key};d["a"].convertToPdfByApi(o).then((function(e){e.data.uploadPath?a(e.data.uploadPath):a(!1)})).catch((function(e){i(e)}))}))},mouseEnter:function(){this.deleteQrPosition=!0},mouseLeave:function(){this.deleteQrPosition=!1},mousemove:function(){this.deleteQrPosition=!0},signSuccess:function(e){var t=this;return Object(r["a"])(Object(s["a"])().mark((function a(){var i;return Object(s["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.loaderSign=!0,i={signedContent:e.content,inn:e.inn,pnfl:e.pnfl},a.t0=t.$route.name,a.next="CommissionInvokeLetterSign"===a.t0?5:7;break;case 5:return d["a"].makeSignedInvokeLetter(i,t.$route.params.projectId,t.$route.params.letterId,t.employee.id,t.employee.comment,t.x,t.y,t.currentPage-1).then(Object(r["a"])(Object(s["a"])().mark((function e(){return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:Object(c["v"])(t.$t("successDocSigned")),t.$router.push("/projects/commission");case 2:case"end":return e.stop()}}),e)})))).catch((function(e){})).finally((function(){t.loaderSign=!1})),a.abrupt("break",7);case 7:case"end":return a.stop()}}),a)})))()},getByIdLetter:function(){var e=this;d["a"].getByIdLetter(this.$route.params.letterId).then((function(t){if(e.currentDoc=t.data,"pdf"===e.currentDoc.fileType.toLowerCase())return e.nextTick(e.currentDoc.url);e.loaderPdf=!0,e.convertToPdf(t.data).then((function(a){a?(e.nextTick(a),e.loaderPdf=!1):setTimeout((function(){e.convertToPdf(t.data).then((function(t){e.nextTick(t),e.loaderPdf=!1})).catch((function(t){e.loaderPdf=!1}))}),4e3)}))})).catch((function(e){}))},nextTick:function(e){var t=this;this.$nextTick((function(){t.src=l["a"].createLoadingTask("".concat(t.baseUrl,"/").concat(e))}))},keyUpEvents:function(e){46==e.keyCode&&this.currentPage==this.qrCodePage&&this.deleteQrPosition?(this.imgUrl=null,this.qrCodePage=null,this.deleteQrPosition=!1):39==e.keyCode&&this.currentPage!=this.numPages&&this.src?this.currentPage++:37==e.keyCode&&this.currentPage>1&&this.src&&this.currentPage--},setCurrentPage:function(e){this.currentPage=e},resize:function(e){this.width=e.width,this.height=e.height,this.y=e.top,this.x=e.left},getPdf:function(){var e=this;return new Promise((function(t,a){e.convertToPdf(),d["a"].getDocPdf(e.$route.params.letterId).then((function(a){var i=a.data;e.$nextTick((function(){e.src=l["a"].createLoadingTask("data:application/pdf;base64, ".concat(i))})),t(a.data)})).catch((function(e){a(e)})).finally((function(){setTimeout((function(){e.loaderPdf=!1}),500)}))}))},signData:function(){var e=this;this.src?this.qrCodePage&&this.imgUrl?Object(c["u"])(this.$t("qrcodeWaring")):(this.loaderQrCode=!0,d["a"].letterQRCODE(this.$route.params.letterId).then((function(t){t.data&&(e.qrCodePage=e.currentPage,e.imgUrl=t.data)})).catch((function(e){})).finally((function(){e.loaderQrCode=!1}))):Object(c["u"])(this.$t("docNotUploaded"))},save:function(){if(!this.qrCodePage||!this.imgUrl||!this.src)return Object(c["u"])(this.$t("qrcodeNotFound"));switch(this.$route.name){case"CommissionInvokeLetterSign":this.employee.list.length||this.fetchEmployeeList(),this.employee.modal=!0;break}},fetchEmployeeList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!t&&this.employee.list.length)return a&&a&&"function"===typeof a?a(this.employee.list):this.employee.list;this.employee.interval&&clearInterval(this.employee.interval),this.employee.interval=setInterval((function(){u["a"].searchListWithKeyword("/employee",Object(n["a"])(Object(n["a"])({},e.var_default_search_payload),{},{keyword:t}),"inner").then((function(t){if(e.employee.list=t.data.list,a&&"function"===typeof a)return a(t.data)})).catch((function(e){console.log(e)})).finally((function(){clearInterval(e.employee.interval)}))}),500)}}},g=p,y=(a("0641"),a("2877")),v=Object(y["a"])(g,i,o,!1,null,null,null);t["default"]=v.exports}}]);