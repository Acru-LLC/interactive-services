(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-78a72bff"],{"3ffd":function(t,e,a){"use strict";a.r(e);var r=a("8468"),o=(a("d81d"),a("a4d3"),a("e01a"),function(){var t=this,e=t._self._c;return e("base-create-or-update-wrapper",{attrs:{"custom-title":t.$t("actions.confirm"),"has-save-suspend":""},on:{save:t.save}},[e("ValidationObserver",{ref:"observer",scopedSlots:t._u([{key:"default",fn:function(a){return Object(r["a"])(a),[e("b-row",{staticClass:"mb-3"},[e("b-col",{attrs:{md:"5",sm:"12"}},[e("div",{staticClass:"d-flex justify-content-between flex-row align-items-end"},[e("div",{staticClass:"w-100"},[e("base-multiselect-with-validation",{staticClass:"required",attrs:{required:"","label-on-top":"","preserve-search":"","with-create-addition":"",rules:"required","open-direction":"bottom","max-height":600,searchable:!0,"show-labels":!1,"custom-styles":{display:"block"},"clear-on-select":!1,"internal-search":!1,loading:t.isLoadingContractors,label:t.$t("column.contractor"),"custom-label":t.customLabelContractor,placeholder:t.$t("column.contractor"),options:t.contractors.map((function(t){return t.id})),"has-next-page":t.hasNextPageContractors},on:{"search-change":t.debounceSearchContractors,reachedEndOfList:t.contractorReachedEndOfList},model:{value:t.form.contractorId,callback:function(e){t.$set(t.form,"contractorId",e)},expression:"form.contractorId"}})],1),e("b-button",{staticStyle:{padding:"2.5px 10px","font-size":"1.2rem"},attrs:{variant:"outline-info",id:"contractorSearchButton"},on:{click:function(e){t.contractorCreateModal=!0}}},[e("i",{staticClass:"mdi mdi-plus-circle"})])],1),e("br"),e("base-input-with-validation",{staticClass:"required",attrs:{required:"",rules:"required","label-on-top":"",label:t.$t("column.ad_construction_passport_number")},model:{value:t.form.passportNumber,callback:function(e){t.$set(t.form,"passportNumber",e)},expression:"form.passportNumber"}}),e("br"),e("base-date-picker-with-validation",{staticClass:"required",attrs:{required:"",rules:"required",format:"DD.MM.YYYY","label-on-top":"",label:t.$t("column.ad_construction_passport_given_date"),"custom-styles":{display:"block"}},model:{value:t.form.passportGivenDate,callback:function(e){t.$set(t.form,"passportGivenDate",e)},expression:"form.passportGivenDate"}}),e("br"),e("base-date-picker-with-validation",{staticClass:"required",attrs:{required:"",rules:"required",format:"DD.MM.YYYY","label-on-top":"",label:t.$t("column.ad_construction_passport_expire_date"),"custom-styles":{display:"block"}},model:{value:t.form.passportExpireDate,callback:function(e){t.$set(t.form,"passportExpireDate",e)},expression:"form.passportExpireDate"}}),e("br"),e("base-textarea-with-validation",{attrs:{"label-on-top":"",rows:"5",label:t.$t("column.comment")},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1),e("b-col",{attrs:{md:"7",sm:"12"}},[e("l-map",{ref:"mymap",attrs:{center:t.center,zoom:6},on:{click:t.addMarker}},[e("l-tile-layer",{attrs:{url:t.url,attribution:t.attribution}}),e("v-locatecontrol")],1)],1)],1),e("b-modal",{attrs:{id:"create-multiple-min-collections-modal-id",size:"xl",title:t.$t("column.contractor"),"title-class":"font-18","ok-title":t.$t("actions.save"),"ok-variant":"success","cancel-title":t.$t("actions.cancel"),"cancel-variant":"danger","no-close-on-backdrop":"","no-close-on-esc":""},on:{ok:t.createContractor,cancel:function(e){return t.fetchContractorsWithKeyword("",!1,!0)}},model:{value:t.contractorCreateModal,callback:function(e){t.contractorCreateModal=e},expression:"contractorCreateModal"}},[e("CreateFormContractor",{ref:"createFormContractor",attrs:{"custom-is-mode-create":!0},on:{saved:t.contractorSaved}})],1)]}}])})],1)}),n=[],c=a("2909"),s=a("c7eb"),i=a("1da1"),l=(a("14d9"),a("d3b7"),a("7db0"),a("4325")),u=a("03f4"),d=a("f2db"),m=a("ac15"),p=a("42f3"),f=a("daa7"),h=a("e977"),b=a.n(h),v=a("2699"),g=a("a40a"),w=a("e11e"),C=a.n(w),y=(a("33d1"),"e-auction-info"),_=C.a.Icon.extend({options:{shadowUrl:null,iconAnchor:new C.a.Point(12,30),iconSize:new C.a.Point(24,30),iconUrl:a("4fad0")}}),k={name:"Confirm",components:{BaseDatePickerWithValidation:f["default"],BaseTextareaWithValidation:p["default"],BaseInputWithValidation:m["default"],CreateFormContractor:l["default"],LMap:v["a"],LTileLayer:g["a"],"v-locatecontrol":b.a},data:function(){return{center:C.a.latLng(41.381166,64.5735819),map:null,marker:null,url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://osm.org/copyright">OSM</a>',item:null,hasNextPageContractors:!1,isLoadingContractors:!1,contractorCreateModal:!1,contractors:[],contractorSearchPayload:{itemsPerPage:10},debounce:!1,form:{eAuctionInfoId:null,contractorId:null,passportNumber:null,passportGivenDate:null,passportExpireDate:null,description:"",latNumber:null,lngNumber:null},statuses:[]}},computed:{viewItems:function(){var t=[];if(!this.item)return t;for(var e in this.item)this.labels[e]&&t.push({label:this.labels[e],value:this.item[e]});return t},labels:function(){return{address:this.$t("submodules.integration.e_auction_info.address"),area:this.$t("submodules.integration.e_auction_info.area"),lot:this.$t("submodules.integration.e_auction_info.lot"),over_time:this.$t("submodules.integration.e_auction_info.over_time"),price:this.$t("submodules.integration.e_auction_info.price"),property:this.$t("submodules.integration.e_auction_info.property"),region:this.$t("submodules.integration.e_auction_info.region"),win_amount:this.$t("submodules.integration.e_auction_info.win_amount"),winner:this.$t("submodules.integration.e_auction_info.winner")}},computedObserver:function(){return this.$refs.observer}},methods:{contractorSaved:function(t){var e=this;return Object(i["a"])(Object(s["a"])().mark((function t(){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.contractorCreateModal=!1,e.contractorNotFound=!1,t.next=4,e.fetchContractorsWithKeyword("",!0);case 4:case"end":return t.stop()}}),t)})))()},createContractor:function(t){t.preventDefault(),this.$refs.createFormContractor.save()},addMarker:function(t){this.marker&&this.map.removeLayer(this.marker),t.latlng.lat&&t.latlng.lng&&(this.form.latNumber=t.latlng.lat,this.form.lngNumber=t.latlng.lng,this.marker=new C.a.Marker(t.latlng,{icon:new _}).addTo(this.map))},getById:function(){var t=this;return Object(i["a"])(Object(s["a"])().mark((function e(){var a;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.form.eAuctionInfoId,e.next=3,d["a"].get(y+"/get/"+a,!0).then((function(e){t.item=e.data}));case 3:case"end":return e.stop()}}),e)})))()},contractorReachedEndOfList:function(t){t&&!this.isLoadingContractors&&this.fetchContractors()},debounceSearchContractors:function(t){var e=this;return Object(i["a"])(Object(s["a"])().mark((function a(){return Object(s["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:clearTimeout(e.debounce),e.debounce=setTimeout(Object(i["a"])(Object(s["a"])().mark((function a(){return Object(s["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.fetchContractorsWithKeyword(t);case 2:case"end":return a.stop()}}),a)}))),1e3);case 2:case"end":return a.stop()}}),a)})))()},fetchContractorsWithKeyword:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.contractors=[],this.contractorSearchPayload.page=1,this.contractorSearchPayload.keyword=t||"",this.fetchContractors(e)},fetchContractors:function(t){var e=this;return Object(i["a"])(Object(s["a"])().mark((function a(){return Object(s["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.isLoadingContractors=!0,a.next=3,u["a"].searchListWithKeyword("contractor",e.contractorSearchPayload,"by-contractor",!e.customIsModeCreate).then((function(a){var r;(r=e.contractors).push.apply(r,Object(c["a"])(a.data.list)),e.hasNextPageContractors=a.data.total/e.contractorSearchPayload.itemsPerPage>e.contractorSearchPayload.page,e.contractorSearchPayload.page+=1,t&&(e.editingItem.parentId=e.contractors.length?e.contractors[0].id:null)})).catch((function(t){console.log(t),e.contractors=[]})).finally((function(){e.isLoadingContractors=!1}));case 3:case"end":return a.stop()}}),a)})))()},customLabelContractor:function(t){var e=this.contractors.find((function(e){return e.id===t}));return e?"".concat(e.fullName):""},save:function(){var t=this;this.computedObserver.validate().then((function(e){t.form.latNumber&&t.form.lngNumber?e?d["a"].post(y+"/confirm",t.form,!0).then((function(e){t.computedObserver.reset(),t.form={eAuctionInfoId:null,contractorId:null},t.$router.go(-1),t.$toast(t.$t("messages.saved_successfully"),{type:"success"})})):t.$toast(t.$t("messages.fill_required_fields"),{type:"error"}):t.$toast(t.$t("messages.pls_select_place_in_map"),{type:"error"})}))}},created:function(){var t=this;return Object(i["a"])(Object(s["a"])().mark((function e(){return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.form.eAuctionInfoId=t.$route.params.id,e.next=3,t.getById();case 3:setTimeout((function(){if(t.$refs.mymap.mapObject.invalidateSize(),t.map=t.$refs.mymap.mapObject,t.fetchContractorsWithKeyword(""),t.item.lat&&t.item.lng){var e={lat:t.item.lat,lng:t.item.lng};t.addMarker({latlng:e}),t.map.setView([e.lat,e.lng],14)}}),500);case 4:case"end":return e.stop()}}),e)})))()}},x=k,$=(a("d33c"),a("2877")),O=Object($["a"])(x,o,n,!1,null,"427cb794",null);e["default"]=O.exports},5506:function(t,e,a){},d33c:function(t,e,a){"use strict";a("5506")}}]);